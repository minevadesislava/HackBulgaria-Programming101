<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>hsSyn/HsExpr.lhs</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
%
% (c) The University of Glasgow 2006
% (c) The GRASP/AQUA Project, Glasgow University, 1992-1998
%
\begin{code}
<pre><a name="line-1"></a><span class='hs-comment'>{-# LANGUAGE DeriveDataTypeable, ScopedTypeVariables #-}</span>
<a name="line-2"></a>
<a name="line-3"></a><span class='hs-comment'>-- | Abstract Haskell syntax for expressions.</span>
<a name="line-4"></a><span class='hs-keyword'>module</span> <span class='hs-conid'>HsExpr</span> <span class='hs-keyword'>where</span>
<a name="line-5"></a>
<a name="line-6"></a><span class='hs-cpp'>#include "HsVersions.h"</span>
<a name="line-7"></a>
<a name="line-8"></a><span class='hs-comment'>-- friends:</span>
<a name="line-9"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>HsDecls</span>
<a name="line-10"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>HsPat</span>
<a name="line-11"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>HsLit</span>
<a name="line-12"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>HsTypes</span>
<a name="line-13"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>HsBinds</span>
<a name="line-14"></a>
<a name="line-15"></a><span class='hs-comment'>-- others:</span>
<a name="line-16"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>TcEvidence</span>
<a name="line-17"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>CoreSyn</span>
<a name="line-18"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Var</span>
<a name="line-19"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>RdrName</span>
<a name="line-20"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Name</span>
<a name="line-21"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>BasicTypes</span>
<a name="line-22"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>DataCon</span>
<a name="line-23"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>SrcLoc</span>
<a name="line-24"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Util</span>
<a name="line-25"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>StaticFlags</span><span class='hs-layout'>(</span> <span class='hs-varid'>opt_PprStyle_Debug</span> <span class='hs-layout'>)</span>
<a name="line-26"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Outputable</span>
<a name="line-27"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>FastString</span>
<a name="line-28"></a>
<a name="line-29"></a><span class='hs-comment'>-- libraries:</span>
<a name="line-30"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Data</span> <span class='hs-varid'>hiding</span> <span class='hs-layout'>(</span><span class='hs-conid'>Fixity</span><span class='hs-layout'>)</span>
</pre>\end{code}


%************************************************************************
%*                                                                      *
\subsection{Expressions proper}
%*                                                                      *
%************************************************************************

\begin{code}
<pre><a name="line-1"></a><span class='hs-comment'>-- * Expressions proper</span>
<a name="line-2"></a>
<a name="line-3"></a><a name="LHsExpr"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-4"></a>
<a name="line-5"></a><a name="PostTcExpr"></a><span class='hs-comment'>-------------------------</span>
<a name="line-6"></a><a name="PostTcExpr"></a><span class='hs-comment'>-- | PostTcExpr is an evidence expression attached to the syntax tree by the</span>
<a name="line-7"></a><a name="PostTcExpr"></a><span class='hs-comment'>-- type checker (c.f. postTcType).</span>
<a name="line-8"></a><a name="PostTcExpr"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>PostTcExpr</span>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HsExpr</span> <span class='hs-conid'>Id</span>
<a name="line-9"></a><a name="PostTcTable"></a><span class='hs-comment'>-- | We use a PostTcTable where there are a bunch of pieces of evidence, more</span>
<a name="line-10"></a><a name="PostTcTable"></a><span class='hs-comment'>-- than is convenient to keep individually.</span>
<a name="line-11"></a><a name="PostTcTable"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>PostTcTable</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>[</span><span class='hs-layout'>(</span><span class='hs-conid'>Name</span><span class='hs-layout'>,</span> <span class='hs-conid'>PostTcExpr</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-12"></a>
<a name="line-13"></a><a name="noPostTcExpr"></a><span class='hs-definition'>noPostTcExpr</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>PostTcExpr</span>
<a name="line-14"></a><span class='hs-definition'>noPostTcExpr</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HsLit</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsString</span> <span class='hs-layout'>(</span><span class='hs-varid'>fsLit</span> <span class='hs-str'>"noPostTcExpr"</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-15"></a>
<a name="line-16"></a><a name="noPostTcTable"></a><span class='hs-definition'>noPostTcTable</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>PostTcTable</span>
<a name="line-17"></a><span class='hs-definition'>noPostTcTable</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>[]</span>
<a name="line-18"></a>
<a name="line-19"></a><span class='hs-comment'>-------------------------</span>
<a name="line-20"></a><span class='hs-comment'>-- | SyntaxExpr is like 'PostTcExpr', but it's filled in a little earlier,</span>
<a name="line-21"></a><span class='hs-comment'>-- by the renamer.  It's used for rebindable syntax.</span>
<a name="line-22"></a><span class='hs-comment'>--</span>
<a name="line-23"></a><span class='hs-comment'>-- E.g. @(&gt;&gt;=)@ is filled in before the renamer by the appropriate 'Name' for</span>
<a name="line-24"></a><span class='hs-comment'>--      @(&gt;&gt;=)@, and then instantiated by the type checker with its type args</span>
<a name="line-25"></a><span class='hs-comment'>--      etc</span>
<a name="line-26"></a>
<a name="line-27"></a><a name="SyntaxExpr"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>SyntaxExpr</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HsExpr</span> <span class='hs-varid'>id</span>
<a name="line-28"></a>
<a name="line-29"></a><a name="noSyntaxExpr"></a><span class='hs-definition'>noSyntaxExpr</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SyntaxExpr</span> <span class='hs-varid'>id</span> <span class='hs-comment'>-- Before renaming, and sometimes after,</span>
<a name="line-30"></a>                              <span class='hs-comment'>-- (if the syntax slot makes no sense)</span>
<a name="line-31"></a><span class='hs-definition'>noSyntaxExpr</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HsLit</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsString</span> <span class='hs-layout'>(</span><span class='hs-varid'>fsLit</span> <span class='hs-str'>"noSyntaxExpr"</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-32"></a>
<a name="line-33"></a>
<a name="line-34"></a><a name="CmdSyntaxTable"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>CmdSyntaxTable</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>[</span><span class='hs-layout'>(</span><span class='hs-conid'>Name</span><span class='hs-layout'>,</span> <span class='hs-conid'>SyntaxExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-35"></a><span class='hs-comment'>-- See Note [CmdSyntaxTable]</span>
<a name="line-36"></a>
<a name="line-37"></a><a name="noSyntaxTable"></a><span class='hs-definition'>noSyntaxTable</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>CmdSyntaxTable</span> <span class='hs-varid'>id</span>
<a name="line-38"></a><span class='hs-definition'>noSyntaxTable</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>[]</span>
</pre>\end{code}

Note [CmdSyntaxtable]
~~~~~~~~~~~~~~~~~~~~~
Used only for arrow-syntax stuff (HsCmdTop), the CmdSyntaxTable keeps
track of the methods needed for a Cmd.

* Before the renamer, this list is 'noSyntaxTable'

* After the renamer, it takes the form @[(std_name, HsVar actual_name)]@
  For example, for the 'arr' method
   * normal case:            (GHC.Control.Arrow.arr, HsVar GHC.Control.Arrow.arr)
   * with rebindable syntax: (GHC.Control.Arrow.arr, arr_22)
             where @arr_22@ is whatever 'arr' is in scope

* After the type checker, it takes the form [(std_name, <expression>)]
  where <expression> is the evidence for the method.  This evidence is
  instantiated with the class, but is still polymorphic in everything
  else.  For example, in the case of 'arr', the evidence has type
         forall b c. (b->c) -> a b c
  where 'a' is the ambient type of the arrow.  This polymorphism is
  important because the desugarer uses the same evidence at multiple
  different types.

This is Less Cool than what we normally do for rebindable syntax, which is to
make fully-instantiated piece of evidence at every use site.  The Cmd way
is Less Cool because
  * The renamer has to predict which methods are needed.
    See the tedious RnExpr.methodNamesCmd.

  * The desugarer has to know the polymorphic type of the instantiated
    method. This is checked by Inst.tcSyntaxName, but is less flexible
    than the rest of rebindable syntax, where the type is less
    pre-ordained.  (And this flexibility is useful; for example we can
    typecheck do-notation with (>>=) :: m1 a -> (a -> m2 b) -> m2 b.)


\begin{code}
<pre><a name="line-1"></a><a name="HsExpr"></a><span class='hs-comment'>-- | A Haskell expression.</span>
<a name="line-2"></a><a name="HsExpr"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>HsExpr</span> <span class='hs-varid'>id</span>
<a name="line-3"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HsVar</span>     <span class='hs-varid'>id</span>                        <span class='hs-comment'>-- ^ Variable</span>
<a name="line-4"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsIPVar</span>   <span class='hs-conid'>HsIPName</span>                  <span class='hs-comment'>-- ^ Implicit parameter</span>
<a name="line-5"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsOverLit</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsOverLit</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>            <span class='hs-comment'>-- ^ Overloaded literals</span>
<a name="line-6"></a>
<a name="line-7"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsLit</span>     <span class='hs-conid'>HsLit</span>                     <span class='hs-comment'>-- ^ Simple (non-overloaded) literals</span>
<a name="line-8"></a>
<a name="line-9"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsLam</span>     <span class='hs-layout'>(</span><span class='hs-conid'>MatchGroup</span> <span class='hs-varid'>id</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- ^ Lambda abstraction. Currently always a single match</span>
<a name="line-10"></a>
<a name="line-11"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsLamCase</span> <span class='hs-conid'>PostTcType</span> <span class='hs-layout'>(</span><span class='hs-conid'>MatchGroup</span> <span class='hs-varid'>id</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- ^ Lambda-case</span>
<a name="line-12"></a>
<a name="line-13"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsApp</span>     <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- ^ Application</span>
<a name="line-14"></a>
<a name="line-15"></a>  <span class='hs-comment'>-- | Operator applications:</span>
<a name="line-16"></a>  <span class='hs-comment'>-- NB Bracketed ops such as (+) come out as Vars.</span>
<a name="line-17"></a>
<a name="line-18"></a>  <span class='hs-comment'>-- NB We need an expr for the operator in an OpApp/Section since</span>
<a name="line-19"></a>  <span class='hs-comment'>-- the typechecker may need to apply the operator to a few types.</span>
<a name="line-20"></a>
<a name="line-21"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>OpApp</span>       <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>    <span class='hs-comment'>-- left operand</span>
<a name="line-22"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>    <span class='hs-comment'>-- operator</span>
<a name="line-23"></a>                <span class='hs-conid'>Fixity</span>          <span class='hs-comment'>-- Renamer adds fixity; bottom until then</span>
<a name="line-24"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>    <span class='hs-comment'>-- right operand</span>
<a name="line-25"></a>
<a name="line-26"></a>  <span class='hs-comment'>-- | Negation operator. Contains the negated expression and the name</span>
<a name="line-27"></a>  <span class='hs-comment'>-- of 'negate'              </span>
<a name="line-28"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>NegApp</span>      <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span> 
<a name="line-29"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>SyntaxExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span> 
<a name="line-30"></a>
<a name="line-31"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsPar</span>       <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>    <span class='hs-comment'>-- ^ Parenthesised expr; see Note [Parens in HsSyn]</span>
<a name="line-32"></a>
<a name="line-33"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>SectionL</span>    <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>    <span class='hs-comment'>-- operand; see Note [Sections in HsSyn]</span>
<a name="line-34"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>    <span class='hs-comment'>-- operator</span>
<a name="line-35"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>SectionR</span>    <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>    <span class='hs-comment'>-- operator; see Note [Sections in HsSyn]</span>
<a name="line-36"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>    <span class='hs-comment'>-- operand</span>
<a name="line-37"></a>
<a name="line-38"></a>  <span class='hs-comment'>-- | Used for explicit tuples and sections thereof</span>
<a name="line-39"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ExplicitTuple</span>               
<a name="line-40"></a>        <span class='hs-keyglyph'>[</span><span class='hs-conid'>HsTupArg</span> <span class='hs-varid'>id</span><span class='hs-keyglyph'>]</span>
<a name="line-41"></a>        <span class='hs-conid'>Boxity</span>
<a name="line-42"></a>
<a name="line-43"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsCase</span>      <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-44"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>MatchGroup</span> <span class='hs-varid'>id</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-45"></a>
<a name="line-46"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsIf</span>        <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>SyntaxExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- cond function</span>
<a name="line-47"></a>                                        <span class='hs-comment'>-- Nothing =&gt; use the built-in 'if'</span>
<a name="line-48"></a>                                        <span class='hs-comment'>-- See Note [Rebindable if]</span>
<a name="line-49"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>    <span class='hs-comment'>--  predicate</span>
<a name="line-50"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>    <span class='hs-comment'>--  then part</span>
<a name="line-51"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>    <span class='hs-comment'>--  else part</span>
<a name="line-52"></a>
<a name="line-53"></a>  <span class='hs-comment'>-- | Multi-way if</span>
<a name="line-54"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsMultiIf</span>   <span class='hs-conid'>PostTcType</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LGRHS</span> <span class='hs-varid'>id</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span> 
<a name="line-55"></a>
<a name="line-56"></a>  <span class='hs-comment'>-- | let(rec)</span>
<a name="line-57"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsLet</span>       <span class='hs-layout'>(</span><span class='hs-conid'>HsLocalBinds</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span> 
<a name="line-58"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span>  <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-59"></a>
<a name="line-60"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsDo</span>        <span class='hs-layout'>(</span><span class='hs-conid'>HsStmtContext</span> <span class='hs-conid'>Name</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- The parameterisation is unimportant</span>
<a name="line-61"></a>                                     <span class='hs-comment'>-- because in this context we never use</span>
<a name="line-62"></a>                                     <span class='hs-comment'>-- the PatGuard or ParStmt variant</span>
<a name="line-63"></a>                <span class='hs-keyglyph'>[</span><span class='hs-conid'>ExprLStmt</span> <span class='hs-varid'>id</span><span class='hs-keyglyph'>]</span>       <span class='hs-comment'>-- "do":one or more stmts</span>
<a name="line-64"></a>                <span class='hs-conid'>PostTcType</span>           <span class='hs-comment'>-- Type of the whole expression</span>
<a name="line-65"></a>
<a name="line-66"></a>  <span class='hs-comment'>-- | Syntactic list: [a,b,c,...]</span>
<a name="line-67"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ExplicitList</span>                        
<a name="line-68"></a>                <span class='hs-conid'>PostTcType</span>              <span class='hs-comment'>-- Gives type of components of list</span>
<a name="line-69"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>SyntaxExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- For OverloadedLists, the fromListN witness</span>
<a name="line-70"></a>                <span class='hs-keyglyph'>[</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-keyglyph'>]</span>
<a name="line-71"></a>
<a name="line-72"></a>  <span class='hs-comment'>-- | Syntactic parallel array: [:e1, ..., en:]</span>
<a name="line-73"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ExplicitPArr</span>                
<a name="line-74"></a>                <span class='hs-conid'>PostTcType</span>      <span class='hs-comment'>-- type of elements of the parallel array</span>
<a name="line-75"></a>                <span class='hs-keyglyph'>[</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-keyglyph'>]</span>
<a name="line-76"></a>
<a name="line-77"></a>  <span class='hs-comment'>-- | Record construction</span>
<a name="line-78"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>RecordCon</span>   <span class='hs-layout'>(</span><span class='hs-conid'>Located</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>       <span class='hs-comment'>-- The constructor.  After type checking</span>
<a name="line-79"></a>                                   <span class='hs-comment'>-- it's the dataConWrapId of the constructor</span>
<a name="line-80"></a>                <span class='hs-conid'>PostTcExpr</span>         <span class='hs-comment'>-- Data con Id applied to type args</span>
<a name="line-81"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>HsRecordBinds</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-82"></a>
<a name="line-83"></a>  <span class='hs-comment'>-- | Record update</span>
<a name="line-84"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>RecordUpd</span>   <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-85"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>HsRecordBinds</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-86"></a><span class='hs-comment'>--              (HsMatchGroup Id)  -- Filled in by the type checker to be</span>
<a name="line-87"></a><span class='hs-comment'>--                                 -- a match that does the job</span>
<a name="line-88"></a>                <span class='hs-keyglyph'>[</span><span class='hs-conid'>DataCon</span><span class='hs-keyglyph'>]</span>          <span class='hs-comment'>-- Filled in by the type checker to the</span>
<a name="line-89"></a>                                   <span class='hs-comment'>-- _non-empty_ list of DataCons that have</span>
<a name="line-90"></a>                                   <span class='hs-comment'>-- all the upd'd fields</span>
<a name="line-91"></a>                <span class='hs-keyglyph'>[</span><span class='hs-conid'>PostTcType</span><span class='hs-keyglyph'>]</span>       <span class='hs-comment'>-- Argument types of *input* record type</span>
<a name="line-92"></a>                <span class='hs-keyglyph'>[</span><span class='hs-conid'>PostTcType</span><span class='hs-keyglyph'>]</span>       <span class='hs-comment'>--              and  *output* record type</span>
<a name="line-93"></a>  <span class='hs-comment'>-- For a type family, the arg types are of the *instance* tycon,</span>
<a name="line-94"></a>  <span class='hs-comment'>-- not the family tycon</span>
<a name="line-95"></a>
<a name="line-96"></a>  <span class='hs-comment'>-- | Expression with an explicit type signature. @e :: type@  </span>
<a name="line-97"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ExprWithTySig</span>                       
<a name="line-98"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-99"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>LHsType</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-100"></a>
<a name="line-101"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ExprWithTySigOut</span>                    <span class='hs-comment'>-- TRANSLATION</span>
<a name="line-102"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-103"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>LHsType</span> <span class='hs-conid'>Name</span><span class='hs-layout'>)</span>          <span class='hs-comment'>-- Retain the signature for</span>
<a name="line-104"></a>                                        <span class='hs-comment'>-- round-tripping purposes</span>
<a name="line-105"></a>
<a name="line-106"></a>  <span class='hs-comment'>-- | Arithmetic sequence</span>
<a name="line-107"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ArithSeq</span>                            
<a name="line-108"></a>                <span class='hs-conid'>PostTcExpr</span>
<a name="line-109"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>SyntaxExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>   <span class='hs-comment'>-- For OverloadedLists, the fromList witness</span>
<a name="line-110"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>ArithSeqInfo</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-111"></a>
<a name="line-112"></a>  <span class='hs-comment'>-- | Arithmetic sequence for parallel array</span>
<a name="line-113"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>PArrSeq</span>                             
<a name="line-114"></a>                <span class='hs-conid'>PostTcExpr</span>              <span class='hs-comment'>-- [:e1..e2:] or [:e1, e2..e3:]</span>
<a name="line-115"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>ArithSeqInfo</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-116"></a>
<a name="line-117"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsSCC</span>       <span class='hs-conid'>FastString</span>              <span class='hs-comment'>-- "set cost centre" SCC pragma</span>
<a name="line-118"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>            <span class='hs-comment'>-- expr whose cost is to be measured</span>
<a name="line-119"></a>
<a name="line-120"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsCoreAnn</span>   <span class='hs-conid'>FastString</span>              <span class='hs-comment'>-- hdaume: core annotation</span>
<a name="line-121"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-122"></a>
<a name="line-123"></a>  <span class='hs-comment'>-----------------------------------------------------------</span>
<a name="line-124"></a>  <span class='hs-comment'>-- MetaHaskell Extensions</span>
<a name="line-125"></a>
<a name="line-126"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsBracket</span>    <span class='hs-layout'>(</span><span class='hs-conid'>HsBracket</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-127"></a>
<a name="line-128"></a>    <span class='hs-comment'>-- See Note [Pending Splices]</span>
<a name="line-129"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsRnBracketOut</span>
<a name="line-130"></a>      <span class='hs-layout'>(</span><span class='hs-conid'>HsBracket</span> <span class='hs-conid'>Name</span><span class='hs-layout'>)</span>     <span class='hs-comment'>-- Output of the renamer is the *original* renamed</span>
<a name="line-131"></a>                           <span class='hs-comment'>-- expression, plus</span>
<a name="line-132"></a>      <span class='hs-keyglyph'>[</span><span class='hs-conid'>PendingRnSplice</span><span class='hs-keyglyph'>]</span>    <span class='hs-comment'>-- _renamed_ splices to be type checked</span>
<a name="line-133"></a>
<a name="line-134"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsTcBracketOut</span>
<a name="line-135"></a>      <span class='hs-layout'>(</span><span class='hs-conid'>HsBracket</span> <span class='hs-conid'>Name</span><span class='hs-layout'>)</span>     <span class='hs-comment'>-- Output of the type checker is the *original*</span>
<a name="line-136"></a>                           <span class='hs-comment'>-- renamed expression, plus</span>
<a name="line-137"></a>      <span class='hs-keyglyph'>[</span><span class='hs-conid'>PendingTcSplice</span><span class='hs-keyglyph'>]</span>    <span class='hs-comment'>-- _typechecked_ splices to be</span>
<a name="line-138"></a>                           <span class='hs-comment'>-- pasted back in by the desugarer</span>
<a name="line-139"></a>
<a name="line-140"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsSpliceE</span>    <span class='hs-conid'>Bool</span>                   <span class='hs-comment'>-- True &lt;=&gt; typed splice</span>
<a name="line-141"></a>                 <span class='hs-layout'>(</span><span class='hs-conid'>HsSplice</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>          <span class='hs-comment'>-- False &lt;=&gt; untyped</span>
<a name="line-142"></a>
<a name="line-143"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsQuasiQuoteE</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsQuasiQuote</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-144"></a>        <span class='hs-comment'>-- See Note [Quasi-quote overview] in TcSplice</span>
<a name="line-145"></a>
<a name="line-146"></a>  <span class='hs-comment'>-----------------------------------------------------------</span>
<a name="line-147"></a>  <span class='hs-comment'>-- Arrow notation extension</span>
<a name="line-148"></a>
<a name="line-149"></a>  <span class='hs-comment'>-- | @proc@ notation for Arrows</span>
<a name="line-150"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsProc</span>      <span class='hs-layout'>(</span><span class='hs-conid'>LPat</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>               <span class='hs-comment'>-- arrow abstraction, proc</span>
<a name="line-151"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>LHsCmdTop</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>          <span class='hs-comment'>-- body of the abstraction</span>
<a name="line-152"></a>                                        <span class='hs-comment'>-- always has an empty stack</span>
<a name="line-153"></a>
<a name="line-154"></a>  <span class='hs-comment'>---------------------------------------</span>
<a name="line-155"></a>  <span class='hs-comment'>-- The following are commands, not expressions proper</span>
<a name="line-156"></a>  <span class='hs-comment'>-- They are only used in the parsing stage and are removed</span>
<a name="line-157"></a>  <span class='hs-comment'>--    immediately in parser.RdrHsSyn.checkCommand</span>
<a name="line-158"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsArrApp</span>            <span class='hs-comment'>-- Arrow tail, or arrow application (f -&lt; arg)</span>
<a name="line-159"></a>        <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>    <span class='hs-comment'>-- arrow expression, f</span>
<a name="line-160"></a>        <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>    <span class='hs-comment'>-- input expression, arg</span>
<a name="line-161"></a>        <span class='hs-conid'>PostTcType</span>      <span class='hs-comment'>-- type of the arrow expressions f,</span>
<a name="line-162"></a>                        <span class='hs-comment'>-- of the form a t t', where arg :: t</span>
<a name="line-163"></a>        <span class='hs-conid'>HsArrAppType</span>    <span class='hs-comment'>-- higher-order (-&lt;&lt;) or first-order (-&lt;)</span>
<a name="line-164"></a>        <span class='hs-conid'>Bool</span>            <span class='hs-comment'>-- True =&gt; right-to-left (f -&lt; arg)</span>
<a name="line-165"></a>                        <span class='hs-comment'>-- False =&gt; left-to-right (arg &gt;- f)</span>
<a name="line-166"></a>
<a name="line-167"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsArrForm</span>           <span class='hs-comment'>-- Command formation,  (| e cmd1 .. cmdn |)</span>
<a name="line-168"></a>        <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>    <span class='hs-comment'>-- the operator</span>
<a name="line-169"></a>                        <span class='hs-comment'>-- after type-checking, a type abstraction to be</span>
<a name="line-170"></a>                        <span class='hs-comment'>-- applied to the type of the local environment tuple</span>
<a name="line-171"></a>        <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-conid'>Fixity</span><span class='hs-layout'>)</span>  <span class='hs-comment'>-- fixity (filled in by the renamer), for forms that</span>
<a name="line-172"></a>                        <span class='hs-comment'>-- were converted from OpApp's by the renamer</span>
<a name="line-173"></a>        <span class='hs-keyglyph'>[</span><span class='hs-conid'>LHsCmdTop</span> <span class='hs-varid'>id</span><span class='hs-keyglyph'>]</span>  <span class='hs-comment'>-- argument commands</span>
<a name="line-174"></a>
<a name="line-175"></a>  <span class='hs-comment'>---------------------------------------</span>
<a name="line-176"></a>  <span class='hs-comment'>-- Haskell program coverage (Hpc) Support</span>
<a name="line-177"></a>
<a name="line-178"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsTick</span>
<a name="line-179"></a>     <span class='hs-layout'>(</span><span class='hs-conid'>Tickish</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-180"></a>     <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>                       <span class='hs-comment'>-- sub-expression</span>
<a name="line-181"></a>
<a name="line-182"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsBinTick</span>
<a name="line-183"></a>     <span class='hs-conid'>Int</span>                                <span class='hs-comment'>-- module-local tick number for True</span>
<a name="line-184"></a>     <span class='hs-conid'>Int</span>                                <span class='hs-comment'>-- module-local tick number for False</span>
<a name="line-185"></a>     <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>                       <span class='hs-comment'>-- sub-expression</span>
<a name="line-186"></a>
<a name="line-187"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsTickPragma</span>                        <span class='hs-comment'>-- A pragma introduced tick</span>
<a name="line-188"></a>     <span class='hs-layout'>(</span><span class='hs-conid'>FastString</span><span class='hs-layout'>,</span><span class='hs-layout'>(</span><span class='hs-conid'>Int</span><span class='hs-layout'>,</span><span class='hs-conid'>Int</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span><span class='hs-layout'>(</span><span class='hs-conid'>Int</span><span class='hs-layout'>,</span><span class='hs-conid'>Int</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>   <span class='hs-comment'>-- external span for this tick</span>
<a name="line-189"></a>     <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-190"></a>
<a name="line-191"></a>  <span class='hs-comment'>---------------------------------------</span>
<a name="line-192"></a>  <span class='hs-comment'>-- These constructors only appear temporarily in the parser.</span>
<a name="line-193"></a>  <span class='hs-comment'>-- The renamer translates them into the Right Thing.</span>
<a name="line-194"></a>
<a name="line-195"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>EWildPat</span>                 <span class='hs-comment'>-- wildcard</span>
<a name="line-196"></a>
<a name="line-197"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>EAsPat</span>      <span class='hs-layout'>(</span><span class='hs-conid'>Located</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- as pattern</span>
<a name="line-198"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-199"></a>
<a name="line-200"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>EViewPat</span>    <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- view pattern</span>
<a name="line-201"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-202"></a>
<a name="line-203"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ELazyPat</span>    <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- ~ pattern</span>
<a name="line-204"></a>
<a name="line-205"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsType</span>      <span class='hs-layout'>(</span><span class='hs-conid'>LHsType</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- Explicit type argument; e.g  f {| Int |} x y</span>
<a name="line-206"></a>
<a name="line-207"></a>  <span class='hs-comment'>---------------------------------------</span>
<a name="line-208"></a>  <span class='hs-comment'>-- Finally, HsWrap appears only in typechecker output</span>
<a name="line-209"></a>
<a name="line-210"></a>  <span class='hs-keyglyph'>|</span>  <span class='hs-conid'>HsWrap</span>     <span class='hs-conid'>HsWrapper</span>    <span class='hs-comment'>-- TRANSLATION</span>
<a name="line-211"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>HsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-212"></a>  <span class='hs-keyglyph'>|</span>  <span class='hs-conid'>HsUnboundVar</span> <span class='hs-conid'>RdrName</span>
<a name="line-213"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Data</span><span class='hs-layout'>,</span> <span class='hs-conid'>Typeable</span><span class='hs-layout'>)</span>
<a name="line-214"></a>
<a name="line-215"></a><a name="HsTupArg"></a><span class='hs-comment'>-- | HsTupArg is used for tuple sections</span>
<a name="line-216"></a><a name="HsTupArg"></a><span class='hs-comment'>--  (,a,) is represented by  ExplicitTuple [Mising ty1, Present a, Missing ty3]</span>
<a name="line-217"></a><a name="HsTupArg"></a><span class='hs-comment'>--  Which in turn stands for (\x:ty1 \y:ty2. (x,a,y))</span>
<a name="line-218"></a><a name="HsTupArg"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>HsTupArg</span> <span class='hs-varid'>id</span>
<a name="line-219"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Present</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>        <span class='hs-comment'>-- ^ The argument</span>
<a name="line-220"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Missing</span> <span class='hs-conid'>PostTcType</span>          <span class='hs-comment'>-- ^ The argument is missing, but this is its type</span>
<a name="line-221"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Data</span><span class='hs-layout'>,</span> <span class='hs-conid'>Typeable</span><span class='hs-layout'>)</span>
<a name="line-222"></a>
<a name="line-223"></a><a name="tupArgPresent"></a><span class='hs-definition'>tupArgPresent</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsTupArg</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-224"></a><span class='hs-definition'>tupArgPresent</span> <span class='hs-layout'>(</span><span class='hs-conid'>Present</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-225"></a><span class='hs-definition'>tupArgPresent</span> <span class='hs-layout'>(</span><span class='hs-conid'>Missing</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-226"></a>
<a name="line-227"></a><a name="PendingRnSplice"></a><span class='hs-comment'>-- See Note [Pending Splices]</span>
<a name="line-228"></a><a name="PendingRnSplice"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>PendingRnSplice</span>
<a name="line-229"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>PendingRnExpSplice</span>        <span class='hs-layout'>(</span><span class='hs-conid'>HsSplice</span> <span class='hs-conid'>Name</span><span class='hs-layout'>)</span>
<a name="line-230"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>PendingRnPatSplice</span>        <span class='hs-layout'>(</span><span class='hs-conid'>HsSplice</span> <span class='hs-conid'>Name</span><span class='hs-layout'>)</span>
<a name="line-231"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>PendingRnTypeSplice</span>       <span class='hs-layout'>(</span><span class='hs-conid'>HsSplice</span> <span class='hs-conid'>Name</span><span class='hs-layout'>)</span>
<a name="line-232"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>PendingRnDeclSplice</span>       <span class='hs-layout'>(</span><span class='hs-conid'>HsSplice</span> <span class='hs-conid'>Name</span><span class='hs-layout'>)</span>
<a name="line-233"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>PendingRnCrossStageSplice</span> <span class='hs-conid'>Name</span>
<a name="line-234"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Data</span><span class='hs-layout'>,</span> <span class='hs-conid'>Typeable</span><span class='hs-layout'>)</span>
<a name="line-235"></a>
<a name="line-236"></a><a name="PendingTcSplice"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>PendingTcSplice</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-conid'>Name</span><span class='hs-layout'>,</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-conid'>Id</span><span class='hs-layout'>)</span>
</pre>\end{code}

Note [Pending Splices]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Now that untyped brackets are not type checked, we need a mechanism to ensure
that splices contained in untyped brackets *are* type checked. Therefore the
renamer now renames every HsBracket into a HsRnBracketOut, which contains the
splices that need to be type checked. There are four varieties of pending
splices generated by the renamer:

 * Pending expression splices (PendingRnExpSplice), e.g.,

   [|$(f x) + 2|]

 * Pending pattern splices (PendingRnPatSplice), e.g.,

   [|\ $(f x) -> x|]

 * Pending type splices (PendingRnTypeSplice), e.g.,

   [|f :: $(g x)|]

 * Pending cross-stage splices (PendingRnCrossStageSplice), e.g.,

   \x -> [| x |]

There is a fifth variety of pending splice, which is generated by the type
checker:

  * Pending *typed* expression splices, (PendingTcSplice), e.g.,

    [||1 + $$(f 2)||]

It would be possible to eliminate HsRnBracketOut and use HsBracketOut for the
output of the renamer. However, when pretty printing the output of the renamer,
e.g., in a type error message, we *do not* want to print out the pending
splices. In contrast, when pretty printing the output of the type checker, we
*do* want to print the pending splices. So splitting them up seems to make
sense, although I hate to add another constructor to HsExpr.

Note [Parens in HsSyn]
~~~~~~~~~~~~~~~~~~~~~~
HsPar (and ParPat in patterns, HsParTy in types) is used as follows

  * Generally HsPar is optional; the pretty printer adds parens where
    necessary.  Eg (HsApp f (HsApp g x)) is fine, and prints 'f (g x)'

  * HsPars are pretty printed as '( .. )' regardless of whether
    or not they are strictly necssary

  * HsPars are respected when rearranging operator fixities.
    So   a * (b + c)  means what it says (where the parens are an HsPar)

Note [Sections in HsSyn]
~~~~~~~~~~~~~~~~~~~~~~~~
Sections should always appear wrapped in an HsPar, thus
         HsPar (SectionR ...)
The parser parses sections in a wider variety of situations
(See Note [Parsing sections]), but the renamer checks for those
parens.  This invariant makes pretty-printing easier; we don't need
a special case for adding the parens round sections.

Note [Rebindable if]
~~~~~~~~~~~~~~~~~~~~
The rebindable syntax for 'if' is a bit special, because when
rebindable syntax is *off* we do not want to treat
   (if c then t else e)
as if it was an application (ifThenElse c t e).  Why not?
Because we allow an 'if' to return *unboxed* results, thus
  if blah then 3# else 4#
whereas that would not be possible using a all to a polymorphic function
(because you can't call a polymorphic function at an unboxed type).

So we use Nothing to mean "use the old built-in typing rule".

\begin{code}
<pre><a name="line-1"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Outputable</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-2"></a>    <span class='hs-varid'>ppr</span> <span class='hs-varid'>expr</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprExpr</span> <span class='hs-varid'>expr</span>
</pre>\end{code}

\begin{code}
<pre><a name="line-1"></a><a name="pprLExpr"></a><span class='hs-comment'>-----------------------</span>
<a name="line-2"></a><span class='hs-comment'>-- pprExpr, pprLExpr, pprBinds call pprDeeper;</span>
<a name="line-3"></a><span class='hs-comment'>-- the underscore versions do not</span>
<a name="line-4"></a><span class='hs-definition'>pprLExpr</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-5"></a><span class='hs-definition'>pprLExpr</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprExpr</span> <span class='hs-varid'>e</span>
<a name="line-6"></a>
<a name="line-7"></a><a name="pprExpr"></a><span class='hs-definition'>pprExpr</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HsExpr</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-8"></a><span class='hs-definition'>pprExpr</span> <span class='hs-varid'>e</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>isAtomicHsExpr</span> <span class='hs-varid'>e</span> <span class='hs-varop'>||</span> <span class='hs-varid'>isQuietHsExpr</span> <span class='hs-varid'>e</span> <span class='hs-keyglyph'>=</span>            <span class='hs-varid'>ppr_expr</span> <span class='hs-varid'>e</span>
<a name="line-9"></a>          <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>                           <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprDeeper</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr_expr</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>
<a name="line-10"></a>
<a name="line-11"></a><a name="isQuietHsExpr"></a><span class='hs-definition'>isQuietHsExpr</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsExpr</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-12"></a><span class='hs-comment'>-- Parentheses do display something, but it gives little info and</span>
<a name="line-13"></a><span class='hs-comment'>-- if we go deeper when we go inside them then we get ugly things</span>
<a name="line-14"></a><span class='hs-comment'>-- like (...)</span>
<a name="line-15"></a><span class='hs-definition'>isQuietHsExpr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsPar</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-16"></a><span class='hs-comment'>-- applications don't display anything themselves</span>
<a name="line-17"></a><span class='hs-definition'>isQuietHsExpr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsApp</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-18"></a><span class='hs-definition'>isQuietHsExpr</span> <span class='hs-layout'>(</span><span class='hs-conid'>OpApp</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-19"></a><span class='hs-definition'>isQuietHsExpr</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-20"></a>
<a name="line-21"></a><a name="pprBinds"></a><span class='hs-definition'>pprBinds</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>idL</span><span class='hs-layout'>,</span> <span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>idR</span><span class='hs-layout'>)</span>
<a name="line-22"></a>         <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HsLocalBindsLR</span> <span class='hs-varid'>idL</span> <span class='hs-varid'>idR</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-23"></a><span class='hs-definition'>pprBinds</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprDeeper</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span>
<a name="line-24"></a>
<a name="line-25"></a><a name="ppr_lexpr"></a><span class='hs-comment'>-----------------------</span>
<a name="line-26"></a><span class='hs-definition'>ppr_lexpr</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-27"></a><span class='hs-definition'>ppr_lexpr</span> <span class='hs-varid'>e</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-varid'>unLoc</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>
<a name="line-28"></a>
<a name="line-29"></a><a name="ppr_expr"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>id</span><span class='hs-varop'>.</span> <span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HsExpr</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-30"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsVar</span> <span class='hs-varid'>v</span><span class='hs-layout'>)</span>       <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprPrefixOcc</span> <span class='hs-varid'>v</span>
<a name="line-31"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsIPVar</span> <span class='hs-varid'>v</span><span class='hs-layout'>)</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>v</span>
<a name="line-32"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsLit</span> <span class='hs-varid'>lit</span><span class='hs-layout'>)</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>lit</span>
<a name="line-33"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsOverLit</span> <span class='hs-varid'>lit</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>lit</span>
<a name="line-34"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsPar</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>       <span class='hs-keyglyph'>=</span> <span class='hs-varid'>parens</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr_lexpr</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>
<a name="line-35"></a>
<a name="line-36"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsCoreAnn</span> <span class='hs-varid'>s</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>
<a name="line-37"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>vcat</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"HsCoreAnn"</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ftext</span> <span class='hs-varid'>s</span><span class='hs-layout'>,</span> <span class='hs-varid'>ppr_lexpr</span> <span class='hs-varid'>e</span><span class='hs-keyglyph'>]</span>
<a name="line-38"></a>
<a name="line-39"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsApp</span> <span class='hs-varid'>e1</span> <span class='hs-varid'>e2</span><span class='hs-layout'>)</span>
<a name="line-40"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>let</span> <span class='hs-layout'>(</span><span class='hs-varid'>fun</span><span class='hs-layout'>,</span> <span class='hs-varid'>args</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>collect_args</span> <span class='hs-varid'>e1</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>e2</span><span class='hs-keyglyph'>]</span> <span class='hs-keyword'>in</span>
<a name="line-41"></a>    <span class='hs-varid'>hang</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr_lexpr</span> <span class='hs-varid'>fun</span><span class='hs-layout'>)</span> <span class='hs-num'>2</span> <span class='hs-layout'>(</span><span class='hs-varid'>sep</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-varid'>pprParendExpr</span> <span class='hs-varid'>args</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-42"></a>  <span class='hs-keyword'>where</span>
<a name="line-43"></a>    <span class='hs-varid'>collect_args</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsApp</span> <span class='hs-varid'>fun</span> <span class='hs-varid'>arg</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varid'>args</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>collect_args</span> <span class='hs-varid'>fun</span> <span class='hs-layout'>(</span><span class='hs-varid'>arg</span><span class='hs-conop'>:</span><span class='hs-varid'>args</span><span class='hs-layout'>)</span>
<a name="line-44"></a>    <span class='hs-varid'>collect_args</span> <span class='hs-varid'>fun</span> <span class='hs-varid'>args</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>fun</span><span class='hs-layout'>,</span> <span class='hs-varid'>args</span><span class='hs-layout'>)</span>
<a name="line-45"></a>
<a name="line-46"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>OpApp</span> <span class='hs-varid'>e1</span> <span class='hs-varid'>op</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>e2</span><span class='hs-layout'>)</span>
<a name="line-47"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>unLoc</span> <span class='hs-varid'>op</span> <span class='hs-keyword'>of</span>
<a name="line-48"></a>      <span class='hs-conid'>HsVar</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>pp_infixly</span> <span class='hs-varid'>v</span>
<a name="line-49"></a>      <span class='hs-keyword'>_</span>       <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>pp_prefixly</span>
<a name="line-50"></a>  <span class='hs-keyword'>where</span>
<a name="line-51"></a>    <span class='hs-varid'>pp_e1</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprDebugParendExpr</span> <span class='hs-varid'>e1</span>   <span class='hs-comment'>-- In debug mode, add parens</span>
<a name="line-52"></a>    <span class='hs-varid'>pp_e2</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprDebugParendExpr</span> <span class='hs-varid'>e2</span>   <span class='hs-comment'>-- to make precedence clear</span>
<a name="line-53"></a>
<a name="line-54"></a>    <span class='hs-varid'>pp_prefixly</span>
<a name="line-55"></a>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hang</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>op</span><span class='hs-layout'>)</span> <span class='hs-num'>2</span> <span class='hs-layout'>(</span><span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>pp_e1</span><span class='hs-layout'>,</span> <span class='hs-varid'>pp_e2</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-56"></a>
<a name="line-57"></a>    <span class='hs-varid'>pp_infixly</span> <span class='hs-varid'>v</span>
<a name="line-58"></a>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>pp_e1</span><span class='hs-layout'>,</span> <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>pprInfixOcc</span> <span class='hs-varid'>v</span><span class='hs-layout'>,</span> <span class='hs-varid'>nest</span> <span class='hs-num'>2</span> <span class='hs-varid'>pp_e2</span><span class='hs-keyglyph'>]</span><span class='hs-keyglyph'>]</span>
<a name="line-59"></a>
<a name="line-60"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>NegApp</span> <span class='hs-varid'>e</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'-'</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>pprDebugParendExpr</span> <span class='hs-varid'>e</span>
<a name="line-61"></a>
<a name="line-62"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>SectionL</span> <span class='hs-varid'>expr</span> <span class='hs-varid'>op</span><span class='hs-layout'>)</span>
<a name="line-63"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>unLoc</span> <span class='hs-varid'>op</span> <span class='hs-keyword'>of</span>
<a name="line-64"></a>      <span class='hs-conid'>HsVar</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>pp_infixly</span> <span class='hs-varid'>v</span>
<a name="line-65"></a>      <span class='hs-keyword'>_</span>       <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>pp_prefixly</span>
<a name="line-66"></a>  <span class='hs-keyword'>where</span>
<a name="line-67"></a>    <span class='hs-varid'>pp_expr</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprDebugParendExpr</span> <span class='hs-varid'>expr</span>
<a name="line-68"></a>
<a name="line-69"></a>    <span class='hs-varid'>pp_prefixly</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hang</span> <span class='hs-layout'>(</span><span class='hs-varid'>hsep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>text</span> <span class='hs-str'>" \\ x_ -&gt;"</span><span class='hs-layout'>,</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>op</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-70"></a>                       <span class='hs-num'>4</span> <span class='hs-layout'>(</span><span class='hs-varid'>hsep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>pp_expr</span><span class='hs-layout'>,</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"x_ )"</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-71"></a>    <span class='hs-varid'>pp_infixly</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>pp_expr</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprInfixOcc</span> <span class='hs-varid'>v</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-72"></a>
<a name="line-73"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>SectionR</span> <span class='hs-varid'>op</span> <span class='hs-varid'>expr</span><span class='hs-layout'>)</span>
<a name="line-74"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>unLoc</span> <span class='hs-varid'>op</span> <span class='hs-keyword'>of</span>
<a name="line-75"></a>      <span class='hs-conid'>HsVar</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>pp_infixly</span> <span class='hs-varid'>v</span>
<a name="line-76"></a>      <span class='hs-keyword'>_</span>       <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>pp_prefixly</span>
<a name="line-77"></a>  <span class='hs-keyword'>where</span>
<a name="line-78"></a>    <span class='hs-varid'>pp_expr</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprDebugParendExpr</span> <span class='hs-varid'>expr</span>
<a name="line-79"></a>
<a name="line-80"></a>    <span class='hs-varid'>pp_prefixly</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hang</span> <span class='hs-layout'>(</span><span class='hs-varid'>hsep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>text</span> <span class='hs-str'>"( \\ x_ -&gt;"</span><span class='hs-layout'>,</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>op</span><span class='hs-layout'>,</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"x_"</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-81"></a>                       <span class='hs-num'>4</span> <span class='hs-layout'>(</span><span class='hs-varid'>pp_expr</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>rparen</span><span class='hs-layout'>)</span>
<a name="line-82"></a>    <span class='hs-varid'>pp_infixly</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>pprInfixOcc</span> <span class='hs-varid'>v</span><span class='hs-layout'>,</span> <span class='hs-varid'>pp_expr</span><span class='hs-keyglyph'>]</span>
<a name="line-83"></a>
<a name="line-84"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>ExplicitTuple</span> <span class='hs-varid'>exprs</span> <span class='hs-varid'>boxity</span><span class='hs-layout'>)</span>
<a name="line-85"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tupleParens</span> <span class='hs-layout'>(</span><span class='hs-varid'>boxityNormalTupleSort</span> <span class='hs-varid'>boxity</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>fcat</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr_tup_args</span> <span class='hs-varid'>exprs</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-86"></a>  <span class='hs-keyword'>where</span>
<a name="line-87"></a>    <span class='hs-varid'>ppr_tup_args</span> <span class='hs-conid'>[]</span>               <span class='hs-keyglyph'>=</span> <span class='hs-conid'>[]</span>
<a name="line-88"></a>    <span class='hs-varid'>ppr_tup_args</span> <span class='hs-layout'>(</span><span class='hs-conid'>Present</span> <span class='hs-varid'>e</span> <span class='hs-conop'>:</span> <span class='hs-varid'>es</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr_lexpr</span> <span class='hs-varid'>e</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>punc</span> <span class='hs-varid'>es</span><span class='hs-layout'>)</span> <span class='hs-conop'>:</span> <span class='hs-varid'>ppr_tup_args</span> <span class='hs-varid'>es</span>
<a name="line-89"></a>    <span class='hs-varid'>ppr_tup_args</span> <span class='hs-layout'>(</span><span class='hs-conid'>Missing</span> <span class='hs-keyword'>_</span> <span class='hs-conop'>:</span> <span class='hs-varid'>es</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>punc</span> <span class='hs-varid'>es</span> <span class='hs-conop'>:</span> <span class='hs-varid'>ppr_tup_args</span> <span class='hs-varid'>es</span>
<a name="line-90"></a>
<a name="line-91"></a>    <span class='hs-varid'>punc</span> <span class='hs-layout'>(</span><span class='hs-conid'>Present</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span> <span class='hs-conop'>:</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>comma</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>space</span>
<a name="line-92"></a>    <span class='hs-varid'>punc</span> <span class='hs-layout'>(</span><span class='hs-conid'>Missing</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span> <span class='hs-conop'>:</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>comma</span>
<a name="line-93"></a>    <span class='hs-varid'>punc</span> <span class='hs-conid'>[]</span>               <span class='hs-keyglyph'>=</span> <span class='hs-varid'>empty</span>
<a name="line-94"></a>
<a name="line-95"></a><span class='hs-comment'>--avoid using PatternSignatures for stage1 code portability</span>
<a name="line-96"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsLam</span> <span class='hs-varid'>matches</span><span class='hs-layout'>)</span>
<a name="line-97"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprMatches</span> <span class='hs-layout'>(</span><span class='hs-conid'>LambdaExpr</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsMatchContext</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span> <span class='hs-varid'>matches</span>
<a name="line-98"></a>
<a name="line-99"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsLamCase</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>matches</span><span class='hs-layout'>)</span>
<a name="line-100"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"\\case {"</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span>
<a name="line-101"></a>          <span class='hs-varid'>nest</span> <span class='hs-num'>2</span> <span class='hs-layout'>(</span><span class='hs-varid'>pprMatches</span> <span class='hs-layout'>(</span><span class='hs-conid'>CaseAlt</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsMatchContext</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span> <span class='hs-varid'>matches</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'}'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>]</span>
<a name="line-102"></a>
<a name="line-103"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsCase</span> <span class='hs-varid'>expr</span> <span class='hs-varid'>matches</span><span class='hs-layout'>)</span>
<a name="line-104"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"case"</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>nest</span> <span class='hs-num'>4</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>expr</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"of {"</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span>
<a name="line-105"></a>          <span class='hs-varid'>nest</span> <span class='hs-num'>2</span> <span class='hs-layout'>(</span><span class='hs-varid'>pprMatches</span> <span class='hs-layout'>(</span><span class='hs-conid'>CaseAlt</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsMatchContext</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span> <span class='hs-varid'>matches</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'}'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>]</span>
<a name="line-106"></a>
<a name="line-107"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsIf</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>e1</span> <span class='hs-varid'>e2</span> <span class='hs-varid'>e3</span><span class='hs-layout'>)</span>
<a name="line-108"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>hsep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"if"</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>nest</span> <span class='hs-num'>2</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>e1</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"then"</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span>
<a name="line-109"></a>         <span class='hs-varid'>nest</span> <span class='hs-num'>4</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>e2</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-110"></a>         <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"else"</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-111"></a>         <span class='hs-varid'>nest</span> <span class='hs-num'>4</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>e3</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-112"></a>
<a name="line-113"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsMultiIf</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>alts</span><span class='hs-layout'>)</span>
<a name="line-114"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sep</span> <span class='hs-varop'>$</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"if"</span><span class='hs-layout'>)</span> <span class='hs-conop'>:</span> <span class='hs-varid'>map</span> <span class='hs-varid'>ppr_alt</span> <span class='hs-varid'>alts</span>
<a name="line-115"></a>  <span class='hs-keyword'>where</span> <span class='hs-varid'>ppr_alt</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>GRHS</span> <span class='hs-varid'>guards</span> <span class='hs-varid'>expr</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-116"></a>          <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'|'</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>interpp'SP</span> <span class='hs-varid'>guards</span>
<a name="line-117"></a>              <span class='hs-layout'>,</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"-&gt;"</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>pprDeeper</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>expr</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>]</span>
<a name="line-118"></a>
<a name="line-119"></a><span class='hs-comment'>-- special case: let ... in let ...</span>
<a name="line-120"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsLet</span> <span class='hs-varid'>binds</span> <span class='hs-varid'>expr</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsLet</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-121"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>hang</span> <span class='hs-layout'>(</span><span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"let"</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-num'>2</span> <span class='hs-layout'>(</span><span class='hs-varid'>hsep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>pprBinds</span> <span class='hs-varid'>binds</span><span class='hs-layout'>,</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"in"</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-122"></a>         <span class='hs-varid'>ppr_lexpr</span> <span class='hs-varid'>expr</span><span class='hs-keyglyph'>]</span>
<a name="line-123"></a>
<a name="line-124"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsLet</span> <span class='hs-varid'>binds</span> <span class='hs-varid'>expr</span><span class='hs-layout'>)</span>
<a name="line-125"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>hang</span> <span class='hs-layout'>(</span><span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"let"</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-num'>2</span> <span class='hs-layout'>(</span><span class='hs-varid'>pprBinds</span> <span class='hs-varid'>binds</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-126"></a>         <span class='hs-varid'>hang</span> <span class='hs-layout'>(</span><span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"in"</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>  <span class='hs-num'>2</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>expr</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-127"></a>
<a name="line-128"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsDo</span> <span class='hs-varid'>do_or_list_comp</span> <span class='hs-varid'>stmts</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprDo</span> <span class='hs-varid'>do_or_list_comp</span> <span class='hs-varid'>stmts</span>
<a name="line-129"></a>
<a name="line-130"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>ExplicitList</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>exprs</span><span class='hs-layout'>)</span>
<a name="line-131"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>brackets</span> <span class='hs-layout'>(</span><span class='hs-varid'>pprDeeperList</span> <span class='hs-varid'>fsep</span> <span class='hs-layout'>(</span><span class='hs-varid'>punctuate</span> <span class='hs-varid'>comma</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-varid'>ppr_lexpr</span> <span class='hs-varid'>exprs</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-132"></a>
<a name="line-133"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>ExplicitPArr</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>exprs</span><span class='hs-layout'>)</span>
<a name="line-134"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>paBrackets</span> <span class='hs-layout'>(</span><span class='hs-varid'>pprDeeperList</span> <span class='hs-varid'>fsep</span> <span class='hs-layout'>(</span><span class='hs-varid'>punctuate</span> <span class='hs-varid'>comma</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-varid'>ppr_lexpr</span> <span class='hs-varid'>exprs</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-135"></a>
<a name="line-136"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>RecordCon</span> <span class='hs-varid'>con_id</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>rbinds</span><span class='hs-layout'>)</span>
<a name="line-137"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hang</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>con_id</span><span class='hs-layout'>)</span> <span class='hs-num'>2</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>rbinds</span><span class='hs-layout'>)</span>
<a name="line-138"></a>
<a name="line-139"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>RecordUpd</span> <span class='hs-varid'>aexp</span> <span class='hs-varid'>rbinds</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>
<a name="line-140"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hang</span> <span class='hs-layout'>(</span><span class='hs-varid'>pprParendExpr</span> <span class='hs-varid'>aexp</span><span class='hs-layout'>)</span> <span class='hs-num'>2</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>rbinds</span><span class='hs-layout'>)</span>
<a name="line-141"></a>
<a name="line-142"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>ExprWithTySig</span> <span class='hs-varid'>expr</span> <span class='hs-varid'>sig</span><span class='hs-layout'>)</span>
<a name="line-143"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hang</span> <span class='hs-layout'>(</span><span class='hs-varid'>nest</span> <span class='hs-num'>2</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr_lexpr</span> <span class='hs-varid'>expr</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>dcolon</span><span class='hs-layout'>)</span>
<a name="line-144"></a>         <span class='hs-num'>4</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>sig</span><span class='hs-layout'>)</span>
<a name="line-145"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>ExprWithTySigOut</span> <span class='hs-varid'>expr</span> <span class='hs-varid'>sig</span><span class='hs-layout'>)</span>
<a name="line-146"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hang</span> <span class='hs-layout'>(</span><span class='hs-varid'>nest</span> <span class='hs-num'>2</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr_lexpr</span> <span class='hs-varid'>expr</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>dcolon</span><span class='hs-layout'>)</span>
<a name="line-147"></a>         <span class='hs-num'>4</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>sig</span><span class='hs-layout'>)</span>
<a name="line-148"></a>
<a name="line-149"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>ArithSeq</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>info</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>brackets</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>info</span><span class='hs-layout'>)</span>
<a name="line-150"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>PArrSeq</span>  <span class='hs-keyword'>_</span> <span class='hs-varid'>info</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>paBrackets</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>info</span><span class='hs-layout'>)</span>
<a name="line-151"></a>
<a name="line-152"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-conid'>EWildPat</span>       <span class='hs-keyglyph'>=</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'_'</span>
<a name="line-153"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>ELazyPat</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'~'</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>pprParendExpr</span> <span class='hs-varid'>e</span>
<a name="line-154"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>EAsPat</span> <span class='hs-varid'>v</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>v</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'@'</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>pprParendExpr</span> <span class='hs-varid'>e</span>
<a name="line-155"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>EViewPat</span> <span class='hs-varid'>p</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>p</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"-&gt;"</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>e</span>
<a name="line-156"></a>
<a name="line-157"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsSCC</span> <span class='hs-varid'>lbl</span> <span class='hs-varid'>expr</span><span class='hs-layout'>)</span>
<a name="line-158"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"{-# SCC"</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>doubleQuotes</span> <span class='hs-layout'>(</span><span class='hs-varid'>ftext</span> <span class='hs-varid'>lbl</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"#-}"</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-159"></a>          <span class='hs-varid'>pprParendExpr</span> <span class='hs-varid'>expr</span> <span class='hs-keyglyph'>]</span>
<a name="line-160"></a>
<a name="line-161"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsWrap</span> <span class='hs-varid'>co_fn</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprHsWrapper</span> <span class='hs-layout'>(</span><span class='hs-varid'>pprExpr</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-varid'>co_fn</span>
<a name="line-162"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsType</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>id</span>
<a name="line-163"></a>
<a name="line-164"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsSpliceE</span> <span class='hs-varid'>t</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span>       <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprSplice</span> <span class='hs-varid'>t</span> <span class='hs-varid'>s</span>
<a name="line-165"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsBracket</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span>         <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprHsBracket</span> <span class='hs-varid'>b</span>
<a name="line-166"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsRnBracketOut</span> <span class='hs-varid'>e</span> <span class='hs-conid'>[]</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>e</span>
<a name="line-167"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsRnBracketOut</span> <span class='hs-varid'>e</span> <span class='hs-varid'>ps</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>e</span> <span class='hs-varop'>$$</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"pending(rn)"</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>ps</span>
<a name="line-168"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsTcBracketOut</span> <span class='hs-varid'>e</span> <span class='hs-conid'>[]</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>e</span>
<a name="line-169"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsTcBracketOut</span> <span class='hs-varid'>e</span> <span class='hs-varid'>ps</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>e</span> <span class='hs-varop'>$$</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"pending(tc)"</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>ps</span>
<a name="line-170"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsQuasiQuoteE</span> <span class='hs-varid'>qq</span><span class='hs-layout'>)</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>qq</span>
<a name="line-171"></a>
<a name="line-172"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsProc</span> <span class='hs-varid'>pat</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsCmdTop</span> <span class='hs-varid'>cmd</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-173"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hsep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"proc"</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>pat</span><span class='hs-layout'>,</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"-&gt;"</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>cmd</span><span class='hs-keyglyph'>]</span>
<a name="line-174"></a>
<a name="line-175"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsTick</span> <span class='hs-varid'>tickish</span> <span class='hs-varid'>exp</span><span class='hs-layout'>)</span>
<a name="line-176"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprTicks</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>exp</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span>
<a name="line-177"></a>    <span class='hs-varid'>ppr</span> <span class='hs-varid'>tickish</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>exp</span>
<a name="line-178"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsBinTick</span> <span class='hs-varid'>tickIdTrue</span> <span class='hs-varid'>tickIdFalse</span> <span class='hs-varid'>exp</span><span class='hs-layout'>)</span>
<a name="line-179"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprTicks</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>exp</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span>
<a name="line-180"></a>    <span class='hs-varid'>hcat</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"bintick&lt;"</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-181"></a>          <span class='hs-varid'>ppr</span> <span class='hs-varid'>tickIdTrue</span><span class='hs-layout'>,</span>
<a name="line-182"></a>          <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>","</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-183"></a>          <span class='hs-varid'>ppr</span> <span class='hs-varid'>tickIdFalse</span><span class='hs-layout'>,</span>
<a name="line-184"></a>          <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"&gt;("</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-185"></a>          <span class='hs-varid'>ppr</span> <span class='hs-varid'>exp</span><span class='hs-layout'>,</span><span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>")"</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-186"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsTickPragma</span> <span class='hs-varid'>externalSrcLoc</span> <span class='hs-varid'>exp</span><span class='hs-layout'>)</span>
<a name="line-187"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprTicks</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>exp</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span>
<a name="line-188"></a>    <span class='hs-varid'>hcat</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"tickpragma&lt;"</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-189"></a>          <span class='hs-varid'>ppr</span> <span class='hs-varid'>externalSrcLoc</span><span class='hs-layout'>,</span>
<a name="line-190"></a>          <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"&gt;("</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-191"></a>          <span class='hs-varid'>ppr</span> <span class='hs-varid'>exp</span><span class='hs-layout'>,</span>
<a name="line-192"></a>          <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>")"</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-193"></a>
<a name="line-194"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsArrApp</span> <span class='hs-varid'>arrow</span> <span class='hs-varid'>arg</span> <span class='hs-keyword'>_</span> <span class='hs-conid'>HsFirstOrderApp</span> <span class='hs-conid'>True</span><span class='hs-layout'>)</span>
<a name="line-195"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hsep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>ppr_lexpr</span> <span class='hs-varid'>arrow</span><span class='hs-layout'>,</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"-&lt;"</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>ppr_lexpr</span> <span class='hs-varid'>arg</span><span class='hs-keyglyph'>]</span>
<a name="line-196"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsArrApp</span> <span class='hs-varid'>arrow</span> <span class='hs-varid'>arg</span> <span class='hs-keyword'>_</span> <span class='hs-conid'>HsFirstOrderApp</span> <span class='hs-conid'>False</span><span class='hs-layout'>)</span>
<a name="line-197"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hsep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>ppr_lexpr</span> <span class='hs-varid'>arg</span><span class='hs-layout'>,</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"&gt;-"</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>ppr_lexpr</span> <span class='hs-varid'>arrow</span><span class='hs-keyglyph'>]</span>
<a name="line-198"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsArrApp</span> <span class='hs-varid'>arrow</span> <span class='hs-varid'>arg</span> <span class='hs-keyword'>_</span> <span class='hs-conid'>HsHigherOrderApp</span> <span class='hs-conid'>True</span><span class='hs-layout'>)</span>
<a name="line-199"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hsep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>ppr_lexpr</span> <span class='hs-varid'>arrow</span><span class='hs-layout'>,</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"-&lt;&lt;"</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>ppr_lexpr</span> <span class='hs-varid'>arg</span><span class='hs-keyglyph'>]</span>
<a name="line-200"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsArrApp</span> <span class='hs-varid'>arrow</span> <span class='hs-varid'>arg</span> <span class='hs-keyword'>_</span> <span class='hs-conid'>HsHigherOrderApp</span> <span class='hs-conid'>False</span><span class='hs-layout'>)</span>
<a name="line-201"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hsep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>ppr_lexpr</span> <span class='hs-varid'>arg</span><span class='hs-layout'>,</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"&gt;&gt;-"</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>ppr_lexpr</span> <span class='hs-varid'>arrow</span><span class='hs-keyglyph'>]</span>
<a name="line-202"></a>
<a name="line-203"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsArrForm</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsVar</span> <span class='hs-varid'>v</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>arg1</span><span class='hs-layout'>,</span> <span class='hs-varid'>arg2</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-204"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>pprCmdArg</span> <span class='hs-layout'>(</span><span class='hs-varid'>unLoc</span> <span class='hs-varid'>arg1</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>hsep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>pprInfixOcc</span> <span class='hs-varid'>v</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprCmdArg</span> <span class='hs-layout'>(</span><span class='hs-varid'>unLoc</span> <span class='hs-varid'>arg2</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span><span class='hs-keyglyph'>]</span>
<a name="line-205"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsArrForm</span> <span class='hs-varid'>op</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>args</span><span class='hs-layout'>)</span>
<a name="line-206"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hang</span> <span class='hs-layout'>(</span><span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"(|"</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr_lexpr</span> <span class='hs-varid'>op</span><span class='hs-layout'>)</span>
<a name="line-207"></a>         <span class='hs-num'>4</span> <span class='hs-layout'>(</span><span class='hs-varid'>sep</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-varid'>pprCmdArg</span><span class='hs-varop'>.</span><span class='hs-varid'>unLoc</span><span class='hs-layout'>)</span> <span class='hs-varid'>args</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"|)"</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-208"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsUnboundVar</span> <span class='hs-varid'>nm</span><span class='hs-layout'>)</span>
<a name="line-209"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>nm</span>
<a name="line-210"></a>
</pre>\end{code}

HsSyn records exactly where the user put parens, with HsPar.
So generally speaking we print without adding any parens.
However, some code is internally generated, and in some places
parens are absolutely required; so for these places we use
pprParendExpr (but don't print double parens of course).

For operator applications we don't add parens, because the oprerator
fixities should do the job, except in debug mode (-dppr-debug) so we
can see the structure of the parse tree.

\begin{code}
<pre><a name="line-1"></a><a name="pprDebugParendExpr"></a><span class='hs-definition'>pprDebugParendExpr</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-2"></a><span class='hs-definition'>pprDebugParendExpr</span> <span class='hs-varid'>expr</span>
<a name="line-3"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getPprStyle</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>sty</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-4"></a>    <span class='hs-keyword'>if</span> <span class='hs-varid'>debugStyle</span> <span class='hs-varid'>sty</span> <span class='hs-keyword'>then</span> <span class='hs-varid'>pprParendExpr</span> <span class='hs-varid'>expr</span>
<a name="line-5"></a>                      <span class='hs-keyword'>else</span> <span class='hs-varid'>pprLExpr</span>      <span class='hs-varid'>expr</span><span class='hs-layout'>)</span>
<a name="line-6"></a>
<a name="line-7"></a><a name="pprParendExpr"></a><span class='hs-definition'>pprParendExpr</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-8"></a><span class='hs-definition'>pprParendExpr</span> <span class='hs-varid'>expr</span>
<a name="line-9"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>hsExprNeedsParens</span> <span class='hs-layout'>(</span><span class='hs-varid'>unLoc</span> <span class='hs-varid'>expr</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>parens</span> <span class='hs-layout'>(</span><span class='hs-varid'>pprLExpr</span> <span class='hs-varid'>expr</span><span class='hs-layout'>)</span>
<a name="line-10"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>                      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprLExpr</span> <span class='hs-varid'>expr</span>
<a name="line-11"></a>        <span class='hs-comment'>-- Using pprLExpr makes sure that we go 'deeper'</span>
<a name="line-12"></a>        <span class='hs-comment'>-- I think that is usually (always?) right</span>
<a name="line-13"></a>
<a name="line-14"></a><a name="hsExprNeedsParens"></a><span class='hs-definition'>hsExprNeedsParens</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsExpr</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-15"></a><span class='hs-comment'>-- True of expressions for which '(e)' and 'e'</span>
<a name="line-16"></a><span class='hs-comment'>-- mean the same thing</span>
<a name="line-17"></a><span class='hs-definition'>hsExprNeedsParens</span> <span class='hs-layout'>(</span><span class='hs-conid'>ArithSeq</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>       <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-18"></a><span class='hs-definition'>hsExprNeedsParens</span> <span class='hs-layout'>(</span><span class='hs-conid'>PArrSeq</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>        <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-19"></a><span class='hs-definition'>hsExprNeedsParens</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsLit</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>          <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-20"></a><span class='hs-definition'>hsExprNeedsParens</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsOverLit</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>      <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-21"></a><span class='hs-definition'>hsExprNeedsParens</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsVar</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>          <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-22"></a><span class='hs-definition'>hsExprNeedsParens</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsUnboundVar</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-23"></a><span class='hs-definition'>hsExprNeedsParens</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsIPVar</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>        <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-24"></a><span class='hs-definition'>hsExprNeedsParens</span> <span class='hs-layout'>(</span><span class='hs-conid'>ExplicitTuple</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-25"></a><span class='hs-definition'>hsExprNeedsParens</span> <span class='hs-layout'>(</span><span class='hs-conid'>ExplicitList</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-26"></a><span class='hs-definition'>hsExprNeedsParens</span> <span class='hs-layout'>(</span><span class='hs-conid'>ExplicitPArr</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-27"></a><span class='hs-definition'>hsExprNeedsParens</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsPar</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>          <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-28"></a><span class='hs-definition'>hsExprNeedsParens</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsBracket</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>      <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-29"></a><span class='hs-definition'>hsExprNeedsParens</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsRnBracketOut</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-30"></a><span class='hs-definition'>hsExprNeedsParens</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsTcBracketOut</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-31"></a><span class='hs-definition'>hsExprNeedsParens</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsDo</span> <span class='hs-varid'>sc</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>
<a name="line-32"></a>       <span class='hs-keyglyph'>|</span> <span class='hs-varid'>isListCompExpr</span> <span class='hs-varid'>sc</span>            <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-33"></a><span class='hs-definition'>hsExprNeedsParens</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-34"></a>
<a name="line-35"></a>
<a name="line-36"></a><a name="isAtomicHsExpr"></a><span class='hs-definition'>isAtomicHsExpr</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsExpr</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-37"></a><span class='hs-comment'>-- True of a single token</span>
<a name="line-38"></a><span class='hs-definition'>isAtomicHsExpr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsVar</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>     <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-39"></a><span class='hs-definition'>isAtomicHsExpr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsLit</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>     <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-40"></a><span class='hs-definition'>isAtomicHsExpr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsOverLit</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-41"></a><span class='hs-definition'>isAtomicHsExpr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsIPVar</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-42"></a><span class='hs-definition'>isAtomicHsExpr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsUnboundVar</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-43"></a><span class='hs-definition'>isAtomicHsExpr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsWrap</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>isAtomicHsExpr</span> <span class='hs-varid'>e</span>
<a name="line-44"></a><span class='hs-definition'>isAtomicHsExpr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsPar</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>isAtomicHsExpr</span> <span class='hs-layout'>(</span><span class='hs-varid'>unLoc</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>
<a name="line-45"></a><span class='hs-definition'>isAtomicHsExpr</span> <span class='hs-keyword'>_</span>              <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
</pre>\end{code}

%************************************************************************
%*                                                                      *
\subsection{Commands (in arrow abstractions)}
%*                                                                      *
%************************************************************************

We re-use HsExpr to represent these.

\begin{code}
<pre><a name="line-1"></a><a name="LHsCmd"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LHsCmd</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsCmd</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-2"></a>
<a name="line-3"></a><a name="HsCmd"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>HsCmd</span> <span class='hs-varid'>id</span>
<a name="line-4"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HsCmdArrApp</span>         <span class='hs-comment'>-- Arrow tail, or arrow application (f -&lt; arg)</span>
<a name="line-5"></a>        <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>    <span class='hs-comment'>-- arrow expression, f</span>
<a name="line-6"></a>        <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>    <span class='hs-comment'>-- input expression, arg</span>
<a name="line-7"></a>        <span class='hs-conid'>PostTcType</span>      <span class='hs-comment'>-- type of the arrow expressions f,</span>
<a name="line-8"></a>                        <span class='hs-comment'>-- of the form a t t', where arg :: t</span>
<a name="line-9"></a>        <span class='hs-conid'>HsArrAppType</span>    <span class='hs-comment'>-- higher-order (-&lt;&lt;) or first-order (-&lt;)</span>
<a name="line-10"></a>        <span class='hs-conid'>Bool</span>            <span class='hs-comment'>-- True =&gt; right-to-left (f -&lt; arg)</span>
<a name="line-11"></a>                        <span class='hs-comment'>-- False =&gt; left-to-right (arg &gt;- f)</span>
<a name="line-12"></a>
<a name="line-13"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsCmdArrForm</span>        <span class='hs-comment'>-- Command formation,  (| e cmd1 .. cmdn |)</span>
<a name="line-14"></a>        <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>    <span class='hs-comment'>-- the operator</span>
<a name="line-15"></a>                        <span class='hs-comment'>-- after type-checking, a type abstraction to be</span>
<a name="line-16"></a>                        <span class='hs-comment'>-- applied to the type of the local environment tuple</span>
<a name="line-17"></a>        <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-conid'>Fixity</span><span class='hs-layout'>)</span>  <span class='hs-comment'>-- fixity (filled in by the renamer), for forms that</span>
<a name="line-18"></a>                        <span class='hs-comment'>-- were converted from OpApp's by the renamer</span>
<a name="line-19"></a>        <span class='hs-keyglyph'>[</span><span class='hs-conid'>LHsCmdTop</span> <span class='hs-varid'>id</span><span class='hs-keyglyph'>]</span>  <span class='hs-comment'>-- argument commands</span>
<a name="line-20"></a>
<a name="line-21"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsCmdApp</span>    <span class='hs-layout'>(</span><span class='hs-conid'>LHsCmd</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-22"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-23"></a>
<a name="line-24"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsCmdLam</span>    <span class='hs-layout'>(</span><span class='hs-conid'>MatchGroup</span> <span class='hs-varid'>id</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsCmd</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>     <span class='hs-comment'>-- kappa</span>
<a name="line-25"></a>
<a name="line-26"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsCmdPar</span>    <span class='hs-layout'>(</span><span class='hs-conid'>LHsCmd</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>                     <span class='hs-comment'>-- parenthesised command</span>
<a name="line-27"></a>
<a name="line-28"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsCmdCase</span>   <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-29"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>MatchGroup</span> <span class='hs-varid'>id</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsCmd</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>     <span class='hs-comment'>-- bodies are HsCmd's</span>
<a name="line-30"></a>
<a name="line-31"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsCmdIf</span>     <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>SyntaxExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>         <span class='hs-comment'>-- cond function</span>
<a name="line-32"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>                    <span class='hs-comment'>-- predicate</span>
<a name="line-33"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>LHsCmd</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>                     <span class='hs-comment'>-- then part</span>
<a name="line-34"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>LHsCmd</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>                     <span class='hs-comment'>-- else part</span>
<a name="line-35"></a>
<a name="line-36"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsCmdLet</span>    <span class='hs-layout'>(</span><span class='hs-conid'>HsLocalBinds</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>               <span class='hs-comment'>-- let(rec)</span>
<a name="line-37"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>LHsCmd</span>  <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-38"></a>
<a name="line-39"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsCmdDo</span>     <span class='hs-keyglyph'>[</span><span class='hs-conid'>CmdLStmt</span> <span class='hs-varid'>id</span><span class='hs-keyglyph'>]</span>
<a name="line-40"></a>                <span class='hs-conid'>PostTcType</span>                      <span class='hs-comment'>-- Type of the whole expression</span>
<a name="line-41"></a>
<a name="line-42"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsCmdCast</span>   <span class='hs-conid'>TcCoercion</span>     <span class='hs-comment'>-- A simpler version of HsWrap in HsExpr</span>
<a name="line-43"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>HsCmd</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>     <span class='hs-comment'>-- If   cmd :: arg1 --&gt; res</span>
<a name="line-44"></a>                               <span class='hs-comment'>--       co :: arg1 ~ arg2</span>
<a name="line-45"></a>                               <span class='hs-comment'>-- Then (HsCmdCast co cmd) :: arg2 --&gt; res</span>
<a name="line-46"></a>                
<a name="line-47"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Data</span><span class='hs-layout'>,</span> <span class='hs-conid'>Typeable</span><span class='hs-layout'>)</span>
<a name="line-48"></a>
<a name="line-49"></a><a name="HsArrAppType"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>HsArrAppType</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HsHigherOrderApp</span> <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsFirstOrderApp</span>
<a name="line-50"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Data</span><span class='hs-layout'>,</span> <span class='hs-conid'>Typeable</span><span class='hs-layout'>)</span>
<a name="line-51"></a>
</pre>\end{code}

Top-level command, introducing a new arrow.
This may occur inside a proc (where the stack is empty) or as an
argument of a command-forming operator.

\begin{code}
<pre><a name="line-1"></a><a name="LHsCmdTop"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LHsCmdTop</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsCmdTop</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-2"></a>
<a name="line-3"></a><a name="HsCmdTop"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>HsCmdTop</span> <span class='hs-varid'>id</span>
<a name="line-4"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HsCmdTop</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsCmd</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-5"></a>             <span class='hs-conid'>PostTcType</span>          <span class='hs-comment'>-- Nested tuple of inputs on the command's stack</span>
<a name="line-6"></a>             <span class='hs-conid'>PostTcType</span>          <span class='hs-comment'>-- return type of the command</span>
<a name="line-7"></a>             <span class='hs-layout'>(</span><span class='hs-conid'>CmdSyntaxTable</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- See Note [CmdSyntaxTable]</span>
<a name="line-8"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Data</span><span class='hs-layout'>,</span> <span class='hs-conid'>Typeable</span><span class='hs-layout'>)</span>
</pre>\end{code}


\begin{code}
<pre><a name="line-1"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Outputable</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsCmd</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-2"></a>    <span class='hs-varid'>ppr</span> <span class='hs-varid'>cmd</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprCmd</span> <span class='hs-varid'>cmd</span>
<a name="line-3"></a>
<a name="line-4"></a><a name="pprLCmd"></a><span class='hs-comment'>-----------------------</span>
<a name="line-5"></a><span class='hs-comment'>-- pprCmd and pprLCmd call pprDeeper;</span>
<a name="line-6"></a><span class='hs-comment'>-- the underscore versions do not</span>
<a name="line-7"></a><span class='hs-definition'>pprLCmd</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>LHsCmd</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-8"></a><span class='hs-definition'>pprLCmd</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprCmd</span> <span class='hs-varid'>c</span>
<a name="line-9"></a>
<a name="line-10"></a><a name="pprCmd"></a><span class='hs-definition'>pprCmd</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HsCmd</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-11"></a><span class='hs-definition'>pprCmd</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>isQuietHsCmd</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>=</span>            <span class='hs-varid'>ppr_cmd</span> <span class='hs-varid'>c</span>
<a name="line-12"></a>         <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprDeeper</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr_cmd</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span>
<a name="line-13"></a>
<a name="line-14"></a><a name="isQuietHsCmd"></a><span class='hs-definition'>isQuietHsCmd</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsCmd</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-15"></a><span class='hs-comment'>-- Parentheses do display something, but it gives little info and</span>
<a name="line-16"></a><span class='hs-comment'>-- if we go deeper when we go inside them then we get ugly things</span>
<a name="line-17"></a><span class='hs-comment'>-- like (...)</span>
<a name="line-18"></a><span class='hs-definition'>isQuietHsCmd</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsCmdPar</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-19"></a><span class='hs-comment'>-- applications don't display anything themselves</span>
<a name="line-20"></a><span class='hs-definition'>isQuietHsCmd</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsCmdApp</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-21"></a><span class='hs-definition'>isQuietHsCmd</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-22"></a>
<a name="line-23"></a><a name="ppr_lcmd"></a><span class='hs-comment'>-----------------------</span>
<a name="line-24"></a><span class='hs-definition'>ppr_lcmd</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>LHsCmd</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-25"></a><span class='hs-definition'>ppr_lcmd</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr_cmd</span> <span class='hs-layout'>(</span><span class='hs-varid'>unLoc</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span>
<a name="line-26"></a>
<a name="line-27"></a><a name="ppr_cmd"></a><span class='hs-definition'>ppr_cmd</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>id</span><span class='hs-varop'>.</span> <span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HsCmd</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-28"></a><span class='hs-definition'>ppr_cmd</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsCmdPar</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>parens</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr_lcmd</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span>
<a name="line-29"></a>
<a name="line-30"></a><span class='hs-definition'>ppr_cmd</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsCmdApp</span> <span class='hs-varid'>c</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>
<a name="line-31"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>let</span> <span class='hs-layout'>(</span><span class='hs-varid'>fun</span><span class='hs-layout'>,</span> <span class='hs-varid'>args</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>collect_args</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>e</span><span class='hs-keyglyph'>]</span> <span class='hs-keyword'>in</span>
<a name="line-32"></a>    <span class='hs-varid'>hang</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr_lcmd</span> <span class='hs-varid'>fun</span><span class='hs-layout'>)</span> <span class='hs-num'>2</span> <span class='hs-layout'>(</span><span class='hs-varid'>sep</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-varid'>pprParendExpr</span> <span class='hs-varid'>args</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-33"></a>  <span class='hs-keyword'>where</span>
<a name="line-34"></a>    <span class='hs-varid'>collect_args</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsCmdApp</span> <span class='hs-varid'>fun</span> <span class='hs-varid'>arg</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varid'>args</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>collect_args</span> <span class='hs-varid'>fun</span> <span class='hs-layout'>(</span><span class='hs-varid'>arg</span><span class='hs-conop'>:</span><span class='hs-varid'>args</span><span class='hs-layout'>)</span>
<a name="line-35"></a>    <span class='hs-varid'>collect_args</span> <span class='hs-varid'>fun</span> <span class='hs-varid'>args</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>fun</span><span class='hs-layout'>,</span> <span class='hs-varid'>args</span><span class='hs-layout'>)</span>
<a name="line-36"></a>
<a name="line-37"></a><span class='hs-comment'>--avoid using PatternSignatures for stage1 code portability</span>
<a name="line-38"></a><span class='hs-definition'>ppr_cmd</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsCmdLam</span> <span class='hs-varid'>matches</span><span class='hs-layout'>)</span>
<a name="line-39"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprMatches</span> <span class='hs-layout'>(</span><span class='hs-conid'>LambdaExpr</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsMatchContext</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span> <span class='hs-varid'>matches</span>
<a name="line-40"></a>
<a name="line-41"></a><span class='hs-definition'>ppr_cmd</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsCmdCase</span> <span class='hs-varid'>expr</span> <span class='hs-varid'>matches</span><span class='hs-layout'>)</span>
<a name="line-42"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"case"</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>nest</span> <span class='hs-num'>4</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>expr</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"of {"</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span>
<a name="line-43"></a>          <span class='hs-varid'>nest</span> <span class='hs-num'>2</span> <span class='hs-layout'>(</span><span class='hs-varid'>pprMatches</span> <span class='hs-layout'>(</span><span class='hs-conid'>CaseAlt</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsMatchContext</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span> <span class='hs-varid'>matches</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'}'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>]</span>
<a name="line-44"></a>
<a name="line-45"></a><span class='hs-definition'>ppr_cmd</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsCmdIf</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>e</span> <span class='hs-varid'>ct</span> <span class='hs-varid'>ce</span><span class='hs-layout'>)</span>
<a name="line-46"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>hsep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"if"</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>nest</span> <span class='hs-num'>2</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"then"</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span>
<a name="line-47"></a>         <span class='hs-varid'>nest</span> <span class='hs-num'>4</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>ct</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-48"></a>         <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"else"</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-49"></a>         <span class='hs-varid'>nest</span> <span class='hs-num'>4</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>ce</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-50"></a>
<a name="line-51"></a><span class='hs-comment'>-- special case: let ... in let ...</span>
<a name="line-52"></a><span class='hs-definition'>ppr_cmd</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsCmdLet</span> <span class='hs-varid'>binds</span> <span class='hs-varid'>cmd</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsCmdLet</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-53"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>hang</span> <span class='hs-layout'>(</span><span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"let"</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-num'>2</span> <span class='hs-layout'>(</span><span class='hs-varid'>hsep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>pprBinds</span> <span class='hs-varid'>binds</span><span class='hs-layout'>,</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"in"</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-54"></a>         <span class='hs-varid'>ppr_lcmd</span> <span class='hs-varid'>cmd</span><span class='hs-keyglyph'>]</span>
<a name="line-55"></a>
<a name="line-56"></a><span class='hs-definition'>ppr_cmd</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsCmdLet</span> <span class='hs-varid'>binds</span> <span class='hs-varid'>cmd</span><span class='hs-layout'>)</span>
<a name="line-57"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>hang</span> <span class='hs-layout'>(</span><span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"let"</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-num'>2</span> <span class='hs-layout'>(</span><span class='hs-varid'>pprBinds</span> <span class='hs-varid'>binds</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-58"></a>         <span class='hs-varid'>hang</span> <span class='hs-layout'>(</span><span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"in"</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>  <span class='hs-num'>2</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>cmd</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-59"></a>
<a name="line-60"></a><span class='hs-definition'>ppr_cmd</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsCmdDo</span> <span class='hs-varid'>stmts</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprDo</span> <span class='hs-conid'>ArrowExpr</span> <span class='hs-varid'>stmts</span>
<a name="line-61"></a><span class='hs-definition'>ppr_cmd</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsCmdCast</span> <span class='hs-varid'>co</span> <span class='hs-varid'>cmd</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>ppr_cmd</span> <span class='hs-varid'>cmd</span>
<a name="line-62"></a>                                 <span class='hs-layout'>,</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"|&gt;"</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>co</span> <span class='hs-keyglyph'>]</span>
<a name="line-63"></a>
<a name="line-64"></a><span class='hs-definition'>ppr_cmd</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsCmdArrApp</span> <span class='hs-varid'>arrow</span> <span class='hs-varid'>arg</span> <span class='hs-keyword'>_</span> <span class='hs-conid'>HsFirstOrderApp</span> <span class='hs-conid'>True</span><span class='hs-layout'>)</span>
<a name="line-65"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hsep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>ppr_lexpr</span> <span class='hs-varid'>arrow</span><span class='hs-layout'>,</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"-&lt;"</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>ppr_lexpr</span> <span class='hs-varid'>arg</span><span class='hs-keyglyph'>]</span>
<a name="line-66"></a><span class='hs-definition'>ppr_cmd</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsCmdArrApp</span> <span class='hs-varid'>arrow</span> <span class='hs-varid'>arg</span> <span class='hs-keyword'>_</span> <span class='hs-conid'>HsFirstOrderApp</span> <span class='hs-conid'>False</span><span class='hs-layout'>)</span>
<a name="line-67"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hsep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>ppr_lexpr</span> <span class='hs-varid'>arg</span><span class='hs-layout'>,</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"&gt;-"</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>ppr_lexpr</span> <span class='hs-varid'>arrow</span><span class='hs-keyglyph'>]</span>
<a name="line-68"></a><span class='hs-definition'>ppr_cmd</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsCmdArrApp</span> <span class='hs-varid'>arrow</span> <span class='hs-varid'>arg</span> <span class='hs-keyword'>_</span> <span class='hs-conid'>HsHigherOrderApp</span> <span class='hs-conid'>True</span><span class='hs-layout'>)</span>
<a name="line-69"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hsep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>ppr_lexpr</span> <span class='hs-varid'>arrow</span><span class='hs-layout'>,</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"-&lt;&lt;"</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>ppr_lexpr</span> <span class='hs-varid'>arg</span><span class='hs-keyglyph'>]</span>
<a name="line-70"></a><span class='hs-definition'>ppr_cmd</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsCmdArrApp</span> <span class='hs-varid'>arrow</span> <span class='hs-varid'>arg</span> <span class='hs-keyword'>_</span> <span class='hs-conid'>HsHigherOrderApp</span> <span class='hs-conid'>False</span><span class='hs-layout'>)</span>
<a name="line-71"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hsep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>ppr_lexpr</span> <span class='hs-varid'>arg</span><span class='hs-layout'>,</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"&gt;&gt;-"</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>ppr_lexpr</span> <span class='hs-varid'>arrow</span><span class='hs-keyglyph'>]</span>
<a name="line-72"></a>
<a name="line-73"></a><span class='hs-definition'>ppr_cmd</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsCmdArrForm</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsVar</span> <span class='hs-varid'>v</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>arg1</span><span class='hs-layout'>,</span> <span class='hs-varid'>arg2</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-74"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>pprCmdArg</span> <span class='hs-layout'>(</span><span class='hs-varid'>unLoc</span> <span class='hs-varid'>arg1</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>hsep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>pprInfixOcc</span> <span class='hs-varid'>v</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprCmdArg</span> <span class='hs-layout'>(</span><span class='hs-varid'>unLoc</span> <span class='hs-varid'>arg2</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span><span class='hs-keyglyph'>]</span>
<a name="line-75"></a><span class='hs-definition'>ppr_cmd</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsCmdArrForm</span> <span class='hs-varid'>op</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>args</span><span class='hs-layout'>)</span>
<a name="line-76"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hang</span> <span class='hs-layout'>(</span><span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"(|"</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>ppr_lexpr</span> <span class='hs-varid'>op</span><span class='hs-layout'>)</span>
<a name="line-77"></a>         <span class='hs-num'>4</span> <span class='hs-layout'>(</span><span class='hs-varid'>sep</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-varid'>pprCmdArg</span><span class='hs-varop'>.</span><span class='hs-varid'>unLoc</span><span class='hs-layout'>)</span> <span class='hs-varid'>args</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"|)"</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-78"></a>
<a name="line-79"></a><a name="pprCmdArg"></a><span class='hs-definition'>pprCmdArg</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HsCmdTop</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-80"></a><span class='hs-definition'>pprCmdArg</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsCmdTop</span> <span class='hs-varid'>cmd</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsCmdArrForm</span> <span class='hs-keyword'>_</span> <span class='hs-conid'>Nothing</span> <span class='hs-conid'>[]</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>
<a name="line-81"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr_lcmd</span> <span class='hs-varid'>cmd</span>
<a name="line-82"></a><span class='hs-definition'>pprCmdArg</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsCmdTop</span> <span class='hs-varid'>cmd</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>
<a name="line-83"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>parens</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr_lcmd</span> <span class='hs-varid'>cmd</span><span class='hs-layout'>)</span>
<a name="line-84"></a>
<a name="line-85"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Outputable</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsCmdTop</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-86"></a>    <span class='hs-varid'>ppr</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprCmdArg</span>
<a name="line-87"></a>
</pre>\end{code}

%************************************************************************
%*                                                                      *
\subsection{Record binds}
%*                                                                      *
%************************************************************************

\begin{code}
<pre><a name="line-1"></a><a name="HsRecordBinds"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>HsRecordBinds</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HsRecFields</span> <span class='hs-varid'>id</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
</pre>\end{code}


%************************************************************************
%*                                                                      *
\subsection{@Match@, @GRHSs@, and @GRHS@ datatypes}
%*                                                                      *
%************************************************************************

@Match@es are sets of pattern bindings and right hand sides for
functions, patterns or case branches. For example, if a function @g@
is defined as:
\begin{verbatim}
g (x,y) = y
g ((x:ys),y) = y+1,
\end{verbatim}
then \tr{g} has two @Match@es: @(x,y) = y@ and @((x:ys),y) = y+1@.

It is always the case that each element of an @[Match]@ list has the
same number of @pats@s inside it.  This corresponds to saying that
a function defined by pattern matching must have the same number of
patterns in each equation.

\begin{code}
<pre><a name="line-1"></a><a name="MatchGroup"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>MatchGroup</span> <span class='hs-varid'>id</span> <span class='hs-varid'>body</span>
<a name="line-2"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>MG</span> <span class='hs-layout'>{</span> <span class='hs-varid'>mg_alts</span>    <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LMatch</span> <span class='hs-varid'>id</span> <span class='hs-varid'>body</span><span class='hs-keyglyph'>]</span>  <span class='hs-comment'>-- The alternatives</span>
<a name="line-3"></a>       <span class='hs-layout'>,</span> <span class='hs-varid'>mg_arg_tys</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>PostTcType</span><span class='hs-keyglyph'>]</span>      <span class='hs-comment'>-- Types of the arguments, t1..tn</span>
<a name="line-4"></a>       <span class='hs-layout'>,</span> <span class='hs-varid'>mg_res_ty</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>PostTcType</span>        <span class='hs-comment'>-- Type of the result, tr </span>
<a name="line-5"></a>       <span class='hs-layout'>,</span> <span class='hs-varid'>mg_origin</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Origin</span> <span class='hs-layout'>}</span>
<a name="line-6"></a>     <span class='hs-comment'>-- The type is the type of the entire group</span>
<a name="line-7"></a>     <span class='hs-comment'>--      t1 -&gt; ... -&gt; tn -&gt; tr</span>
<a name="line-8"></a>     <span class='hs-comment'>-- where there are n patterns</span>
<a name="line-9"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Data</span><span class='hs-layout'>,</span> <span class='hs-conid'>Typeable</span><span class='hs-layout'>)</span>
<a name="line-10"></a>
<a name="line-11"></a><a name="LMatch"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LMatch</span> <span class='hs-varid'>id</span> <span class='hs-varid'>body</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-conid'>Match</span> <span class='hs-varid'>id</span> <span class='hs-varid'>body</span><span class='hs-layout'>)</span>
<a name="line-12"></a>
<a name="line-13"></a><a name="Match"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>Match</span> <span class='hs-varid'>id</span> <span class='hs-varid'>body</span>
<a name="line-14"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Match</span>
<a name="line-15"></a>        <span class='hs-keyglyph'>[</span><span class='hs-conid'>LPat</span> <span class='hs-varid'>id</span><span class='hs-keyglyph'>]</span>               <span class='hs-comment'>-- The patterns</span>
<a name="line-16"></a>        <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsType</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>    <span class='hs-comment'>-- A type signature for the result of the match</span>
<a name="line-17"></a>                                <span class='hs-comment'>-- Nothing after typechecking</span>
<a name="line-18"></a>        <span class='hs-layout'>(</span><span class='hs-conid'>GRHSs</span> <span class='hs-varid'>id</span> <span class='hs-varid'>body</span><span class='hs-layout'>)</span>
<a name="line-19"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Data</span><span class='hs-layout'>,</span> <span class='hs-conid'>Typeable</span><span class='hs-layout'>)</span>
<a name="line-20"></a>
<a name="line-21"></a><a name="isEmptyMatchGroup"></a><span class='hs-definition'>isEmptyMatchGroup</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>MatchGroup</span> <span class='hs-varid'>id</span> <span class='hs-varid'>body</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-22"></a><span class='hs-definition'>isEmptyMatchGroup</span> <span class='hs-layout'>(</span><span class='hs-conid'>MG</span> <span class='hs-layout'>{</span> <span class='hs-varid'>mg_alts</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ms</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>null</span> <span class='hs-varid'>ms</span>
<a name="line-23"></a>
<a name="line-24"></a><a name="matchGroupArity"></a><span class='hs-definition'>matchGroupArity</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>MatchGroup</span> <span class='hs-varid'>id</span> <span class='hs-varid'>body</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Arity</span>
<a name="line-25"></a><span class='hs-comment'>-- Precondition: MatchGroup is non-empty</span>
<a name="line-26"></a><span class='hs-comment'>-- This is called before type checking, when mg_arg_tys is not set</span>
<a name="line-27"></a><span class='hs-definition'>matchGroupArity</span> <span class='hs-layout'>(</span><span class='hs-conid'>MG</span> <span class='hs-layout'>{</span> <span class='hs-varid'>mg_alts</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>alts</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-28"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-layout'>(</span><span class='hs-varid'>alt1</span><span class='hs-conop'>:</span><span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>alts</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>length</span> <span class='hs-layout'>(</span><span class='hs-varid'>hsLMatchPats</span> <span class='hs-varid'>alt1</span><span class='hs-layout'>)</span>
<a name="line-29"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>        <span class='hs-keyglyph'>=</span> <span class='hs-varid'>panic</span> <span class='hs-str'>"matchGroupArity"</span>
<a name="line-30"></a>
<a name="line-31"></a><a name="hsLMatchPats"></a><span class='hs-definition'>hsLMatchPats</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LMatch</span> <span class='hs-varid'>id</span> <span class='hs-varid'>body</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LPat</span> <span class='hs-varid'>id</span><span class='hs-keyglyph'>]</span>
<a name="line-32"></a><span class='hs-definition'>hsLMatchPats</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>Match</span> <span class='hs-varid'>pats</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pats</span>
<a name="line-33"></a>
<a name="line-34"></a><a name="GRHSs"></a><span class='hs-comment'>-- | GRHSs are used both for pattern bindings and for Matches</span>
<a name="line-35"></a><a name="GRHSs"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>GRHSs</span> <span class='hs-varid'>id</span> <span class='hs-varid'>body</span>
<a name="line-36"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>GRHSs</span> <span class='hs-layout'>{</span>
<a name="line-37"></a>      <span class='hs-varid'>grhssGRHSs</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LGRHS</span> <span class='hs-varid'>id</span> <span class='hs-varid'>body</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span>       <span class='hs-comment'>-- ^ Guarded RHSs</span>
<a name="line-38"></a>      <span class='hs-varid'>grhssLocalBinds</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsLocalBinds</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- ^ The where clause</span>
<a name="line-39"></a>    <span class='hs-layout'>}</span> <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Data</span><span class='hs-layout'>,</span> <span class='hs-conid'>Typeable</span><span class='hs-layout'>)</span>
<a name="line-40"></a>
<a name="line-41"></a><a name="LGRHS"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LGRHS</span> <span class='hs-varid'>id</span> <span class='hs-varid'>body</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-conid'>GRHS</span> <span class='hs-varid'>id</span> <span class='hs-varid'>body</span><span class='hs-layout'>)</span>
<a name="line-42"></a>
<a name="line-43"></a><a name="GRHS"></a><span class='hs-comment'>-- | Guarded Right Hand Side.</span>
<a name="line-44"></a><a name="GRHS"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>GRHS</span> <span class='hs-varid'>id</span> <span class='hs-varid'>body</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>GRHS</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>GuardLStmt</span> <span class='hs-varid'>id</span><span class='hs-keyglyph'>]</span> <span class='hs-comment'>-- Guards</span>
<a name="line-45"></a>                         <span class='hs-varid'>body</span>            <span class='hs-comment'>-- Right hand side</span>
<a name="line-46"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Data</span><span class='hs-layout'>,</span> <span class='hs-conid'>Typeable</span><span class='hs-layout'>)</span>
</pre>\end{code}

We know the list must have at least one @Match@ in it.

\begin{code}
<pre><a name="line-1"></a><a name="pprMatches"></a><span class='hs-definition'>pprMatches</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>idL</span><span class='hs-layout'>,</span> <span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>idR</span><span class='hs-layout'>,</span> <span class='hs-conid'>Outputable</span> <span class='hs-varid'>body</span><span class='hs-layout'>)</span>
<a name="line-2"></a>           <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HsMatchContext</span> <span class='hs-varid'>idL</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>MatchGroup</span> <span class='hs-varid'>idR</span> <span class='hs-varid'>body</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-3"></a><span class='hs-definition'>pprMatches</span> <span class='hs-varid'>ctxt</span> <span class='hs-layout'>(</span><span class='hs-conid'>MG</span> <span class='hs-layout'>{</span> <span class='hs-varid'>mg_alts</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>matches</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-4"></a>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>vcat</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-varid'>pprMatch</span> <span class='hs-varid'>ctxt</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-varid'>unLoc</span> <span class='hs-varid'>matches</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-5"></a>      <span class='hs-comment'>-- Don't print the type; it's only a place-holder before typechecking</span>
<a name="line-6"></a>
<a name="line-7"></a><a name="pprFunBind"></a><span class='hs-comment'>-- Exported to HsBinds, which can't see the defn of HsMatchContext</span>
<a name="line-8"></a><span class='hs-definition'>pprFunBind</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>idL</span><span class='hs-layout'>,</span> <span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>idR</span><span class='hs-layout'>,</span> <span class='hs-conid'>Outputable</span> <span class='hs-varid'>body</span><span class='hs-layout'>)</span>
<a name="line-9"></a>           <span class='hs-keyglyph'>=&gt;</span> <span class='hs-varid'>idL</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>MatchGroup</span> <span class='hs-varid'>idR</span> <span class='hs-varid'>body</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-10"></a><span class='hs-definition'>pprFunBind</span> <span class='hs-varid'>fun</span> <span class='hs-varid'>inf</span> <span class='hs-varid'>matches</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprMatches</span> <span class='hs-layout'>(</span><span class='hs-conid'>FunRhs</span> <span class='hs-varid'>fun</span> <span class='hs-varid'>inf</span><span class='hs-layout'>)</span> <span class='hs-varid'>matches</span>
<a name="line-11"></a>
<a name="line-12"></a><a name="pprPatBind"></a><span class='hs-comment'>-- Exported to HsBinds, which can't see the defn of HsMatchContext</span>
<a name="line-13"></a><span class='hs-definition'>pprPatBind</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>bndr</span> <span class='hs-varid'>id</span> <span class='hs-varid'>body</span><span class='hs-varop'>.</span> <span class='hs-layout'>(</span><span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>bndr</span><span class='hs-layout'>,</span> <span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>id</span><span class='hs-layout'>,</span> <span class='hs-conid'>Outputable</span> <span class='hs-varid'>body</span><span class='hs-layout'>)</span>
<a name="line-14"></a>           <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>LPat</span> <span class='hs-varid'>bndr</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>GRHSs</span> <span class='hs-varid'>id</span> <span class='hs-varid'>body</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-15"></a><span class='hs-definition'>pprPatBind</span> <span class='hs-varid'>pat</span> <span class='hs-layout'>(</span><span class='hs-varid'>grhss</span><span class='hs-layout'>)</span>
<a name="line-16"></a> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>pat</span><span class='hs-layout'>,</span> <span class='hs-varid'>nest</span> <span class='hs-num'>2</span> <span class='hs-layout'>(</span><span class='hs-varid'>pprGRHSs</span> <span class='hs-layout'>(</span><span class='hs-conid'>PatBindRhs</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsMatchContext</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span> <span class='hs-varid'>grhss</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-17"></a>
<a name="line-18"></a><a name="pprMatch"></a><span class='hs-definition'>pprMatch</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>idL</span><span class='hs-layout'>,</span> <span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>idR</span><span class='hs-layout'>,</span> <span class='hs-conid'>Outputable</span> <span class='hs-varid'>body</span><span class='hs-layout'>)</span>
<a name="line-19"></a>         <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HsMatchContext</span> <span class='hs-varid'>idL</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Match</span> <span class='hs-varid'>idR</span> <span class='hs-varid'>body</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-20"></a><span class='hs-definition'>pprMatch</span> <span class='hs-varid'>ctxt</span> <span class='hs-layout'>(</span><span class='hs-conid'>Match</span> <span class='hs-varid'>pats</span> <span class='hs-varid'>maybe_ty</span> <span class='hs-varid'>grhss</span><span class='hs-layout'>)</span>
<a name="line-21"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>sep</span> <span class='hs-layout'>(</span><span class='hs-varid'>herald</span> <span class='hs-conop'>:</span> <span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-varid'>nest</span> <span class='hs-num'>2</span> <span class='hs-varop'>.</span> <span class='hs-varid'>pprParendLPat</span><span class='hs-layout'>)</span> <span class='hs-varid'>other_pats</span><span class='hs-layout'>)</span>
<a name="line-22"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>nest</span> <span class='hs-num'>2</span> <span class='hs-varid'>ppr_maybe_ty</span>
<a name="line-23"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>nest</span> <span class='hs-num'>2</span> <span class='hs-layout'>(</span><span class='hs-varid'>pprGRHSs</span> <span class='hs-varid'>ctxt</span> <span class='hs-varid'>grhss</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>]</span>
<a name="line-24"></a>  <span class='hs-keyword'>where</span>
<a name="line-25"></a>    <span class='hs-layout'>(</span><span class='hs-varid'>herald</span><span class='hs-layout'>,</span> <span class='hs-varid'>other_pats</span><span class='hs-layout'>)</span>
<a name="line-26"></a>        <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>ctxt</span> <span class='hs-keyword'>of</span>
<a name="line-27"></a>            <span class='hs-conid'>FunRhs</span> <span class='hs-varid'>fun</span> <span class='hs-varid'>is_infix</span>
<a name="line-28"></a>                <span class='hs-keyglyph'>|</span> <span class='hs-varid'>not</span> <span class='hs-varid'>is_infix</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>pprPrefixOcc</span> <span class='hs-varid'>fun</span><span class='hs-layout'>,</span> <span class='hs-varid'>pats</span><span class='hs-layout'>)</span>
<a name="line-29"></a>                        <span class='hs-comment'>-- f x y z = e</span>
<a name="line-30"></a>                        <span class='hs-comment'>-- Not pprBndr; the AbsBinds will</span>
<a name="line-31"></a>                        <span class='hs-comment'>-- have printed the signature</span>
<a name="line-32"></a>
<a name="line-33"></a>                <span class='hs-keyglyph'>|</span> <span class='hs-varid'>null</span> <span class='hs-varid'>pats2</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>pp_infix</span><span class='hs-layout'>,</span> <span class='hs-conid'>[]</span><span class='hs-layout'>)</span>
<a name="line-34"></a>                        <span class='hs-comment'>-- x &amp;&amp;&amp; y = e</span>
<a name="line-35"></a>
<a name="line-36"></a>                <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>parens</span> <span class='hs-varid'>pp_infix</span><span class='hs-layout'>,</span> <span class='hs-varid'>pats2</span><span class='hs-layout'>)</span>
<a name="line-37"></a>                        <span class='hs-comment'>-- (x &amp;&amp;&amp; y) z = e</span>
<a name="line-38"></a>                <span class='hs-keyword'>where</span>
<a name="line-39"></a>                  <span class='hs-varid'>pp_infix</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprParendLPat</span> <span class='hs-varid'>pat1</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>pprInfixOcc</span> <span class='hs-varid'>fun</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>pprParendLPat</span> <span class='hs-varid'>pat2</span>
<a name="line-40"></a>
<a name="line-41"></a>            <span class='hs-conid'>LambdaExpr</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>char</span> <span class='hs-chr'>'\\'</span><span class='hs-layout'>,</span> <span class='hs-varid'>pats</span><span class='hs-layout'>)</span>
<a name="line-42"></a>
<a name="line-43"></a>            <span class='hs-keyword'>_</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ASSERT</span><span class='hs-layout'>(</span> <span class='hs-varid'>null</span> <span class='hs-varid'>pats1</span> <span class='hs-layout'>)</span>
<a name="line-44"></a>                  <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>pat1</span><span class='hs-layout'>,</span> <span class='hs-conid'>[]</span><span class='hs-layout'>)</span>        <span class='hs-comment'>-- No parens around the single pat</span>
<a name="line-45"></a>
<a name="line-46"></a>    <span class='hs-layout'>(</span><span class='hs-varid'>pat1</span><span class='hs-conop'>:</span><span class='hs-varid'>pats1</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pats</span>
<a name="line-47"></a>    <span class='hs-layout'>(</span><span class='hs-varid'>pat2</span><span class='hs-conop'>:</span><span class='hs-varid'>pats2</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pats1</span>
<a name="line-48"></a>    <span class='hs-varid'>ppr_maybe_ty</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>maybe_ty</span> <span class='hs-keyword'>of</span>
<a name="line-49"></a>                        <span class='hs-conid'>Just</span> <span class='hs-varid'>ty</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>dcolon</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>ty</span>
<a name="line-50"></a>                        <span class='hs-conid'>Nothing</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>empty</span>
<a name="line-51"></a>
<a name="line-52"></a>
<a name="line-53"></a><a name="pprGRHSs"></a><span class='hs-definition'>pprGRHSs</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>idL</span><span class='hs-layout'>,</span> <span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>idR</span><span class='hs-layout'>,</span> <span class='hs-conid'>Outputable</span> <span class='hs-varid'>body</span><span class='hs-layout'>)</span>
<a name="line-54"></a>         <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HsMatchContext</span> <span class='hs-varid'>idL</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>GRHSs</span> <span class='hs-varid'>idR</span> <span class='hs-varid'>body</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-55"></a><span class='hs-definition'>pprGRHSs</span> <span class='hs-varid'>ctxt</span> <span class='hs-layout'>(</span><span class='hs-conid'>GRHSs</span> <span class='hs-varid'>grhss</span> <span class='hs-varid'>binds</span><span class='hs-layout'>)</span>
<a name="line-56"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>vcat</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-varid'>pprGRHS</span> <span class='hs-varid'>ctxt</span> <span class='hs-varop'>.</span> <span class='hs-varid'>unLoc</span><span class='hs-layout'>)</span> <span class='hs-varid'>grhss</span><span class='hs-layout'>)</span>
<a name="line-57"></a> <span class='hs-varop'>$$</span> <span class='hs-varid'>ppUnless</span> <span class='hs-layout'>(</span><span class='hs-varid'>isEmptyLocalBinds</span> <span class='hs-varid'>binds</span><span class='hs-layout'>)</span>
<a name="line-58"></a>      <span class='hs-layout'>(</span><span class='hs-varid'>text</span> <span class='hs-str'>"where"</span> <span class='hs-varop'>$$</span> <span class='hs-varid'>nest</span> <span class='hs-num'>4</span> <span class='hs-layout'>(</span><span class='hs-varid'>pprBinds</span> <span class='hs-varid'>binds</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-59"></a>
<a name="line-60"></a><a name="pprGRHS"></a><span class='hs-definition'>pprGRHS</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>idL</span><span class='hs-layout'>,</span> <span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>idR</span><span class='hs-layout'>,</span> <span class='hs-conid'>Outputable</span> <span class='hs-varid'>body</span><span class='hs-layout'>)</span>
<a name="line-61"></a>        <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HsMatchContext</span> <span class='hs-varid'>idL</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>GRHS</span> <span class='hs-varid'>idR</span> <span class='hs-varid'>body</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-62"></a><span class='hs-definition'>pprGRHS</span> <span class='hs-varid'>ctxt</span> <span class='hs-layout'>(</span><span class='hs-conid'>GRHS</span> <span class='hs-conid'>[]</span> <span class='hs-varid'>body</span><span class='hs-layout'>)</span>
<a name="line-63"></a> <span class='hs-keyglyph'>=</span>  <span class='hs-varid'>pp_rhs</span> <span class='hs-varid'>ctxt</span> <span class='hs-varid'>body</span>
<a name="line-64"></a>
<a name="line-65"></a><span class='hs-definition'>pprGRHS</span> <span class='hs-varid'>ctxt</span> <span class='hs-layout'>(</span><span class='hs-conid'>GRHS</span> <span class='hs-varid'>guards</span> <span class='hs-varid'>body</span><span class='hs-layout'>)</span>
<a name="line-66"></a> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>char</span> <span class='hs-chr'>'|'</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>interpp'SP</span> <span class='hs-varid'>guards</span><span class='hs-layout'>,</span> <span class='hs-varid'>pp_rhs</span> <span class='hs-varid'>ctxt</span> <span class='hs-varid'>body</span><span class='hs-keyglyph'>]</span>
<a name="line-67"></a>
<a name="line-68"></a><a name="pp_rhs"></a><span class='hs-definition'>pp_rhs</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Outputable</span> <span class='hs-varid'>body</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HsMatchContext</span> <span class='hs-varid'>idL</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>body</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-69"></a><span class='hs-definition'>pp_rhs</span> <span class='hs-varid'>ctxt</span> <span class='hs-varid'>rhs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>matchSeparator</span> <span class='hs-varid'>ctxt</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>pprDeeper</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>rhs</span><span class='hs-layout'>)</span>
</pre>\end{code}

%************************************************************************
%*                                                                      *
\subsection{Do stmts and list comprehensions}
%*                                                                      *
%************************************************************************

\begin{code}
<pre><a name="line-1"></a><a name="LStmt"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LStmt</span> <span class='hs-varid'>id</span> <span class='hs-varid'>body</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-conid'>StmtLR</span> <span class='hs-varid'>id</span> <span class='hs-varid'>id</span> <span class='hs-varid'>body</span><span class='hs-layout'>)</span>
<a name="line-2"></a><a name="LStmtLR"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LStmtLR</span> <span class='hs-varid'>idL</span> <span class='hs-varid'>idR</span> <span class='hs-varid'>body</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-conid'>StmtLR</span> <span class='hs-varid'>idL</span> <span class='hs-varid'>idR</span> <span class='hs-varid'>body</span><span class='hs-layout'>)</span>
<a name="line-3"></a>
<a name="line-4"></a><a name="Stmt"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>Stmt</span> <span class='hs-varid'>id</span> <span class='hs-varid'>body</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>StmtLR</span> <span class='hs-varid'>id</span> <span class='hs-varid'>id</span> <span class='hs-varid'>body</span>
<a name="line-5"></a>
<a name="line-6"></a><a name="CmdLStmt"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>CmdLStmt</span>   <span class='hs-varid'>id</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>LStmt</span> <span class='hs-varid'>id</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsCmd</span>  <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-7"></a><a name="CmdStmt"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>CmdStmt</span>    <span class='hs-varid'>id</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Stmt</span>  <span class='hs-varid'>id</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsCmd</span>  <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-8"></a><a name="ExprLStmt"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>ExprLStmt</span>  <span class='hs-varid'>id</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>LStmt</span> <span class='hs-varid'>id</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-9"></a><a name="ExprStmt"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>ExprStmt</span>   <span class='hs-varid'>id</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Stmt</span>  <span class='hs-varid'>id</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-10"></a>
<a name="line-11"></a><a name="GuardLStmt"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>GuardLStmt</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>LStmt</span> <span class='hs-varid'>id</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-12"></a><a name="GuardStmt"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>GuardStmt</span>  <span class='hs-varid'>id</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Stmt</span>  <span class='hs-varid'>id</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-13"></a><a name="GhciLStmt"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>GhciLStmt</span>  <span class='hs-varid'>id</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>LStmt</span> <span class='hs-varid'>id</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-14"></a><a name="GhciStmt"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>GhciStmt</span>   <span class='hs-varid'>id</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Stmt</span>  <span class='hs-varid'>id</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-15"></a>
<a name="line-16"></a><a name="StmtLR"></a><span class='hs-comment'>-- The SyntaxExprs in here are used *only* for do-notation and monad</span>
<a name="line-17"></a><a name="StmtLR"></a><span class='hs-comment'>-- comprehensions, which have rebindable syntax. Otherwise they are unused.</span>
<a name="line-18"></a><a name="StmtLR"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>StmtLR</span> <span class='hs-varid'>idL</span> <span class='hs-varid'>idR</span> <span class='hs-varid'>body</span> <span class='hs-comment'>-- body should always be (LHs**** idR)</span>
<a name="line-19"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>LastStmt</span>  <span class='hs-comment'>-- Always the last Stmt in ListComp, MonadComp, PArrComp,</span>
<a name="line-20"></a>              <span class='hs-comment'>-- and (after the renamer) DoExpr, MDoExpr</span>
<a name="line-21"></a>              <span class='hs-comment'>-- Not used for GhciStmtCtxt, PatGuard, which scope over other stuff</span>
<a name="line-22"></a>               <span class='hs-varid'>body</span>
<a name="line-23"></a>               <span class='hs-layout'>(</span><span class='hs-conid'>SyntaxExpr</span> <span class='hs-varid'>idR</span><span class='hs-layout'>)</span>   <span class='hs-comment'>-- The return operator, used only for MonadComp</span>
<a name="line-24"></a>                                  <span class='hs-comment'>-- For ListComp, PArrComp, we use the baked-in 'return'</span>
<a name="line-25"></a>                                  <span class='hs-comment'>-- For DoExpr, MDoExpr, we don't appply a 'return' at all</span>
<a name="line-26"></a>                                  <span class='hs-comment'>-- See Note [Monad Comprehensions]</span>
<a name="line-27"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>BindStmt</span> <span class='hs-layout'>(</span><span class='hs-conid'>LPat</span> <span class='hs-varid'>idL</span><span class='hs-layout'>)</span>
<a name="line-28"></a>             <span class='hs-varid'>body</span>
<a name="line-29"></a>             <span class='hs-layout'>(</span><span class='hs-conid'>SyntaxExpr</span> <span class='hs-varid'>idR</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- The (&gt;&gt;=) operator; see Note [The type of bind]</span>
<a name="line-30"></a>             <span class='hs-layout'>(</span><span class='hs-conid'>SyntaxExpr</span> <span class='hs-varid'>idR</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- The fail operator</span>
<a name="line-31"></a>             <span class='hs-comment'>-- The fail operator is noSyntaxExpr</span>
<a name="line-32"></a>             <span class='hs-comment'>-- if the pattern match can't fail</span>
<a name="line-33"></a>
<a name="line-34"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>BodyStmt</span> <span class='hs-varid'>body</span>             <span class='hs-comment'>-- See Note [BodyStmt]</span>
<a name="line-35"></a>             <span class='hs-layout'>(</span><span class='hs-conid'>SyntaxExpr</span> <span class='hs-varid'>idR</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- The (&gt;&gt;) operator</span>
<a name="line-36"></a>             <span class='hs-layout'>(</span><span class='hs-conid'>SyntaxExpr</span> <span class='hs-varid'>idR</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- The `guard` operator; used only in MonadComp</span>
<a name="line-37"></a>                              <span class='hs-comment'>-- See notes [Monad Comprehensions]</span>
<a name="line-38"></a>             <span class='hs-conid'>PostTcType</span>       <span class='hs-comment'>-- Element type of the RHS (used for arrows)</span>
<a name="line-39"></a>
<a name="line-40"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LetStmt</span>  <span class='hs-layout'>(</span><span class='hs-conid'>HsLocalBindsLR</span> <span class='hs-varid'>idL</span> <span class='hs-varid'>idR</span><span class='hs-layout'>)</span>
<a name="line-41"></a>
<a name="line-42"></a>  <span class='hs-comment'>-- ParStmts only occur in a list/monad comprehension</span>
<a name="line-43"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ParStmt</span>  <span class='hs-keyglyph'>[</span><span class='hs-conid'>ParStmtBlock</span> <span class='hs-varid'>idL</span> <span class='hs-varid'>idR</span><span class='hs-keyglyph'>]</span>
<a name="line-44"></a>             <span class='hs-layout'>(</span><span class='hs-conid'>SyntaxExpr</span> <span class='hs-varid'>idR</span><span class='hs-layout'>)</span>           <span class='hs-comment'>-- Polymorphic `mzip` for monad comprehensions</span>
<a name="line-45"></a>             <span class='hs-layout'>(</span><span class='hs-conid'>SyntaxExpr</span> <span class='hs-varid'>idR</span><span class='hs-layout'>)</span>           <span class='hs-comment'>-- The `&gt;&gt;=` operator</span>
<a name="line-46"></a>                                        <span class='hs-comment'>-- See notes [Monad Comprehensions]</span>
<a name="line-47"></a>            <span class='hs-comment'>-- After renaming, the ids are the binders</span>
<a name="line-48"></a>            <span class='hs-comment'>-- bound by the stmts and used after themp</span>
<a name="line-49"></a>
<a name="line-50"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>TransStmt</span> <span class='hs-layout'>{</span>
<a name="line-51"></a>      <span class='hs-varid'>trS_form</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TransForm</span><span class='hs-layout'>,</span>
<a name="line-52"></a>      <span class='hs-varid'>trS_stmts</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>ExprLStmt</span> <span class='hs-varid'>idL</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span>   <span class='hs-comment'>-- Stmts to the *left* of the 'group'</span>
<a name="line-53"></a>                                      <span class='hs-comment'>-- which generates the tuples to be grouped</span>
<a name="line-54"></a>
<a name="line-55"></a>      <span class='hs-varid'>trS_bndrs</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-layout'>(</span><span class='hs-varid'>idR</span><span class='hs-layout'>,</span> <span class='hs-varid'>idR</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span>      <span class='hs-comment'>-- See Note [TransStmt binder map]</span>
<a name="line-56"></a>
<a name="line-57"></a>      <span class='hs-varid'>trS_using</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>idR</span><span class='hs-layout'>,</span>
<a name="line-58"></a>      <span class='hs-varid'>trS_by</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>idR</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>  <span class='hs-comment'>-- "by e" (optional)</span>
<a name="line-59"></a>        <span class='hs-comment'>-- Invariant: if trS_form = GroupBy, then grp_by = Just e</span>
<a name="line-60"></a>
<a name="line-61"></a>      <span class='hs-varid'>trS_ret</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SyntaxExpr</span> <span class='hs-varid'>idR</span><span class='hs-layout'>,</span>      <span class='hs-comment'>-- The monomorphic 'return' function for</span>
<a name="line-62"></a>                                      <span class='hs-comment'>-- the inner monad comprehensions</span>
<a name="line-63"></a>      <span class='hs-varid'>trS_bind</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SyntaxExpr</span> <span class='hs-varid'>idR</span><span class='hs-layout'>,</span>     <span class='hs-comment'>-- The '(&gt;&gt;=)' operator</span>
<a name="line-64"></a>      <span class='hs-varid'>trS_fmap</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SyntaxExpr</span> <span class='hs-varid'>idR</span>      <span class='hs-comment'>-- The polymorphic 'fmap' function for desugaring</span>
<a name="line-65"></a>                                      <span class='hs-comment'>-- Only for 'group' forms</span>
<a name="line-66"></a>    <span class='hs-layout'>}</span>                                 <span class='hs-comment'>-- See Note [Monad Comprehensions]</span>
<a name="line-67"></a>
<a name="line-68"></a>  <span class='hs-comment'>-- Recursive statement (see Note [How RecStmt works] below)</span>
<a name="line-69"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>RecStmt</span>
<a name="line-70"></a>     <span class='hs-layout'>{</span> <span class='hs-varid'>recS_stmts</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LStmtLR</span> <span class='hs-varid'>idL</span> <span class='hs-varid'>idR</span> <span class='hs-varid'>body</span><span class='hs-keyglyph'>]</span>
<a name="line-71"></a>
<a name="line-72"></a>        <span class='hs-comment'>-- The next two fields are only valid after renaming</span>
<a name="line-73"></a>     <span class='hs-layout'>,</span> <span class='hs-varid'>recS_later_ids</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>idR</span><span class='hs-keyglyph'>]</span> <span class='hs-comment'>-- The ids are a subset of the variables bound by the</span>
<a name="line-74"></a>                               <span class='hs-comment'>-- stmts that are used in stmts that follow the RecStmt</span>
<a name="line-75"></a>
<a name="line-76"></a>     <span class='hs-layout'>,</span> <span class='hs-varid'>recS_rec_ids</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>idR</span><span class='hs-keyglyph'>]</span>   <span class='hs-comment'>-- Ditto, but these variables are the "recursive" ones,</span>
<a name="line-77"></a>                               <span class='hs-comment'>-- that are used before they are bound in the stmts of</span>
<a name="line-78"></a>                               <span class='hs-comment'>-- the RecStmt.</span>
<a name="line-79"></a>        <span class='hs-comment'>-- An Id can be in both groups</span>
<a name="line-80"></a>        <span class='hs-comment'>-- Both sets of Ids are (now) treated monomorphically</span>
<a name="line-81"></a>        <span class='hs-comment'>-- See Note [How RecStmt works] for why they are separate</span>
<a name="line-82"></a>
<a name="line-83"></a>        <span class='hs-comment'>-- Rebindable syntax</span>
<a name="line-84"></a>     <span class='hs-layout'>,</span> <span class='hs-varid'>recS_bind_fn</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SyntaxExpr</span> <span class='hs-varid'>idR</span> <span class='hs-comment'>-- The bind function</span>
<a name="line-85"></a>     <span class='hs-layout'>,</span> <span class='hs-varid'>recS_ret_fn</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SyntaxExpr</span> <span class='hs-varid'>idR</span> <span class='hs-comment'>-- The return function</span>
<a name="line-86"></a>     <span class='hs-layout'>,</span> <span class='hs-varid'>recS_mfix_fn</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SyntaxExpr</span> <span class='hs-varid'>idR</span> <span class='hs-comment'>-- The mfix function</span>
<a name="line-87"></a>
<a name="line-88"></a>        <span class='hs-comment'>-- These fields are only valid after typechecking</span>
<a name="line-89"></a>     <span class='hs-layout'>,</span> <span class='hs-varid'>recS_later_rets</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>PostTcExpr</span><span class='hs-keyglyph'>]</span> <span class='hs-comment'>-- (only used in the arrow version)</span>
<a name="line-90"></a>     <span class='hs-layout'>,</span> <span class='hs-varid'>recS_rec_rets</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>PostTcExpr</span><span class='hs-keyglyph'>]</span> <span class='hs-comment'>-- These expressions correspond 1-to-1</span>
<a name="line-91"></a>                                     <span class='hs-comment'>-- with recS_later_ids and recS_rec_ids,</span>
<a name="line-92"></a>                                     <span class='hs-comment'>-- and are the expressions that should be</span>
<a name="line-93"></a>                                     <span class='hs-comment'>-- returned by the recursion.</span>
<a name="line-94"></a>                                     <span class='hs-comment'>-- They may not quite be the Ids themselves,</span>
<a name="line-95"></a>                                     <span class='hs-comment'>-- because the Id may be *polymorphic*, but</span>
<a name="line-96"></a>                                     <span class='hs-comment'>-- the returned thing has to be *monomorphic*,</span>
<a name="line-97"></a>                                     <span class='hs-comment'>-- so they may be type applications</span>
<a name="line-98"></a>
<a name="line-99"></a>      <span class='hs-layout'>,</span> <span class='hs-varid'>recS_ret_ty</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>PostTcType</span>    <span class='hs-comment'>-- The type of of do { stmts; return (a,b,c) }</span>
<a name="line-100"></a>                                     <span class='hs-comment'>-- With rebindable syntax the type might not</span>
<a name="line-101"></a>                                     <span class='hs-comment'>-- be quite as simple as (m (tya, tyb, tyc)).</span>
<a name="line-102"></a>      <span class='hs-layout'>}</span>
<a name="line-103"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Data</span><span class='hs-layout'>,</span> <span class='hs-conid'>Typeable</span><span class='hs-layout'>)</span>
<a name="line-104"></a>
<a name="line-105"></a><a name="TransForm"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>TransForm</span>   <span class='hs-comment'>-- The 'f' below is the 'using' function, 'e' is the by function</span>
<a name="line-106"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ThenForm</span>     <span class='hs-comment'>-- then f               or    then f by e             (depending on trS_by)</span>
<a name="line-107"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>GroupForm</span>    <span class='hs-comment'>-- then group using f   or    then group by e using f (depending on trS_by)</span>
<a name="line-108"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Data</span><span class='hs-layout'>,</span> <span class='hs-conid'>Typeable</span><span class='hs-layout'>)</span>
<a name="line-109"></a>
<a name="line-110"></a><a name="ParStmtBlock"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>ParStmtBlock</span> <span class='hs-varid'>idL</span> <span class='hs-varid'>idR</span>
<a name="line-111"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ParStmtBlock</span>
<a name="line-112"></a>        <span class='hs-keyglyph'>[</span><span class='hs-conid'>ExprLStmt</span> <span class='hs-varid'>idL</span><span class='hs-keyglyph'>]</span>
<a name="line-113"></a>        <span class='hs-keyglyph'>[</span><span class='hs-varid'>idR</span><span class='hs-keyglyph'>]</span>              <span class='hs-comment'>-- The variables to be returned</span>
<a name="line-114"></a>        <span class='hs-layout'>(</span><span class='hs-conid'>SyntaxExpr</span> <span class='hs-varid'>idR</span><span class='hs-layout'>)</span>   <span class='hs-comment'>-- The return operator</span>
<a name="line-115"></a>  <span class='hs-keyword'>deriving</span><span class='hs-layout'>(</span> <span class='hs-conid'>Data</span><span class='hs-layout'>,</span> <span class='hs-conid'>Typeable</span> <span class='hs-layout'>)</span>
</pre>\end{code}

Note [The type of bind in Stmts]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Some Stmts, notably BindStmt, keep the (>>=) bind operator.
We do NOT assume that it has type
    (>>=) :: m a -> (a -> m b) -> m b
In some cases (see Trac #303, #1537) it might have a more
exotic type, such as
    (>>=) :: m i j a -> (a -> m j k b) -> m i k b
So we must be careful not to make assumptions about the type.
In particular, the monad may not be uniform throughout.

Note [TransStmt binder map]
~~~~~~~~~~~~~~~~~~~~~~~~~~~
The [(idR,idR)] in a TransStmt behaves as follows:

  * Before renaming: []

  * After renaming:
          [ (x27,x27), ..., (z35,z35) ]
    These are the variables
       bound by the stmts to the left of the 'group'
       and used either in the 'by' clause,
                or     in the stmts following the 'group'
    Each item is a pair of identical variables.

  * After typechecking:
          [ (x27:Int, x27:[Int]), ..., (z35:Bool, z35:[Bool]) ]
    Each pair has the same unique, but different *types*.

Note [BodyStmt]
~~~~~~~~~~~~~~~
BodyStmts are a bit tricky, because what they mean
depends on the context.  Consider the following contexts:

        A do expression of type (m res_ty)
        ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
        * BodyStmt E any_ty:   do { ....; E; ... }
                E :: m any_ty
          Translation: E >> ...

        A list comprehensions of type [elt_ty]
        ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
        * BodyStmt E Bool:   [ .. | .... E ]
                        [ .. | ..., E, ... ]
                        [ .. | .... | ..., E | ... ]
                E :: Bool
          Translation: if E then fail else ...

        A guard list, guarding a RHS of type rhs_ty
        ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
        * BodyStmt E BooParStmtBlockl:   f x | ..., E, ... = ...rhs...
                E :: Bool
          Translation: if E then fail else ...

        A monad comprehension of type (m res_ty)
        ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
        * BodyStmt E Bool:   [ .. | .... E ]
                E :: Bool
          Translation: guard E >> ...

Array comprehensions are handled like list comprehensions.

Note [How RecStmt works]
~~~~~~~~~~~~~~~~~~~~~~~~
Example:
   HsDo [ BindStmt x ex

        , RecStmt { recS_rec_ids   = [a, c]
                  , recS_stmts     = [ BindStmt b (return (a,c))
                                     , LetStmt a = ...b...
                                     , BindStmt c ec ]
                  , recS_later_ids = [a, b]

        , return (a b) ]

Here, the RecStmt binds a,b,c; but
  - Only a,b are used in the stmts *following* the RecStmt,
  - Only a,c are used in the stmts *inside* the RecStmt
        *before* their bindings

Why do we need *both* rec_ids and later_ids?  For monads they could be
combined into a single set of variables, but not for arrows.  That
follows from the types of the respective feedback operators:

        mfix :: MonadFix m => (a -> m a) -> m a
        loop :: ArrowLoop a => a (b,d) (c,d) -> a b c

* For mfix, the 'a' covers the union of the later_ids and the rec_ids
* For 'loop', 'c' is the later_ids and 'd' is the rec_ids

Note [Typing a RecStmt]
~~~~~~~~~~~~~~~~~~~~~~~
A (RecStmt stmts) types as if you had written

  (v1,..,vn, _, ..., _) <- mfix (\~(_, ..., _, r1, ..., rm) ->
                                 do { stmts
                                    ; return (v1,..vn, r1, ..., rm) })

where v1..vn are the later_ids
      r1..rm are the rec_ids

Note [Monad Comprehensions]
~~~~~~~~~~~~~~~~~~~~~~~~~~~
Monad comprehensions require separate functions like 'return' and
'>>=' for desugaring. These functions are stored in the statements
used in monad comprehensions. For example, the 'return' of the 'LastStmt'
expression is used to lift the body of the monad comprehension:

  [ body | stmts ]
   =>
  stmts >>= \bndrs -> return body

In transform and grouping statements ('then ..' and 'then group ..') the
'return' function is required for nested monad comprehensions, for example:

  [ body | stmts, then f, rest ]
   =>
  f [ env | stmts ] >>= \bndrs -> [ body | rest ]

BodyStmts require the 'Control.Monad.guard' function for boolean
expressions:

  [ body | exp, stmts ]
   =>
  guard exp >> [ body | stmts ]

Parallel statements require the 'Control.Monad.Zip.mzip' function:

  [ body | stmts1 | stmts2 | .. ]
   =>
  mzip stmts1 (mzip stmts2 (..)) >>= \(bndrs1, (bndrs2, ..)) -> return body

In any other context than 'MonadComp', the fields for most of these
'SyntaxExpr's stay bottom.


\begin{code}
<pre><a name="line-1"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>idL</span><span class='hs-layout'>,</span> <span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>idR</span><span class='hs-layout'>)</span>
<a name="line-2"></a>    <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Outputable</span> <span class='hs-layout'>(</span><span class='hs-conid'>ParStmtBlock</span> <span class='hs-varid'>idL</span> <span class='hs-varid'>idR</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-3"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>ParStmtBlock</span> <span class='hs-varid'>stmts</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>interpp'SP</span> <span class='hs-varid'>stmts</span>
<a name="line-4"></a>
<a name="line-5"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>idL</span><span class='hs-layout'>,</span> <span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>idR</span><span class='hs-layout'>,</span> <span class='hs-conid'>Outputable</span> <span class='hs-varid'>body</span><span class='hs-layout'>)</span>
<a name="line-6"></a>         <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Outputable</span> <span class='hs-layout'>(</span><span class='hs-conid'>StmtLR</span> <span class='hs-varid'>idL</span> <span class='hs-varid'>idR</span> <span class='hs-varid'>body</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-7"></a>    <span class='hs-varid'>ppr</span> <span class='hs-varid'>stmt</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprStmt</span> <span class='hs-varid'>stmt</span>
<a name="line-8"></a>
<a name="line-9"></a><a name="pprStmt"></a><span class='hs-definition'>pprStmt</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>idL</span><span class='hs-layout'>,</span> <span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>idR</span><span class='hs-layout'>,</span> <span class='hs-conid'>Outputable</span> <span class='hs-varid'>body</span><span class='hs-layout'>)</span>
<a name="line-10"></a>        <span class='hs-keyglyph'>=&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>StmtLR</span> <span class='hs-varid'>idL</span> <span class='hs-varid'>idR</span> <span class='hs-varid'>body</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-11"></a><span class='hs-definition'>pprStmt</span> <span class='hs-layout'>(</span><span class='hs-conid'>LastStmt</span> <span class='hs-varid'>expr</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>         <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ifPprDebug</span> <span class='hs-layout'>(</span><span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"[last]"</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>expr</span>
<a name="line-12"></a><span class='hs-definition'>pprStmt</span> <span class='hs-layout'>(</span><span class='hs-conid'>BindStmt</span> <span class='hs-varid'>pat</span> <span class='hs-varid'>expr</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hsep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>pat</span><span class='hs-layout'>,</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"&lt;-"</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>expr</span><span class='hs-keyglyph'>]</span>
<a name="line-13"></a><span class='hs-definition'>pprStmt</span> <span class='hs-layout'>(</span><span class='hs-conid'>LetStmt</span> <span class='hs-varid'>binds</span><span class='hs-layout'>)</span>           <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hsep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"let"</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprBinds</span> <span class='hs-varid'>binds</span><span class='hs-keyglyph'>]</span>
<a name="line-14"></a><span class='hs-definition'>pprStmt</span> <span class='hs-layout'>(</span><span class='hs-conid'>BodyStmt</span> <span class='hs-varid'>expr</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>expr</span>
<a name="line-15"></a><span class='hs-definition'>pprStmt</span> <span class='hs-layout'>(</span><span class='hs-conid'>ParStmt</span> <span class='hs-varid'>stmtss</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sep</span> <span class='hs-layout'>(</span><span class='hs-varid'>punctuate</span> <span class='hs-layout'>(</span><span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>" | "</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>stmtss</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-16"></a>
<a name="line-17"></a><span class='hs-definition'>pprStmt</span> <span class='hs-layout'>(</span><span class='hs-conid'>TransStmt</span> <span class='hs-layout'>{</span> <span class='hs-varid'>trS_stmts</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>stmts</span><span class='hs-layout'>,</span> <span class='hs-varid'>trS_by</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>by</span><span class='hs-layout'>,</span> <span class='hs-varid'>trS_using</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>using</span><span class='hs-layout'>,</span> <span class='hs-varid'>trS_form</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>form</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-18"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sep</span> <span class='hs-varop'>$</span> <span class='hs-varid'>punctuate</span> <span class='hs-varid'>comma</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>stmts</span> <span class='hs-varop'>++</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>pprTransStmt</span> <span class='hs-varid'>by</span> <span class='hs-varid'>using</span> <span class='hs-varid'>form</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-19"></a>
<a name="line-20"></a><span class='hs-definition'>pprStmt</span> <span class='hs-layout'>(</span><span class='hs-conid'>RecStmt</span> <span class='hs-layout'>{</span> <span class='hs-varid'>recS_stmts</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>segment</span><span class='hs-layout'>,</span> <span class='hs-varid'>recS_rec_ids</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>rec_ids</span>
<a name="line-21"></a>                 <span class='hs-layout'>,</span> <span class='hs-varid'>recS_later_ids</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>later_ids</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-22"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"rec"</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;+&gt;</span>
<a name="line-23"></a>    <span class='hs-varid'>vcat</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>ppr_do_stmts</span> <span class='hs-varid'>segment</span>
<a name="line-24"></a>         <span class='hs-layout'>,</span> <span class='hs-varid'>ifPprDebug</span> <span class='hs-layout'>(</span><span class='hs-varid'>vcat</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"rec_ids="</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>rec_ids</span>
<a name="line-25"></a>                            <span class='hs-layout'>,</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"later_ids="</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>later_ids</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-26"></a>
<a name="line-27"></a><a name="pprTransformStmt"></a><span class='hs-definition'>pprTransformStmt</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>id</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-28"></a><span class='hs-definition'>pprTransformStmt</span> <span class='hs-varid'>bndrs</span> <span class='hs-varid'>using</span> <span class='hs-varid'>by</span>
<a name="line-29"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"then"</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ifPprDebug</span> <span class='hs-layout'>(</span><span class='hs-varid'>braces</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>bndrs</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-30"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>nest</span> <span class='hs-num'>2</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>using</span><span class='hs-layout'>)</span>
<a name="line-31"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>nest</span> <span class='hs-num'>2</span> <span class='hs-layout'>(</span><span class='hs-varid'>pprBy</span> <span class='hs-varid'>by</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-32"></a>
<a name="line-33"></a><a name="pprTransStmt"></a><span class='hs-definition'>pprTransStmt</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Outputable</span> <span class='hs-varid'>body</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-varid'>body</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>body</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TransForm</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-34"></a><span class='hs-definition'>pprTransStmt</span> <span class='hs-varid'>by</span> <span class='hs-varid'>using</span> <span class='hs-conid'>ThenForm</span>
<a name="line-35"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"then"</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>nest</span> <span class='hs-num'>2</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>using</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>nest</span> <span class='hs-num'>2</span> <span class='hs-layout'>(</span><span class='hs-varid'>pprBy</span> <span class='hs-varid'>by</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-36"></a><span class='hs-definition'>pprTransStmt</span> <span class='hs-varid'>by</span> <span class='hs-varid'>using</span> <span class='hs-conid'>GroupForm</span>
<a name="line-37"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"then group"</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>nest</span> <span class='hs-num'>2</span> <span class='hs-layout'>(</span><span class='hs-varid'>pprBy</span> <span class='hs-varid'>by</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>nest</span> <span class='hs-num'>2</span> <span class='hs-layout'>(</span><span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"using"</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>using</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-38"></a>
<a name="line-39"></a><a name="pprBy"></a><span class='hs-definition'>pprBy</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Outputable</span> <span class='hs-varid'>body</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-varid'>body</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-40"></a><span class='hs-definition'>pprBy</span> <span class='hs-conid'>Nothing</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>empty</span>
<a name="line-41"></a><span class='hs-definition'>pprBy</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"by"</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>e</span>
<a name="line-42"></a>
<a name="line-43"></a><a name="pprDo"></a><span class='hs-definition'>pprDo</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>id</span><span class='hs-layout'>,</span> <span class='hs-conid'>Outputable</span> <span class='hs-varid'>body</span><span class='hs-layout'>)</span>
<a name="line-44"></a>      <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HsStmtContext</span> <span class='hs-varid'>any</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LStmt</span> <span class='hs-varid'>id</span> <span class='hs-varid'>body</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-45"></a><span class='hs-definition'>pprDo</span> <span class='hs-conid'>DoExpr</span>        <span class='hs-varid'>stmts</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"do"</span><span class='hs-layout'>)</span>  <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr_do_stmts</span> <span class='hs-varid'>stmts</span>
<a name="line-46"></a><span class='hs-definition'>pprDo</span> <span class='hs-conid'>GhciStmtCtxt</span>  <span class='hs-varid'>stmts</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"do"</span><span class='hs-layout'>)</span>  <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr_do_stmts</span> <span class='hs-varid'>stmts</span>
<a name="line-47"></a><span class='hs-definition'>pprDo</span> <span class='hs-conid'>ArrowExpr</span>     <span class='hs-varid'>stmts</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"do"</span><span class='hs-layout'>)</span>  <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr_do_stmts</span> <span class='hs-varid'>stmts</span>
<a name="line-48"></a><span class='hs-definition'>pprDo</span> <span class='hs-conid'>MDoExpr</span>       <span class='hs-varid'>stmts</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"mdo"</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr_do_stmts</span> <span class='hs-varid'>stmts</span>
<a name="line-49"></a><span class='hs-definition'>pprDo</span> <span class='hs-conid'>ListComp</span>      <span class='hs-varid'>stmts</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>brackets</span>    <span class='hs-varop'>$</span> <span class='hs-varid'>pprComp</span> <span class='hs-varid'>stmts</span>
<a name="line-50"></a><span class='hs-definition'>pprDo</span> <span class='hs-conid'>PArrComp</span>      <span class='hs-varid'>stmts</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>paBrackets</span>  <span class='hs-varop'>$</span> <span class='hs-varid'>pprComp</span> <span class='hs-varid'>stmts</span>
<a name="line-51"></a><span class='hs-definition'>pprDo</span> <span class='hs-conid'>MonadComp</span>     <span class='hs-varid'>stmts</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>brackets</span>    <span class='hs-varop'>$</span> <span class='hs-varid'>pprComp</span> <span class='hs-varid'>stmts</span>
<a name="line-52"></a><span class='hs-definition'>pprDo</span> <span class='hs-keyword'>_</span>             <span class='hs-keyword'>_</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>panic</span> <span class='hs-str'>"pprDo"</span> <span class='hs-comment'>-- PatGuard, ParStmtCxt</span>
<a name="line-53"></a>
<a name="line-54"></a><a name="ppr_do_stmts"></a><span class='hs-definition'>ppr_do_stmts</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>idL</span><span class='hs-layout'>,</span> <span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>idR</span><span class='hs-layout'>,</span> <span class='hs-conid'>Outputable</span> <span class='hs-varid'>body</span><span class='hs-layout'>)</span>
<a name="line-55"></a>             <span class='hs-keyglyph'>=&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LStmtLR</span> <span class='hs-varid'>idL</span> <span class='hs-varid'>idR</span> <span class='hs-varid'>body</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-56"></a><span class='hs-comment'>-- Print a bunch of do stmts, with explicit braces and semicolons,</span>
<a name="line-57"></a><span class='hs-comment'>-- so that we are not vulnerable to layout bugs</span>
<a name="line-58"></a><span class='hs-definition'>ppr_do_stmts</span> <span class='hs-varid'>stmts</span>
<a name="line-59"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>lbrace</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>pprDeeperList</span> <span class='hs-varid'>vcat</span> <span class='hs-layout'>(</span><span class='hs-varid'>punctuate</span> <span class='hs-varid'>semi</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>stmts</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-60"></a>           <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>rbrace</span>
<a name="line-61"></a>
<a name="line-62"></a><a name="pprComp"></a><span class='hs-definition'>pprComp</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>id</span><span class='hs-layout'>,</span> <span class='hs-conid'>Outputable</span> <span class='hs-varid'>body</span><span class='hs-layout'>)</span>
<a name="line-63"></a>        <span class='hs-keyglyph'>=&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LStmt</span> <span class='hs-varid'>id</span> <span class='hs-varid'>body</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-64"></a><span class='hs-definition'>pprComp</span> <span class='hs-varid'>quals</span>     <span class='hs-comment'>-- Prints:  body | qual1, ..., qualn</span>
<a name="line-65"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>not</span> <span class='hs-layout'>(</span><span class='hs-varid'>null</span> <span class='hs-varid'>quals</span><span class='hs-layout'>)</span>
<a name="line-66"></a>  <span class='hs-layout'>,</span> <span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>LastStmt</span> <span class='hs-varid'>body</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>last</span> <span class='hs-varid'>quals</span>
<a name="line-67"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hang</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>body</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'|'</span><span class='hs-layout'>)</span> <span class='hs-num'>2</span> <span class='hs-layout'>(</span><span class='hs-varid'>pprQuals</span> <span class='hs-layout'>(</span><span class='hs-varid'>dropTail</span> <span class='hs-num'>1</span> <span class='hs-varid'>quals</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-68"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>
<a name="line-69"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprPanic</span> <span class='hs-str'>"pprComp"</span> <span class='hs-layout'>(</span><span class='hs-varid'>pprQuals</span> <span class='hs-varid'>quals</span><span class='hs-layout'>)</span>
<a name="line-70"></a>
<a name="line-71"></a><a name="pprQuals"></a><span class='hs-definition'>pprQuals</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>id</span><span class='hs-layout'>,</span> <span class='hs-conid'>Outputable</span> <span class='hs-varid'>body</span><span class='hs-layout'>)</span>
<a name="line-72"></a>        <span class='hs-keyglyph'>=&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LStmt</span> <span class='hs-varid'>id</span> <span class='hs-varid'>body</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-73"></a><span class='hs-comment'>-- Show list comprehension qualifiers separated by commas</span>
<a name="line-74"></a><span class='hs-definition'>pprQuals</span> <span class='hs-varid'>quals</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>interpp'SP</span> <span class='hs-varid'>quals</span>
</pre>\end{code}

%************************************************************************
%*                                                                      *
                Template Haskell quotation brackets
%*                                                                      *
%************************************************************************

\begin{code}
<pre><a name="line-1"></a><a name="HsSplice"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>HsSplice</span> <span class='hs-varid'>id</span>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HsSplice</span>            <span class='hs-comment'>--  $z  or $(f 4)</span>
<a name="line-2"></a>                        <span class='hs-varid'>id</span>              <span class='hs-comment'>-- The id is just a unique name to</span>
<a name="line-3"></a>                        <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>    <span class='hs-comment'>-- identify this splice point</span>
<a name="line-4"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Data</span><span class='hs-layout'>,</span> <span class='hs-conid'>Typeable</span><span class='hs-layout'>)</span>
<a name="line-5"></a>
<a name="line-6"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Outputable</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsSplice</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-7"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsSplice</span> <span class='hs-varid'>n</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>angleBrackets</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>n</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>comma</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>
<a name="line-8"></a>
<a name="line-9"></a><a name="pprUntypedSplice"></a><span class='hs-definition'>pprUntypedSplice</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HsSplice</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-10"></a><span class='hs-definition'>pprUntypedSplice</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprSplice</span> <span class='hs-conid'>False</span>
<a name="line-11"></a>
<a name="line-12"></a><a name="pprTypedSplice"></a><span class='hs-definition'>pprTypedSplice</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HsSplice</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-13"></a><span class='hs-definition'>pprTypedSplice</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprSplice</span> <span class='hs-conid'>True</span>
<a name="line-14"></a>
<a name="line-15"></a><a name="pprSplice"></a><span class='hs-definition'>pprSplice</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Bool</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HsSplice</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-16"></a><span class='hs-definition'>pprSplice</span> <span class='hs-varid'>is_typed</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsSplice</span> <span class='hs-varid'>n</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>
<a name="line-17"></a>    <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-keyword'>if</span> <span class='hs-varid'>is_typed</span> <span class='hs-keyword'>then</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"$$"</span><span class='hs-layout'>)</span> <span class='hs-keyword'>else</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'$'</span><span class='hs-layout'>)</span>
<a name="line-18"></a>      <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>ifPprDebug</span> <span class='hs-layout'>(</span><span class='hs-varid'>brackets</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>eDoc</span>
<a name="line-19"></a>    <span class='hs-keyword'>where</span>
<a name="line-20"></a>          <span class='hs-comment'>-- We use pprLExpr to match pprParendExpr:</span>
<a name="line-21"></a>          <span class='hs-comment'>--     Using pprLExpr makes sure that we go 'deeper'</span>
<a name="line-22"></a>          <span class='hs-comment'>--     I think that is usually (always?) right</span>
<a name="line-23"></a>          <span class='hs-varid'>pp_as_was</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprLExpr</span> <span class='hs-varid'>e</span>
<a name="line-24"></a>          <span class='hs-varid'>eDoc</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>unLoc</span> <span class='hs-varid'>e</span> <span class='hs-keyword'>of</span>
<a name="line-25"></a>                 <span class='hs-conid'>HsPar</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>pp_as_was</span>
<a name="line-26"></a>                 <span class='hs-conid'>HsVar</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>pp_as_was</span>
<a name="line-27"></a>                 <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>parens</span> <span class='hs-varid'>pp_as_was</span>
<a name="line-28"></a>
<a name="line-29"></a><a name="HsBracket"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>HsBracket</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ExpBr</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>   <span class='hs-comment'>-- [|  expr  |]</span>
<a name="line-30"></a>                  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>PatBr</span> <span class='hs-layout'>(</span><span class='hs-conid'>LPat</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>      <span class='hs-comment'>-- [p| pat   |]</span>
<a name="line-31"></a>                  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>DecBrL</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LHsDecl</span> <span class='hs-varid'>id</span><span class='hs-keyglyph'>]</span>  <span class='hs-comment'>-- [d| decls |]; result of parser</span>
<a name="line-32"></a>                  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>DecBrG</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsGroup</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>  <span class='hs-comment'>-- [d| decls |]; result of renamer</span>
<a name="line-33"></a>                  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>TypBr</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsType</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>   <span class='hs-comment'>-- [t| type  |]</span>
<a name="line-34"></a>                  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>VarBr</span> <span class='hs-conid'>Bool</span> <span class='hs-varid'>id</span>        <span class='hs-comment'>-- True: 'x, False: ''T</span>
<a name="line-35"></a>                                         <span class='hs-comment'>-- (The Bool flag is used only in pprHsBracket)</span>
<a name="line-36"></a>                  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>TExpBr</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>  <span class='hs-comment'>-- [||  expr  ||]</span>
<a name="line-37"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Data</span><span class='hs-layout'>,</span> <span class='hs-conid'>Typeable</span><span class='hs-layout'>)</span>
<a name="line-38"></a>
<a name="line-39"></a><a name="isTypedBracket"></a><span class='hs-definition'>isTypedBracket</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsBracket</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-40"></a><span class='hs-definition'>isTypedBracket</span> <span class='hs-layout'>(</span><span class='hs-conid'>TExpBr</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-41"></a><span class='hs-definition'>isTypedBracket</span> <span class='hs-keyword'>_</span>           <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-42"></a>
<a name="line-43"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Outputable</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsBracket</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-44"></a>  <span class='hs-varid'>ppr</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprHsBracket</span>
<a name="line-45"></a>
<a name="line-46"></a>
<a name="line-47"></a><a name="pprHsBracket"></a><span class='hs-definition'>pprHsBracket</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HsBracket</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-48"></a><span class='hs-definition'>pprHsBracket</span> <span class='hs-layout'>(</span><span class='hs-conid'>ExpBr</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>thBrackets</span> <span class='hs-varid'>empty</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>
<a name="line-49"></a><span class='hs-definition'>pprHsBracket</span> <span class='hs-layout'>(</span><span class='hs-conid'>PatBr</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>thBrackets</span> <span class='hs-layout'>(</span><span class='hs-varid'>char</span> <span class='hs-chr'>'p'</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>
<a name="line-50"></a><span class='hs-definition'>pprHsBracket</span> <span class='hs-layout'>(</span><span class='hs-conid'>DecBrG</span> <span class='hs-varid'>gp</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>thBrackets</span> <span class='hs-layout'>(</span><span class='hs-varid'>char</span> <span class='hs-chr'>'d'</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>gp</span><span class='hs-layout'>)</span>
<a name="line-51"></a><span class='hs-definition'>pprHsBracket</span> <span class='hs-layout'>(</span><span class='hs-conid'>DecBrL</span> <span class='hs-varid'>ds</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>thBrackets</span> <span class='hs-layout'>(</span><span class='hs-varid'>char</span> <span class='hs-chr'>'d'</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>vcat</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>ds</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-52"></a><span class='hs-definition'>pprHsBracket</span> <span class='hs-layout'>(</span><span class='hs-conid'>TypBr</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>thBrackets</span> <span class='hs-layout'>(</span><span class='hs-varid'>char</span> <span class='hs-chr'>'t'</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span>
<a name="line-53"></a><span class='hs-definition'>pprHsBracket</span> <span class='hs-layout'>(</span><span class='hs-conid'>VarBr</span> <span class='hs-conid'>True</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'\''</span>         <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>n</span>
<a name="line-54"></a><span class='hs-definition'>pprHsBracket</span> <span class='hs-layout'>(</span><span class='hs-conid'>VarBr</span> <span class='hs-conid'>False</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"''"</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>n</span>
<a name="line-55"></a><span class='hs-definition'>pprHsBracket</span> <span class='hs-layout'>(</span><span class='hs-conid'>TExpBr</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>thTyBrackets</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>
<a name="line-56"></a>
<a name="line-57"></a><a name="thBrackets"></a><span class='hs-definition'>thBrackets</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SDoc</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-58"></a><span class='hs-definition'>thBrackets</span> <span class='hs-varid'>pp_kind</span> <span class='hs-varid'>pp_body</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'['</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>pp_kind</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'|'</span> <span class='hs-varop'>&lt;+&gt;</span>
<a name="line-59"></a>                             <span class='hs-varid'>pp_body</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"|]"</span><span class='hs-layout'>)</span>
<a name="line-60"></a>
<a name="line-61"></a><a name="thTyBrackets"></a><span class='hs-definition'>thTyBrackets</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SDoc</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-62"></a><span class='hs-definition'>thTyBrackets</span> <span class='hs-varid'>pp_body</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"[||"</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>pp_body</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"||]"</span><span class='hs-layout'>)</span>
<a name="line-63"></a>
<a name="line-64"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Outputable</span> <span class='hs-conid'>PendingRnSplice</span> <span class='hs-keyword'>where</span>
<a name="line-65"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>PendingRnExpSplice</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>s</span>
<a name="line-66"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>PendingRnPatSplice</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>s</span>
<a name="line-67"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>PendingRnTypeSplice</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>s</span>
<a name="line-68"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>PendingRnDeclSplice</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>s</span>
<a name="line-69"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>PendingRnCrossStageSplice</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>name</span>
</pre>\end{code}

%************************************************************************
%*                                                                      *
\subsection{Enumerations and list comprehensions}
%*                                                                      *
%************************************************************************

\begin{code}
<pre><a name="line-1"></a><a name="ArithSeqInfo"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>ArithSeqInfo</span> <span class='hs-varid'>id</span>
<a name="line-2"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>From</span>            <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-3"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>FromThen</span>        <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-4"></a>                    <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-5"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>FromTo</span>          <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-6"></a>                    <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-7"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>FromThenTo</span>      <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-8"></a>                    <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-9"></a>                    <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-10"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Data</span><span class='hs-layout'>,</span> <span class='hs-conid'>Typeable</span><span class='hs-layout'>)</span>
</pre>\end{code}

\begin{code}
<pre><a name="line-1"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Outputable</span> <span class='hs-layout'>(</span><span class='hs-conid'>ArithSeqInfo</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-2"></a>    <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>From</span> <span class='hs-varid'>e1</span><span class='hs-layout'>)</span>             <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hcat</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>e1</span><span class='hs-layout'>,</span> <span class='hs-varid'>pp_dotdot</span><span class='hs-keyglyph'>]</span>
<a name="line-3"></a>    <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>FromThen</span> <span class='hs-varid'>e1</span> <span class='hs-varid'>e2</span><span class='hs-layout'>)</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hcat</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>e1</span><span class='hs-layout'>,</span> <span class='hs-varid'>comma</span><span class='hs-layout'>,</span> <span class='hs-varid'>space</span><span class='hs-layout'>,</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>e2</span><span class='hs-layout'>,</span> <span class='hs-varid'>pp_dotdot</span><span class='hs-keyglyph'>]</span>
<a name="line-4"></a>    <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>FromTo</span> <span class='hs-varid'>e1</span> <span class='hs-varid'>e3</span><span class='hs-layout'>)</span>        <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hcat</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>e1</span><span class='hs-layout'>,</span> <span class='hs-varid'>pp_dotdot</span><span class='hs-layout'>,</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>e3</span><span class='hs-keyglyph'>]</span>
<a name="line-5"></a>    <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>FromThenTo</span> <span class='hs-varid'>e1</span> <span class='hs-varid'>e2</span> <span class='hs-varid'>e3</span><span class='hs-layout'>)</span>
<a name="line-6"></a>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hcat</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>e1</span><span class='hs-layout'>,</span> <span class='hs-varid'>comma</span><span class='hs-layout'>,</span> <span class='hs-varid'>space</span><span class='hs-layout'>,</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>e2</span><span class='hs-layout'>,</span> <span class='hs-varid'>pp_dotdot</span><span class='hs-layout'>,</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>e3</span><span class='hs-keyglyph'>]</span>
<a name="line-7"></a>
<a name="line-8"></a><a name="pp_dotdot"></a><span class='hs-definition'>pp_dotdot</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SDoc</span>
<a name="line-9"></a><span class='hs-definition'>pp_dotdot</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>" .. "</span><span class='hs-layout'>)</span>
</pre>\end{code}


%************************************************************************
%*                                                                      *
\subsection{HsMatchCtxt}
%*                                                                      *
%************************************************************************

\begin{code}
<pre><a name="line-1"></a><a name="HsMatchContext"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>HsMatchContext</span> <span class='hs-varid'>id</span>  <span class='hs-comment'>-- Context of a Match</span>
<a name="line-2"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>FunRhs</span> <span class='hs-varid'>id</span> <span class='hs-conid'>Bool</span>              <span class='hs-comment'>-- Function binding for f; True &lt;=&gt; written infix</span>
<a name="line-3"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LambdaExpr</span>                  <span class='hs-comment'>-- Patterns of a lambda</span>
<a name="line-4"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>CaseAlt</span>                     <span class='hs-comment'>-- Patterns and guards on a case alternative</span>
<a name="line-5"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>IfAlt</span>                       <span class='hs-comment'>-- Guards of a multi-way if alternative</span>
<a name="line-6"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ProcExpr</span>                    <span class='hs-comment'>-- Patterns of a proc</span>
<a name="line-7"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>PatBindRhs</span>                  <span class='hs-comment'>-- A pattern binding  eg [y] &lt;- e = e</span>
<a name="line-8"></a>
<a name="line-9"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>RecUpd</span>                      <span class='hs-comment'>-- Record update [used only in DsExpr to</span>
<a name="line-10"></a>                                <span class='hs-comment'>--    tell matchWrapper what sort of</span>
<a name="line-11"></a>                                <span class='hs-comment'>--    runtime error message to generate]</span>
<a name="line-12"></a>
<a name="line-13"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>StmtCtxt</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsStmtContext</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- Pattern of a do-stmt, list comprehension,</span>
<a name="line-14"></a>                                <span class='hs-comment'>-- pattern guard, etc</span>
<a name="line-15"></a>
<a name="line-16"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ThPatSplice</span>                 <span class='hs-comment'>-- A Template Haskell pattern splice</span>
<a name="line-17"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ThPatQuote</span>                  <span class='hs-comment'>-- A Template Haskell pattern quotation [p| (a,b) |]</span>
<a name="line-18"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>PatSyn</span>                      <span class='hs-comment'>-- A pattern synonym declaration</span>
<a name="line-19"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Data</span><span class='hs-layout'>,</span> <span class='hs-conid'>Typeable</span><span class='hs-layout'>)</span>
<a name="line-20"></a>
<a name="line-21"></a><a name="HsStmtContext"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>HsStmtContext</span> <span class='hs-varid'>id</span>
<a name="line-22"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ListComp</span>
<a name="line-23"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>MonadComp</span>
<a name="line-24"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>PArrComp</span>                             <span class='hs-comment'>-- Parallel array comprehension</span>
<a name="line-25"></a>
<a name="line-26"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>DoExpr</span>                               <span class='hs-comment'>-- do { ... }</span>
<a name="line-27"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>MDoExpr</span>                              <span class='hs-comment'>-- mdo { ... }  ie recursive do-expression</span>
<a name="line-28"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ArrowExpr</span>                            <span class='hs-comment'>-- do-notation in an arrow-command context</span>
<a name="line-29"></a>
<a name="line-30"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>GhciStmtCtxt</span>                         <span class='hs-comment'>-- A command-line Stmt in GHCi pat &lt;- rhs</span>
<a name="line-31"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>PatGuard</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsMatchContext</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>         <span class='hs-comment'>-- Pattern guard for specified thing</span>
<a name="line-32"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ParStmtCtxt</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsStmtContext</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>       <span class='hs-comment'>-- A branch of a parallel stmt</span>
<a name="line-33"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>TransStmtCtxt</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsStmtContext</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>     <span class='hs-comment'>-- A branch of a transform stmt</span>
<a name="line-34"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Data</span><span class='hs-layout'>,</span> <span class='hs-conid'>Typeable</span><span class='hs-layout'>)</span>
</pre>\end{code}

\begin{code}
<pre><a name="line-1"></a><a name="isListCompExpr"></a><span class='hs-definition'>isListCompExpr</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsStmtContext</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-2"></a><span class='hs-comment'>-- Uses syntax [ e | quals ]</span>
<a name="line-3"></a><span class='hs-definition'>isListCompExpr</span> <span class='hs-conid'>ListComp</span>          <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-4"></a><span class='hs-definition'>isListCompExpr</span> <span class='hs-conid'>PArrComp</span>          <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-5"></a><span class='hs-definition'>isListCompExpr</span> <span class='hs-conid'>MonadComp</span>         <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-6"></a><span class='hs-definition'>isListCompExpr</span> <span class='hs-layout'>(</span><span class='hs-conid'>ParStmtCtxt</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>isListCompExpr</span> <span class='hs-varid'>c</span>
<a name="line-7"></a><span class='hs-definition'>isListCompExpr</span> <span class='hs-layout'>(</span><span class='hs-conid'>TransStmtCtxt</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>isListCompExpr</span> <span class='hs-varid'>c</span>
<a name="line-8"></a><span class='hs-definition'>isListCompExpr</span> <span class='hs-keyword'>_</span>                 <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-9"></a>
<a name="line-10"></a><a name="isMonadCompExpr"></a><span class='hs-definition'>isMonadCompExpr</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsStmtContext</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-11"></a><span class='hs-definition'>isMonadCompExpr</span> <span class='hs-conid'>MonadComp</span>            <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-12"></a><span class='hs-definition'>isMonadCompExpr</span> <span class='hs-layout'>(</span><span class='hs-conid'>ParStmtCtxt</span> <span class='hs-varid'>ctxt</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>isMonadCompExpr</span> <span class='hs-varid'>ctxt</span>
<a name="line-13"></a><span class='hs-definition'>isMonadCompExpr</span> <span class='hs-layout'>(</span><span class='hs-conid'>TransStmtCtxt</span> <span class='hs-varid'>ctxt</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>isMonadCompExpr</span> <span class='hs-varid'>ctxt</span>
<a name="line-14"></a><span class='hs-definition'>isMonadCompExpr</span> <span class='hs-keyword'>_</span>                    <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
</pre>\end{code}

\begin{code}
<pre><a name="line-1"></a><a name="matchSeparator"></a><span class='hs-definition'>matchSeparator</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsMatchContext</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-2"></a><span class='hs-definition'>matchSeparator</span> <span class='hs-layout'>(</span><span class='hs-conid'>FunRhs</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"="</span><span class='hs-layout'>)</span>
<a name="line-3"></a><span class='hs-definition'>matchSeparator</span> <span class='hs-conid'>CaseAlt</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"-&gt;"</span><span class='hs-layout'>)</span>
<a name="line-4"></a><span class='hs-definition'>matchSeparator</span> <span class='hs-conid'>IfAlt</span>        <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"-&gt;"</span><span class='hs-layout'>)</span>
<a name="line-5"></a><span class='hs-definition'>matchSeparator</span> <span class='hs-conid'>LambdaExpr</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"-&gt;"</span><span class='hs-layout'>)</span>
<a name="line-6"></a><span class='hs-definition'>matchSeparator</span> <span class='hs-conid'>ProcExpr</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"-&gt;"</span><span class='hs-layout'>)</span>
<a name="line-7"></a><span class='hs-definition'>matchSeparator</span> <span class='hs-conid'>PatBindRhs</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"="</span><span class='hs-layout'>)</span>
<a name="line-8"></a><span class='hs-definition'>matchSeparator</span> <span class='hs-layout'>(</span><span class='hs-conid'>StmtCtxt</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"&lt;-"</span><span class='hs-layout'>)</span>
<a name="line-9"></a><span class='hs-definition'>matchSeparator</span> <span class='hs-conid'>RecUpd</span>       <span class='hs-keyglyph'>=</span> <span class='hs-varid'>panic</span> <span class='hs-str'>"unused"</span>
<a name="line-10"></a><span class='hs-definition'>matchSeparator</span> <span class='hs-conid'>ThPatSplice</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>panic</span> <span class='hs-str'>"unused"</span>
<a name="line-11"></a><span class='hs-definition'>matchSeparator</span> <span class='hs-conid'>ThPatQuote</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>panic</span> <span class='hs-str'>"unused"</span>
<a name="line-12"></a><span class='hs-definition'>matchSeparator</span> <span class='hs-conid'>PatSyn</span>       <span class='hs-keyglyph'>=</span> <span class='hs-varid'>panic</span> <span class='hs-str'>"unused"</span>
</pre>\end{code}

\begin{code}
<pre><a name="line-1"></a><a name="pprMatchContext"></a><span class='hs-definition'>pprMatchContext</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Outputable</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HsMatchContext</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-2"></a><span class='hs-definition'>pprMatchContext</span> <span class='hs-varid'>ctxt</span>
<a name="line-3"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>want_an</span> <span class='hs-varid'>ctxt</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"an"</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>pprMatchContextNoun</span> <span class='hs-varid'>ctxt</span>
<a name="line-4"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"a"</span><span class='hs-layout'>)</span>  <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>pprMatchContextNoun</span> <span class='hs-varid'>ctxt</span>
<a name="line-5"></a>  <span class='hs-keyword'>where</span>
<a name="line-6"></a>    <span class='hs-varid'>want_an</span> <span class='hs-layout'>(</span><span class='hs-conid'>FunRhs</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>  <span class='hs-comment'>-- Use "an" in front</span>
<a name="line-7"></a>    <span class='hs-varid'>want_an</span> <span class='hs-conid'>ProcExpr</span>    <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-8"></a>    <span class='hs-varid'>want_an</span> <span class='hs-keyword'>_</span>           <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-9"></a>
<a name="line-10"></a><a name="pprMatchContextNoun"></a><span class='hs-definition'>pprMatchContextNoun</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Outputable</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HsMatchContext</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-11"></a><span class='hs-definition'>pprMatchContextNoun</span> <span class='hs-layout'>(</span><span class='hs-conid'>FunRhs</span> <span class='hs-varid'>fun</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"equation for"</span><span class='hs-layout'>)</span>
<a name="line-12"></a>                                      <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>quotes</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>fun</span><span class='hs-layout'>)</span>
<a name="line-13"></a><span class='hs-definition'>pprMatchContextNoun</span> <span class='hs-conid'>CaseAlt</span>         <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"case alternative"</span><span class='hs-layout'>)</span>
<a name="line-14"></a><span class='hs-definition'>pprMatchContextNoun</span> <span class='hs-conid'>IfAlt</span>           <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"multi-way if alternative"</span><span class='hs-layout'>)</span>
<a name="line-15"></a><span class='hs-definition'>pprMatchContextNoun</span> <span class='hs-conid'>RecUpd</span>          <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"record-update construct"</span><span class='hs-layout'>)</span>
<a name="line-16"></a><span class='hs-definition'>pprMatchContextNoun</span> <span class='hs-conid'>ThPatSplice</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"Template Haskell pattern splice"</span><span class='hs-layout'>)</span>
<a name="line-17"></a><span class='hs-definition'>pprMatchContextNoun</span> <span class='hs-conid'>ThPatQuote</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"Template Haskell pattern quotation"</span><span class='hs-layout'>)</span>
<a name="line-18"></a><span class='hs-definition'>pprMatchContextNoun</span> <span class='hs-conid'>PatBindRhs</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"pattern binding"</span><span class='hs-layout'>)</span>
<a name="line-19"></a><span class='hs-definition'>pprMatchContextNoun</span> <span class='hs-conid'>LambdaExpr</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"lambda abstraction"</span><span class='hs-layout'>)</span>
<a name="line-20"></a><span class='hs-definition'>pprMatchContextNoun</span> <span class='hs-conid'>ProcExpr</span>        <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"arrow abstraction"</span><span class='hs-layout'>)</span>
<a name="line-21"></a><span class='hs-definition'>pprMatchContextNoun</span> <span class='hs-layout'>(</span><span class='hs-conid'>StmtCtxt</span> <span class='hs-varid'>ctxt</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"pattern binding in"</span><span class='hs-layout'>)</span>
<a name="line-22"></a>                                      <span class='hs-varop'>$$</span> <span class='hs-varid'>pprStmtContext</span> <span class='hs-varid'>ctxt</span>
<a name="line-23"></a><span class='hs-definition'>pprMatchContextNoun</span> <span class='hs-conid'>PatSyn</span>          <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"pattern synonym declaration"</span><span class='hs-layout'>)</span>
<a name="line-24"></a>
<a name="line-25"></a><a name="pprAStmtContext"></a><span class='hs-comment'>-----------------</span>
<a name="line-26"></a><span class='hs-definition'>pprAStmtContext</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprStmtContext</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Outputable</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HsStmtContext</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-27"></a><span class='hs-definition'>pprAStmtContext</span> <span class='hs-varid'>ctxt</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>article</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>pprStmtContext</span> <span class='hs-varid'>ctxt</span>
<a name="line-28"></a>  <span class='hs-keyword'>where</span>
<a name="line-29"></a>    <span class='hs-varid'>pp_an</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"an"</span><span class='hs-layout'>)</span>
<a name="line-30"></a>    <span class='hs-varid'>pp_a</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"a"</span><span class='hs-layout'>)</span>
<a name="line-31"></a>    <span class='hs-varid'>article</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>ctxt</span> <span class='hs-keyword'>of</span>
<a name="line-32"></a>                  <span class='hs-conid'>MDoExpr</span>       <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>pp_an</span>
<a name="line-33"></a>                  <span class='hs-conid'>PArrComp</span>      <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>pp_an</span>
<a name="line-34"></a>                  <span class='hs-conid'>GhciStmtCtxt</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>pp_an</span>
<a name="line-35"></a>                  <span class='hs-keyword'>_</span>             <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>pp_a</span>
<a name="line-36"></a>
<a name="line-37"></a>
<a name="line-38"></a><a name="pprStmtContext"></a><span class='hs-comment'>-----------------</span>
<a name="line-39"></a><span class='hs-definition'>pprStmtContext</span> <span class='hs-conid'>GhciStmtCtxt</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"interactive GHCi command"</span><span class='hs-layout'>)</span>
<a name="line-40"></a><span class='hs-definition'>pprStmtContext</span> <span class='hs-conid'>DoExpr</span>          <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"'do' block"</span><span class='hs-layout'>)</span>
<a name="line-41"></a><span class='hs-definition'>pprStmtContext</span> <span class='hs-conid'>MDoExpr</span>         <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"'mdo' block"</span><span class='hs-layout'>)</span>
<a name="line-42"></a><span class='hs-definition'>pprStmtContext</span> <span class='hs-conid'>ArrowExpr</span>       <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"'do' block in an arrow command"</span><span class='hs-layout'>)</span>
<a name="line-43"></a><span class='hs-definition'>pprStmtContext</span> <span class='hs-conid'>ListComp</span>        <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"list comprehension"</span><span class='hs-layout'>)</span>
<a name="line-44"></a><span class='hs-definition'>pprStmtContext</span> <span class='hs-conid'>MonadComp</span>       <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"monad comprehension"</span><span class='hs-layout'>)</span>
<a name="line-45"></a><span class='hs-definition'>pprStmtContext</span> <span class='hs-conid'>PArrComp</span>        <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"array comprehension"</span><span class='hs-layout'>)</span>
<a name="line-46"></a><span class='hs-definition'>pprStmtContext</span> <span class='hs-layout'>(</span><span class='hs-conid'>PatGuard</span> <span class='hs-varid'>ctxt</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"pattern guard for"</span><span class='hs-layout'>)</span> <span class='hs-varop'>$$</span> <span class='hs-varid'>pprMatchContext</span> <span class='hs-varid'>ctxt</span>
<a name="line-47"></a>
<a name="line-48"></a><span class='hs-comment'>-- Drop the inner contexts when reporting errors, else we get</span>
<a name="line-49"></a><span class='hs-comment'>--     Unexpected transform statement</span>
<a name="line-50"></a><span class='hs-comment'>--     in a transformed branch of</span>
<a name="line-51"></a><span class='hs-comment'>--          transformed branch of</span>
<a name="line-52"></a><span class='hs-comment'>--          transformed branch of monad comprehension</span>
<a name="line-53"></a><span class='hs-definition'>pprStmtContext</span> <span class='hs-layout'>(</span><span class='hs-conid'>ParStmtCtxt</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span>
<a name="line-54"></a> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>opt_PprStyle_Debug</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"parallel branch of"</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprAStmtContext</span> <span class='hs-varid'>c</span><span class='hs-keyglyph'>]</span>
<a name="line-55"></a> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>          <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprStmtContext</span> <span class='hs-varid'>c</span>
<a name="line-56"></a><span class='hs-definition'>pprStmtContext</span> <span class='hs-layout'>(</span><span class='hs-conid'>TransStmtCtxt</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span>
<a name="line-57"></a> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>opt_PprStyle_Debug</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"transformed branch of"</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprAStmtContext</span> <span class='hs-varid'>c</span><span class='hs-keyglyph'>]</span>
<a name="line-58"></a> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>          <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprStmtContext</span> <span class='hs-varid'>c</span>
<a name="line-59"></a>
<a name="line-60"></a>
<a name="line-61"></a><a name="matchContextErrString"></a><span class='hs-comment'>-- Used to generate the string for a *runtime* error message</span>
<a name="line-62"></a><span class='hs-definition'>matchContextErrString</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Outputable</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HsMatchContext</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-63"></a><span class='hs-definition'>matchContextErrString</span> <span class='hs-layout'>(</span><span class='hs-conid'>FunRhs</span> <span class='hs-varid'>fun</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>             <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"function"</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>fun</span>
<a name="line-64"></a><span class='hs-definition'>matchContextErrString</span> <span class='hs-conid'>CaseAlt</span>                    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"case"</span><span class='hs-layout'>)</span>
<a name="line-65"></a><span class='hs-definition'>matchContextErrString</span> <span class='hs-conid'>IfAlt</span>                      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"multi-way if"</span><span class='hs-layout'>)</span>
<a name="line-66"></a><span class='hs-definition'>matchContextErrString</span> <span class='hs-conid'>PatBindRhs</span>                 <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"pattern binding"</span><span class='hs-layout'>)</span>
<a name="line-67"></a><span class='hs-definition'>matchContextErrString</span> <span class='hs-conid'>RecUpd</span>                     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"record update"</span><span class='hs-layout'>)</span>
<a name="line-68"></a><span class='hs-definition'>matchContextErrString</span> <span class='hs-conid'>LambdaExpr</span>                 <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"lambda"</span><span class='hs-layout'>)</span>
<a name="line-69"></a><span class='hs-definition'>matchContextErrString</span> <span class='hs-conid'>ProcExpr</span>                   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"proc"</span><span class='hs-layout'>)</span>
<a name="line-70"></a><span class='hs-definition'>matchContextErrString</span> <span class='hs-conid'>ThPatSplice</span>                <span class='hs-keyglyph'>=</span> <span class='hs-varid'>panic</span> <span class='hs-str'>"matchContextErrString"</span>  <span class='hs-comment'>-- Not used at runtime</span>
<a name="line-71"></a><span class='hs-definition'>matchContextErrString</span> <span class='hs-conid'>ThPatQuote</span>                 <span class='hs-keyglyph'>=</span> <span class='hs-varid'>panic</span> <span class='hs-str'>"matchContextErrString"</span>  <span class='hs-comment'>-- Not used at runtime</span>
<a name="line-72"></a><span class='hs-definition'>matchContextErrString</span> <span class='hs-conid'>PatSyn</span>                     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>panic</span> <span class='hs-str'>"matchContextErrString"</span>  <span class='hs-comment'>-- Not used at runtime</span>
<a name="line-73"></a><span class='hs-definition'>matchContextErrString</span> <span class='hs-layout'>(</span><span class='hs-conid'>StmtCtxt</span> <span class='hs-layout'>(</span><span class='hs-conid'>ParStmtCtxt</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>matchContextErrString</span> <span class='hs-layout'>(</span><span class='hs-conid'>StmtCtxt</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span>
<a name="line-74"></a><span class='hs-definition'>matchContextErrString</span> <span class='hs-layout'>(</span><span class='hs-conid'>StmtCtxt</span> <span class='hs-layout'>(</span><span class='hs-conid'>TransStmtCtxt</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>matchContextErrString</span> <span class='hs-layout'>(</span><span class='hs-conid'>StmtCtxt</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span>
<a name="line-75"></a><span class='hs-definition'>matchContextErrString</span> <span class='hs-layout'>(</span><span class='hs-conid'>StmtCtxt</span> <span class='hs-layout'>(</span><span class='hs-conid'>PatGuard</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"pattern guard"</span><span class='hs-layout'>)</span>
<a name="line-76"></a><span class='hs-definition'>matchContextErrString</span> <span class='hs-layout'>(</span><span class='hs-conid'>StmtCtxt</span> <span class='hs-conid'>GhciStmtCtxt</span><span class='hs-layout'>)</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"interactive GHCi command"</span><span class='hs-layout'>)</span>
<a name="line-77"></a><span class='hs-definition'>matchContextErrString</span> <span class='hs-layout'>(</span><span class='hs-conid'>StmtCtxt</span> <span class='hs-conid'>DoExpr</span><span class='hs-layout'>)</span>            <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"'do' block"</span><span class='hs-layout'>)</span>
<a name="line-78"></a><span class='hs-definition'>matchContextErrString</span> <span class='hs-layout'>(</span><span class='hs-conid'>StmtCtxt</span> <span class='hs-conid'>ArrowExpr</span><span class='hs-layout'>)</span>         <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"'do' block"</span><span class='hs-layout'>)</span>
<a name="line-79"></a><span class='hs-definition'>matchContextErrString</span> <span class='hs-layout'>(</span><span class='hs-conid'>StmtCtxt</span> <span class='hs-conid'>MDoExpr</span><span class='hs-layout'>)</span>           <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"'mdo' block"</span><span class='hs-layout'>)</span>
<a name="line-80"></a><span class='hs-definition'>matchContextErrString</span> <span class='hs-layout'>(</span><span class='hs-conid'>StmtCtxt</span> <span class='hs-conid'>ListComp</span><span class='hs-layout'>)</span>          <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"list comprehension"</span><span class='hs-layout'>)</span>
<a name="line-81"></a><span class='hs-definition'>matchContextErrString</span> <span class='hs-layout'>(</span><span class='hs-conid'>StmtCtxt</span> <span class='hs-conid'>MonadComp</span><span class='hs-layout'>)</span>         <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"monad comprehension"</span><span class='hs-layout'>)</span>
<a name="line-82"></a><span class='hs-definition'>matchContextErrString</span> <span class='hs-layout'>(</span><span class='hs-conid'>StmtCtxt</span> <span class='hs-conid'>PArrComp</span><span class='hs-layout'>)</span>          <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"array comprehension"</span><span class='hs-layout'>)</span>
</pre>\end{code}

\begin{code}
<pre><a name="line-1"></a><a name="pprMatchInCtxt"></a><span class='hs-definition'>pprMatchInCtxt</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>idL</span><span class='hs-layout'>,</span> <span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>idR</span><span class='hs-layout'>,</span> <span class='hs-conid'>Outputable</span> <span class='hs-varid'>body</span><span class='hs-layout'>)</span>
<a name="line-2"></a>               <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HsMatchContext</span> <span class='hs-varid'>idL</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Match</span> <span class='hs-varid'>idR</span> <span class='hs-varid'>body</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-3"></a><span class='hs-definition'>pprMatchInCtxt</span> <span class='hs-varid'>ctxt</span> <span class='hs-varid'>match</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hang</span> <span class='hs-layout'>(</span><span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"In"</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>pprMatchContext</span> <span class='hs-varid'>ctxt</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>colon</span><span class='hs-layout'>)</span>
<a name="line-4"></a>                             <span class='hs-num'>4</span> <span class='hs-layout'>(</span><span class='hs-varid'>pprMatch</span> <span class='hs-varid'>ctxt</span> <span class='hs-varid'>match</span><span class='hs-layout'>)</span>
<a name="line-5"></a>
<a name="line-6"></a><a name="pprStmtInCtxt"></a><span class='hs-definition'>pprStmtInCtxt</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>idL</span><span class='hs-layout'>,</span> <span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>idR</span><span class='hs-layout'>,</span> <span class='hs-conid'>Outputable</span> <span class='hs-varid'>body</span><span class='hs-layout'>)</span>
<a name="line-7"></a>               <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HsStmtContext</span> <span class='hs-varid'>idL</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>StmtLR</span> <span class='hs-varid'>idL</span> <span class='hs-varid'>idR</span> <span class='hs-varid'>body</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-8"></a><span class='hs-definition'>pprStmtInCtxt</span> <span class='hs-varid'>ctxt</span> <span class='hs-layout'>(</span><span class='hs-conid'>LastStmt</span> <span class='hs-varid'>e</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>
<a name="line-9"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>isListCompExpr</span> <span class='hs-varid'>ctxt</span>      <span class='hs-comment'>-- For [ e | .. ], do not mutter about "stmts"</span>
<a name="line-10"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hang</span> <span class='hs-layout'>(</span><span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"In the expression:"</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-num'>2</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>
<a name="line-11"></a>
<a name="line-12"></a><span class='hs-definition'>pprStmtInCtxt</span> <span class='hs-varid'>ctxt</span> <span class='hs-varid'>stmt</span>
<a name="line-13"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hang</span> <span class='hs-layout'>(</span><span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"In a stmt of"</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>pprAStmtContext</span> <span class='hs-varid'>ctxt</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>colon</span><span class='hs-layout'>)</span>
<a name="line-14"></a>       <span class='hs-num'>2</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr_stmt</span> <span class='hs-varid'>stmt</span><span class='hs-layout'>)</span>
<a name="line-15"></a>  <span class='hs-keyword'>where</span>
<a name="line-16"></a>    <span class='hs-comment'>-- For Group and Transform Stmts, don't print the nested stmts!</span>
<a name="line-17"></a>    <span class='hs-varid'>ppr_stmt</span> <span class='hs-layout'>(</span><span class='hs-conid'>TransStmt</span> <span class='hs-layout'>{</span> <span class='hs-varid'>trS_by</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>by</span><span class='hs-layout'>,</span> <span class='hs-varid'>trS_using</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>using</span>
<a name="line-18"></a>                        <span class='hs-layout'>,</span> <span class='hs-varid'>trS_form</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>form</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprTransStmt</span> <span class='hs-varid'>by</span> <span class='hs-varid'>using</span> <span class='hs-varid'>form</span>
<a name="line-19"></a>    <span class='hs-varid'>ppr_stmt</span> <span class='hs-varid'>stmt</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprStmt</span> <span class='hs-varid'>stmt</span>
</pre>\end{code}
</body>
</html>
