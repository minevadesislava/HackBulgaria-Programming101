<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>typecheck/TcPatSyn.lhs</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
%
% (c) The University of Glasgow 2006
% (c) The GRASP/AQUA Project, Glasgow University, 1992-1998
%
\section[TcPatSyn]{Typechecking pattern synonym declarations}

\begin{code}
<pre><a name="line-1"></a><span class='hs-keyword'>module</span> <span class='hs-conid'>TcPatSyn</span> <span class='hs-layout'>(</span><span class='hs-varid'>tcPatSynDecl</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-2"></a>
<a name="line-3"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>HsSyn</span>
<a name="line-4"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>TcPat</span>
<a name="line-5"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>TcRnMonad</span>
<a name="line-6"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>TcEnv</span>
<a name="line-7"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>TcMType</span>
<a name="line-8"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>TysPrim</span>
<a name="line-9"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Name</span>
<a name="line-10"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>SrcLoc</span>
<a name="line-11"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>PatSyn</span>
<a name="line-12"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>NameSet</span>
<a name="line-13"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Panic</span>
<a name="line-14"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Outputable</span>
<a name="line-15"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>FastString</span>
<a name="line-16"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Var</span>
<a name="line-17"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Id</span>
<a name="line-18"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>IdInfo</span><span class='hs-layout'>(</span> <span class='hs-conid'>IdDetails</span><span class='hs-layout'>(</span> <span class='hs-conid'>VanillaId</span> <span class='hs-layout'>)</span> <span class='hs-layout'>)</span>
<a name="line-19"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>TcBinds</span>
<a name="line-20"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>BasicTypes</span>
<a name="line-21"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>TcSimplify</span>
<a name="line-22"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>TcType</span>
<a name="line-23"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>VarSet</span>
<a name="line-24"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Monoid</span>
<a name="line-25"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Bag</span>
<a name="line-26"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>TcEvidence</span>
<a name="line-27"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>BuildTyCl</span>
<a name="line-28"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>TypeRep</span>
<a name="line-29"></a>
<a name="line-30"></a><span class='hs-cpp'>#include "HsVersions.h"</span>
</pre>\end{code}

\begin{code}
<pre><a name="line-1"></a><a name="tcPatSynDecl"></a><span class='hs-definition'>tcPatSynDecl</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Located</span> <span class='hs-conid'>Name</span>
<a name="line-2"></a>             <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HsPatSynDetails</span> <span class='hs-layout'>(</span><span class='hs-conid'>Located</span> <span class='hs-conid'>Name</span><span class='hs-layout'>)</span>
<a name="line-3"></a>             <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LPat</span> <span class='hs-conid'>Name</span>
<a name="line-4"></a>             <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HsPatSynDir</span> <span class='hs-conid'>Name</span>
<a name="line-5"></a>             <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TcM</span> <span class='hs-layout'>(</span><span class='hs-conid'>PatSyn</span><span class='hs-layout'>,</span> <span class='hs-conid'>LHsBinds</span> <span class='hs-conid'>Id</span><span class='hs-layout'>)</span>
<a name="line-6"></a><span class='hs-definition'>tcPatSynDecl</span> <span class='hs-varid'>lname</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-varid'>details</span> <span class='hs-varid'>lpat</span> <span class='hs-varid'>dir</span>
<a name="line-7"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span> <span class='hs-layout'>{</span> <span class='hs-varid'>traceTc</span> <span class='hs-str'>"tcPatSynDecl {"</span> <span class='hs-varop'>$</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>name</span> <span class='hs-varop'>$$</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>lpat</span>
<a name="line-8"></a>       <span class='hs-layout'>;</span> <span class='hs-varid'>tcCheckPatSynPat</span> <span class='hs-varid'>lpat</span>
<a name="line-9"></a>       <span class='hs-layout'>;</span> <span class='hs-varid'>pat_ty</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>newFlexiTyVarTy</span> <span class='hs-varid'>openTypeKind</span>
<a name="line-10"></a>
<a name="line-11"></a>       <span class='hs-layout'>;</span> <span class='hs-keyword'>let</span> <span class='hs-layout'>(</span><span class='hs-varid'>arg_names</span><span class='hs-layout'>,</span> <span class='hs-varid'>is_infix</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>details</span> <span class='hs-keyword'>of</span>
<a name="line-12"></a>                 <span class='hs-conid'>PrefixPatSyn</span> <span class='hs-varid'>names</span>      <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-varid'>unLoc</span> <span class='hs-varid'>names</span><span class='hs-layout'>,</span> <span class='hs-conid'>False</span><span class='hs-layout'>)</span>
<a name="line-13"></a>                 <span class='hs-conid'>InfixPatSyn</span> <span class='hs-varid'>name1</span> <span class='hs-varid'>name2</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-varid'>unLoc</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>name1</span><span class='hs-layout'>,</span> <span class='hs-varid'>name2</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span> <span class='hs-conid'>True</span><span class='hs-layout'>)</span>
<a name="line-14"></a>       <span class='hs-layout'>;</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-varid'>lpat'</span><span class='hs-layout'>,</span> <span class='hs-varid'>args</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>wanted</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>captureConstraints</span>       <span class='hs-varop'>$</span>
<a name="line-15"></a>                                    <span class='hs-varid'>tcPat</span> <span class='hs-conid'>PatSyn</span> <span class='hs-varid'>lpat</span> <span class='hs-varid'>pat_ty</span> <span class='hs-varop'>$</span>
<a name="line-16"></a>                                    <span class='hs-varid'>mapM</span> <span class='hs-varid'>tcLookupId</span> <span class='hs-varid'>arg_names</span>
<a name="line-17"></a>       <span class='hs-layout'>;</span> <span class='hs-keyword'>let</span> <span class='hs-varid'>named_taus</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>name</span><span class='hs-layout'>,</span> <span class='hs-varid'>pat_ty</span><span class='hs-layout'>)</span><span class='hs-conop'>:</span><span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>arg</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>getName</span> <span class='hs-varid'>arg</span><span class='hs-layout'>,</span> <span class='hs-varid'>varType</span> <span class='hs-varid'>arg</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varid'>args</span>
<a name="line-18"></a>
<a name="line-19"></a>       <span class='hs-layout'>;</span> <span class='hs-varid'>traceTc</span> <span class='hs-str'>"tcPatSynDecl::wanted"</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>named_taus</span> <span class='hs-varop'>$$</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>wanted</span><span class='hs-layout'>)</span>
<a name="line-20"></a>       <span class='hs-layout'>;</span> <span class='hs-layout'>(</span><span class='hs-varid'>qtvs</span><span class='hs-layout'>,</span> <span class='hs-varid'>req_dicts</span><span class='hs-layout'>,</span> <span class='hs-sel'>_mr_bites</span><span class='hs-layout'>,</span> <span class='hs-varid'>ev_binds</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>simplifyInfer</span> <span class='hs-conid'>True</span> <span class='hs-conid'>False</span> <span class='hs-varid'>named_taus</span> <span class='hs-varid'>wanted</span>
<a name="line-21"></a>
<a name="line-22"></a>       <span class='hs-layout'>;</span> <span class='hs-layout'>(</span><span class='hs-varid'>ex_vars</span><span class='hs-layout'>,</span> <span class='hs-varid'>prov_dicts</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>tcCollectEx</span> <span class='hs-varid'>lpat'</span>
<a name="line-23"></a>       <span class='hs-layout'>;</span> <span class='hs-keyword'>let</span> <span class='hs-varid'>univ_tvs</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>filter</span> <span class='hs-layout'>(</span><span class='hs-varid'>not</span> <span class='hs-varop'>.</span> <span class='hs-layout'>(</span><span class='hs-varop'>`elemVarSet`</span> <span class='hs-varid'>ex_vars</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varid'>qtvs</span>
<a name="line-24"></a>             <span class='hs-varid'>ex_tvs</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>varSetElems</span> <span class='hs-varid'>ex_vars</span>
<a name="line-25"></a>             <span class='hs-varid'>prov_theta</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>map</span> <span class='hs-varid'>evVarPred</span> <span class='hs-varid'>prov_dicts</span>
<a name="line-26"></a>             <span class='hs-varid'>req_theta</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>map</span> <span class='hs-varid'>evVarPred</span> <span class='hs-varid'>req_dicts</span>
<a name="line-27"></a>
<a name="line-28"></a>       <span class='hs-layout'>;</span> <span class='hs-varid'>univ_tvs</span>   <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>mapM</span> <span class='hs-varid'>zonkQuantifiedTyVar</span> <span class='hs-varid'>univ_tvs</span>
<a name="line-29"></a>       <span class='hs-layout'>;</span> <span class='hs-varid'>ex_tvs</span>     <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>mapM</span> <span class='hs-varid'>zonkQuantifiedTyVar</span> <span class='hs-varid'>ex_tvs</span>
<a name="line-30"></a>       <span class='hs-layout'>;</span> <span class='hs-varid'>prov_theta</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>zonkTcThetaType</span> <span class='hs-varid'>prov_theta</span>
<a name="line-31"></a>       <span class='hs-layout'>;</span> <span class='hs-varid'>req_theta</span>  <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>zonkTcThetaType</span> <span class='hs-varid'>req_theta</span>
<a name="line-32"></a>       <span class='hs-layout'>;</span> <span class='hs-varid'>pat_ty</span>     <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>zonkTcType</span> <span class='hs-varid'>pat_ty</span>
<a name="line-33"></a>       <span class='hs-layout'>;</span> <span class='hs-varid'>args</span>       <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>mapM</span> <span class='hs-varid'>zonkId</span> <span class='hs-varid'>args</span>
<a name="line-34"></a>
<a name="line-35"></a>       <span class='hs-layout'>;</span> <span class='hs-varid'>traceTc</span> <span class='hs-str'>"tcPatSynDecl: ex"</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>ex_tvs</span> <span class='hs-varop'>$$</span>
<a name="line-36"></a>                                     <span class='hs-varid'>ppr</span> <span class='hs-varid'>prov_theta</span> <span class='hs-varop'>$$</span>
<a name="line-37"></a>                                     <span class='hs-varid'>ppr</span> <span class='hs-varid'>prov_dicts</span><span class='hs-layout'>)</span>
<a name="line-38"></a>       <span class='hs-layout'>;</span> <span class='hs-varid'>traceTc</span> <span class='hs-str'>"tcPatSynDecl: univ"</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>univ_tvs</span> <span class='hs-varop'>$$</span>
<a name="line-39"></a>                                       <span class='hs-varid'>ppr</span> <span class='hs-varid'>req_theta</span> <span class='hs-varop'>$$</span>
<a name="line-40"></a>                                       <span class='hs-varid'>ppr</span> <span class='hs-varid'>req_dicts</span> <span class='hs-varop'>$$</span>
<a name="line-41"></a>                                       <span class='hs-varid'>ppr</span> <span class='hs-varid'>ev_binds</span><span class='hs-layout'>)</span>
<a name="line-42"></a>
<a name="line-43"></a>       <span class='hs-layout'>;</span> <span class='hs-keyword'>let</span> <span class='hs-varid'>theta</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>prov_theta</span> <span class='hs-varop'>++</span> <span class='hs-varid'>req_theta</span>
<a name="line-44"></a>
<a name="line-45"></a>       <span class='hs-layout'>;</span> <span class='hs-varid'>traceTc</span> <span class='hs-str'>"tcPatSynDecl: type"</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>name</span> <span class='hs-varop'>$$</span>
<a name="line-46"></a>                                       <span class='hs-varid'>ppr</span> <span class='hs-varid'>univ_tvs</span> <span class='hs-varop'>$$</span>
<a name="line-47"></a>                                       <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-varid'>varType</span> <span class='hs-varid'>args</span><span class='hs-layout'>)</span> <span class='hs-varop'>$$</span>
<a name="line-48"></a>                                       <span class='hs-varid'>ppr</span> <span class='hs-varid'>pat_ty</span><span class='hs-layout'>)</span>
<a name="line-49"></a>
<a name="line-50"></a>       <span class='hs-layout'>;</span> <span class='hs-layout'>(</span><span class='hs-varid'>matcher_id</span><span class='hs-layout'>,</span> <span class='hs-varid'>matcher_bind</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>tcPatSynMatcher</span> <span class='hs-varid'>lname</span> <span class='hs-varid'>lpat'</span> <span class='hs-varid'>args</span>
<a name="line-51"></a>                                         <span class='hs-varid'>univ_tvs</span> <span class='hs-varid'>ex_tvs</span>
<a name="line-52"></a>                                         <span class='hs-varid'>ev_binds</span>
<a name="line-53"></a>                                         <span class='hs-varid'>prov_dicts</span> <span class='hs-varid'>req_dicts</span>
<a name="line-54"></a>                                         <span class='hs-varid'>prov_theta</span> <span class='hs-varid'>req_theta</span>
<a name="line-55"></a>                                         <span class='hs-varid'>pat_ty</span>
<a name="line-56"></a>       <span class='hs-layout'>;</span> <span class='hs-varid'>m_wrapper</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>tcPatSynWrapper</span> <span class='hs-varid'>lname</span> <span class='hs-varid'>lpat</span> <span class='hs-varid'>dir</span> <span class='hs-varid'>args</span>
<a name="line-57"></a>                                      <span class='hs-varid'>univ_tvs</span> <span class='hs-varid'>ex_tvs</span> <span class='hs-varid'>theta</span> <span class='hs-varid'>pat_ty</span>
<a name="line-58"></a>       <span class='hs-layout'>;</span> <span class='hs-keyword'>let</span> <span class='hs-varid'>binds</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>matcher_bind</span> <span class='hs-varop'>`unionBags`</span> <span class='hs-varid'>maybe</span> <span class='hs-varid'>emptyBag</span> <span class='hs-varid'>snd</span> <span class='hs-varid'>m_wrapper</span>
<a name="line-59"></a>
<a name="line-60"></a>       <span class='hs-layout'>;</span> <span class='hs-varid'>traceTc</span> <span class='hs-str'>"tcPatSynDecl }"</span> <span class='hs-varop'>$</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>name</span>
<a name="line-61"></a>       <span class='hs-layout'>;</span> <span class='hs-keyword'>let</span> <span class='hs-varid'>patSyn</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkPatSyn</span> <span class='hs-varid'>name</span> <span class='hs-varid'>is_infix</span>
<a name="line-62"></a>                        <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-varid'>varType</span> <span class='hs-varid'>args</span><span class='hs-layout'>)</span>
<a name="line-63"></a>                        <span class='hs-varid'>univ_tvs</span> <span class='hs-varid'>ex_tvs</span>
<a name="line-64"></a>                        <span class='hs-varid'>prov_theta</span> <span class='hs-varid'>req_theta</span>
<a name="line-65"></a>                        <span class='hs-varid'>pat_ty</span>
<a name="line-66"></a>                        <span class='hs-varid'>matcher_id</span> <span class='hs-layout'>(</span><span class='hs-varid'>fmap</span> <span class='hs-varid'>fst</span> <span class='hs-varid'>m_wrapper</span><span class='hs-layout'>)</span>
<a name="line-67"></a>       <span class='hs-layout'>;</span> <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>patSyn</span><span class='hs-layout'>,</span> <span class='hs-varid'>binds</span><span class='hs-layout'>)</span> <span class='hs-layout'>}</span>
<a name="line-68"></a>
</pre>\end{code}


\begin{code}
<pre><a name="line-1"></a><a name="tcPatSynMatcher"></a><span class='hs-definition'>tcPatSynMatcher</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Located</span> <span class='hs-conid'>Name</span>
<a name="line-2"></a>                <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LPat</span> <span class='hs-conid'>Id</span>
<a name="line-3"></a>                <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Var</span><span class='hs-keyglyph'>]</span>
<a name="line-4"></a>                <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>TcTyVar</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>TcTyVar</span><span class='hs-keyglyph'>]</span>
<a name="line-5"></a>                <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TcEvBinds</span>
<a name="line-6"></a>                <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>EvVar</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>EvVar</span><span class='hs-keyglyph'>]</span>
<a name="line-7"></a>                <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ThetaType</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ThetaType</span>
<a name="line-8"></a>                <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TcType</span>
<a name="line-9"></a>                <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TcM</span> <span class='hs-layout'>(</span><span class='hs-conid'>Id</span><span class='hs-layout'>,</span> <span class='hs-conid'>LHsBinds</span> <span class='hs-conid'>Id</span><span class='hs-layout'>)</span>
<a name="line-10"></a><span class='hs-comment'>-- See Note [Matchers and wrappers for pattern synonyms] in PatSyn</span>
<a name="line-11"></a><span class='hs-definition'>tcPatSynMatcher</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-varid'>loc</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-varid'>lpat</span> <span class='hs-varid'>args</span> <span class='hs-varid'>univ_tvs</span> <span class='hs-varid'>ex_tvs</span> <span class='hs-varid'>ev_binds</span> <span class='hs-varid'>prov_dicts</span> <span class='hs-varid'>req_dicts</span> <span class='hs-varid'>prov_theta</span> <span class='hs-varid'>req_theta</span> <span class='hs-varid'>pat_ty</span>
<a name="line-12"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span> <span class='hs-layout'>{</span> <span class='hs-varid'>res_tv</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>zonkQuantifiedTyVar</span> <span class='hs-varop'>=&lt;&lt;</span> <span class='hs-varid'>newFlexiTyVar</span> <span class='hs-varid'>liftedTypeKind</span>
<a name="line-13"></a>       <span class='hs-layout'>;</span> <span class='hs-varid'>matcher_name</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>newImplicitBinder</span> <span class='hs-varid'>name</span> <span class='hs-varid'>mkMatcherOcc</span>
<a name="line-14"></a>       <span class='hs-layout'>;</span> <span class='hs-keyword'>let</span> <span class='hs-varid'>res_ty</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>TyVarTy</span> <span class='hs-varid'>res_tv</span>
<a name="line-15"></a>             <span class='hs-varid'>cont_ty</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkSigmaTy</span> <span class='hs-varid'>ex_tvs</span> <span class='hs-varid'>prov_theta</span> <span class='hs-varop'>$</span>
<a name="line-16"></a>                       <span class='hs-varid'>mkFunTys</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-varid'>varType</span> <span class='hs-varid'>args</span><span class='hs-layout'>)</span> <span class='hs-varid'>res_ty</span>
<a name="line-17"></a>
<a name="line-18"></a>       <span class='hs-layout'>;</span> <span class='hs-keyword'>let</span> <span class='hs-varid'>matcher_tau</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkFunTys</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>pat_ty</span><span class='hs-layout'>,</span> <span class='hs-varid'>cont_ty</span><span class='hs-layout'>,</span> <span class='hs-varid'>res_ty</span><span class='hs-keyglyph'>]</span> <span class='hs-varid'>res_ty</span>
<a name="line-19"></a>             <span class='hs-varid'>matcher_sigma</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkSigmaTy</span> <span class='hs-layout'>(</span><span class='hs-varid'>res_tv</span><span class='hs-conop'>:</span><span class='hs-varid'>univ_tvs</span><span class='hs-layout'>)</span> <span class='hs-varid'>req_theta</span> <span class='hs-varid'>matcher_tau</span>
<a name="line-20"></a>             <span class='hs-varid'>matcher_id</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkExportedLocalId</span> <span class='hs-conid'>VanillaId</span> <span class='hs-varid'>matcher_name</span> <span class='hs-varid'>matcher_sigma</span>
<a name="line-21"></a>
<a name="line-22"></a>       <span class='hs-layout'>;</span> <span class='hs-varid'>traceTc</span> <span class='hs-str'>"tcPatSynMatcher"</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>name</span> <span class='hs-varop'>$$</span> <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-varid'>idType</span> <span class='hs-varid'>matcher_id</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-23"></a>       <span class='hs-layout'>;</span> <span class='hs-keyword'>let</span> <span class='hs-varid'>matcher_lid</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>L</span> <span class='hs-varid'>loc</span> <span class='hs-varid'>matcher_id</span>
<a name="line-24"></a>
<a name="line-25"></a>       <span class='hs-layout'>;</span> <span class='hs-varid'>scrutinee</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>mkId</span> <span class='hs-str'>"scrut"</span> <span class='hs-varid'>pat_ty</span>
<a name="line-26"></a>       <span class='hs-layout'>;</span> <span class='hs-varid'>cont</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>mkId</span> <span class='hs-str'>"cont"</span> <span class='hs-varid'>cont_ty</span>
<a name="line-27"></a>       <span class='hs-layout'>;</span> <span class='hs-keyword'>let</span> <span class='hs-varid'>cont'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>nlHsApps</span> <span class='hs-varid'>cont</span> <span class='hs-varop'>$</span> <span class='hs-varid'>map</span> <span class='hs-varid'>nlHsVar</span> <span class='hs-layout'>(</span><span class='hs-varid'>ex_tvs</span> <span class='hs-varop'>++</span> <span class='hs-varid'>prov_dicts</span> <span class='hs-varop'>++</span> <span class='hs-varid'>args</span><span class='hs-layout'>)</span>
<a name="line-28"></a>       <span class='hs-layout'>;</span> <span class='hs-varid'>fail</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>mkId</span> <span class='hs-str'>"fail"</span> <span class='hs-varid'>res_ty</span>
<a name="line-29"></a>       <span class='hs-layout'>;</span> <span class='hs-keyword'>let</span> <span class='hs-varid'>fail'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>nlHsVar</span> <span class='hs-varid'>fail</span>
<a name="line-30"></a>
<a name="line-31"></a>
<a name="line-32"></a>       <span class='hs-layout'>;</span> <span class='hs-keyword'>let</span> <span class='hs-varid'>args</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>map</span> <span class='hs-varid'>nlVarPat</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>scrutinee</span><span class='hs-layout'>,</span> <span class='hs-varid'>cont</span><span class='hs-layout'>,</span> <span class='hs-varid'>fail</span><span class='hs-keyglyph'>]</span>
<a name="line-33"></a>             <span class='hs-varid'>lwpat</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>noLoc</span> <span class='hs-varop'>$</span> <span class='hs-conid'>WildPat</span> <span class='hs-varid'>pat_ty</span>
<a name="line-34"></a>             <span class='hs-varid'>cases</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>if</span> <span class='hs-varid'>isIrrefutableHsPat</span> <span class='hs-varid'>lpat</span>
<a name="line-35"></a>                     <span class='hs-keyword'>then</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>mkSimpleHsAlt</span> <span class='hs-varid'>lpat</span>  <span class='hs-varid'>cont'</span><span class='hs-keyglyph'>]</span>
<a name="line-36"></a>                     <span class='hs-keyword'>else</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>mkSimpleHsAlt</span> <span class='hs-varid'>lpat</span>  <span class='hs-varid'>cont'</span><span class='hs-layout'>,</span>
<a name="line-37"></a>                           <span class='hs-varid'>mkSimpleHsAlt</span> <span class='hs-varid'>lwpat</span> <span class='hs-varid'>fail'</span><span class='hs-keyglyph'>]</span>
<a name="line-38"></a>             <span class='hs-varid'>body</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkLHsWrap</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkWpLet</span> <span class='hs-varid'>ev_binds</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span>
<a name="line-39"></a>                    <span class='hs-conid'>L</span> <span class='hs-layout'>(</span><span class='hs-varid'>getLoc</span> <span class='hs-varid'>lpat</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span>
<a name="line-40"></a>                    <span class='hs-conid'>HsCase</span> <span class='hs-layout'>(</span><span class='hs-varid'>nlHsVar</span> <span class='hs-varid'>scrutinee</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span>
<a name="line-41"></a>                    <span class='hs-conid'>MG</span><span class='hs-layout'>{</span> <span class='hs-varid'>mg_alts</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>cases</span>
<a name="line-42"></a>                      <span class='hs-layout'>,</span> <span class='hs-varid'>mg_arg_tys</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>pat_ty</span><span class='hs-keyglyph'>]</span>
<a name="line-43"></a>                      <span class='hs-layout'>,</span> <span class='hs-varid'>mg_res_ty</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>res_ty</span>
<a name="line-44"></a>                      <span class='hs-layout'>,</span> <span class='hs-varid'>mg_origin</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Generated</span>
<a name="line-45"></a>                      <span class='hs-layout'>}</span>
<a name="line-46"></a>             <span class='hs-varid'>body'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>noLoc</span> <span class='hs-varop'>$</span>
<a name="line-47"></a>                     <span class='hs-conid'>HsLam</span> <span class='hs-varop'>$</span>
<a name="line-48"></a>                     <span class='hs-conid'>MG</span><span class='hs-layout'>{</span> <span class='hs-varid'>mg_alts</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>mkSimpleMatch</span> <span class='hs-varid'>args</span> <span class='hs-varid'>body</span><span class='hs-keyglyph'>]</span>
<a name="line-49"></a>                       <span class='hs-layout'>,</span> <span class='hs-varid'>mg_arg_tys</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>pat_ty</span><span class='hs-layout'>,</span> <span class='hs-varid'>cont_ty</span><span class='hs-layout'>,</span> <span class='hs-varid'>res_ty</span><span class='hs-keyglyph'>]</span>
<a name="line-50"></a>                       <span class='hs-layout'>,</span> <span class='hs-varid'>mg_res_ty</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>res_ty</span>
<a name="line-51"></a>                       <span class='hs-layout'>,</span> <span class='hs-varid'>mg_origin</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Generated</span>
<a name="line-52"></a>                       <span class='hs-layout'>}</span>
<a name="line-53"></a>
<a name="line-54"></a>             <span class='hs-varid'>match</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkMatch</span> <span class='hs-conid'>[]</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkHsLams</span> <span class='hs-layout'>(</span><span class='hs-varid'>res_tv</span><span class='hs-conop'>:</span><span class='hs-varid'>univ_tvs</span><span class='hs-layout'>)</span> <span class='hs-varid'>req_dicts</span> <span class='hs-varid'>body'</span><span class='hs-layout'>)</span> <span class='hs-conid'>EmptyLocalBinds</span>
<a name="line-55"></a>             <span class='hs-varid'>mg</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>MG</span><span class='hs-layout'>{</span> <span class='hs-varid'>mg_alts</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>match</span><span class='hs-keyglyph'>]</span>
<a name="line-56"></a>                    <span class='hs-layout'>,</span> <span class='hs-varid'>mg_arg_tys</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>[]</span>
<a name="line-57"></a>                    <span class='hs-layout'>,</span> <span class='hs-varid'>mg_res_ty</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>res_ty</span>
<a name="line-58"></a>                    <span class='hs-layout'>,</span> <span class='hs-varid'>mg_origin</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Generated</span>
<a name="line-59"></a>                    <span class='hs-layout'>}</span>
<a name="line-60"></a>
<a name="line-61"></a>       <span class='hs-layout'>;</span> <span class='hs-keyword'>let</span> <span class='hs-varid'>bind</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>FunBind</span><span class='hs-layout'>{</span> <span class='hs-varid'>fun_id</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>matcher_lid</span>
<a name="line-62"></a>                           <span class='hs-layout'>,</span> <span class='hs-varid'>fun_infix</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-63"></a>                           <span class='hs-layout'>,</span> <span class='hs-varid'>fun_matches</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mg</span>
<a name="line-64"></a>                           <span class='hs-layout'>,</span> <span class='hs-varid'>fun_co_fn</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>idHsWrapper</span>
<a name="line-65"></a>                           <span class='hs-layout'>,</span> <span class='hs-varid'>bind_fvs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>emptyNameSet</span>
<a name="line-66"></a>                           <span class='hs-layout'>,</span> <span class='hs-varid'>fun_tick</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span> <span class='hs-layout'>}</span>
<a name="line-67"></a>             <span class='hs-varid'>matcher_bind</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>unitBag</span> <span class='hs-layout'>(</span><span class='hs-varid'>noLoc</span> <span class='hs-varid'>bind</span><span class='hs-layout'>)</span>
<a name="line-68"></a>
<a name="line-69"></a>       <span class='hs-layout'>;</span> <span class='hs-varid'>traceTc</span> <span class='hs-str'>"tcPatSynMatcher"</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>matcher_bind</span><span class='hs-layout'>)</span>
<a name="line-70"></a>
<a name="line-71"></a>       <span class='hs-layout'>;</span> <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>matcher_id</span><span class='hs-layout'>,</span> <span class='hs-varid'>matcher_bind</span><span class='hs-layout'>)</span> <span class='hs-layout'>}</span>
<a name="line-72"></a>  <span class='hs-keyword'>where</span>
<a name="line-73"></a>    <span class='hs-varid'>mkId</span> <span class='hs-varid'>s</span> <span class='hs-varid'>ty</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-74"></a>        <span class='hs-varid'>name</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>newName</span> <span class='hs-varop'>.</span> <span class='hs-varid'>mkVarOccFS</span> <span class='hs-varop'>.</span> <span class='hs-varid'>fsLit</span> <span class='hs-varop'>$</span> <span class='hs-varid'>s</span>
<a name="line-75"></a>        <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-varid'>mkLocalId</span> <span class='hs-varid'>name</span> <span class='hs-varid'>ty</span>
<a name="line-76"></a>
<a name="line-77"></a><a name="tcPatSynWrapper"></a><span class='hs-definition'>tcPatSynWrapper</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Located</span> <span class='hs-conid'>Name</span>
<a name="line-78"></a>                <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LPat</span> <span class='hs-conid'>Name</span>
<a name="line-79"></a>                <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HsPatSynDir</span> <span class='hs-conid'>Name</span>
<a name="line-80"></a>                <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Var</span><span class='hs-keyglyph'>]</span>
<a name="line-81"></a>                <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>TyVar</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>TyVar</span><span class='hs-keyglyph'>]</span>
<a name="line-82"></a>                <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ThetaType</span>
<a name="line-83"></a>                <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TcType</span>
<a name="line-84"></a>                <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TcM</span> <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>Id</span><span class='hs-layout'>,</span> <span class='hs-conid'>LHsBinds</span> <span class='hs-conid'>Id</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-85"></a><span class='hs-comment'>-- See Note [Matchers and wrappers for pattern synonyms] in PatSyn</span>
<a name="line-86"></a><span class='hs-definition'>tcPatSynWrapper</span> <span class='hs-varid'>lname</span> <span class='hs-varid'>lpat</span> <span class='hs-varid'>dir</span> <span class='hs-varid'>args</span> <span class='hs-varid'>univ_tvs</span> <span class='hs-varid'>ex_tvs</span> <span class='hs-varid'>theta</span> <span class='hs-varid'>pat_ty</span>
<a name="line-87"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span> <span class='hs-layout'>{</span> <span class='hs-keyword'>let</span> <span class='hs-varid'>argNames</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkNameSet</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-conid'>Var</span><span class='hs-varop'>.</span><span class='hs-varid'>varName</span> <span class='hs-varid'>args</span><span class='hs-layout'>)</span>
<a name="line-88"></a>       <span class='hs-layout'>;</span> <span class='hs-keyword'>case</span> <span class='hs-layout'>(</span><span class='hs-varid'>dir</span><span class='hs-layout'>,</span> <span class='hs-varid'>tcPatToExpr</span> <span class='hs-varid'>argNames</span> <span class='hs-varid'>lpat</span><span class='hs-layout'>)</span> <span class='hs-keyword'>of</span>
<a name="line-89"></a>           <span class='hs-layout'>(</span><span class='hs-conid'>Unidirectional</span><span class='hs-layout'>,</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-90"></a>               <span class='hs-varid'>return</span> <span class='hs-conid'>Nothing</span>
<a name="line-91"></a>           <span class='hs-layout'>(</span><span class='hs-conid'>ImplicitBidirectional</span><span class='hs-layout'>,</span> <span class='hs-conid'>Nothing</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-92"></a>               <span class='hs-varid'>cannotInvertPatSynErr</span> <span class='hs-varid'>lpat</span>
<a name="line-93"></a>           <span class='hs-layout'>(</span><span class='hs-conid'>ImplicitBidirectional</span><span class='hs-layout'>,</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>lexpr</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-94"></a>               <span class='hs-varid'>fmap</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-varid'>tc_pat_syn_wrapper_from_expr</span> <span class='hs-varid'>lname</span> <span class='hs-varid'>lexpr</span> <span class='hs-varid'>args</span> <span class='hs-varid'>univ_tvs</span> <span class='hs-varid'>ex_tvs</span> <span class='hs-varid'>theta</span> <span class='hs-varid'>pat_ty</span> <span class='hs-layout'>}</span>
<a name="line-95"></a>
<a name="line-96"></a><a name="tc_pat_syn_wrapper_from_expr"></a><span class='hs-definition'>tc_pat_syn_wrapper_from_expr</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Located</span> <span class='hs-conid'>Name</span>
<a name="line-97"></a>                             <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-conid'>Name</span>
<a name="line-98"></a>                             <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Var</span><span class='hs-keyglyph'>]</span>
<a name="line-99"></a>                             <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>TyVar</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>TyVar</span><span class='hs-keyglyph'>]</span>
<a name="line-100"></a>                             <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ThetaType</span>
<a name="line-101"></a>                             <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Type</span>
<a name="line-102"></a>                             <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TcM</span> <span class='hs-layout'>(</span><span class='hs-conid'>Id</span><span class='hs-layout'>,</span> <span class='hs-conid'>LHsBinds</span> <span class='hs-conid'>Id</span><span class='hs-layout'>)</span>
<a name="line-103"></a><span class='hs-definition'>tc_pat_syn_wrapper_from_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-varid'>loc</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-varid'>lexpr</span> <span class='hs-varid'>args</span> <span class='hs-varid'>univ_tvs</span> <span class='hs-varid'>ex_tvs</span> <span class='hs-varid'>theta</span> <span class='hs-varid'>pat_ty</span>
<a name="line-104"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span> <span class='hs-layout'>{</span> <span class='hs-keyword'>let</span> <span class='hs-varid'>qtvs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>univ_tvs</span> <span class='hs-varop'>++</span> <span class='hs-varid'>ex_tvs</span>
<a name="line-105"></a>       <span class='hs-layout'>;</span> <span class='hs-layout'>(</span><span class='hs-varid'>subst</span><span class='hs-layout'>,</span> <span class='hs-varid'>wrapper_tvs</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>tcInstSkolTyVars</span> <span class='hs-varid'>qtvs</span>
<a name="line-106"></a>       <span class='hs-layout'>;</span> <span class='hs-keyword'>let</span> <span class='hs-varid'>wrapper_theta</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>substTheta</span> <span class='hs-varid'>subst</span> <span class='hs-varid'>theta</span>
<a name="line-107"></a>             <span class='hs-varid'>pat_ty'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>substTy</span> <span class='hs-varid'>subst</span> <span class='hs-varid'>pat_ty</span>
<a name="line-108"></a>             <span class='hs-varid'>args'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>arg</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>setVarType</span> <span class='hs-varid'>arg</span> <span class='hs-varop'>$</span> <span class='hs-varid'>substTy</span> <span class='hs-varid'>subst</span> <span class='hs-layout'>(</span><span class='hs-varid'>varType</span> <span class='hs-varid'>arg</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varid'>args</span>
<a name="line-109"></a>             <span class='hs-varid'>wrapper_tau</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkFunTys</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-varid'>varType</span> <span class='hs-varid'>args'</span><span class='hs-layout'>)</span> <span class='hs-varid'>pat_ty'</span>
<a name="line-110"></a>             <span class='hs-varid'>wrapper_sigma</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkSigmaTy</span> <span class='hs-varid'>wrapper_tvs</span> <span class='hs-varid'>wrapper_theta</span> <span class='hs-varid'>wrapper_tau</span>
<a name="line-111"></a>
<a name="line-112"></a>       <span class='hs-layout'>;</span> <span class='hs-varid'>wrapper_name</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>newImplicitBinder</span> <span class='hs-varid'>name</span> <span class='hs-varid'>mkDataConWrapperOcc</span>
<a name="line-113"></a>       <span class='hs-layout'>;</span> <span class='hs-keyword'>let</span> <span class='hs-varid'>wrapper_lname</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>L</span> <span class='hs-varid'>loc</span> <span class='hs-varid'>wrapper_name</span>
<a name="line-114"></a>             <span class='hs-varid'>wrapper_id</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkExportedLocalId</span> <span class='hs-conid'>VanillaId</span> <span class='hs-varid'>wrapper_name</span> <span class='hs-varid'>wrapper_sigma</span>
<a name="line-115"></a>
<a name="line-116"></a>       <span class='hs-layout'>;</span> <span class='hs-keyword'>let</span> <span class='hs-varid'>wrapper_args</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-varid'>noLoc</span> <span class='hs-varop'>.</span> <span class='hs-conid'>VarPat</span> <span class='hs-varop'>.</span> <span class='hs-conid'>Var</span><span class='hs-varop'>.</span><span class='hs-varid'>varName</span><span class='hs-layout'>)</span> <span class='hs-varid'>args'</span>
<a name="line-117"></a>             <span class='hs-varid'>wrapper_match</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkMatch</span> <span class='hs-varid'>wrapper_args</span> <span class='hs-varid'>lexpr</span> <span class='hs-conid'>EmptyLocalBinds</span>
<a name="line-118"></a>             <span class='hs-varid'>bind</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkTopFunBind</span> <span class='hs-conid'>Generated</span> <span class='hs-varid'>wrapper_lname</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>wrapper_match</span><span class='hs-keyglyph'>]</span>
<a name="line-119"></a>             <span class='hs-varid'>lbind</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>noLoc</span> <span class='hs-varid'>bind</span>
<a name="line-120"></a>       <span class='hs-layout'>;</span> <span class='hs-keyword'>let</span> <span class='hs-varid'>sig</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>TcSigInfo</span><span class='hs-layout'>{</span> <span class='hs-varid'>sig_id</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>wrapper_id</span>
<a name="line-121"></a>                            <span class='hs-layout'>,</span> <span class='hs-varid'>sig_tvs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>tv</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Nothing</span><span class='hs-layout'>,</span> <span class='hs-varid'>tv</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varid'>wrapper_tvs</span>
<a name="line-122"></a>                            <span class='hs-layout'>,</span> <span class='hs-varid'>sig_theta</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>wrapper_theta</span>
<a name="line-123"></a>                            <span class='hs-layout'>,</span> <span class='hs-varid'>sig_tau</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>wrapper_tau</span>
<a name="line-124"></a>                            <span class='hs-layout'>,</span> <span class='hs-varid'>sig_loc</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>loc</span>
<a name="line-125"></a>                            <span class='hs-layout'>}</span>
<a name="line-126"></a>       <span class='hs-layout'>;</span> <span class='hs-layout'>(</span><span class='hs-varid'>wrapper_binds</span><span class='hs-layout'>,</span> <span class='hs-keyword'>_</span><span class='hs-layout'>,</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>tcPolyCheck</span> <span class='hs-conid'>NonRecursive</span> <span class='hs-layout'>(</span><span class='hs-varid'>const</span> <span class='hs-conid'>[]</span><span class='hs-layout'>)</span> <span class='hs-varid'>sig</span> <span class='hs-varid'>lbind</span>
<a name="line-127"></a>       <span class='hs-layout'>;</span> <span class='hs-varid'>traceTc</span> <span class='hs-str'>"tcPatSynDecl wrapper"</span> <span class='hs-varop'>$</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>wrapper_binds</span>
<a name="line-128"></a>       <span class='hs-layout'>;</span> <span class='hs-varid'>traceTc</span> <span class='hs-str'>"tcPatSynDecl wrapper type"</span> <span class='hs-varop'>$</span> <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-varid'>varType</span> <span class='hs-varid'>wrapper_id</span><span class='hs-layout'>)</span>
<a name="line-129"></a>       <span class='hs-layout'>;</span> <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>wrapper_id</span><span class='hs-layout'>,</span> <span class='hs-varid'>wrapper_binds</span><span class='hs-layout'>)</span> <span class='hs-layout'>}</span>
<a name="line-130"></a>
</pre>\end{code}

Note [As-patterns in pattern synonym definitions]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The rationale for rejecting as-patterns in pattern synonym definitions
is that an as-pattern would introduce nonindependent pattern synonym
arguments, e.g. given a pattern synonym like:

        pattern K x y = x@(Just y)

one could write a nonsensical function like

        f (K Nothing x) = ...

or
        g (K (Just True) False) = ...

\begin{code}
<pre><a name="line-1"></a><a name="tcCheckPatSynPat"></a><span class='hs-definition'>tcCheckPatSynPat</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LPat</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TcM</span> <span class='hs-conid'>()</span>
<a name="line-2"></a><span class='hs-definition'>tcCheckPatSynPat</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>go</span>
<a name="line-3"></a>  <span class='hs-keyword'>where</span>
<a name="line-4"></a>    <span class='hs-varid'>go</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LPat</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TcM</span> <span class='hs-conid'>()</span>
<a name="line-5"></a>    <span class='hs-varid'>go</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>addLocM</span> <span class='hs-varid'>go1</span>
<a name="line-6"></a>
<a name="line-7"></a>    <span class='hs-varid'>go1</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Pat</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TcM</span> <span class='hs-conid'>()</span>
<a name="line-8"></a>    <span class='hs-varid'>go1</span>   <span class='hs-layout'>(</span><span class='hs-conid'>ConPatIn</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>info</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mapM_</span> <span class='hs-varid'>go</span> <span class='hs-layout'>(</span><span class='hs-varid'>hsConPatArgs</span> <span class='hs-varid'>info</span><span class='hs-layout'>)</span>
<a name="line-9"></a>    <span class='hs-varid'>go1</span>   <span class='hs-conid'>VarPat</span><span class='hs-layout'>{</span><span class='hs-layout'>}</span>            <span class='hs-keyglyph'>=</span> <span class='hs-varid'>return</span> <span class='hs-conid'>()</span>
<a name="line-10"></a>    <span class='hs-varid'>go1</span>   <span class='hs-conid'>WildPat</span><span class='hs-layout'>{</span><span class='hs-layout'>}</span>           <span class='hs-keyglyph'>=</span> <span class='hs-varid'>return</span> <span class='hs-conid'>()</span>
<a name="line-11"></a>    <span class='hs-varid'>go1</span> <span class='hs-varid'>p</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-conid'>AsPat</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>         <span class='hs-keyglyph'>=</span> <span class='hs-varid'>asPatInPatSynErr</span> <span class='hs-varid'>p</span>
<a name="line-12"></a>    <span class='hs-varid'>go1</span>   <span class='hs-layout'>(</span><span class='hs-conid'>LazyPat</span> <span class='hs-varid'>pat</span><span class='hs-layout'>)</span>       <span class='hs-keyglyph'>=</span> <span class='hs-varid'>go</span> <span class='hs-varid'>pat</span>
<a name="line-13"></a>    <span class='hs-varid'>go1</span>   <span class='hs-layout'>(</span><span class='hs-conid'>ParPat</span> <span class='hs-varid'>pat</span><span class='hs-layout'>)</span>        <span class='hs-keyglyph'>=</span> <span class='hs-varid'>go</span> <span class='hs-varid'>pat</span>
<a name="line-14"></a>    <span class='hs-varid'>go1</span>   <span class='hs-layout'>(</span><span class='hs-conid'>BangPat</span> <span class='hs-varid'>pat</span><span class='hs-layout'>)</span>       <span class='hs-keyglyph'>=</span> <span class='hs-varid'>go</span> <span class='hs-varid'>pat</span>
<a name="line-15"></a>    <span class='hs-varid'>go1</span>   <span class='hs-layout'>(</span><span class='hs-conid'>PArrPat</span> <span class='hs-varid'>pats</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mapM_</span> <span class='hs-varid'>go</span> <span class='hs-varid'>pats</span>
<a name="line-16"></a>    <span class='hs-varid'>go1</span>   <span class='hs-layout'>(</span><span class='hs-conid'>ListPat</span> <span class='hs-varid'>pats</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mapM_</span> <span class='hs-varid'>go</span> <span class='hs-varid'>pats</span>
<a name="line-17"></a>    <span class='hs-varid'>go1</span>   <span class='hs-layout'>(</span><span class='hs-conid'>TuplePat</span> <span class='hs-varid'>pats</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mapM_</span> <span class='hs-varid'>go</span> <span class='hs-varid'>pats</span>
<a name="line-18"></a>    <span class='hs-varid'>go1</span>   <span class='hs-conid'>LitPat</span><span class='hs-layout'>{</span><span class='hs-layout'>}</span>            <span class='hs-keyglyph'>=</span> <span class='hs-varid'>return</span> <span class='hs-conid'>()</span>
<a name="line-19"></a>    <span class='hs-varid'>go1</span>   <span class='hs-conid'>NPat</span><span class='hs-layout'>{</span><span class='hs-layout'>}</span>              <span class='hs-keyglyph'>=</span> <span class='hs-varid'>return</span> <span class='hs-conid'>()</span>
<a name="line-20"></a>    <span class='hs-varid'>go1</span>   <span class='hs-layout'>(</span><span class='hs-conid'>SigPatIn</span> <span class='hs-varid'>pat</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>go</span> <span class='hs-varid'>pat</span>
<a name="line-21"></a>    <span class='hs-varid'>go1</span>   <span class='hs-layout'>(</span><span class='hs-conid'>ViewPat</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>pat</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>go</span> <span class='hs-varid'>pat</span>
<a name="line-22"></a>    <span class='hs-varid'>go1</span> <span class='hs-varid'>p</span><span class='hs-keyglyph'>@</span><span class='hs-conid'>SplicePat</span><span class='hs-layout'>{</span><span class='hs-layout'>}</span>         <span class='hs-keyglyph'>=</span> <span class='hs-varid'>thInPatSynErr</span> <span class='hs-varid'>p</span>
<a name="line-23"></a>    <span class='hs-varid'>go1</span> <span class='hs-varid'>p</span><span class='hs-keyglyph'>@</span><span class='hs-conid'>QuasiQuotePat</span><span class='hs-layout'>{</span><span class='hs-layout'>}</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>thInPatSynErr</span> <span class='hs-varid'>p</span>
<a name="line-24"></a>    <span class='hs-varid'>go1</span> <span class='hs-varid'>p</span><span class='hs-keyglyph'>@</span><span class='hs-conid'>NPlusKPat</span><span class='hs-layout'>{</span><span class='hs-layout'>}</span>         <span class='hs-keyglyph'>=</span> <span class='hs-varid'>nPlusKPatInPatSynErr</span> <span class='hs-varid'>p</span>
<a name="line-25"></a>    <span class='hs-varid'>go1</span>   <span class='hs-conid'>ConPatOut</span><span class='hs-layout'>{</span><span class='hs-layout'>}</span>         <span class='hs-keyglyph'>=</span> <span class='hs-varid'>panic</span> <span class='hs-str'>"ConPatOut in output of renamer"</span>
<a name="line-26"></a>    <span class='hs-varid'>go1</span>   <span class='hs-conid'>SigPatOut</span><span class='hs-layout'>{</span><span class='hs-layout'>}</span>         <span class='hs-keyglyph'>=</span> <span class='hs-varid'>panic</span> <span class='hs-str'>"SigPatOut in output of renamer"</span>
<a name="line-27"></a>    <span class='hs-varid'>go1</span>   <span class='hs-conid'>CoPat</span><span class='hs-layout'>{</span><span class='hs-layout'>}</span>             <span class='hs-keyglyph'>=</span> <span class='hs-varid'>panic</span> <span class='hs-str'>"CoPat in output of renamer"</span>
<a name="line-28"></a>
<a name="line-29"></a><a name="asPatInPatSynErr"></a><span class='hs-definition'>asPatInPatSynErr</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Pat</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TcM</span> <span class='hs-varid'>a</span>
<a name="line-30"></a><span class='hs-definition'>asPatInPatSynErr</span> <span class='hs-varid'>pat</span>
<a name="line-31"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>failWithTc</span> <span class='hs-varop'>$</span>
<a name="line-32"></a>    <span class='hs-varid'>hang</span> <span class='hs-layout'>(</span><span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"Pattern synonym definition cannot contain as-patterns (@):"</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-33"></a>       <span class='hs-num'>2</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>pat</span><span class='hs-layout'>)</span>
<a name="line-34"></a>
<a name="line-35"></a><a name="thInPatSynErr"></a><span class='hs-definition'>thInPatSynErr</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Pat</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TcM</span> <span class='hs-varid'>a</span>
<a name="line-36"></a><span class='hs-definition'>thInPatSynErr</span> <span class='hs-varid'>pat</span>
<a name="line-37"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>failWithTc</span> <span class='hs-varop'>$</span>
<a name="line-38"></a>    <span class='hs-varid'>hang</span> <span class='hs-layout'>(</span><span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"Pattern synonym definition cannot contain Template Haskell:"</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-39"></a>       <span class='hs-num'>2</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>pat</span><span class='hs-layout'>)</span>
<a name="line-40"></a>
<a name="line-41"></a><a name="nPlusKPatInPatSynErr"></a><span class='hs-definition'>nPlusKPatInPatSynErr</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Pat</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TcM</span> <span class='hs-varid'>a</span>
<a name="line-42"></a><span class='hs-definition'>nPlusKPatInPatSynErr</span> <span class='hs-varid'>pat</span>
<a name="line-43"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>failWithTc</span> <span class='hs-varop'>$</span>
<a name="line-44"></a>    <span class='hs-varid'>hang</span> <span class='hs-layout'>(</span><span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"Pattern synonym definition cannot contain n+k-pattern:"</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-45"></a>       <span class='hs-num'>2</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>pat</span><span class='hs-layout'>)</span>
<a name="line-46"></a>
<a name="line-47"></a><a name="tcPatToExpr"></a><span class='hs-definition'>tcPatToExpr</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>NameSet</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LPat</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-conid'>Name</span><span class='hs-layout'>)</span>
<a name="line-48"></a><span class='hs-definition'>tcPatToExpr</span> <span class='hs-varid'>lhsVars</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>go</span>
<a name="line-49"></a>  <span class='hs-keyword'>where</span>
<a name="line-50"></a>    <span class='hs-varid'>go</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LPat</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-conid'>Name</span><span class='hs-layout'>)</span>
<a name="line-51"></a>    <span class='hs-varid'>go</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-varid'>loc</span> <span class='hs-layout'>(</span><span class='hs-conid'>ConPatIn</span> <span class='hs-varid'>conName</span> <span class='hs-varid'>info</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-52"></a>      <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-53"></a>          <span class='hs-layout'>{</span> <span class='hs-keyword'>let</span> <span class='hs-varid'>con</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>L</span> <span class='hs-varid'>loc</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsVar</span> <span class='hs-layout'>(</span><span class='hs-varid'>unLoc</span> <span class='hs-varid'>conName</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-54"></a>          <span class='hs-layout'>;</span> <span class='hs-varid'>exprs</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>mapM</span> <span class='hs-varid'>go</span> <span class='hs-layout'>(</span><span class='hs-varid'>hsConPatArgs</span> <span class='hs-varid'>info</span><span class='hs-layout'>)</span>
<a name="line-55"></a>          <span class='hs-layout'>;</span> <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-varid'>foldl</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-varid'>y</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>L</span> <span class='hs-varid'>loc</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsApp</span> <span class='hs-varid'>x</span> <span class='hs-varid'>y</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varid'>con</span> <span class='hs-varid'>exprs</span> <span class='hs-layout'>}</span>
<a name="line-56"></a>    <span class='hs-varid'>go</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-varid'>loc</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fmap</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-varid'>loc</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-varid'>go1</span> <span class='hs-varid'>p</span>
<a name="line-57"></a>
<a name="line-58"></a>    <span class='hs-varid'>go1</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Pat</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsExpr</span> <span class='hs-conid'>Name</span><span class='hs-layout'>)</span>
<a name="line-59"></a>    <span class='hs-varid'>go1</span>   <span class='hs-layout'>(</span><span class='hs-conid'>VarPat</span> <span class='hs-varid'>var</span><span class='hs-layout'>)</span>
<a name="line-60"></a>      <span class='hs-keyglyph'>|</span> <span class='hs-varid'>var</span> <span class='hs-varop'>`elemNameSet`</span> <span class='hs-varid'>lhsVars</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-conid'>HsVar</span> <span class='hs-varid'>var</span>
<a name="line-61"></a>      <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>                  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-62"></a>    <span class='hs-varid'>go1</span>   <span class='hs-layout'>(</span><span class='hs-conid'>LazyPat</span> <span class='hs-varid'>pat</span><span class='hs-layout'>)</span>            <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fmap</span> <span class='hs-conid'>HsPar</span> <span class='hs-varop'>$</span> <span class='hs-varid'>go</span> <span class='hs-varid'>pat</span>
<a name="line-63"></a>    <span class='hs-varid'>go1</span>   <span class='hs-layout'>(</span><span class='hs-conid'>ParPat</span> <span class='hs-varid'>pat</span><span class='hs-layout'>)</span>             <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fmap</span> <span class='hs-conid'>HsPar</span> <span class='hs-varop'>$</span> <span class='hs-varid'>go</span> <span class='hs-varid'>pat</span>
<a name="line-64"></a>    <span class='hs-varid'>go1</span>   <span class='hs-layout'>(</span><span class='hs-conid'>BangPat</span> <span class='hs-varid'>pat</span><span class='hs-layout'>)</span>            <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fmap</span> <span class='hs-conid'>HsPar</span> <span class='hs-varop'>$</span> <span class='hs-varid'>go</span> <span class='hs-varid'>pat</span>
<a name="line-65"></a>    <span class='hs-varid'>go1</span>   <span class='hs-layout'>(</span><span class='hs-conid'>PArrPat</span> <span class='hs-varid'>pats</span> <span class='hs-varid'>ptt</span><span class='hs-layout'>)</span>
<a name="line-66"></a>      <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span> <span class='hs-layout'>{</span> <span class='hs-varid'>exprs</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>mapM</span> <span class='hs-varid'>go</span> <span class='hs-varid'>pats</span>
<a name="line-67"></a>           <span class='hs-layout'>;</span> <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-conid'>ExplicitPArr</span> <span class='hs-varid'>ptt</span> <span class='hs-varid'>exprs</span> <span class='hs-layout'>}</span>
<a name="line-68"></a>    <span class='hs-varid'>go1</span>   <span class='hs-layout'>(</span><span class='hs-conid'>ListPat</span> <span class='hs-varid'>pats</span> <span class='hs-varid'>ptt</span> <span class='hs-varid'>reb</span><span class='hs-layout'>)</span>
<a name="line-69"></a>      <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span> <span class='hs-layout'>{</span> <span class='hs-varid'>exprs</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>mapM</span> <span class='hs-varid'>go</span> <span class='hs-varid'>pats</span>
<a name="line-70"></a>           <span class='hs-layout'>;</span> <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-conid'>ExplicitList</span> <span class='hs-varid'>ptt</span> <span class='hs-layout'>(</span><span class='hs-varid'>fmap</span> <span class='hs-varid'>snd</span> <span class='hs-varid'>reb</span><span class='hs-layout'>)</span> <span class='hs-varid'>exprs</span> <span class='hs-layout'>}</span>
<a name="line-71"></a>    <span class='hs-varid'>go1</span>   <span class='hs-layout'>(</span><span class='hs-conid'>TuplePat</span> <span class='hs-varid'>pats</span> <span class='hs-varid'>box</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>
<a name="line-72"></a>      <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span> <span class='hs-layout'>{</span> <span class='hs-varid'>exprs</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>mapM</span> <span class='hs-varid'>go</span> <span class='hs-varid'>pats</span>
<a name="line-73"></a>           <span class='hs-layout'>;</span> <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-conid'>ExplicitTuple</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-conid'>Present</span> <span class='hs-varid'>exprs</span><span class='hs-layout'>)</span> <span class='hs-varid'>box</span><span class='hs-layout'>)</span>
<a name="line-74"></a>           <span class='hs-layout'>}</span>
<a name="line-75"></a>    <span class='hs-varid'>go1</span>   <span class='hs-layout'>(</span><span class='hs-conid'>LitPat</span> <span class='hs-varid'>lit</span><span class='hs-layout'>)</span>             <span class='hs-keyglyph'>=</span> <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-conid'>HsLit</span> <span class='hs-varid'>lit</span>
<a name="line-76"></a>    <span class='hs-varid'>go1</span>   <span class='hs-layout'>(</span><span class='hs-conid'>NPat</span> <span class='hs-varid'>n</span> <span class='hs-conid'>Nothing</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>       <span class='hs-keyglyph'>=</span> <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-conid'>HsOverLit</span> <span class='hs-varid'>n</span>
<a name="line-77"></a>    <span class='hs-varid'>go1</span>   <span class='hs-layout'>(</span><span class='hs-conid'>NPat</span> <span class='hs-varid'>n</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-varid'>neg</span><span class='hs-layout'>)</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-varid'>noLoc</span> <span class='hs-varid'>neg</span> <span class='hs-varop'>`HsApp`</span> <span class='hs-varid'>noLoc</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsOverLit</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span>
<a name="line-78"></a>    <span class='hs-varid'>go1</span>   <span class='hs-layout'>(</span><span class='hs-conid'>SigPatIn</span> <span class='hs-varid'>pat</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsWB</span> <span class='hs-varid'>ty</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-79"></a>      <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span> <span class='hs-layout'>{</span> <span class='hs-varid'>expr</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>go</span> <span class='hs-varid'>pat</span>
<a name="line-80"></a>           <span class='hs-layout'>;</span> <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-conid'>ExprWithTySig</span> <span class='hs-varid'>expr</span> <span class='hs-varid'>ty</span> <span class='hs-layout'>}</span>
<a name="line-81"></a>    <span class='hs-varid'>go1</span>   <span class='hs-layout'>(</span><span class='hs-conid'>ConPatOut</span><span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>            <span class='hs-keyglyph'>=</span> <span class='hs-varid'>panic</span> <span class='hs-str'>"ConPatOut in output of renamer"</span>
<a name="line-82"></a>    <span class='hs-varid'>go1</span>   <span class='hs-layout'>(</span><span class='hs-conid'>SigPatOut</span><span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>            <span class='hs-keyglyph'>=</span> <span class='hs-varid'>panic</span> <span class='hs-str'>"SigPatOut in output of renamer"</span>
<a name="line-83"></a>    <span class='hs-varid'>go1</span>   <span class='hs-layout'>(</span><span class='hs-conid'>CoPat</span><span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>                <span class='hs-keyglyph'>=</span> <span class='hs-varid'>panic</span> <span class='hs-str'>"CoPat in output of renamer"</span>
<a name="line-84"></a>    <span class='hs-varid'>go1</span>   <span class='hs-keyword'>_</span>                        <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-85"></a>
<a name="line-86"></a><a name="cannotInvertPatSynErr"></a><span class='hs-definition'>cannotInvertPatSynErr</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>LPat</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TcM</span> <span class='hs-varid'>a</span>
<a name="line-87"></a><span class='hs-definition'>cannotInvertPatSynErr</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-varid'>loc</span> <span class='hs-varid'>pat</span><span class='hs-layout'>)</span>
<a name="line-88"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>setSrcSpan</span> <span class='hs-varid'>loc</span> <span class='hs-varop'>$</span> <span class='hs-varid'>failWithTc</span> <span class='hs-varop'>$</span>
<a name="line-89"></a>    <span class='hs-varid'>hang</span> <span class='hs-layout'>(</span><span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"Right-hand side of bidirectional pattern synonym cannot be used as an expression"</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-90"></a>       <span class='hs-num'>2</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>pat</span><span class='hs-layout'>)</span>
<a name="line-91"></a>
<a name="line-92"></a><a name="tcCollectEx"></a><span class='hs-comment'>-- Walk the whole pattern and for all ConPatOuts, collect the</span>
<a name="line-93"></a><span class='hs-comment'>-- existentially-bound type variables and evidence binding variables.</span>
<a name="line-94"></a><span class='hs-comment'>--</span>
<a name="line-95"></a><span class='hs-comment'>-- These are used in computing the type of a pattern synonym and also</span>
<a name="line-96"></a><span class='hs-comment'>-- in generating matcher functions, since success continuations need</span>
<a name="line-97"></a><span class='hs-comment'>-- to be passed these pattern-bound evidences.</span>
<a name="line-98"></a><span class='hs-definition'>tcCollectEx</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LPat</span> <span class='hs-conid'>Id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TcM</span> <span class='hs-layout'>(</span><span class='hs-conid'>TyVarSet</span><span class='hs-layout'>,</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>EvVar</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-99"></a><span class='hs-definition'>tcCollectEx</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>return</span> <span class='hs-varop'>.</span> <span class='hs-varid'>go</span>
<a name="line-100"></a>  <span class='hs-keyword'>where</span>
<a name="line-101"></a>    <span class='hs-varid'>go</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LPat</span> <span class='hs-conid'>Id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>TyVarSet</span><span class='hs-layout'>,</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>EvVar</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-102"></a>    <span class='hs-varid'>go</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>go1</span> <span class='hs-varop'>.</span> <span class='hs-varid'>unLoc</span>
<a name="line-103"></a>
<a name="line-104"></a>    <span class='hs-varid'>go1</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Pat</span> <span class='hs-conid'>Id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>TyVarSet</span><span class='hs-layout'>,</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>EvVar</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-105"></a>    <span class='hs-varid'>go1</span> <span class='hs-layout'>(</span><span class='hs-conid'>LazyPat</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>         <span class='hs-keyglyph'>=</span> <span class='hs-varid'>go</span> <span class='hs-varid'>p</span>
<a name="line-106"></a>    <span class='hs-varid'>go1</span> <span class='hs-layout'>(</span><span class='hs-conid'>AsPat</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>         <span class='hs-keyglyph'>=</span> <span class='hs-varid'>go</span> <span class='hs-varid'>p</span>
<a name="line-107"></a>    <span class='hs-varid'>go1</span> <span class='hs-layout'>(</span><span class='hs-conid'>ParPat</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>          <span class='hs-keyglyph'>=</span> <span class='hs-varid'>go</span> <span class='hs-varid'>p</span>
<a name="line-108"></a>    <span class='hs-varid'>go1</span> <span class='hs-layout'>(</span><span class='hs-conid'>BangPat</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>         <span class='hs-keyglyph'>=</span> <span class='hs-varid'>go</span> <span class='hs-varid'>p</span>
<a name="line-109"></a>    <span class='hs-varid'>go1</span> <span class='hs-layout'>(</span><span class='hs-conid'>ListPat</span> <span class='hs-varid'>ps</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mconcat</span> <span class='hs-varop'>.</span> <span class='hs-varid'>map</span> <span class='hs-varid'>go</span> <span class='hs-varop'>$</span> <span class='hs-varid'>ps</span>
<a name="line-110"></a>    <span class='hs-varid'>go1</span> <span class='hs-layout'>(</span><span class='hs-conid'>TuplePat</span> <span class='hs-varid'>ps</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mconcat</span> <span class='hs-varop'>.</span> <span class='hs-varid'>map</span> <span class='hs-varid'>go</span> <span class='hs-varop'>$</span> <span class='hs-varid'>ps</span>
<a name="line-111"></a>    <span class='hs-varid'>go1</span> <span class='hs-layout'>(</span><span class='hs-conid'>PArrPat</span> <span class='hs-varid'>ps</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mconcat</span> <span class='hs-varop'>.</span> <span class='hs-varid'>map</span> <span class='hs-varid'>go</span> <span class='hs-varop'>$</span> <span class='hs-varid'>ps</span>
<a name="line-112"></a>    <span class='hs-varid'>go1</span> <span class='hs-layout'>(</span><span class='hs-conid'>ViewPat</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>p</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>go</span> <span class='hs-varid'>p</span>
<a name="line-113"></a>    <span class='hs-varid'>go1</span> <span class='hs-layout'>(</span><span class='hs-conid'>QuasiQuotePat</span> <span class='hs-varid'>qq</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprPanic</span> <span class='hs-str'>"TODO: tcInstPatSyn QuasiQuotePat"</span> <span class='hs-varop'>$</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>qq</span>
<a name="line-114"></a>    <span class='hs-varid'>go1</span> <span class='hs-varid'>con</span><span class='hs-keyglyph'>@</span><span class='hs-conid'>ConPatOut</span><span class='hs-layout'>{</span><span class='hs-layout'>}</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mappend</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkVarSet</span> <span class='hs-layout'>(</span><span class='hs-varid'>pat_tvs</span> <span class='hs-varid'>con</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>pat_dicts</span> <span class='hs-varid'>con</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span>
<a name="line-115"></a>                                 <span class='hs-varid'>goConDetails</span> <span class='hs-varop'>$</span> <span class='hs-varid'>pat_args</span> <span class='hs-varid'>con</span>
<a name="line-116"></a>    <span class='hs-varid'>go1</span> <span class='hs-layout'>(</span><span class='hs-conid'>SigPatOut</span> <span class='hs-varid'>p</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>go</span> <span class='hs-varid'>p</span>
<a name="line-117"></a>    <span class='hs-varid'>go1</span> <span class='hs-layout'>(</span><span class='hs-conid'>CoPat</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>p</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>       <span class='hs-keyglyph'>=</span> <span class='hs-varid'>go1</span> <span class='hs-varid'>p</span>
<a name="line-118"></a>    <span class='hs-varid'>go1</span> <span class='hs-layout'>(</span><span class='hs-conid'>NPlusKPat</span> <span class='hs-varid'>n</span> <span class='hs-varid'>k</span> <span class='hs-varid'>geq</span> <span class='hs-varid'>subtract</span><span class='hs-layout'>)</span>
<a name="line-119"></a>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprPanic</span> <span class='hs-str'>"TODO: NPlusKPat"</span> <span class='hs-varop'>$</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>n</span> <span class='hs-varop'>$$</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>k</span> <span class='hs-varop'>$$</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>geq</span> <span class='hs-varop'>$$</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>subtract</span>
<a name="line-120"></a>    <span class='hs-varid'>go1</span> <span class='hs-keyword'>_</span>                   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mempty</span>
<a name="line-121"></a>
<a name="line-122"></a>    <span class='hs-varid'>goConDetails</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsConPatDetails</span> <span class='hs-conid'>Id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>TyVarSet</span><span class='hs-layout'>,</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>EvVar</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-123"></a>    <span class='hs-varid'>goConDetails</span> <span class='hs-layout'>(</span><span class='hs-conid'>PrefixCon</span> <span class='hs-varid'>ps</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mconcat</span> <span class='hs-varop'>.</span> <span class='hs-varid'>map</span> <span class='hs-varid'>go</span> <span class='hs-varop'>$</span> <span class='hs-varid'>ps</span>
<a name="line-124"></a>    <span class='hs-varid'>goConDetails</span> <span class='hs-layout'>(</span><span class='hs-conid'>InfixCon</span> <span class='hs-varid'>p1</span> <span class='hs-varid'>p2</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>go</span> <span class='hs-varid'>p1</span> <span class='hs-varop'>`mappend`</span> <span class='hs-varid'>go</span> <span class='hs-varid'>p2</span>
<a name="line-125"></a>    <span class='hs-varid'>goConDetails</span> <span class='hs-layout'>(</span><span class='hs-conid'>RecCon</span> <span class='hs-conid'>HsRecFields</span><span class='hs-layout'>{</span> <span class='hs-varid'>rec_flds</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>flds</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-126"></a>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mconcat</span> <span class='hs-varop'>.</span> <span class='hs-varid'>map</span> <span class='hs-varid'>goRecFd</span> <span class='hs-varop'>$</span> <span class='hs-varid'>flds</span>
<a name="line-127"></a>
<a name="line-128"></a>    <span class='hs-varid'>goRecFd</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsRecField</span> <span class='hs-conid'>Id</span> <span class='hs-layout'>(</span><span class='hs-conid'>LPat</span> <span class='hs-conid'>Id</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>TyVarSet</span><span class='hs-layout'>,</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>EvVar</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-129"></a>    <span class='hs-varid'>goRecFd</span> <span class='hs-conid'>HsRecField</span><span class='hs-layout'>{</span> <span class='hs-varid'>hsRecFieldArg</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>p</span> <span class='hs-layout'>}</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>go</span> <span class='hs-varid'>p</span>
<a name="line-130"></a>
</pre>\end{code}
</body>
</html>
