<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>types/TyCon.lhs</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
%
% (c) The University of Glasgow 2006
% (c) The GRASP/AQUA Project, Glasgow University, 1992-1998
%

The @TyCon@ datatype

\begin{code}
<pre><a name="line-1"></a>
<a name="line-2"></a><span class='hs-keyword'>module</span> <span class='hs-conid'>TyCon</span><span class='hs-layout'>(</span>
<a name="line-3"></a>        <span class='hs-comment'>-- * Main TyCon data types</span>
<a name="line-4"></a>        <span class='hs-conid'>TyCon</span><span class='hs-layout'>,</span> <span class='hs-conid'>FieldLabel</span><span class='hs-layout'>,</span>
<a name="line-5"></a>
<a name="line-6"></a>        <span class='hs-conid'>AlgTyConRhs</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>visibleDataCons</span><span class='hs-layout'>,</span>
<a name="line-7"></a>        <span class='hs-conid'>TyConParent</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>isNoParent</span><span class='hs-layout'>,</span>
<a name="line-8"></a>        <span class='hs-conid'>SynTyConRhs</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>Role</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-9"></a>
<a name="line-10"></a>        <span class='hs-comment'>-- ** Constructing TyCons</span>
<a name="line-11"></a>        <span class='hs-varid'>mkAlgTyCon</span><span class='hs-layout'>,</span>
<a name="line-12"></a>        <span class='hs-varid'>mkClassTyCon</span><span class='hs-layout'>,</span>
<a name="line-13"></a>        <span class='hs-varid'>mkFunTyCon</span><span class='hs-layout'>,</span>
<a name="line-14"></a>        <span class='hs-varid'>mkPrimTyCon</span><span class='hs-layout'>,</span>
<a name="line-15"></a>        <span class='hs-varid'>mkKindTyCon</span><span class='hs-layout'>,</span>
<a name="line-16"></a>        <span class='hs-varid'>mkLiftedPrimTyCon</span><span class='hs-layout'>,</span>
<a name="line-17"></a>        <span class='hs-varid'>mkTupleTyCon</span><span class='hs-layout'>,</span>
<a name="line-18"></a>        <span class='hs-varid'>mkSynTyCon</span><span class='hs-layout'>,</span>
<a name="line-19"></a>        <span class='hs-varid'>mkForeignTyCon</span><span class='hs-layout'>,</span>
<a name="line-20"></a>        <span class='hs-varid'>mkPromotedDataCon</span><span class='hs-layout'>,</span>
<a name="line-21"></a>        <span class='hs-varid'>mkPromotedTyCon</span><span class='hs-layout'>,</span>
<a name="line-22"></a>
<a name="line-23"></a>        <span class='hs-comment'>-- ** Predicates on TyCons</span>
<a name="line-24"></a>        <span class='hs-varid'>isAlgTyCon</span><span class='hs-layout'>,</span>
<a name="line-25"></a>        <span class='hs-varid'>isClassTyCon</span><span class='hs-layout'>,</span> <span class='hs-varid'>isFamInstTyCon</span><span class='hs-layout'>,</span>
<a name="line-26"></a>        <span class='hs-varid'>isFunTyCon</span><span class='hs-layout'>,</span>
<a name="line-27"></a>        <span class='hs-varid'>isPrimTyCon</span><span class='hs-layout'>,</span>
<a name="line-28"></a>        <span class='hs-varid'>isTupleTyCon</span><span class='hs-layout'>,</span> <span class='hs-varid'>isUnboxedTupleTyCon</span><span class='hs-layout'>,</span> <span class='hs-varid'>isBoxedTupleTyCon</span><span class='hs-layout'>,</span>
<a name="line-29"></a>        <span class='hs-varid'>isSynTyCon</span><span class='hs-layout'>,</span> <span class='hs-varid'>isTypeSynonymTyCon</span><span class='hs-layout'>,</span>
<a name="line-30"></a>        <span class='hs-varid'>isDecomposableTyCon</span><span class='hs-layout'>,</span>
<a name="line-31"></a>        <span class='hs-varid'>isForeignTyCon</span><span class='hs-layout'>,</span> 
<a name="line-32"></a>        <span class='hs-varid'>isPromotedDataCon</span><span class='hs-layout'>,</span> <span class='hs-varid'>isPromotedTyCon</span><span class='hs-layout'>,</span>
<a name="line-33"></a>        <span class='hs-varid'>isPromotedDataCon_maybe</span><span class='hs-layout'>,</span> <span class='hs-varid'>isPromotedTyCon_maybe</span><span class='hs-layout'>,</span>
<a name="line-34"></a>        <span class='hs-varid'>promotableTyCon_maybe</span><span class='hs-layout'>,</span> <span class='hs-varid'>promoteTyCon</span><span class='hs-layout'>,</span>
<a name="line-35"></a>
<a name="line-36"></a>        <span class='hs-varid'>isDataTyCon</span><span class='hs-layout'>,</span> <span class='hs-varid'>isProductTyCon</span><span class='hs-layout'>,</span> <span class='hs-varid'>isDataProductTyCon_maybe</span><span class='hs-layout'>,</span>
<a name="line-37"></a>        <span class='hs-varid'>isEnumerationTyCon</span><span class='hs-layout'>,</span>
<a name="line-38"></a>        <span class='hs-varid'>isNewTyCon</span><span class='hs-layout'>,</span> <span class='hs-varid'>isAbstractTyCon</span><span class='hs-layout'>,</span>
<a name="line-39"></a>        <span class='hs-varid'>isFamilyTyCon</span><span class='hs-layout'>,</span> <span class='hs-varid'>isOpenFamilyTyCon</span><span class='hs-layout'>,</span>
<a name="line-40"></a>        <span class='hs-varid'>isSynFamilyTyCon</span><span class='hs-layout'>,</span> <span class='hs-varid'>isDataFamilyTyCon</span><span class='hs-layout'>,</span>
<a name="line-41"></a>        <span class='hs-varid'>isOpenSynFamilyTyCon</span><span class='hs-layout'>,</span> <span class='hs-varid'>isClosedSynFamilyTyCon_maybe</span><span class='hs-layout'>,</span>
<a name="line-42"></a>        <span class='hs-varid'>isBuiltInSynFamTyCon_maybe</span><span class='hs-layout'>,</span>
<a name="line-43"></a>        <span class='hs-varid'>isUnLiftedTyCon</span><span class='hs-layout'>,</span>
<a name="line-44"></a>        <span class='hs-varid'>isGadtSyntaxTyCon</span><span class='hs-layout'>,</span> <span class='hs-varid'>isDistinctTyCon</span><span class='hs-layout'>,</span> <span class='hs-varid'>isDistinctAlgRhs</span><span class='hs-layout'>,</span>
<a name="line-45"></a>        <span class='hs-varid'>isTyConAssoc</span><span class='hs-layout'>,</span> <span class='hs-varid'>tyConAssoc_maybe</span><span class='hs-layout'>,</span>
<a name="line-46"></a>        <span class='hs-varid'>isRecursiveTyCon</span><span class='hs-layout'>,</span>
<a name="line-47"></a>        <span class='hs-varid'>isImplicitTyCon</span><span class='hs-layout'>,</span>
<a name="line-48"></a>
<a name="line-49"></a>        <span class='hs-comment'>-- ** Extracting information out of TyCons</span>
<a name="line-50"></a>        <span class='hs-varid'>tyConName</span><span class='hs-layout'>,</span>
<a name="line-51"></a>        <span class='hs-varid'>tyConKind</span><span class='hs-layout'>,</span>
<a name="line-52"></a>        <span class='hs-varid'>tyConUnique</span><span class='hs-layout'>,</span>
<a name="line-53"></a>        <span class='hs-varid'>tyConTyVars</span><span class='hs-layout'>,</span>
<a name="line-54"></a>        <span class='hs-varid'>tyConCType</span><span class='hs-layout'>,</span> <span class='hs-varid'>tyConCType_maybe</span><span class='hs-layout'>,</span>
<a name="line-55"></a>        <span class='hs-varid'>tyConDataCons</span><span class='hs-layout'>,</span> <span class='hs-varid'>tyConDataCons_maybe</span><span class='hs-layout'>,</span> 
<a name="line-56"></a>        <span class='hs-varid'>tyConSingleDataCon_maybe</span><span class='hs-layout'>,</span> <span class='hs-varid'>tyConSingleAlgDataCon_maybe</span><span class='hs-layout'>,</span>
<a name="line-57"></a>        <span class='hs-varid'>tyConFamilySize</span><span class='hs-layout'>,</span>
<a name="line-58"></a>        <span class='hs-varid'>tyConStupidTheta</span><span class='hs-layout'>,</span>
<a name="line-59"></a>        <span class='hs-varid'>tyConArity</span><span class='hs-layout'>,</span>
<a name="line-60"></a>        <span class='hs-varid'>tyConRoles</span><span class='hs-layout'>,</span>
<a name="line-61"></a>        <span class='hs-varid'>tyConParent</span><span class='hs-layout'>,</span>
<a name="line-62"></a>        <span class='hs-varid'>tyConTuple_maybe</span><span class='hs-layout'>,</span> <span class='hs-varid'>tyConClass_maybe</span><span class='hs-layout'>,</span>
<a name="line-63"></a>        <span class='hs-varid'>tyConFamInst_maybe</span><span class='hs-layout'>,</span> <span class='hs-varid'>tyConFamInstSig_maybe</span><span class='hs-layout'>,</span> <span class='hs-varid'>tyConFamilyCoercion_maybe</span><span class='hs-layout'>,</span>
<a name="line-64"></a>        <span class='hs-varid'>synTyConDefn_maybe</span><span class='hs-layout'>,</span> <span class='hs-varid'>synTyConRhs_maybe</span><span class='hs-layout'>,</span> 
<a name="line-65"></a>        <span class='hs-varid'>tyConExtName</span><span class='hs-layout'>,</span>           <span class='hs-comment'>-- External name for foreign types</span>
<a name="line-66"></a>        <span class='hs-varid'>algTyConRhs</span><span class='hs-layout'>,</span>
<a name="line-67"></a>        <span class='hs-varid'>newTyConRhs</span><span class='hs-layout'>,</span> <span class='hs-varid'>newTyConEtadArity</span><span class='hs-layout'>,</span> <span class='hs-varid'>newTyConEtadRhs</span><span class='hs-layout'>,</span> <span class='hs-varid'>unwrapNewTyCon_maybe</span><span class='hs-layout'>,</span>
<a name="line-68"></a>        <span class='hs-varid'>tupleTyConBoxity</span><span class='hs-layout'>,</span> <span class='hs-varid'>tupleTyConSort</span><span class='hs-layout'>,</span> <span class='hs-varid'>tupleTyConArity</span><span class='hs-layout'>,</span>
<a name="line-69"></a>
<a name="line-70"></a>        <span class='hs-comment'>-- ** Manipulating TyCons</span>
<a name="line-71"></a>        <span class='hs-varid'>tcExpandTyCon_maybe</span><span class='hs-layout'>,</span> <span class='hs-varid'>coreExpandTyCon_maybe</span><span class='hs-layout'>,</span>
<a name="line-72"></a>        <span class='hs-varid'>makeTyConAbstract</span><span class='hs-layout'>,</span>
<a name="line-73"></a>        <span class='hs-varid'>newTyConCo</span><span class='hs-layout'>,</span> <span class='hs-varid'>newTyConCo_maybe</span><span class='hs-layout'>,</span>
<a name="line-74"></a>        <span class='hs-varid'>pprPromotionQuote</span><span class='hs-layout'>,</span>
<a name="line-75"></a>
<a name="line-76"></a>        <span class='hs-comment'>-- * Primitive representations of Types</span>
<a name="line-77"></a>        <span class='hs-conid'>PrimRep</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>PrimElemRep</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-78"></a>        <span class='hs-varid'>tyConPrimRep</span><span class='hs-layout'>,</span> <span class='hs-varid'>isVoidRep</span><span class='hs-layout'>,</span> <span class='hs-varid'>isGcPtrRep</span><span class='hs-layout'>,</span>
<a name="line-79"></a>        <span class='hs-varid'>primRepSizeW</span><span class='hs-layout'>,</span> <span class='hs-varid'>primElemRepSizeB</span><span class='hs-layout'>,</span>
<a name="line-80"></a>
<a name="line-81"></a>        <span class='hs-comment'>-- * Recursion breaking</span>
<a name="line-82"></a>        <span class='hs-conid'>RecTcChecker</span><span class='hs-layout'>,</span> <span class='hs-varid'>initRecTc</span><span class='hs-layout'>,</span> <span class='hs-varid'>checkRecTc</span>
<a name="line-83"></a>
<a name="line-84"></a><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-85"></a>
<a name="line-86"></a><span class='hs-cpp'>#include "HsVersions.h"</span>
<a name="line-87"></a>
<a name="line-88"></a><span class='hs-keyword'>import</span> <span class='hs-comment'>{-# SOURCE #-}</span> <span class='hs-conid'>TypeRep</span> <span class='hs-layout'>(</span> <span class='hs-conid'>Kind</span><span class='hs-layout'>,</span> <span class='hs-conid'>Type</span><span class='hs-layout'>,</span> <span class='hs-conid'>PredType</span> <span class='hs-layout'>)</span>
<a name="line-89"></a><span class='hs-keyword'>import</span> <span class='hs-comment'>{-# SOURCE #-}</span> <span class='hs-conid'>DataCon</span> <span class='hs-layout'>(</span> <span class='hs-conid'>DataCon</span><span class='hs-layout'>,</span> <span class='hs-varid'>isVanillaDataCon</span> <span class='hs-layout'>)</span>
<a name="line-90"></a>
<a name="line-91"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Var</span>
<a name="line-92"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Class</span>
<a name="line-93"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>BasicTypes</span>
<a name="line-94"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>DynFlags</span>
<a name="line-95"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>ForeignCall</span>
<a name="line-96"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Name</span>
<a name="line-97"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>NameSet</span>
<a name="line-98"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>CoAxiom</span>
<a name="line-99"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>PrelNames</span>
<a name="line-100"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Maybes</span>
<a name="line-101"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Outputable</span>
<a name="line-102"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>FastString</span>
<a name="line-103"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Constants</span>
<a name="line-104"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Util</span>
<a name="line-105"></a><span class='hs-keyword'>import</span> <span class='hs-keyword'>qualified</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Data</span> <span class='hs-keyword'>as</span> <span class='hs-conid'>Data</span>
<a name="line-106"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Typeable</span> <span class='hs-layout'>(</span><span class='hs-conid'>Typeable</span><span class='hs-layout'>)</span>
</pre>\end{code}

-----------------------------------------------
        Notes about type families
-----------------------------------------------

Note [Type synonym families]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* Type synonym families, also known as "type functions", map directly
  onto the type functions in FC:

        type family F a :: *
        type instance F Int = Bool
        ..etc...

* Reply "yes" to isSynFamilyTyCon, and isFamilyTyCon

* From the user's point of view (F Int) and Bool are simply
  equivalent types.

* A Haskell 98 type synonym is a degenerate form of a type synonym
  family.

* Type functions can't appear in the LHS of a type function:
        type instance F (F Int) = ...   -- BAD!

* Translation of type family decl:
        type family F a :: *
  translates to
    a SynTyCon 'F', whose SynTyConRhs is OpenSynFamilyTyCon

        type family G a :: * where
          G Int = Bool
          G Bool = Char
          G a = ()
  translates to
    a SynTyCon 'G', whose SynTyConRhs is ClosedSynFamilyTyCon, with the
    appropriate CoAxiom representing the equations

* In the future we might want to support
    * injective type families (allow decomposition)
  but we don't at the moment [2013]

Note [Data type families]
~~~~~~~~~~~~~~~~~~~~~~~~~
See also Note [Wrappers for data instance tycons] in MkId.lhs

* Data type families are declared thus
        data family T a :: *
        data instance T Int = T1 | T2 Bool

  Here T is the "family TyCon".

* Reply "yes" to isDataFamilyTyCon, and isFamilyTyCon

* The user does not see any "equivalent types" as he did with type
  synonym families.  He just sees constructors with types
        T1 :: T Int
        T2 :: Bool -> T Int

* Here's the FC version of the above declarations:

        data T a
        data R:TInt = T1 | T2 Bool
        axiom ax_ti : T Int ~ R:TInt

  The R:TInt is the "representation TyCons".
  It has an AlgTyConParent of
        FamInstTyCon T [Int] ax_ti

* The data contructor T2 has a wrapper (which is what the
  source-level "T2" invokes):

        $WT2 :: Bool -> T Int
        $WT2 b = T2 b `cast` sym ax_ti

* A data instance can declare a fully-fledged GADT:

        data instance T (a,b) where
          X1 :: T (Int,Bool)
          X2 :: a -> b -> T (a,b)

  Here's the FC version of the above declaration:

        data R:TPair a where
          X1 :: R:TPair Int Bool
          X2 :: a -> b -> R:TPair a b
        axiom ax_pr :: T (a,b) ~ R:TPair a b

        $WX1 :: forall a b. a -> b -> T (a,b)
        $WX1 a b (x::a) (y::b) = X2 a b x y `cast` sym (ax_pr a b)

  The R:TPair are the "representation TyCons".
  We have a bit of work to do, to unpick the result types of the
  data instance declaration for T (a,b), to get the result type in the
  representation; e.g.  T (a,b) --> R:TPair a b

  The representation TyCon R:TList, has an AlgTyConParent of

        FamInstTyCon T [(a,b)] ax_pr

* Notice that T is NOT translated to a FC type function; it just
  becomes a "data type" with no constructors, which can be coerced inot
  into R:TInt, R:TPair by the axioms.  These axioms
  axioms come into play when (and *only* when) you
        - use a data constructor
        - do pattern matching
  Rather like newtype, in fact

  As a result

  - T behaves just like a data type so far as decomposition is concerned

  - (T Int) is not implicitly converted to R:TInt during type inference.
    Indeed the latter type is unknown to the programmer.

  - There *is* an instance for (T Int) in the type-family instance
    environment, but it is only used for overlap checking

  - It's fine to have T in the LHS of a type function:
    type instance F (T a) = [a]

  It was this last point that confused me!  The big thing is that you
  should not think of a data family T as a *type function* at all, not
  even an injective one!  We can't allow even injective type functions
  on the LHS of a type function:
        type family injective G a :: *
        type instance F (G Int) = Bool
  is no good, even if G is injective, because consider
        type instance G Int = Bool
        type instance F Bool = Char

  So a data type family is not an injective type function. It's just a
  data type with some axioms that connect it to other data types.

Note [Associated families and their parent class]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
*Associated* families are just like *non-associated* families, except
that they have a TyConParent of AssocFamilyTyCon, which identifies the
parent class.

However there is an important sharing relationship between
  * the tyConTyVars of the parent Class
  * the tyConTyvars of the associated TyCon

   class C a b where
     data T p a
     type F a q b

Here the 'a' and 'b' are shared with the 'Class'; that is, they have
the same Unique.

This is important. In an instance declaration we expect
  * all the shared variables to be instantiated the same way
  * the non-shared variables of the associated type should not
    be instantiated at all

  instance C [x] (Tree y) where
     data T p [x] = T1 x | T2 p
     type F [x] q (Tree y) = (x,y,q)

Note [TyCon Role signatures]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Every tycon has a role signature, assigning a role to each of the tyConTyVars
(or of equal length to the tyConArity, if there are no tyConTyVars). An
example demonstrates these best: say we have a tycon T, with parameters a at
nominal, b at representational, and c at phantom. Then, to prove
representational equality between T a1 b1 c1 and T a2 b2 c2, we need to have
nominal equality between a1 and a2, representational equality between b1 and
b2, and nothing in particular (i.e., phantom equality) between c1 and c2. This
might happen, say, with the following declaration:

  data T a b c where
    MkT :: b -> T Int b c

Data and class tycons have their roles inferred (see inferRoles in TcTyDecls),
as do vanilla synonym tycons. Family tycons have all parameters at role N,
though it is conceivable that we could relax this restriction. (->)'s and
tuples' parameters are at role R. Each primitive tycon declares its roles;
it's worth noting that (~#)'s parameters are at role N. Promoted data
constructors' type arguments are at role R. All kind arguments are at role
N.

%************************************************************************
%*                                                                      *
\subsection{The data type}
%*                                                                      *
%************************************************************************

\begin{code}
<pre><a name="line-1"></a><span class='hs-comment'>-- | TyCons represent type constructors. Type constructors are introduced by things such as:</span>
<a name="line-2"></a><span class='hs-comment'>--</span>
<a name="line-3"></a><span class='hs-comment'>-- 1) Data declarations: @data Foo = ...@ creates the @Foo@ type constructor of kind @*@</span>
<a name="line-4"></a><span class='hs-comment'>--</span>
<a name="line-5"></a><span class='hs-comment'>-- 2) Type synonyms: @type Foo = ...@ creates the @Foo@ type constructor</span>
<a name="line-6"></a><span class='hs-comment'>--</span>
<a name="line-7"></a><span class='hs-comment'>-- 3) Newtypes: @newtype Foo a = MkFoo ...@ creates the @Foo@ type constructor of kind @* -&gt; *@</span>
<a name="line-8"></a><span class='hs-comment'>--</span>
<a name="line-9"></a><span class='hs-comment'>-- 4) Class declarations: @class Foo where@ creates the @Foo@ type constructor of kind @*@</span>
<a name="line-10"></a><span class='hs-comment'>--</span>
<a name="line-11"></a><span class='hs-comment'>-- This data type also encodes a number of primitive, built in type constructors such as those</span>
<a name="line-12"></a><span class='hs-comment'>-- for function and tuple types.</span>
<a name="line-13"></a>
<a name="line-14"></a><a name="TyCon"></a><span class='hs-comment'>-- If you edit this type, you may need to update the GHC formalism</span>
<a name="line-15"></a><a name="TyCon"></a><span class='hs-comment'>-- See Note [GHC Formalism] in coreSyn/CoreLint.lhs</span>
<a name="line-16"></a><a name="TyCon"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>TyCon</span>
<a name="line-17"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-comment'>-- | The function type constructor, @(-&gt;)@</span>
<a name="line-18"></a>    <span class='hs-conid'>FunTyCon</span> <span class='hs-layout'>{</span>
<a name="line-19"></a>        <span class='hs-varid'>tyConUnique</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Unique</span><span class='hs-layout'>,</span>
<a name="line-20"></a>        <span class='hs-varid'>tyConName</span>   <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Name</span><span class='hs-layout'>,</span>
<a name="line-21"></a>        <span class='hs-varid'>tc_kind</span>   <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Kind</span><span class='hs-layout'>,</span>
<a name="line-22"></a>        <span class='hs-varid'>tyConArity</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Arity</span>
<a name="line-23"></a>    <span class='hs-layout'>}</span>
<a name="line-24"></a>
<a name="line-25"></a>  <span class='hs-comment'>-- | Algebraic type constructors, which are defined to be those</span>
<a name="line-26"></a>  <span class='hs-comment'>-- arising @data@ type and @newtype@ declarations.  All these</span>
<a name="line-27"></a>  <span class='hs-comment'>-- constructors are lifted and boxed. See 'AlgTyConRhs' for more</span>
<a name="line-28"></a>  <span class='hs-comment'>-- information.</span>
<a name="line-29"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AlgTyCon</span> <span class='hs-layout'>{</span>
<a name="line-30"></a>        <span class='hs-varid'>tyConUnique</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Unique</span><span class='hs-layout'>,</span>
<a name="line-31"></a>        <span class='hs-varid'>tyConName</span>   <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Name</span><span class='hs-layout'>,</span>
<a name="line-32"></a>        <span class='hs-varid'>tc_kind</span>     <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Kind</span><span class='hs-layout'>,</span>
<a name="line-33"></a>        <span class='hs-varid'>tyConArity</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Arity</span><span class='hs-layout'>,</span>
<a name="line-34"></a>
<a name="line-35"></a>        <span class='hs-varid'>tyConTyVars</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>TyVar</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span>   <span class='hs-comment'>-- ^ The kind and type variables used in the type constructor.</span>
<a name="line-36"></a>                                  <span class='hs-comment'>-- Invariant: length tyvars = arity</span>
<a name="line-37"></a>                                  <span class='hs-comment'>-- Precisely, this list scopes over:</span>
<a name="line-38"></a>                                  <span class='hs-comment'>--</span>
<a name="line-39"></a>                                  <span class='hs-comment'>-- 1. The 'algTcStupidTheta'</span>
<a name="line-40"></a>                                  <span class='hs-comment'>-- 2. The cached types in 'algTyConRhs.NewTyCon'</span>
<a name="line-41"></a>                                  <span class='hs-comment'>-- 3. The family instance types if present</span>
<a name="line-42"></a>                                  <span class='hs-comment'>--</span>
<a name="line-43"></a>                                  <span class='hs-comment'>-- Note that it does /not/ scope over the data constructors.</span>
<a name="line-44"></a>        <span class='hs-varid'>tc_roles</span>     <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Role</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span>   <span class='hs-comment'>-- ^ The role for each type variable</span>
<a name="line-45"></a>                                  <span class='hs-comment'>-- This list has the same length as tyConTyVars</span>
<a name="line-46"></a>                                  <span class='hs-comment'>-- See also Note [TyCon Role signatures]</span>
<a name="line-47"></a>        
<a name="line-48"></a>        <span class='hs-varid'>tyConCType</span>   <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>CType</span><span class='hs-layout'>,</span> <span class='hs-comment'>-- The C type that should be used</span>
<a name="line-49"></a>                                     <span class='hs-comment'>-- for this type when using the FFI</span>
<a name="line-50"></a>                                     <span class='hs-comment'>-- and CAPI</span>
<a name="line-51"></a>
<a name="line-52"></a>        <span class='hs-varid'>algTcGadtSyntax</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Bool</span><span class='hs-layout'>,</span>       <span class='hs-comment'>-- ^ Was the data type declared with GADT syntax?</span>
<a name="line-53"></a>                                        <span class='hs-comment'>-- If so, that doesn't mean it's a true GADT;</span>
<a name="line-54"></a>                                        <span class='hs-comment'>-- only that the "where" form was used.</span>
<a name="line-55"></a>                                        <span class='hs-comment'>-- This field is used only to guide pretty-printing</span>
<a name="line-56"></a>
<a name="line-57"></a>        <span class='hs-varid'>algTcStupidTheta</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>PredType</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span> <span class='hs-comment'>-- ^ The \"stupid theta\" for the data type</span>
<a name="line-58"></a>                                        <span class='hs-comment'>-- (always empty for GADTs).</span>
<a name="line-59"></a>                                        <span class='hs-comment'>-- A \"stupid theta\" is the context to the left</span>
<a name="line-60"></a>                                        <span class='hs-comment'>-- of an algebraic type declaration,</span>
<a name="line-61"></a>                                        <span class='hs-comment'>-- e.g. @Eq a@ in the declaration</span>
<a name="line-62"></a>                                        <span class='hs-comment'>--    @data Eq a =&gt; T a ...@.</span>
<a name="line-63"></a>
<a name="line-64"></a>        <span class='hs-varid'>algTcRhs</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>AlgTyConRhs</span><span class='hs-layout'>,</span>  <span class='hs-comment'>-- ^ Contains information about the</span>
<a name="line-65"></a>                                  <span class='hs-comment'>-- data constructors of the algebraic type</span>
<a name="line-66"></a>
<a name="line-67"></a>        <span class='hs-varid'>algTcRec</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>RecFlag</span><span class='hs-layout'>,</span>      <span class='hs-comment'>-- ^ Tells us whether the data type is part</span>
<a name="line-68"></a>                                  <span class='hs-comment'>-- of a mutually-recursive group or not</span>
<a name="line-69"></a>
<a name="line-70"></a>        <span class='hs-varid'>algTcParent</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyConParent</span><span class='hs-layout'>,</span>     <span class='hs-comment'>-- ^ Gives the class or family declaration 'TyCon'</span>
<a name="line-71"></a>                                        <span class='hs-comment'>-- for derived 'TyCon's representing class</span>
<a name="line-72"></a>                                        <span class='hs-comment'>-- or family instances, respectively.</span>
<a name="line-73"></a>                                        <span class='hs-comment'>-- See also 'synTcParent'</span>
<a name="line-74"></a>        
<a name="line-75"></a>        <span class='hs-varid'>tcPromoted</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>TyCon</span>    <span class='hs-comment'>-- ^ Promoted TyCon, if any</span>
<a name="line-76"></a>    <span class='hs-layout'>}</span>
<a name="line-77"></a>
<a name="line-78"></a>  <span class='hs-comment'>-- | Represents the infinite family of tuple type constructors,</span>
<a name="line-79"></a>  <span class='hs-comment'>--   @()@, @(a,b)@, @(# a, b #)@ etc.</span>
<a name="line-80"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>TupleTyCon</span> <span class='hs-layout'>{</span>
<a name="line-81"></a>        <span class='hs-varid'>tyConUnique</span>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Unique</span><span class='hs-layout'>,</span>
<a name="line-82"></a>        <span class='hs-varid'>tyConName</span>      <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Name</span><span class='hs-layout'>,</span>
<a name="line-83"></a>        <span class='hs-varid'>tc_kind</span>        <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Kind</span><span class='hs-layout'>,</span>
<a name="line-84"></a>        <span class='hs-varid'>tyConArity</span>     <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Arity</span><span class='hs-layout'>,</span>
<a name="line-85"></a>        <span class='hs-varid'>tyConTupleSort</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TupleSort</span><span class='hs-layout'>,</span>
<a name="line-86"></a>        <span class='hs-varid'>tyConTyVars</span>    <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>TyVar</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span>
<a name="line-87"></a>        <span class='hs-varid'>dataCon</span>        <span class='hs-keyglyph'>::</span> <span class='hs-conid'>DataCon</span><span class='hs-layout'>,</span> <span class='hs-comment'>-- ^ Corresponding tuple data constructor</span>
<a name="line-88"></a>        <span class='hs-varid'>tcPromoted</span>     <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>TyCon</span>    <span class='hs-comment'>-- Nothing for unboxed tuples</span>
<a name="line-89"></a>    <span class='hs-layout'>}</span>
<a name="line-90"></a>
<a name="line-91"></a>  <span class='hs-comment'>-- | Represents type synonyms</span>
<a name="line-92"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>SynTyCon</span> <span class='hs-layout'>{</span>
<a name="line-93"></a>        <span class='hs-varid'>tyConUnique</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Unique</span><span class='hs-layout'>,</span>
<a name="line-94"></a>        <span class='hs-varid'>tyConName</span>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Name</span><span class='hs-layout'>,</span>
<a name="line-95"></a>        <span class='hs-varid'>tc_kind</span>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Kind</span><span class='hs-layout'>,</span>
<a name="line-96"></a>        <span class='hs-varid'>tyConArity</span>   <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Arity</span><span class='hs-layout'>,</span>
<a name="line-97"></a>
<a name="line-98"></a>        <span class='hs-varid'>tyConTyVars</span>  <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>TyVar</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span>        <span class='hs-comment'>-- Bound tyvars</span>
<a name="line-99"></a>        <span class='hs-varid'>tc_roles</span>     <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Role</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span>
<a name="line-100"></a>
<a name="line-101"></a>        <span class='hs-varid'>synTcRhs</span>     <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SynTyConRhs</span><span class='hs-layout'>,</span>       <span class='hs-comment'>-- ^ Contains information about the</span>
<a name="line-102"></a>                                           <span class='hs-comment'>-- expansion of the synonym</span>
<a name="line-103"></a>
<a name="line-104"></a>        <span class='hs-varid'>synTcParent</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyConParent</span>     <span class='hs-comment'>-- ^ Gives the family declaration 'TyCon'</span>
<a name="line-105"></a>                                        <span class='hs-comment'>-- of 'TyCon's representing family instances</span>
<a name="line-106"></a>
<a name="line-107"></a>    <span class='hs-layout'>}</span>
<a name="line-108"></a>
<a name="line-109"></a>  <span class='hs-comment'>-- | Primitive types; cannot be defined in Haskell. This includes</span>
<a name="line-110"></a>  <span class='hs-comment'>-- the usual suspects (such as @Int#@) as well as foreign-imported</span>
<a name="line-111"></a>  <span class='hs-comment'>-- types and kinds</span>
<a name="line-112"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>PrimTyCon</span> <span class='hs-layout'>{</span>
<a name="line-113"></a>        <span class='hs-varid'>tyConUnique</span>   <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Unique</span><span class='hs-layout'>,</span>
<a name="line-114"></a>        <span class='hs-varid'>tyConName</span>     <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Name</span><span class='hs-layout'>,</span>
<a name="line-115"></a>        <span class='hs-varid'>tc_kind</span>       <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Kind</span><span class='hs-layout'>,</span>
<a name="line-116"></a>        <span class='hs-varid'>tyConArity</span>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Arity</span><span class='hs-layout'>,</span>         
<a name="line-117"></a>        <span class='hs-varid'>tc_roles</span>      <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Role</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span>
<a name="line-118"></a>
<a name="line-119"></a>        <span class='hs-varid'>primTyConRep</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>PrimRep</span><span class='hs-layout'>,</span>       <span class='hs-comment'>-- ^ Many primitive tycons are unboxed, but some are</span>
<a name="line-120"></a>                                        <span class='hs-comment'>--   boxed (represented by pointers). This 'PrimRep'</span>
<a name="line-121"></a>                                        <span class='hs-comment'>--   holds that information.</span>
<a name="line-122"></a>                                        <span class='hs-comment'>-- Only relevant if tc_kind = *</span>
<a name="line-123"></a>
<a name="line-124"></a>        <span class='hs-varid'>isUnLifted</span>   <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Bool</span><span class='hs-layout'>,</span>           <span class='hs-comment'>-- ^ Most primitive tycons are unlifted</span>
<a name="line-125"></a>                                        <span class='hs-comment'>--   (may not contain bottom)</span>
<a name="line-126"></a>                                        <span class='hs-comment'>--   but foreign-imported ones may be lifted</span>
<a name="line-127"></a>
<a name="line-128"></a>        <span class='hs-varid'>tyConExtName</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>FastString</span>   <span class='hs-comment'>-- ^ @Just e@ for foreign-imported types,</span>
<a name="line-129"></a>                                           <span class='hs-comment'>--   holds the name of the imported thing</span>
<a name="line-130"></a>    <span class='hs-layout'>}</span>
<a name="line-131"></a>
<a name="line-132"></a>  <span class='hs-comment'>-- | Represents promoted data constructor.</span>
<a name="line-133"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>PromotedDataCon</span> <span class='hs-layout'>{</span>         <span class='hs-comment'>-- See Note [Promoted data constructors]</span>
<a name="line-134"></a>        <span class='hs-varid'>tyConUnique</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Unique</span><span class='hs-layout'>,</span> <span class='hs-comment'>-- ^ Same Unique as the data constructor</span>
<a name="line-135"></a>        <span class='hs-varid'>tyConName</span>   <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Name</span><span class='hs-layout'>,</span>   <span class='hs-comment'>-- ^ Same Name as the data constructor</span>
<a name="line-136"></a>        <span class='hs-varid'>tyConArity</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Arity</span><span class='hs-layout'>,</span>
<a name="line-137"></a>        <span class='hs-varid'>tc_roles</span>    <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Role</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span> <span class='hs-comment'>-- ^ Roles: N for kind vars, R for type vars</span>
<a name="line-138"></a>        <span class='hs-varid'>tc_kind</span>     <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Kind</span><span class='hs-layout'>,</span>   <span class='hs-comment'>-- ^ Translated type of the data constructor</span>
<a name="line-139"></a>        <span class='hs-varid'>dataCon</span>     <span class='hs-keyglyph'>::</span> <span class='hs-conid'>DataCon</span> <span class='hs-comment'>-- ^ Corresponding data constructor</span>
<a name="line-140"></a>    <span class='hs-layout'>}</span>
<a name="line-141"></a>
<a name="line-142"></a>  <span class='hs-comment'>-- | Represents promoted type constructor.</span>
<a name="line-143"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>PromotedTyCon</span> <span class='hs-layout'>{</span>
<a name="line-144"></a>        <span class='hs-varid'>tyConUnique</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Unique</span><span class='hs-layout'>,</span> <span class='hs-comment'>-- ^ Same Unique as the type constructor</span>
<a name="line-145"></a>        <span class='hs-varid'>tyConName</span>   <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Name</span><span class='hs-layout'>,</span>   <span class='hs-comment'>-- ^ Same Name as the type constructor</span>
<a name="line-146"></a>        <span class='hs-varid'>tyConArity</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Arity</span><span class='hs-layout'>,</span>  <span class='hs-comment'>-- ^ n if ty_con :: * -&gt; ... -&gt; *  n times</span>
<a name="line-147"></a>        <span class='hs-varid'>tc_kind</span>     <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Kind</span><span class='hs-layout'>,</span>   <span class='hs-comment'>-- ^ Always TysPrim.superKind</span>
<a name="line-148"></a>        <span class='hs-varid'>ty_con</span>      <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span>   <span class='hs-comment'>-- ^ Corresponding type constructor</span>
<a name="line-149"></a>    <span class='hs-layout'>}</span>
<a name="line-150"></a>
<a name="line-151"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-conid'>Typeable</span>
<a name="line-152"></a>
<a name="line-153"></a><a name="FieldLabel"></a><span class='hs-comment'>-- | Names of the fields in an algebraic record type</span>
<a name="line-154"></a><a name="FieldLabel"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>FieldLabel</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Name</span>
<a name="line-155"></a>
<a name="line-156"></a><a name="AlgTyConRhs"></a><span class='hs-comment'>-- | Represents right-hand-sides of 'TyCon's for algebraic types</span>
<a name="line-157"></a><a name="AlgTyConRhs"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>AlgTyConRhs</span>
<a name="line-158"></a>
<a name="line-159"></a>    <span class='hs-comment'>-- | Says that we know nothing about this data type, except that</span>
<a name="line-160"></a>    <span class='hs-comment'>-- it's represented by a pointer.  Used when we export a data type</span>
<a name="line-161"></a>    <span class='hs-comment'>-- abstractly into an .hi file.</span>
<a name="line-162"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AbstractTyCon</span>
<a name="line-163"></a>      <span class='hs-conid'>Bool</span>      <span class='hs-comment'>-- True  &lt;=&gt; It's definitely a distinct data type,</span>
<a name="line-164"></a>                <span class='hs-comment'>--           equal only to itself; ie not a newtype</span>
<a name="line-165"></a>                <span class='hs-comment'>-- False &lt;=&gt; Not sure</span>
<a name="line-166"></a>                <span class='hs-comment'>-- See Note [AbstractTyCon and type equality]</span>
<a name="line-167"></a>
<a name="line-168"></a>    <span class='hs-comment'>-- | Represents an open type family without a fixed right hand</span>
<a name="line-169"></a>    <span class='hs-comment'>-- side.  Additional instances can appear at any time.</span>
<a name="line-170"></a>    <span class='hs-comment'>--</span>
<a name="line-171"></a>    <span class='hs-comment'>-- These are introduced by either a top level declaration:</span>
<a name="line-172"></a>    <span class='hs-comment'>--</span>
<a name="line-173"></a>    <span class='hs-comment'>-- &gt; data T a :: *</span>
<a name="line-174"></a>    <span class='hs-comment'>--</span>
<a name="line-175"></a>    <span class='hs-comment'>-- Or an associated data type declaration, within a class declaration:</span>
<a name="line-176"></a>    <span class='hs-comment'>--</span>
<a name="line-177"></a>    <span class='hs-comment'>-- &gt; class C a b where</span>
<a name="line-178"></a>    <span class='hs-comment'>-- &gt;   data T b :: *</span>
<a name="line-179"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>DataFamilyTyCon</span>
<a name="line-180"></a>
<a name="line-181"></a>    <span class='hs-comment'>-- | Information about those 'TyCon's derived from a @data@</span>
<a name="line-182"></a>    <span class='hs-comment'>-- declaration. This includes data types with no constructors at</span>
<a name="line-183"></a>    <span class='hs-comment'>-- all.</span>
<a name="line-184"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>DataTyCon</span> <span class='hs-layout'>{</span>
<a name="line-185"></a>        <span class='hs-varid'>data_cons</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>DataCon</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span>
<a name="line-186"></a>                          <span class='hs-comment'>-- ^ The data type constructors; can be empty if the user</span>
<a name="line-187"></a>                          <span class='hs-comment'>--   declares the type to have no constructors</span>
<a name="line-188"></a>                          <span class='hs-comment'>--</span>
<a name="line-189"></a>                          <span class='hs-comment'>-- INVARIANT: Kept in order of increasing 'DataCon' tag</span>
<a name="line-190"></a>                          <span class='hs-comment'>--      (see the tag assignment in DataCon.mkDataCon)</span>
<a name="line-191"></a>
<a name="line-192"></a>        <span class='hs-varid'>is_enum</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Bool</span>   <span class='hs-comment'>-- ^ Cached value: is this an enumeration type?</span>
<a name="line-193"></a>                          <span class='hs-comment'>--   See Note [Enumeration types]</span>
<a name="line-194"></a>    <span class='hs-layout'>}</span>
<a name="line-195"></a>
<a name="line-196"></a>  <span class='hs-comment'>-- | Information about those 'TyCon's derived from a @newtype@ declaration</span>
<a name="line-197"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>NewTyCon</span> <span class='hs-layout'>{</span>
<a name="line-198"></a>        <span class='hs-varid'>data_con</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>DataCon</span><span class='hs-layout'>,</span>    <span class='hs-comment'>-- ^ The unique constructor for the @newtype@.</span>
<a name="line-199"></a>                                <span class='hs-comment'>--   It has no existentials</span>
<a name="line-200"></a>
<a name="line-201"></a>        <span class='hs-varid'>nt_rhs</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Type</span><span class='hs-layout'>,</span>         <span class='hs-comment'>-- ^ Cached value: the argument type of the constructor,</span>
<a name="line-202"></a>                                <span class='hs-comment'>-- which is just the representation type of the 'TyCon'</span>
<a name="line-203"></a>                                <span class='hs-comment'>-- (remember that @newtype@s do not exist at runtime</span>
<a name="line-204"></a>                                <span class='hs-comment'>-- so need a different representation type).</span>
<a name="line-205"></a>                                <span class='hs-comment'>--</span>
<a name="line-206"></a>                                <span class='hs-comment'>-- The free 'TyVar's of this type are the 'tyConTyVars'</span>
<a name="line-207"></a>                                <span class='hs-comment'>-- from the corresponding 'TyCon'</span>
<a name="line-208"></a>
<a name="line-209"></a>        <span class='hs-varid'>nt_etad_rhs</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>[</span><span class='hs-conid'>TyVar</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span> <span class='hs-conid'>Type</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-210"></a>                        <span class='hs-comment'>-- ^ Same as the 'nt_rhs', but this time eta-reduced.</span>
<a name="line-211"></a>                        <span class='hs-comment'>-- Hence the list of 'TyVar's in this field may be</span>
<a name="line-212"></a>                        <span class='hs-comment'>-- shorter than the declared arity of the 'TyCon'.</span>
<a name="line-213"></a>
<a name="line-214"></a>                        <span class='hs-comment'>-- See Note [Newtype eta]</span>
<a name="line-215"></a>        <span class='hs-varid'>nt_co</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>CoAxiom</span> <span class='hs-conid'>Unbranched</span>
<a name="line-216"></a>                             <span class='hs-comment'>-- The axiom coercion that creates the @newtype@ from</span>
<a name="line-217"></a>                             <span class='hs-comment'>-- the representation 'Type'.</span>
<a name="line-218"></a>
<a name="line-219"></a>                             <span class='hs-comment'>-- See Note [Newtype coercions]</span>
<a name="line-220"></a>                             <span class='hs-comment'>-- Invariant: arity = #tvs in nt_etad_rhs;</span>
<a name="line-221"></a>                             <span class='hs-comment'>-- See Note [Newtype eta]</span>
<a name="line-222"></a>                             <span class='hs-comment'>-- Watch out!  If any newtypes become transparent</span>
<a name="line-223"></a>                             <span class='hs-comment'>-- again check Trac #1072.</span>
<a name="line-224"></a>    <span class='hs-layout'>}</span>
<a name="line-225"></a>
</pre>\end{code}

Note [AbstractTyCon and type equality]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
TODO

\begin{code}
<pre><a name="line-1"></a>
<a name="line-2"></a><a name="visibleDataCons"></a><span class='hs-comment'>-- | Extract those 'DataCon's that we are able to learn about.  Note</span>
<a name="line-3"></a><span class='hs-comment'>-- that visibility in this sense does not correspond to visibility in</span>
<a name="line-4"></a><span class='hs-comment'>-- the context of any particular user program!</span>
<a name="line-5"></a><span class='hs-definition'>visibleDataCons</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>AlgTyConRhs</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>DataCon</span><span class='hs-keyglyph'>]</span>
<a name="line-6"></a><span class='hs-definition'>visibleDataCons</span> <span class='hs-layout'>(</span><span class='hs-conid'>AbstractTyCon</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>            <span class='hs-keyglyph'>=</span> <span class='hs-conid'>[]</span>
<a name="line-7"></a><span class='hs-definition'>visibleDataCons</span> <span class='hs-conid'>DataFamilyTyCon</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span>            <span class='hs-keyglyph'>=</span> <span class='hs-conid'>[]</span>
<a name="line-8"></a><span class='hs-definition'>visibleDataCons</span> <span class='hs-layout'>(</span><span class='hs-conid'>DataTyCon</span><span class='hs-layout'>{</span> <span class='hs-varid'>data_cons</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>cs</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>cs</span>
<a name="line-9"></a><span class='hs-definition'>visibleDataCons</span> <span class='hs-layout'>(</span><span class='hs-conid'>NewTyCon</span><span class='hs-layout'>{</span> <span class='hs-varid'>data_con</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>c</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span>    <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>c</span><span class='hs-keyglyph'>]</span>
<a name="line-10"></a>
<a name="line-11"></a><a name="TyConParent"></a><span class='hs-comment'>-- ^ Both type classes as well as family instances imply implicit</span>
<a name="line-12"></a><a name="TyConParent"></a><span class='hs-comment'>-- type constructors.  These implicit type constructors refer to their parent</span>
<a name="line-13"></a><a name="TyConParent"></a><span class='hs-comment'>-- structure (ie, the class or family from which they derive) using a type of</span>
<a name="line-14"></a><a name="TyConParent"></a><span class='hs-comment'>-- the following form.  We use 'TyConParent' for both algebraic and synonym</span>
<a name="line-15"></a><a name="TyConParent"></a><span class='hs-comment'>-- types, but the variant 'ClassTyCon' will only be used by algebraic 'TyCon's.</span>
<a name="line-16"></a><a name="TyConParent"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>TyConParent</span>
<a name="line-17"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-comment'>-- | An ordinary type constructor has no parent.</span>
<a name="line-18"></a>    <span class='hs-conid'>NoParentTyCon</span>
<a name="line-19"></a>
<a name="line-20"></a>  <span class='hs-comment'>-- | Type constructors representing a class dictionary.</span>
<a name="line-21"></a>  <span class='hs-comment'>-- See Note [ATyCon for classes] in TypeRep</span>
<a name="line-22"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ClassTyCon</span>
<a name="line-23"></a>        <span class='hs-conid'>Class</span>           <span class='hs-comment'>-- INVARIANT: the classTyCon of this Class is the current tycon</span>
<a name="line-24"></a>
<a name="line-25"></a>  <span class='hs-comment'>-- | An *associated* type of a class.</span>
<a name="line-26"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AssocFamilyTyCon</span>
<a name="line-27"></a>        <span class='hs-conid'>Class</span>           <span class='hs-comment'>-- The class in whose declaration the family is declared</span>
<a name="line-28"></a>                        <span class='hs-comment'>-- See Note [Associated families and their parent class]</span>
<a name="line-29"></a>
<a name="line-30"></a>  <span class='hs-comment'>-- | Type constructors representing an instance of a *data* family. Parameters:</span>
<a name="line-31"></a>  <span class='hs-comment'>--</span>
<a name="line-32"></a>  <span class='hs-comment'>--  1) The type family in question</span>
<a name="line-33"></a>  <span class='hs-comment'>--</span>
<a name="line-34"></a>  <span class='hs-comment'>--  2) Instance types; free variables are the 'tyConTyVars'</span>
<a name="line-35"></a>  <span class='hs-comment'>--  of the current 'TyCon' (not the family one). INVARIANT:</span>
<a name="line-36"></a>  <span class='hs-comment'>--  the number of types matches the arity of the family 'TyCon'</span>
<a name="line-37"></a>  <span class='hs-comment'>--</span>
<a name="line-38"></a>  <span class='hs-comment'>--  3) A 'CoTyCon' identifying the representation</span>
<a name="line-39"></a>  <span class='hs-comment'>--  type with the type instance family</span>
<a name="line-40"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>FamInstTyCon</span>          <span class='hs-comment'>-- See Note [Data type families]</span>
<a name="line-41"></a>        <span class='hs-layout'>(</span><span class='hs-conid'>CoAxiom</span> <span class='hs-conid'>Unbranched</span><span class='hs-layout'>)</span>  <span class='hs-comment'>-- The coercion constructor,</span>
<a name="line-42"></a>                              <span class='hs-comment'>-- always of kind   T ty1 ty2 ~ R:T a b c</span>
<a name="line-43"></a>                              <span class='hs-comment'>-- where T is the family TyCon,</span>
<a name="line-44"></a>                              <span class='hs-comment'>-- and R:T is the representation TyCon (ie this one)</span>
<a name="line-45"></a>                              <span class='hs-comment'>-- and a,b,c are the tyConTyVars of this TyCon</span>
<a name="line-46"></a>
<a name="line-47"></a>          <span class='hs-comment'>-- Cached fields of the CoAxiom, but adjusted to</span>
<a name="line-48"></a>          <span class='hs-comment'>-- use the tyConTyVars of this TyCon</span>
<a name="line-49"></a>        <span class='hs-conid'>TyCon</span>   <span class='hs-comment'>-- The family TyCon</span>
<a name="line-50"></a>        <span class='hs-keyglyph'>[</span><span class='hs-conid'>Type</span><span class='hs-keyglyph'>]</span>  <span class='hs-comment'>-- Argument types (mentions the tyConTyVars of this TyCon)</span>
<a name="line-51"></a>                <span class='hs-comment'>-- Match in length the tyConTyVars of the family TyCon</span>
<a name="line-52"></a>
<a name="line-53"></a>        <span class='hs-comment'>-- E.g.  data intance T [a] = ...</span>
<a name="line-54"></a>        <span class='hs-comment'>-- gives a representation tycon:</span>
<a name="line-55"></a>        <span class='hs-comment'>--      data R:TList a = ...</span>
<a name="line-56"></a>        <span class='hs-comment'>--      axiom co a :: T [a] ~ R:TList a</span>
<a name="line-57"></a>        <span class='hs-comment'>-- with R:TList's algTcParent = FamInstTyCon T [a] co</span>
<a name="line-58"></a>
<a name="line-59"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Outputable</span> <span class='hs-conid'>TyConParent</span> <span class='hs-keyword'>where</span>
<a name="line-60"></a>    <span class='hs-varid'>ppr</span> <span class='hs-conid'>NoParentTyCon</span>           <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"No parent"</span>
<a name="line-61"></a>    <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>ClassTyCon</span> <span class='hs-varid'>cls</span><span class='hs-layout'>)</span>        <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"Class parent"</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>cls</span>
<a name="line-62"></a>    <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>AssocFamilyTyCon</span> <span class='hs-varid'>cls</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"Class parent (assoc. family)"</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>cls</span>
<a name="line-63"></a>    <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>FamInstTyCon</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>tc</span> <span class='hs-varid'>tys</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"Family parent (family instance)"</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>tc</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>sep</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>tys</span><span class='hs-layout'>)</span>
<a name="line-64"></a>
<a name="line-65"></a><a name="okParent"></a><span class='hs-comment'>-- | Checks the invariants of a 'TyConParent' given the appropriate type class name, if any</span>
<a name="line-66"></a><span class='hs-definition'>okParent</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TyConParent</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-67"></a><span class='hs-definition'>okParent</span> <span class='hs-keyword'>_</span>       <span class='hs-conid'>NoParentTyCon</span>               <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-68"></a><span class='hs-definition'>okParent</span> <span class='hs-varid'>tc_name</span> <span class='hs-layout'>(</span><span class='hs-conid'>AssocFamilyTyCon</span> <span class='hs-varid'>cls</span><span class='hs-layout'>)</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tc_name</span> <span class='hs-varop'>`elem`</span> <span class='hs-varid'>map</span> <span class='hs-varid'>tyConName</span> <span class='hs-layout'>(</span><span class='hs-varid'>classATs</span> <span class='hs-varid'>cls</span><span class='hs-layout'>)</span>
<a name="line-69"></a><span class='hs-definition'>okParent</span> <span class='hs-varid'>tc_name</span> <span class='hs-layout'>(</span><span class='hs-conid'>ClassTyCon</span> <span class='hs-varid'>cls</span><span class='hs-layout'>)</span>            <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tc_name</span> <span class='hs-varop'>==</span> <span class='hs-varid'>tyConName</span> <span class='hs-layout'>(</span><span class='hs-varid'>classTyCon</span> <span class='hs-varid'>cls</span><span class='hs-layout'>)</span>
<a name="line-70"></a><span class='hs-definition'>okParent</span> <span class='hs-keyword'>_</span>       <span class='hs-layout'>(</span><span class='hs-conid'>FamInstTyCon</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>fam_tc</span> <span class='hs-varid'>tys</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tyConArity</span> <span class='hs-varid'>fam_tc</span> <span class='hs-varop'>==</span> <span class='hs-varid'>length</span> <span class='hs-varid'>tys</span>
<a name="line-71"></a>
<a name="line-72"></a><a name="isNoParent"></a><span class='hs-definition'>isNoParent</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyConParent</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-73"></a><span class='hs-definition'>isNoParent</span> <span class='hs-conid'>NoParentTyCon</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-74"></a><span class='hs-definition'>isNoParent</span> <span class='hs-keyword'>_</span>             <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-75"></a>
<a name="line-76"></a><span class='hs-comment'>--------------------</span>
<a name="line-77"></a>
<a name="line-78"></a><a name="SynTyConRhs"></a><span class='hs-comment'>-- | Information pertaining to the expansion of a type synonym (@type@)</span>
<a name="line-79"></a><a name="SynTyConRhs"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>SynTyConRhs</span>
<a name="line-80"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-comment'>-- | An ordinary type synonyn.</span>
<a name="line-81"></a>    <span class='hs-conid'>SynonymTyCon</span>
<a name="line-82"></a>       <span class='hs-conid'>Type</span>           <span class='hs-comment'>-- This 'Type' is the rhs, and may mention from 'tyConTyVars'.</span>
<a name="line-83"></a>                      <span class='hs-comment'>-- It acts as a template for the expansion when the 'TyCon'</span>
<a name="line-84"></a>                      <span class='hs-comment'>-- is applied to some types.</span>
<a name="line-85"></a>
<a name="line-86"></a>   <span class='hs-comment'>-- | An open type synonym family  e.g. @type family F x y :: * -&gt; *@</span>
<a name="line-87"></a>   <span class='hs-keyglyph'>|</span> <span class='hs-conid'>OpenSynFamilyTyCon</span> 
<a name="line-88"></a>
<a name="line-89"></a>   <span class='hs-comment'>-- | A closed type synonym family  e.g. @type family F x where { F Int = Bool }@</span>
<a name="line-90"></a>   <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ClosedSynFamilyTyCon</span>
<a name="line-91"></a>       <span class='hs-layout'>(</span><span class='hs-conid'>CoAxiom</span> <span class='hs-conid'>Branched</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- The one axiom for this family</span>
<a name="line-92"></a>
<a name="line-93"></a>   <span class='hs-comment'>-- | A closed type synonym family declared in an hs-boot file with</span>
<a name="line-94"></a>   <span class='hs-comment'>-- type family F a where ..</span>
<a name="line-95"></a>   <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AbstractClosedSynFamilyTyCon</span>
<a name="line-96"></a>
<a name="line-97"></a>   <span class='hs-keyglyph'>|</span> <span class='hs-conid'>BuiltInSynFamTyCon</span> <span class='hs-conid'>BuiltInSynFamily</span>
</pre>\end{code}

Note [Closed type families]
~~~~~~~~~~~~~~~~~~~~~~~~~
* In an open type family you can add new instances later.  This is the 
  usual case.  

* In a closed type family you can only put equations where the family
  is defined.


Note [Promoted data constructors]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
A data constructor can be promoted to become a type constructor,
via the PromotedTyCon alternative in TyCon.

* Only data constructors with  
     (a) no kind polymorphism
     (b) no constraints in its type (eg GADTs)
  are promoted.  Existentials are ok; see Trac #7347.

* The TyCon promoted from a DataCon has the *same* Name and Unique as
  the DataCon.  Eg. If the data constructor Data.Maybe.Just(unique 78,
  say) is promoted to a TyCon whose name is Data.Maybe.Just(unique 78)

* The *kind* of a promoted DataCon may be polymorphic.  Example:
    type of DataCon           Just :: forall (a:*). a -> Maybe a
    kind of (promoted) tycon  Just :: forall (a:box). a -> Maybe a
  The kind is not identical to the type, because of the */box
  kind signature on the forall'd variable; so the tc_kind field of
  PromotedTyCon is not identical to the dataConUserType of the
  DataCon.  But it's the same modulo changing the variable kinds,
  done by DataCon.promoteType.

* Small note: We promote the *user* type of the DataCon.  Eg
     data T = MkT {-# UNPACK #-} !(Bool, Bool)
  The promoted kind is
     MkT :: (Bool,Bool) -> T
  *not*
     MkT :: Bool -> Bool -> T

Note [Enumeration types]
~~~~~~~~~~~~~~~~~~~~~~~~
We define datatypes with no constructors to *not* be
enumerations; this fixes trac #2578,  Otherwise we
end up generating an empty table for
  <mod>_<type>_closure_tbl
which is used by tagToEnum# to map Int# to constructors
in an enumeration. The empty table apparently upset
the linker.

Moreover, all the data constructor must be enumerations, meaning
they have type  (forall abc. T a b c).  GADTs are not enumerations.
For example consider
    data T a where
      T1 :: T Int
      T2 :: T Bool
      T3 :: T a
What would [T1 ..] be?  [T1,T3] :: T Int? Easiest thing is to exclude them.
See Trac #4528.

Note [Newtype coercions]
~~~~~~~~~~~~~~~~~~~~~~~~
The NewTyCon field nt_co is a CoAxiom which is used for coercing from
the representation type of the newtype, to the newtype itself. For
example,

   newtype T a = MkT (a -> a)

the NewTyCon for T will contain nt_co = CoT where CoT t : T t ~ t -> t.

In the case that the right hand side is a type application
ending with the same type variables as the left hand side, we
"eta-contract" the coercion.  So if we had

   newtype S a = MkT [a]

then we would generate the arity 0 axiom CoS : S ~ [].  The
primary reason we do this is to make newtype deriving cleaner.

In the paper we'd write
        axiom CoT : (forall t. T t) ~ (forall t. [t])
and then when we used CoT at a particular type, s, we'd say
        CoT @ s
which encodes as (TyConApp instCoercionTyCon [TyConApp CoT [], s])

Note [Newtype eta]
~~~~~~~~~~~~~~~~~~
Consider
        newtype Parser a = MkParser (IO a) derriving( Monad )
Are these two types equal (to Core)?
        Monad Parser
        Monad IO
which we need to make the derived instance for Monad Parser.

Well, yes.  But to see that easily we eta-reduce the RHS type of
Parser, in this case to ([], Froogle), so that even unsaturated applications
of Parser will work right.  This eta reduction is done when the type
constructor is built, and cached in NewTyCon.  The cached field is
only used in coreExpandTyCon_maybe.

Here's an example that I think showed up in practice
Source code:
        newtype T a = MkT [a]
        newtype Foo m = MkFoo (forall a. m a -> Int)

        w1 :: Foo []
        w1 = ...

        w2 :: Foo T
        w2 = MkFoo (\(MkT x) -> case w1 of MkFoo f -> f x)

After desugaring, and discarding the data constructors for the newtypes,
we get:
        w2 :: Foo T
        w2 = w1
And now Lint complains unless Foo T == Foo [], and that requires T==[]

This point carries over to the newtype coercion, because we need to
say
        w2 = w1 `cast` Foo CoT

so the coercion tycon CoT must have
        kind:    T ~ []
 and    arity:   0

%************************************************************************
%*                                                                      *
\subsection{PrimRep}
%*                                                                      *
%************************************************************************

Note [rep swamp]

GHC has a rich selection of types that represent "primitive types" of
one kind or another.  Each of them makes a different set of
distinctions, and mostly the differences are for good reasons,
although it's probably true that we could merge some of these.

Roughly in order of "includes more information":

 - A Width (cmm/CmmType) is simply a binary value with the specified
   number of bits.  It may represent a signed or unsigned integer, a
   floating-point value, or an address.

    data Width = W8 | W16 | W32 | W64 | W80 | W128

 - Size, which is used in the native code generator, is Width +
   floating point information.

   data Size = II8 | II16 | II32 | II64 | FF32 | FF64 | FF80

   it is necessary because e.g. the instruction to move a 64-bit float
   on x86 (movsd) is different from the instruction to move a 64-bit
   integer (movq), so the mov instruction is parameterised by Size.

 - CmmType wraps Width with more information: GC ptr, float, or
   other value.

    data CmmType = CmmType CmmCat Width
    
    data CmmCat     -- "Category" (not exported)
       = GcPtrCat   -- GC pointer
       | BitsCat    -- Non-pointer
       | FloatCat   -- Float

   It is important to have GcPtr information in Cmm, since we generate
   info tables containing pointerhood for the GC from this.  As for
   why we have float (and not signed/unsigned) here, see Note [Signed
   vs unsigned].

 - ArgRep makes only the distinctions necessary for the call and
   return conventions of the STG machine.  It is essentially CmmType
   + void.

 - PrimRep makes a few more distinctions than ArgRep: it divides
   non-GC-pointers into signed/unsigned and addresses, information
   that is necessary for passing these values to foreign functions.

There's another tension here: whether the type encodes its size in
bytes, or whether its size depends on the machine word size.  Width
and CmmType have the size built-in, whereas ArgRep and PrimRep do not.

This means to turn an ArgRep/PrimRep into a CmmType requires DynFlags.

On the other hand, CmmType includes some "nonsense" values, such as
CmmType GcPtrCat W32 on a 64-bit machine.

\begin{code}
<pre><a name="line-1"></a><a name="PrimRep"></a><span class='hs-comment'>-- | A 'PrimRep' is an abstraction of a type.  It contains information that</span>
<a name="line-2"></a><a name="PrimRep"></a><span class='hs-comment'>-- the code generator needs in order to pass arguments, return results,</span>
<a name="line-3"></a><a name="PrimRep"></a><span class='hs-comment'>-- and store values of this type.</span>
<a name="line-4"></a><a name="PrimRep"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>PrimRep</span>
<a name="line-5"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>VoidRep</span>
<a name="line-6"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>PtrRep</span>
<a name="line-7"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>IntRep</span>              <span class='hs-comment'>-- ^ Signed, word-sized value</span>
<a name="line-8"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>WordRep</span>             <span class='hs-comment'>-- ^ Unsigned, word-sized value</span>
<a name="line-9"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Int64Rep</span>            <span class='hs-comment'>-- ^ Signed, 64 bit value (with 32-bit words only)</span>
<a name="line-10"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Word64Rep</span>           <span class='hs-comment'>-- ^ Unsigned, 64 bit value (with 32-bit words only)</span>
<a name="line-11"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AddrRep</span>             <span class='hs-comment'>-- ^ A pointer, but /not/ to a Haskell value (use 'PtrRep')</span>
<a name="line-12"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>FloatRep</span>
<a name="line-13"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>DoubleRep</span>
<a name="line-14"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>VecRep</span> <span class='hs-conid'>Int</span> <span class='hs-conid'>PrimElemRep</span>  <span class='hs-comment'>-- ^ A vector</span>
<a name="line-15"></a>  <span class='hs-keyword'>deriving</span><span class='hs-layout'>(</span> <span class='hs-conid'>Eq</span><span class='hs-layout'>,</span> <span class='hs-conid'>Show</span> <span class='hs-layout'>)</span>
<a name="line-16"></a>
<a name="line-17"></a><a name="PrimElemRep"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>PrimElemRep</span>
<a name="line-18"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Int8ElemRep</span>
<a name="line-19"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Int16ElemRep</span>
<a name="line-20"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Int32ElemRep</span>
<a name="line-21"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Int64ElemRep</span>
<a name="line-22"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Word8ElemRep</span>
<a name="line-23"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Word16ElemRep</span>
<a name="line-24"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Word32ElemRep</span>
<a name="line-25"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Word64ElemRep</span>
<a name="line-26"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>FloatElemRep</span>
<a name="line-27"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>DoubleElemRep</span>
<a name="line-28"></a>   <span class='hs-keyword'>deriving</span><span class='hs-layout'>(</span> <span class='hs-conid'>Eq</span><span class='hs-layout'>,</span> <span class='hs-conid'>Show</span> <span class='hs-layout'>)</span>
<a name="line-29"></a>
<a name="line-30"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Outputable</span> <span class='hs-conid'>PrimRep</span> <span class='hs-keyword'>where</span>
<a name="line-31"></a>  <span class='hs-varid'>ppr</span> <span class='hs-varid'>r</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-layout'>(</span><span class='hs-varid'>show</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span>
<a name="line-32"></a>
<a name="line-33"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Outputable</span> <span class='hs-conid'>PrimElemRep</span> <span class='hs-keyword'>where</span>
<a name="line-34"></a>  <span class='hs-varid'>ppr</span> <span class='hs-varid'>r</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-layout'>(</span><span class='hs-varid'>show</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span>
<a name="line-35"></a>
<a name="line-36"></a><a name="isVoidRep"></a><span class='hs-definition'>isVoidRep</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>PrimRep</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-37"></a><span class='hs-definition'>isVoidRep</span> <span class='hs-conid'>VoidRep</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-38"></a><span class='hs-definition'>isVoidRep</span> <span class='hs-sel'>_other</span>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-39"></a>
<a name="line-40"></a><a name="isGcPtrRep"></a><span class='hs-definition'>isGcPtrRep</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>PrimRep</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-41"></a><span class='hs-definition'>isGcPtrRep</span> <span class='hs-conid'>PtrRep</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-42"></a><span class='hs-definition'>isGcPtrRep</span> <span class='hs-keyword'>_</span>      <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-43"></a>
<a name="line-44"></a><a name="primRepSizeW"></a><span class='hs-comment'>-- | Find the size of a 'PrimRep', in words</span>
<a name="line-45"></a><span class='hs-definition'>primRepSizeW</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>DynFlags</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>PrimRep</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span>
<a name="line-46"></a><span class='hs-definition'>primRepSizeW</span> <span class='hs-keyword'>_</span>      <span class='hs-conid'>IntRep</span>           <span class='hs-keyglyph'>=</span> <span class='hs-num'>1</span>
<a name="line-47"></a><span class='hs-definition'>primRepSizeW</span> <span class='hs-keyword'>_</span>      <span class='hs-conid'>WordRep</span>          <span class='hs-keyglyph'>=</span> <span class='hs-num'>1</span>
<a name="line-48"></a><span class='hs-definition'>primRepSizeW</span> <span class='hs-varid'>dflags</span> <span class='hs-conid'>Int64Rep</span>         <span class='hs-keyglyph'>=</span> <span class='hs-varid'>wORD64_SIZE</span> <span class='hs-varop'>`quot`</span> <span class='hs-varid'>wORD_SIZE</span> <span class='hs-varid'>dflags</span>
<a name="line-49"></a><span class='hs-definition'>primRepSizeW</span> <span class='hs-varid'>dflags</span> <span class='hs-conid'>Word64Rep</span>        <span class='hs-keyglyph'>=</span> <span class='hs-varid'>wORD64_SIZE</span> <span class='hs-varop'>`quot`</span> <span class='hs-varid'>wORD_SIZE</span> <span class='hs-varid'>dflags</span>
<a name="line-50"></a><span class='hs-definition'>primRepSizeW</span> <span class='hs-keyword'>_</span>      <span class='hs-conid'>FloatRep</span>         <span class='hs-keyglyph'>=</span> <span class='hs-num'>1</span>    <span class='hs-comment'>-- NB. might not take a full word</span>
<a name="line-51"></a><span class='hs-definition'>primRepSizeW</span> <span class='hs-varid'>dflags</span> <span class='hs-conid'>DoubleRep</span>        <span class='hs-keyglyph'>=</span> <span class='hs-varid'>dOUBLE_SIZE</span> <span class='hs-varid'>dflags</span> <span class='hs-varop'>`quot`</span> <span class='hs-varid'>wORD_SIZE</span> <span class='hs-varid'>dflags</span>
<a name="line-52"></a><span class='hs-definition'>primRepSizeW</span> <span class='hs-keyword'>_</span>      <span class='hs-conid'>AddrRep</span>          <span class='hs-keyglyph'>=</span> <span class='hs-num'>1</span>
<a name="line-53"></a><span class='hs-definition'>primRepSizeW</span> <span class='hs-keyword'>_</span>      <span class='hs-conid'>PtrRep</span>           <span class='hs-keyglyph'>=</span> <span class='hs-num'>1</span>
<a name="line-54"></a><span class='hs-definition'>primRepSizeW</span> <span class='hs-keyword'>_</span>      <span class='hs-conid'>VoidRep</span>          <span class='hs-keyglyph'>=</span> <span class='hs-num'>0</span>
<a name="line-55"></a><span class='hs-definition'>primRepSizeW</span> <span class='hs-varid'>dflags</span> <span class='hs-layout'>(</span><span class='hs-conid'>VecRep</span> <span class='hs-varid'>len</span> <span class='hs-varid'>rep</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>len</span> <span class='hs-varop'>*</span> <span class='hs-varid'>primElemRepSizeB</span> <span class='hs-varid'>rep</span> <span class='hs-varop'>`quot`</span> <span class='hs-varid'>wORD_SIZE</span> <span class='hs-varid'>dflags</span>
<a name="line-56"></a>
<a name="line-57"></a><a name="primElemRepSizeB"></a><span class='hs-definition'>primElemRepSizeB</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>PrimElemRep</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span>
<a name="line-58"></a><span class='hs-definition'>primElemRepSizeB</span> <span class='hs-conid'>Int8ElemRep</span>   <span class='hs-keyglyph'>=</span> <span class='hs-num'>1</span>
<a name="line-59"></a><span class='hs-definition'>primElemRepSizeB</span> <span class='hs-conid'>Int16ElemRep</span>  <span class='hs-keyglyph'>=</span> <span class='hs-num'>2</span>
<a name="line-60"></a><span class='hs-definition'>primElemRepSizeB</span> <span class='hs-conid'>Int32ElemRep</span>  <span class='hs-keyglyph'>=</span> <span class='hs-num'>4</span>
<a name="line-61"></a><span class='hs-definition'>primElemRepSizeB</span> <span class='hs-conid'>Int64ElemRep</span>  <span class='hs-keyglyph'>=</span> <span class='hs-num'>8</span>
<a name="line-62"></a><span class='hs-definition'>primElemRepSizeB</span> <span class='hs-conid'>Word8ElemRep</span>  <span class='hs-keyglyph'>=</span> <span class='hs-num'>1</span>
<a name="line-63"></a><span class='hs-definition'>primElemRepSizeB</span> <span class='hs-conid'>Word16ElemRep</span> <span class='hs-keyglyph'>=</span> <span class='hs-num'>2</span>
<a name="line-64"></a><span class='hs-definition'>primElemRepSizeB</span> <span class='hs-conid'>Word32ElemRep</span> <span class='hs-keyglyph'>=</span> <span class='hs-num'>4</span>
<a name="line-65"></a><span class='hs-definition'>primElemRepSizeB</span> <span class='hs-conid'>Word64ElemRep</span> <span class='hs-keyglyph'>=</span> <span class='hs-num'>8</span>
<a name="line-66"></a><span class='hs-definition'>primElemRepSizeB</span> <span class='hs-conid'>FloatElemRep</span>  <span class='hs-keyglyph'>=</span> <span class='hs-num'>4</span>
<a name="line-67"></a><span class='hs-definition'>primElemRepSizeB</span> <span class='hs-conid'>DoubleElemRep</span> <span class='hs-keyglyph'>=</span> <span class='hs-num'>8</span>
</pre>\end{code}

%************************************************************************
%*                                                                      *
\subsection{TyCon Construction}
%*                                                                      *
%************************************************************************

Note: the TyCon constructors all take a Kind as one argument, even though
they could, in principle, work out their Kind from their other arguments.
But to do so they need functions from Types, and that makes a nasty
module mutual-recursion.  And they aren't called from many places.
So we compromise, and move their Kind calculation to the call site.

\begin{code}
<pre><a name="line-1"></a><a name="mkFunTyCon"></a><span class='hs-comment'>-- | Given the name of the function type constructor and it's kind, create the</span>
<a name="line-2"></a><span class='hs-comment'>-- corresponding 'TyCon'. It is reccomended to use 'TypeRep.funTyCon' if you want</span>
<a name="line-3"></a><span class='hs-comment'>-- this functionality</span>
<a name="line-4"></a><span class='hs-definition'>mkFunTyCon</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Kind</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TyCon</span>
<a name="line-5"></a><span class='hs-definition'>mkFunTyCon</span> <span class='hs-varid'>name</span> <span class='hs-varid'>kind</span>
<a name="line-6"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>FunTyCon</span> <span class='hs-layout'>{</span>
<a name="line-7"></a>        <span class='hs-varid'>tyConUnique</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>nameUnique</span> <span class='hs-varid'>name</span><span class='hs-layout'>,</span>
<a name="line-8"></a>        <span class='hs-varid'>tyConName</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>name</span><span class='hs-layout'>,</span>
<a name="line-9"></a>        <span class='hs-varid'>tc_kind</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>kind</span><span class='hs-layout'>,</span>
<a name="line-10"></a>        <span class='hs-varid'>tyConArity</span>  <span class='hs-keyglyph'>=</span> <span class='hs-num'>2</span>
<a name="line-11"></a>    <span class='hs-layout'>}</span>
<a name="line-12"></a>
<a name="line-13"></a><a name="mkAlgTyCon"></a><span class='hs-comment'>-- | This is the making of an algebraic 'TyCon'. Notably, you have to</span>
<a name="line-14"></a><span class='hs-comment'>-- pass in the generic (in the -XGenerics sense) information about the</span>
<a name="line-15"></a><span class='hs-comment'>-- type constructor - you can get hold of it easily (see Generics</span>
<a name="line-16"></a><span class='hs-comment'>-- module)</span>
<a name="line-17"></a><span class='hs-definition'>mkAlgTyCon</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Name</span>
<a name="line-18"></a>           <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Kind</span>              <span class='hs-comment'>-- ^ Kind of the resulting 'TyCon'</span>
<a name="line-19"></a>           <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>TyVar</span><span class='hs-keyglyph'>]</span>           <span class='hs-comment'>-- ^ 'TyVar's scoped over: see 'tyConTyVars'.</span>
<a name="line-20"></a>                                <span class='hs-comment'>--   Arity is inferred from the length of this list</span>
<a name="line-21"></a>           <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Role</span><span class='hs-keyglyph'>]</span>            <span class='hs-comment'>-- ^ The roles for each TyVar</span>
<a name="line-22"></a>           <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>CType</span>       <span class='hs-comment'>-- ^ The C type this type corresponds to</span>
<a name="line-23"></a>                                <span class='hs-comment'>--   when using the CAPI FFI</span>
<a name="line-24"></a>           <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>PredType</span><span class='hs-keyglyph'>]</span>        <span class='hs-comment'>-- ^ Stupid theta: see 'algTcStupidTheta'</span>
<a name="line-25"></a>           <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>AlgTyConRhs</span>       <span class='hs-comment'>-- ^ Information about dat aconstructors</span>
<a name="line-26"></a>           <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TyConParent</span>
<a name="line-27"></a>           <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>RecFlag</span>           <span class='hs-comment'>-- ^ Is the 'TyCon' recursive?</span>
<a name="line-28"></a>           <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>              <span class='hs-comment'>-- ^ Was the 'TyCon' declared with GADT syntax?</span>
<a name="line-29"></a>           <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>TyCon</span>       <span class='hs-comment'>-- ^ Promoted version</span>
<a name="line-30"></a>           <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TyCon</span>
<a name="line-31"></a><span class='hs-definition'>mkAlgTyCon</span> <span class='hs-varid'>name</span> <span class='hs-varid'>kind</span> <span class='hs-varid'>tyvars</span> <span class='hs-varid'>roles</span> <span class='hs-varid'>cType</span> <span class='hs-varid'>stupid</span> <span class='hs-varid'>rhs</span> <span class='hs-varid'>parent</span> <span class='hs-varid'>is_rec</span> <span class='hs-varid'>gadt_syn</span> <span class='hs-varid'>prom_tc</span>
<a name="line-32"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AlgTyCon</span> <span class='hs-layout'>{</span>
<a name="line-33"></a>        <span class='hs-varid'>tyConName</span>        <span class='hs-keyglyph'>=</span> <span class='hs-varid'>name</span><span class='hs-layout'>,</span>
<a name="line-34"></a>        <span class='hs-varid'>tyConUnique</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>nameUnique</span> <span class='hs-varid'>name</span><span class='hs-layout'>,</span>
<a name="line-35"></a>        <span class='hs-varid'>tc_kind</span>          <span class='hs-keyglyph'>=</span> <span class='hs-varid'>kind</span><span class='hs-layout'>,</span>
<a name="line-36"></a>        <span class='hs-varid'>tyConArity</span>       <span class='hs-keyglyph'>=</span> <span class='hs-varid'>length</span> <span class='hs-varid'>tyvars</span><span class='hs-layout'>,</span>
<a name="line-37"></a>        <span class='hs-varid'>tyConTyVars</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tyvars</span><span class='hs-layout'>,</span>
<a name="line-38"></a>        <span class='hs-varid'>tc_roles</span>         <span class='hs-keyglyph'>=</span> <span class='hs-varid'>roles</span><span class='hs-layout'>,</span>
<a name="line-39"></a>        <span class='hs-varid'>tyConCType</span>       <span class='hs-keyglyph'>=</span> <span class='hs-varid'>cType</span><span class='hs-layout'>,</span>
<a name="line-40"></a>        <span class='hs-varid'>algTcStupidTheta</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>stupid</span><span class='hs-layout'>,</span>
<a name="line-41"></a>        <span class='hs-varid'>algTcRhs</span>         <span class='hs-keyglyph'>=</span> <span class='hs-varid'>rhs</span><span class='hs-layout'>,</span>
<a name="line-42"></a>        <span class='hs-varid'>algTcParent</span>      <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ASSERT2</span><span class='hs-layout'>(</span> <span class='hs-varid'>okParent</span> <span class='hs-varid'>name</span> <span class='hs-varid'>parent</span><span class='hs-layout'>,</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>name</span> <span class='hs-varop'>$$</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>parent</span> <span class='hs-layout'>)</span> <span class='hs-varid'>parent</span><span class='hs-layout'>,</span>
<a name="line-43"></a>        <span class='hs-varid'>algTcRec</span>         <span class='hs-keyglyph'>=</span> <span class='hs-varid'>is_rec</span><span class='hs-layout'>,</span>
<a name="line-44"></a>        <span class='hs-varid'>algTcGadtSyntax</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>gadt_syn</span><span class='hs-layout'>,</span>
<a name="line-45"></a>        <span class='hs-varid'>tcPromoted</span>       <span class='hs-keyglyph'>=</span> <span class='hs-varid'>prom_tc</span>
<a name="line-46"></a>    <span class='hs-layout'>}</span>
<a name="line-47"></a>
<a name="line-48"></a><a name="mkClassTyCon"></a><span class='hs-comment'>-- | Simpler specialization of 'mkAlgTyCon' for classes</span>
<a name="line-49"></a><span class='hs-definition'>mkClassTyCon</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Kind</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>TyVar</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Role</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>AlgTyConRhs</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Class</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>RecFlag</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TyCon</span>
<a name="line-50"></a><span class='hs-definition'>mkClassTyCon</span> <span class='hs-varid'>name</span> <span class='hs-varid'>kind</span> <span class='hs-varid'>tyvars</span> <span class='hs-varid'>roles</span> <span class='hs-varid'>rhs</span> <span class='hs-varid'>clas</span> <span class='hs-varid'>is_rec</span>
<a name="line-51"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkAlgTyCon</span> <span class='hs-varid'>name</span> <span class='hs-varid'>kind</span> <span class='hs-varid'>tyvars</span> <span class='hs-varid'>roles</span> <span class='hs-conid'>Nothing</span> <span class='hs-conid'>[]</span> <span class='hs-varid'>rhs</span> <span class='hs-layout'>(</span><span class='hs-conid'>ClassTyCon</span> <span class='hs-varid'>clas</span><span class='hs-layout'>)</span> 
<a name="line-52"></a>               <span class='hs-varid'>is_rec</span> <span class='hs-conid'>False</span> 
<a name="line-53"></a>               <span class='hs-conid'>Nothing</span>    <span class='hs-comment'>-- Class TyCons are not pormoted</span>
<a name="line-54"></a>
<a name="line-55"></a><a name="mkTupleTyCon"></a><span class='hs-definition'>mkTupleTyCon</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Name</span>
<a name="line-56"></a>             <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Kind</span>    <span class='hs-comment'>-- ^ Kind of the resulting 'TyCon'</span>
<a name="line-57"></a>             <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Arity</span>   <span class='hs-comment'>-- ^ Arity of the tuple</span>
<a name="line-58"></a>             <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>TyVar</span><span class='hs-keyglyph'>]</span> <span class='hs-comment'>-- ^ 'TyVar's scoped over: see 'tyConTyVars'</span>
<a name="line-59"></a>             <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>DataCon</span>
<a name="line-60"></a>             <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TupleSort</span>    <span class='hs-comment'>-- ^ Whether the tuple is boxed or unboxed</span>
<a name="line-61"></a>             <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>TyCon</span>  <span class='hs-comment'>-- ^ Promoted version</span>
<a name="line-62"></a>             <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TyCon</span>
<a name="line-63"></a><span class='hs-definition'>mkTupleTyCon</span> <span class='hs-varid'>name</span> <span class='hs-varid'>kind</span> <span class='hs-varid'>arity</span> <span class='hs-varid'>tyvars</span> <span class='hs-varid'>con</span> <span class='hs-varid'>sort</span> <span class='hs-varid'>prom_tc</span>
<a name="line-64"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>TupleTyCon</span> <span class='hs-layout'>{</span>
<a name="line-65"></a>        <span class='hs-varid'>tyConUnique</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>nameUnique</span> <span class='hs-varid'>name</span><span class='hs-layout'>,</span>
<a name="line-66"></a>        <span class='hs-varid'>tyConName</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>name</span><span class='hs-layout'>,</span>
<a name="line-67"></a>        <span class='hs-varid'>tc_kind</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>kind</span><span class='hs-layout'>,</span>
<a name="line-68"></a>        <span class='hs-varid'>tyConArity</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>arity</span><span class='hs-layout'>,</span>
<a name="line-69"></a>        <span class='hs-varid'>tyConTupleSort</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sort</span><span class='hs-layout'>,</span>
<a name="line-70"></a>        <span class='hs-varid'>tyConTyVars</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tyvars</span><span class='hs-layout'>,</span>
<a name="line-71"></a>        <span class='hs-varid'>dataCon</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>con</span><span class='hs-layout'>,</span>
<a name="line-72"></a>        <span class='hs-varid'>tcPromoted</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>prom_tc</span>
<a name="line-73"></a>    <span class='hs-layout'>}</span>
<a name="line-74"></a>
<a name="line-75"></a><a name="mkForeignTyCon"></a><span class='hs-comment'>-- ^ Foreign-imported (.NET) type constructors are represented</span>
<a name="line-76"></a><span class='hs-comment'>-- as primitive, but /lifted/, 'TyCons' for now. They are lifted</span>
<a name="line-77"></a><span class='hs-comment'>-- because the Haskell type @T@ representing the (foreign) .NET</span>
<a name="line-78"></a><span class='hs-comment'>-- type @T@ is actually implemented (in ILX) as a @thunk&lt;T&gt;@</span>
<a name="line-79"></a><span class='hs-definition'>mkForeignTyCon</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Name</span>
<a name="line-80"></a>               <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>FastString</span> <span class='hs-comment'>-- ^ Name of the foreign imported thing, maybe</span>
<a name="line-81"></a>               <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Kind</span>
<a name="line-82"></a>               <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TyCon</span>
<a name="line-83"></a><span class='hs-definition'>mkForeignTyCon</span> <span class='hs-varid'>name</span> <span class='hs-varid'>ext_name</span> <span class='hs-varid'>kind</span>
<a name="line-84"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>PrimTyCon</span> <span class='hs-layout'>{</span>
<a name="line-85"></a>        <span class='hs-varid'>tyConName</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>name</span><span class='hs-layout'>,</span>
<a name="line-86"></a>        <span class='hs-varid'>tyConUnique</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>nameUnique</span> <span class='hs-varid'>name</span><span class='hs-layout'>,</span>
<a name="line-87"></a>        <span class='hs-varid'>tc_kind</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>kind</span><span class='hs-layout'>,</span>
<a name="line-88"></a>        <span class='hs-varid'>tyConArity</span>   <span class='hs-keyglyph'>=</span> <span class='hs-num'>0</span><span class='hs-layout'>,</span>
<a name="line-89"></a>        <span class='hs-varid'>tc_roles</span>     <span class='hs-keyglyph'>=</span> <span class='hs-conid'>[]</span><span class='hs-layout'>,</span>
<a name="line-90"></a>        <span class='hs-varid'>primTyConRep</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>PtrRep</span><span class='hs-layout'>,</span> <span class='hs-comment'>-- they all do</span>
<a name="line-91"></a>        <span class='hs-varid'>isUnLifted</span>   <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span><span class='hs-layout'>,</span>
<a name="line-92"></a>        <span class='hs-varid'>tyConExtName</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ext_name</span>
<a name="line-93"></a>    <span class='hs-layout'>}</span>
<a name="line-94"></a>
<a name="line-95"></a>
<a name="line-96"></a><a name="mkPrimTyCon"></a><span class='hs-comment'>-- | Create an unlifted primitive 'TyCon', such as @Int#@</span>
<a name="line-97"></a><span class='hs-definition'>mkPrimTyCon</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Name</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Kind</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Role</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>PrimRep</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TyCon</span>
<a name="line-98"></a><span class='hs-definition'>mkPrimTyCon</span> <span class='hs-varid'>name</span> <span class='hs-varid'>kind</span> <span class='hs-varid'>roles</span> <span class='hs-varid'>rep</span>
<a name="line-99"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkPrimTyCon'</span> <span class='hs-varid'>name</span> <span class='hs-varid'>kind</span> <span class='hs-varid'>roles</span> <span class='hs-varid'>rep</span> <span class='hs-conid'>True</span>
<a name="line-100"></a>
<a name="line-101"></a><a name="mkKindTyCon"></a><span class='hs-comment'>-- | Kind constructors</span>
<a name="line-102"></a><span class='hs-definition'>mkKindTyCon</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Kind</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TyCon</span>
<a name="line-103"></a><span class='hs-definition'>mkKindTyCon</span> <span class='hs-varid'>name</span> <span class='hs-varid'>kind</span>
<a name="line-104"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkPrimTyCon'</span> <span class='hs-varid'>name</span> <span class='hs-varid'>kind</span> <span class='hs-conid'>[]</span> <span class='hs-conid'>VoidRep</span> <span class='hs-conid'>True</span>
<a name="line-105"></a>
<a name="line-106"></a><a name="mkLiftedPrimTyCon"></a><span class='hs-comment'>-- | Create a lifted primitive 'TyCon' such as @RealWorld@</span>
<a name="line-107"></a><span class='hs-definition'>mkLiftedPrimTyCon</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Name</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Kind</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Role</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>PrimRep</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TyCon</span>
<a name="line-108"></a><span class='hs-definition'>mkLiftedPrimTyCon</span> <span class='hs-varid'>name</span> <span class='hs-varid'>kind</span> <span class='hs-varid'>roles</span> <span class='hs-varid'>rep</span>
<a name="line-109"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkPrimTyCon'</span> <span class='hs-varid'>name</span> <span class='hs-varid'>kind</span> <span class='hs-varid'>roles</span> <span class='hs-varid'>rep</span> <span class='hs-conid'>False</span>
<a name="line-110"></a>
<a name="line-111"></a><a name="mkPrimTyCon'"></a><span class='hs-definition'>mkPrimTyCon'</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Name</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Kind</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Role</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>PrimRep</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TyCon</span>
<a name="line-112"></a><span class='hs-definition'>mkPrimTyCon'</span> <span class='hs-varid'>name</span> <span class='hs-varid'>kind</span> <span class='hs-varid'>roles</span> <span class='hs-varid'>rep</span> <span class='hs-varid'>is_unlifted</span>
<a name="line-113"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>PrimTyCon</span> <span class='hs-layout'>{</span>
<a name="line-114"></a>        <span class='hs-varid'>tyConName</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>name</span><span class='hs-layout'>,</span>
<a name="line-115"></a>        <span class='hs-varid'>tyConUnique</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>nameUnique</span> <span class='hs-varid'>name</span><span class='hs-layout'>,</span>
<a name="line-116"></a>        <span class='hs-varid'>tc_kind</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>kind</span><span class='hs-layout'>,</span>
<a name="line-117"></a>        <span class='hs-varid'>tyConArity</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>length</span> <span class='hs-varid'>roles</span><span class='hs-layout'>,</span>
<a name="line-118"></a>        <span class='hs-varid'>tc_roles</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>roles</span><span class='hs-layout'>,</span>
<a name="line-119"></a>        <span class='hs-varid'>primTyConRep</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>rep</span><span class='hs-layout'>,</span>
<a name="line-120"></a>        <span class='hs-varid'>isUnLifted</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>is_unlifted</span><span class='hs-layout'>,</span>
<a name="line-121"></a>        <span class='hs-varid'>tyConExtName</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-122"></a>    <span class='hs-layout'>}</span>
<a name="line-123"></a>
<a name="line-124"></a><a name="mkSynTyCon"></a><span class='hs-comment'>-- | Create a type synonym 'TyCon'</span>
<a name="line-125"></a><span class='hs-definition'>mkSynTyCon</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Kind</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>TyVar</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Role</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SynTyConRhs</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TyConParent</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TyCon</span>
<a name="line-126"></a><span class='hs-definition'>mkSynTyCon</span> <span class='hs-varid'>name</span> <span class='hs-varid'>kind</span> <span class='hs-varid'>tyvars</span> <span class='hs-varid'>roles</span> <span class='hs-varid'>rhs</span> <span class='hs-varid'>parent</span>
<a name="line-127"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>SynTyCon</span> <span class='hs-layout'>{</span>
<a name="line-128"></a>        <span class='hs-varid'>tyConName</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>name</span><span class='hs-layout'>,</span>
<a name="line-129"></a>        <span class='hs-varid'>tyConUnique</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>nameUnique</span> <span class='hs-varid'>name</span><span class='hs-layout'>,</span>
<a name="line-130"></a>        <span class='hs-varid'>tc_kind</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>kind</span><span class='hs-layout'>,</span>
<a name="line-131"></a>        <span class='hs-varid'>tyConArity</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>length</span> <span class='hs-varid'>tyvars</span><span class='hs-layout'>,</span>
<a name="line-132"></a>        <span class='hs-varid'>tyConTyVars</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tyvars</span><span class='hs-layout'>,</span>
<a name="line-133"></a>        <span class='hs-varid'>tc_roles</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>roles</span><span class='hs-layout'>,</span>
<a name="line-134"></a>        <span class='hs-varid'>synTcRhs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>rhs</span><span class='hs-layout'>,</span>
<a name="line-135"></a>        <span class='hs-varid'>synTcParent</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>parent</span>
<a name="line-136"></a>    <span class='hs-layout'>}</span>
<a name="line-137"></a>
<a name="line-138"></a><a name="mkPromotedDataCon"></a><span class='hs-comment'>-- | Create a promoted data constructor 'TyCon'</span>
<a name="line-139"></a><span class='hs-comment'>-- Somewhat dodgily, we give it the same Name</span>
<a name="line-140"></a><span class='hs-comment'>-- as the data constructor itself; when we pretty-print</span>
<a name="line-141"></a><span class='hs-comment'>-- the TyCon we add a quote; see the Outputable TyCon instance</span>
<a name="line-142"></a><span class='hs-definition'>mkPromotedDataCon</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>DataCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Unique</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Kind</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Role</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TyCon</span>
<a name="line-143"></a><span class='hs-definition'>mkPromotedDataCon</span> <span class='hs-varid'>con</span> <span class='hs-varid'>name</span> <span class='hs-varid'>unique</span> <span class='hs-varid'>kind</span> <span class='hs-varid'>roles</span>
<a name="line-144"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>PromotedDataCon</span> <span class='hs-layout'>{</span>
<a name="line-145"></a>        <span class='hs-varid'>tyConName</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>name</span><span class='hs-layout'>,</span>
<a name="line-146"></a>        <span class='hs-varid'>tyConUnique</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>unique</span><span class='hs-layout'>,</span>
<a name="line-147"></a>        <span class='hs-varid'>tyConArity</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>arity</span><span class='hs-layout'>,</span>
<a name="line-148"></a>        <span class='hs-varid'>tc_roles</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>roles</span><span class='hs-layout'>,</span>
<a name="line-149"></a>        <span class='hs-varid'>tc_kind</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>kind</span><span class='hs-layout'>,</span>
<a name="line-150"></a>        <span class='hs-varid'>dataCon</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>con</span>
<a name="line-151"></a>  <span class='hs-layout'>}</span>
<a name="line-152"></a>  <span class='hs-keyword'>where</span>
<a name="line-153"></a>    <span class='hs-varid'>arity</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>length</span> <span class='hs-varid'>roles</span>
<a name="line-154"></a>
<a name="line-155"></a><a name="mkPromotedTyCon"></a><span class='hs-comment'>-- | Create a promoted type constructor 'TyCon'</span>
<a name="line-156"></a><span class='hs-comment'>-- Somewhat dodgily, we give it the same Name</span>
<a name="line-157"></a><span class='hs-comment'>-- as the type constructor itself</span>
<a name="line-158"></a><span class='hs-definition'>mkPromotedTyCon</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Kind</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TyCon</span>
<a name="line-159"></a><span class='hs-definition'>mkPromotedTyCon</span> <span class='hs-varid'>tc</span> <span class='hs-varid'>kind</span>
<a name="line-160"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>PromotedTyCon</span> <span class='hs-layout'>{</span>
<a name="line-161"></a>        <span class='hs-varid'>tyConName</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getName</span> <span class='hs-varid'>tc</span><span class='hs-layout'>,</span>
<a name="line-162"></a>        <span class='hs-varid'>tyConUnique</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getUnique</span> <span class='hs-varid'>tc</span><span class='hs-layout'>,</span>
<a name="line-163"></a>        <span class='hs-varid'>tyConArity</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tyConArity</span> <span class='hs-varid'>tc</span><span class='hs-layout'>,</span>
<a name="line-164"></a>        <span class='hs-varid'>tc_kind</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>kind</span><span class='hs-layout'>,</span>
<a name="line-165"></a>        <span class='hs-varid'>ty_con</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tc</span>
<a name="line-166"></a>  <span class='hs-layout'>}</span>
</pre>\end{code}

\begin{code}
<pre><a name="line-1"></a><a name="isFunTyCon"></a><span class='hs-definition'>isFunTyCon</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-2"></a><span class='hs-definition'>isFunTyCon</span> <span class='hs-layout'>(</span><span class='hs-conid'>FunTyCon</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-3"></a><span class='hs-definition'>isFunTyCon</span> <span class='hs-keyword'>_</span>             <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-4"></a>
<a name="line-5"></a><a name="isAbstractTyCon"></a><span class='hs-comment'>-- | Test if the 'TyCon' is algebraic but abstract (invisible data constructors)</span>
<a name="line-6"></a><span class='hs-definition'>isAbstractTyCon</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-7"></a><span class='hs-definition'>isAbstractTyCon</span> <span class='hs-layout'>(</span><span class='hs-conid'>AlgTyCon</span> <span class='hs-layout'>{</span> <span class='hs-varid'>algTcRhs</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AbstractTyCon</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-8"></a><span class='hs-definition'>isAbstractTyCon</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-9"></a>
<a name="line-10"></a><a name="makeTyConAbstract"></a><span class='hs-comment'>-- | Make an algebraic 'TyCon' abstract. Panics if the supplied 'TyCon' is not algebraic</span>
<a name="line-11"></a><span class='hs-definition'>makeTyConAbstract</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TyCon</span>
<a name="line-12"></a><span class='hs-definition'>makeTyConAbstract</span> <span class='hs-varid'>tc</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-conid'>AlgTyCon</span> <span class='hs-layout'>{</span> <span class='hs-varid'>algTcRhs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>rhs</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-13"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tc</span> <span class='hs-layout'>{</span> <span class='hs-varid'>algTcRhs</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AbstractTyCon</span> <span class='hs-layout'>(</span><span class='hs-varid'>isDistinctAlgRhs</span> <span class='hs-varid'>rhs</span><span class='hs-layout'>)</span> <span class='hs-layout'>}</span>
<a name="line-14"></a><span class='hs-definition'>makeTyConAbstract</span> <span class='hs-varid'>tc</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprPanic</span> <span class='hs-str'>"makeTyConAbstract"</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>tc</span><span class='hs-layout'>)</span>
<a name="line-15"></a>
<a name="line-16"></a><a name="isPrimTyCon"></a><span class='hs-comment'>-- | Does this 'TyCon' represent something that cannot be defined in Haskell?</span>
<a name="line-17"></a><span class='hs-definition'>isPrimTyCon</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-18"></a><span class='hs-definition'>isPrimTyCon</span> <span class='hs-layout'>(</span><span class='hs-conid'>PrimTyCon</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-19"></a><span class='hs-definition'>isPrimTyCon</span> <span class='hs-keyword'>_</span>              <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-20"></a>
<a name="line-21"></a><a name="isUnLiftedTyCon"></a><span class='hs-comment'>-- | Is this 'TyCon' unlifted (i.e. cannot contain bottom)? Note that this can only</span>
<a name="line-22"></a><span class='hs-comment'>-- be true for primitive and unboxed-tuple 'TyCon's</span>
<a name="line-23"></a><span class='hs-definition'>isUnLiftedTyCon</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-24"></a><span class='hs-definition'>isUnLiftedTyCon</span> <span class='hs-layout'>(</span><span class='hs-conid'>PrimTyCon</span>  <span class='hs-layout'>{</span><span class='hs-varid'>isUnLifted</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>is_unlifted</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>is_unlifted</span>
<a name="line-25"></a><span class='hs-definition'>isUnLiftedTyCon</span> <span class='hs-layout'>(</span><span class='hs-conid'>TupleTyCon</span> <span class='hs-layout'>{</span><span class='hs-varid'>tyConTupleSort</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sort</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>not</span> <span class='hs-layout'>(</span><span class='hs-varid'>isBoxed</span> <span class='hs-layout'>(</span><span class='hs-varid'>tupleSortBoxity</span> <span class='hs-varid'>sort</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-26"></a><span class='hs-definition'>isUnLiftedTyCon</span> <span class='hs-keyword'>_</span>                                       <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-27"></a>
<a name="line-28"></a><a name="isAlgTyCon"></a><span class='hs-comment'>-- | Returns @True@ if the supplied 'TyCon' resulted from either a</span>
<a name="line-29"></a><span class='hs-comment'>-- @data@ or @newtype@ declaration</span>
<a name="line-30"></a><span class='hs-definition'>isAlgTyCon</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-31"></a><span class='hs-definition'>isAlgTyCon</span> <span class='hs-layout'>(</span><span class='hs-conid'>AlgTyCon</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-32"></a><span class='hs-definition'>isAlgTyCon</span> <span class='hs-layout'>(</span><span class='hs-conid'>TupleTyCon</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-33"></a><span class='hs-definition'>isAlgTyCon</span> <span class='hs-keyword'>_</span>               <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-34"></a>
<a name="line-35"></a><a name="isDataTyCon"></a><span class='hs-definition'>isDataTyCon</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-36"></a><span class='hs-comment'>-- ^ Returns @True@ for data types that are /definitely/ represented by</span>
<a name="line-37"></a><span class='hs-comment'>-- heap-allocated constructors.  These are scrutinised by Core-level</span>
<a name="line-38"></a><span class='hs-comment'>-- @case@ expressions, and they get info tables allocated for them.</span>
<a name="line-39"></a><span class='hs-comment'>--</span>
<a name="line-40"></a><span class='hs-comment'>-- Generally, the function will be true for all @data@ types and false</span>
<a name="line-41"></a><span class='hs-comment'>-- for @newtype@s, unboxed tuples and type family 'TyCon's. But it is</span>
<a name="line-42"></a><span class='hs-comment'>-- not guaranteed to return @True@ in all cases that it could.</span>
<a name="line-43"></a><span class='hs-comment'>--</span>
<a name="line-44"></a><span class='hs-comment'>-- NB: for a data type family, only the /instance/ 'TyCon's</span>
<a name="line-45"></a><span class='hs-comment'>--     get an info table.  The family declaration 'TyCon' does not</span>
<a name="line-46"></a><span class='hs-definition'>isDataTyCon</span> <span class='hs-layout'>(</span><span class='hs-conid'>AlgTyCon</span> <span class='hs-layout'>{</span><span class='hs-varid'>algTcRhs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>rhs</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-47"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>rhs</span> <span class='hs-keyword'>of</span>
<a name="line-48"></a>        <span class='hs-conid'>DataTyCon</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span>       <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>True</span>
<a name="line-49"></a>        <span class='hs-conid'>NewTyCon</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span>        <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>False</span>
<a name="line-50"></a>        <span class='hs-conid'>DataFamilyTyCon</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>False</span>
<a name="line-51"></a>        <span class='hs-conid'>AbstractTyCon</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>False</span>      <span class='hs-comment'>-- We don't know, so return False</span>
<a name="line-52"></a><span class='hs-definition'>isDataTyCon</span> <span class='hs-layout'>(</span><span class='hs-conid'>TupleTyCon</span> <span class='hs-layout'>{</span><span class='hs-varid'>tyConTupleSort</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sort</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>isBoxed</span> <span class='hs-layout'>(</span><span class='hs-varid'>tupleSortBoxity</span> <span class='hs-varid'>sort</span><span class='hs-layout'>)</span>
<a name="line-53"></a><span class='hs-definition'>isDataTyCon</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-54"></a>
<a name="line-55"></a><a name="isDistinctTyCon"></a><span class='hs-comment'>-- | 'isDistinctTyCon' is true of 'TyCon's that are equal only to</span>
<a name="line-56"></a><span class='hs-comment'>-- themselves, even via coercions (except for unsafeCoerce).</span>
<a name="line-57"></a><span class='hs-comment'>-- This excludes newtypes, type functions, type synonyms.</span>
<a name="line-58"></a><span class='hs-comment'>-- It relates directly to the FC consistency story:</span>
<a name="line-59"></a><span class='hs-comment'>--     If the axioms are consistent,</span>
<a name="line-60"></a><span class='hs-comment'>--     and  co : S tys ~ T tys, and S,T are "distinct" TyCons,</span>
<a name="line-61"></a><span class='hs-comment'>--     then S=T.</span>
<a name="line-62"></a><span class='hs-comment'>-- Cf Note [Pruning dead case alternatives] in Unify</span>
<a name="line-63"></a><span class='hs-definition'>isDistinctTyCon</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-64"></a><span class='hs-definition'>isDistinctTyCon</span> <span class='hs-layout'>(</span><span class='hs-conid'>AlgTyCon</span> <span class='hs-layout'>{</span><span class='hs-varid'>algTcRhs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>rhs</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>isDistinctAlgRhs</span> <span class='hs-varid'>rhs</span>
<a name="line-65"></a><span class='hs-definition'>isDistinctTyCon</span> <span class='hs-layout'>(</span><span class='hs-conid'>FunTyCon</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>               <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-66"></a><span class='hs-definition'>isDistinctTyCon</span> <span class='hs-layout'>(</span><span class='hs-conid'>TupleTyCon</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>             <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-67"></a><span class='hs-definition'>isDistinctTyCon</span> <span class='hs-layout'>(</span><span class='hs-conid'>PrimTyCon</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>              <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-68"></a><span class='hs-definition'>isDistinctTyCon</span> <span class='hs-layout'>(</span><span class='hs-conid'>PromotedDataCon</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>        <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-69"></a><span class='hs-definition'>isDistinctTyCon</span> <span class='hs-keyword'>_</span>                           <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-70"></a>
<a name="line-71"></a><a name="isDistinctAlgRhs"></a><span class='hs-definition'>isDistinctAlgRhs</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>AlgTyConRhs</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-72"></a><span class='hs-definition'>isDistinctAlgRhs</span> <span class='hs-layout'>(</span><span class='hs-conid'>DataTyCon</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>           <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-73"></a><span class='hs-definition'>isDistinctAlgRhs</span> <span class='hs-layout'>(</span><span class='hs-conid'>DataFamilyTyCon</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>     <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-74"></a><span class='hs-definition'>isDistinctAlgRhs</span> <span class='hs-layout'>(</span><span class='hs-conid'>AbstractTyCon</span> <span class='hs-varid'>distinct</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>distinct</span>
<a name="line-75"></a><span class='hs-definition'>isDistinctAlgRhs</span> <span class='hs-layout'>(</span><span class='hs-conid'>NewTyCon</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>            <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-76"></a>
<a name="line-77"></a><a name="isNewTyCon"></a><span class='hs-comment'>-- | Is this 'TyCon' that for a @newtype@</span>
<a name="line-78"></a><span class='hs-definition'>isNewTyCon</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-79"></a><span class='hs-definition'>isNewTyCon</span> <span class='hs-layout'>(</span><span class='hs-conid'>AlgTyCon</span> <span class='hs-layout'>{</span><span class='hs-varid'>algTcRhs</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>NewTyCon</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-80"></a><span class='hs-definition'>isNewTyCon</span> <span class='hs-keyword'>_</span>                                   <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-81"></a>
<a name="line-82"></a><a name="unwrapNewTyCon_maybe"></a><span class='hs-comment'>-- | Take a 'TyCon' apart into the 'TyVar's it scopes over, the 'Type' it expands</span>
<a name="line-83"></a><span class='hs-comment'>-- into, and (possibly) a coercion from the representation type to the @newtype@.</span>
<a name="line-84"></a><span class='hs-comment'>-- Returns @Nothing@ if this is not possible.</span>
<a name="line-85"></a><span class='hs-definition'>unwrapNewTyCon_maybe</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>[</span><span class='hs-conid'>TyVar</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span> <span class='hs-conid'>Type</span><span class='hs-layout'>,</span> <span class='hs-conid'>CoAxiom</span> <span class='hs-conid'>Unbranched</span><span class='hs-layout'>)</span>
<a name="line-86"></a><span class='hs-definition'>unwrapNewTyCon_maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>AlgTyCon</span> <span class='hs-layout'>{</span> <span class='hs-varid'>tyConTyVars</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tvs</span><span class='hs-layout'>,</span>
<a name="line-87"></a>                                 <span class='hs-varid'>algTcRhs</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>NewTyCon</span> <span class='hs-layout'>{</span> <span class='hs-varid'>nt_co</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>co</span><span class='hs-layout'>,</span>
<a name="line-88"></a>                                                       <span class='hs-varid'>nt_rhs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>rhs</span> <span class='hs-layout'>}</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-89"></a>                           <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-varid'>tvs</span><span class='hs-layout'>,</span> <span class='hs-varid'>rhs</span><span class='hs-layout'>,</span> <span class='hs-varid'>co</span><span class='hs-layout'>)</span>
<a name="line-90"></a><span class='hs-definition'>unwrapNewTyCon_maybe</span> <span class='hs-keyword'>_</span>     <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-91"></a>
<a name="line-92"></a><a name="isProductTyCon"></a><span class='hs-definition'>isProductTyCon</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-93"></a><span class='hs-comment'>-- True of datatypes or newtypes that have</span>
<a name="line-94"></a><span class='hs-comment'>--   one, vanilla, data constructor</span>
<a name="line-95"></a><span class='hs-definition'>isProductTyCon</span> <span class='hs-varid'>tc</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-conid'>AlgTyCon</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>algTcRhs</span> <span class='hs-varid'>tc</span> <span class='hs-keyword'>of</span>
<a name="line-96"></a>                                    <span class='hs-conid'>DataTyCon</span><span class='hs-layout'>{</span> <span class='hs-varid'>data_cons</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>data_con</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>}</span>
<a name="line-97"></a>                                                <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>isVanillaDataCon</span> <span class='hs-varid'>data_con</span>
<a name="line-98"></a>                                    <span class='hs-conid'>NewTyCon</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>True</span>
<a name="line-99"></a>                                    <span class='hs-keyword'>_</span>           <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>False</span>
<a name="line-100"></a><span class='hs-definition'>isProductTyCon</span> <span class='hs-layout'>(</span><span class='hs-conid'>TupleTyCon</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-101"></a><span class='hs-definition'>isProductTyCon</span> <span class='hs-keyword'>_</span>                <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-102"></a>
<a name="line-103"></a>
<a name="line-104"></a><a name="isDataProductTyCon_maybe"></a><span class='hs-definition'>isDataProductTyCon_maybe</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>DataCon</span>
<a name="line-105"></a><span class='hs-comment'>-- True of datatypes (not newtypes) with </span>
<a name="line-106"></a><span class='hs-comment'>--   one, vanilla, data constructor</span>
<a name="line-107"></a><span class='hs-definition'>isDataProductTyCon_maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>AlgTyCon</span> <span class='hs-layout'>{</span> <span class='hs-varid'>algTcRhs</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>DataTyCon</span> <span class='hs-layout'>{</span> <span class='hs-varid'>data_cons</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>cons</span> <span class='hs-layout'>}</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-108"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>con</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>cons</span>         <span class='hs-comment'>-- Singleton</span>
<a name="line-109"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>isVanillaDataCon</span> <span class='hs-varid'>con</span>  <span class='hs-comment'>-- Vanilla</span>
<a name="line-110"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>con</span>
<a name="line-111"></a><span class='hs-definition'>isDataProductTyCon_maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>TupleTyCon</span> <span class='hs-layout'>{</span> <span class='hs-varid'>dataCon</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>con</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-112"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>con</span>
<a name="line-113"></a><span class='hs-definition'>isDataProductTyCon_maybe</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-114"></a>
<a name="line-115"></a><a name="isTypeSynonymTyCon"></a><span class='hs-comment'>-- | Is this a 'TyCon' representing a regular H98 type synonym (@type@)?</span>
<a name="line-116"></a><span class='hs-definition'>isTypeSynonymTyCon</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-117"></a><span class='hs-definition'>isTypeSynonymTyCon</span> <span class='hs-layout'>(</span><span class='hs-conid'>SynTyCon</span> <span class='hs-layout'>{</span> <span class='hs-varid'>synTcRhs</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>SynonymTyCon</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-118"></a><span class='hs-definition'>isTypeSynonymTyCon</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-119"></a>
<a name="line-120"></a><a name="isSynTyCon"></a><span class='hs-comment'>-- | Is this 'TyCon' a type synonym or type family?</span>
<a name="line-121"></a><span class='hs-definition'>isSynTyCon</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-122"></a><span class='hs-definition'>isSynTyCon</span> <span class='hs-layout'>(</span><span class='hs-conid'>SynTyCon</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-123"></a><span class='hs-definition'>isSynTyCon</span> <span class='hs-keyword'>_</span>             <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-124"></a>
<a name="line-125"></a>
<a name="line-126"></a><span class='hs-comment'>-- As for newtypes, it is in some contexts important to distinguish between</span>
<a name="line-127"></a><span class='hs-comment'>-- closed synonyms and synonym families, as synonym families have no unique</span>
<a name="line-128"></a><span class='hs-comment'>-- right hand side to which a synonym family application can expand.</span>
<a name="line-129"></a><span class='hs-comment'>--</span>
<a name="line-130"></a>
<a name="line-131"></a><a name="isDecomposableTyCon"></a><span class='hs-definition'>isDecomposableTyCon</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-132"></a><span class='hs-comment'>-- True iff we can decompose (T a b c) into ((T a b) c)</span>
<a name="line-133"></a><span class='hs-comment'>--   I.e. is it injective?</span>
<a name="line-134"></a><span class='hs-comment'>-- Specifically NOT true of synonyms (open and otherwise)</span>
<a name="line-135"></a><span class='hs-comment'>-- Ultimately we may have injective associated types</span>
<a name="line-136"></a><span class='hs-comment'>-- in which case this test will become more interesting</span>
<a name="line-137"></a><span class='hs-comment'>--</span>
<a name="line-138"></a><span class='hs-comment'>-- It'd be unusual to call isInjectiveTyCon on a regular H98</span>
<a name="line-139"></a><span class='hs-comment'>-- type synonym, because you should probably have expanded it first</span>
<a name="line-140"></a><span class='hs-comment'>-- But regardless, it's not decomposable</span>
<a name="line-141"></a><span class='hs-definition'>isDecomposableTyCon</span> <span class='hs-layout'>(</span><span class='hs-conid'>SynTyCon</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-142"></a><span class='hs-definition'>isDecomposableTyCon</span> <span class='hs-sel'>_other</span>        <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-143"></a>
<a name="line-144"></a><a name="isGadtSyntaxTyCon"></a><span class='hs-comment'>-- | Is this an algebraic 'TyCon' declared with the GADT syntax?</span>
<a name="line-145"></a><span class='hs-definition'>isGadtSyntaxTyCon</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-146"></a><span class='hs-definition'>isGadtSyntaxTyCon</span> <span class='hs-layout'>(</span><span class='hs-conid'>AlgTyCon</span> <span class='hs-layout'>{</span> <span class='hs-varid'>algTcGadtSyntax</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>res</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>res</span>
<a name="line-147"></a><span class='hs-definition'>isGadtSyntaxTyCon</span> <span class='hs-keyword'>_</span>                                    <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-148"></a>
<a name="line-149"></a><a name="isEnumerationTyCon"></a><span class='hs-comment'>-- | Is this an algebraic 'TyCon' which is just an enumeration of values?</span>
<a name="line-150"></a><span class='hs-definition'>isEnumerationTyCon</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-151"></a><span class='hs-comment'>-- See Note [Enumeration types] in TyCon</span>
<a name="line-152"></a><span class='hs-definition'>isEnumerationTyCon</span> <span class='hs-layout'>(</span><span class='hs-conid'>AlgTyCon</span> <span class='hs-layout'>{</span><span class='hs-varid'>algTcRhs</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>DataTyCon</span> <span class='hs-layout'>{</span> <span class='hs-varid'>is_enum</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>res</span> <span class='hs-layout'>}</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>res</span>
<a name="line-153"></a><span class='hs-definition'>isEnumerationTyCon</span> <span class='hs-layout'>(</span><span class='hs-conid'>TupleTyCon</span> <span class='hs-layout'>{</span><span class='hs-varid'>tyConArity</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>arity</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>arity</span> <span class='hs-varop'>==</span> <span class='hs-num'>0</span>
<a name="line-154"></a><span class='hs-definition'>isEnumerationTyCon</span> <span class='hs-keyword'>_</span>                                                   <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-155"></a>
<a name="line-156"></a><a name="isFamilyTyCon"></a><span class='hs-comment'>-- | Is this a 'TyCon', synonym or otherwise, that defines a family?</span>
<a name="line-157"></a><span class='hs-definition'>isFamilyTyCon</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-158"></a><span class='hs-definition'>isFamilyTyCon</span> <span class='hs-layout'>(</span><span class='hs-conid'>SynTyCon</span> <span class='hs-layout'>{</span><span class='hs-varid'>synTcRhs</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>OpenSynFamilyTyCon</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span>              <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-159"></a><span class='hs-definition'>isFamilyTyCon</span> <span class='hs-layout'>(</span><span class='hs-conid'>SynTyCon</span> <span class='hs-layout'>{</span><span class='hs-varid'>synTcRhs</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ClosedSynFamilyTyCon</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span>         <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-160"></a><span class='hs-definition'>isFamilyTyCon</span> <span class='hs-layout'>(</span><span class='hs-conid'>SynTyCon</span> <span class='hs-layout'>{</span><span class='hs-varid'>synTcRhs</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AbstractClosedSynFamilyTyCon</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-161"></a><span class='hs-definition'>isFamilyTyCon</span> <span class='hs-layout'>(</span><span class='hs-conid'>SynTyCon</span> <span class='hs-layout'>{</span><span class='hs-varid'>synTcRhs</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>BuiltInSynFamTyCon</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span>           <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-162"></a><span class='hs-definition'>isFamilyTyCon</span> <span class='hs-layout'>(</span><span class='hs-conid'>AlgTyCon</span> <span class='hs-layout'>{</span><span class='hs-varid'>algTcRhs</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>DataFamilyTyCon</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>               <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-163"></a><span class='hs-definition'>isFamilyTyCon</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-164"></a>
<a name="line-165"></a><a name="isOpenFamilyTyCon"></a><span class='hs-comment'>-- | Is this a 'TyCon', synonym or otherwise, that defines an family with</span>
<a name="line-166"></a><span class='hs-comment'>-- instances?</span>
<a name="line-167"></a><span class='hs-definition'>isOpenFamilyTyCon</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-168"></a><span class='hs-definition'>isOpenFamilyTyCon</span> <span class='hs-layout'>(</span><span class='hs-conid'>SynTyCon</span> <span class='hs-layout'>{</span><span class='hs-varid'>synTcRhs</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>OpenSynFamilyTyCon</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-169"></a><span class='hs-definition'>isOpenFamilyTyCon</span> <span class='hs-layout'>(</span><span class='hs-conid'>AlgTyCon</span> <span class='hs-layout'>{</span><span class='hs-varid'>algTcRhs</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>DataFamilyTyCon</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span>    <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-170"></a><span class='hs-definition'>isOpenFamilyTyCon</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-171"></a>
<a name="line-172"></a><a name="isSynFamilyTyCon"></a><span class='hs-comment'>-- | Is this a synonym 'TyCon' that can have may have further instances appear?</span>
<a name="line-173"></a><span class='hs-definition'>isSynFamilyTyCon</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-174"></a><span class='hs-definition'>isSynFamilyTyCon</span> <span class='hs-layout'>(</span><span class='hs-conid'>SynTyCon</span> <span class='hs-layout'>{</span><span class='hs-varid'>synTcRhs</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>OpenSynFamilyTyCon</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>           <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-175"></a><span class='hs-definition'>isSynFamilyTyCon</span> <span class='hs-layout'>(</span><span class='hs-conid'>SynTyCon</span> <span class='hs-layout'>{</span><span class='hs-varid'>synTcRhs</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ClosedSynFamilyTyCon</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>         <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-176"></a><span class='hs-definition'>isSynFamilyTyCon</span> <span class='hs-layout'>(</span><span class='hs-conid'>SynTyCon</span> <span class='hs-layout'>{</span><span class='hs-varid'>synTcRhs</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AbstractClosedSynFamilyTyCon</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-177"></a><span class='hs-definition'>isSynFamilyTyCon</span> <span class='hs-layout'>(</span><span class='hs-conid'>SynTyCon</span> <span class='hs-layout'>{</span><span class='hs-varid'>synTcRhs</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>BuiltInSynFamTyCon</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>           <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-178"></a><span class='hs-definition'>isSynFamilyTyCon</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-179"></a>
<a name="line-180"></a><a name="isOpenSynFamilyTyCon"></a><span class='hs-definition'>isOpenSynFamilyTyCon</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-181"></a><span class='hs-definition'>isOpenSynFamilyTyCon</span> <span class='hs-layout'>(</span><span class='hs-conid'>SynTyCon</span> <span class='hs-layout'>{</span><span class='hs-varid'>synTcRhs</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>OpenSynFamilyTyCon</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-182"></a><span class='hs-definition'>isOpenSynFamilyTyCon</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-183"></a>
<a name="line-184"></a><a name="isClosedSynFamilyTyCon_maybe"></a><span class='hs-comment'>-- leave out abstract closed families here</span>
<a name="line-185"></a><span class='hs-definition'>isClosedSynFamilyTyCon_maybe</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>CoAxiom</span> <span class='hs-conid'>Branched</span><span class='hs-layout'>)</span>
<a name="line-186"></a><span class='hs-definition'>isClosedSynFamilyTyCon_maybe</span>
<a name="line-187"></a>  <span class='hs-layout'>(</span><span class='hs-conid'>SynTyCon</span> <span class='hs-layout'>{</span><span class='hs-varid'>synTcRhs</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ClosedSynFamilyTyCon</span> <span class='hs-varid'>ax</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>ax</span>
<a name="line-188"></a><span class='hs-definition'>isClosedSynFamilyTyCon_maybe</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-189"></a>
<a name="line-190"></a><a name="isBuiltInSynFamTyCon_maybe"></a><span class='hs-definition'>isBuiltInSynFamTyCon_maybe</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>BuiltInSynFamily</span>
<a name="line-191"></a><span class='hs-definition'>isBuiltInSynFamTyCon_maybe</span>
<a name="line-192"></a>  <span class='hs-conid'>SynTyCon</span> <span class='hs-layout'>{</span><span class='hs-varid'>synTcRhs</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>BuiltInSynFamTyCon</span> <span class='hs-varid'>ops</span> <span class='hs-layout'>}</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>ops</span>
<a name="line-193"></a><span class='hs-definition'>isBuiltInSynFamTyCon_maybe</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-194"></a>
<a name="line-195"></a><a name="isDataFamilyTyCon"></a><span class='hs-comment'>-- | Is this a synonym 'TyCon' that can have may have further instances appear?</span>
<a name="line-196"></a><span class='hs-definition'>isDataFamilyTyCon</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-197"></a><span class='hs-definition'>isDataFamilyTyCon</span> <span class='hs-layout'>(</span><span class='hs-conid'>AlgTyCon</span> <span class='hs-layout'>{</span><span class='hs-varid'>algTcRhs</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>DataFamilyTyCon</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-198"></a><span class='hs-definition'>isDataFamilyTyCon</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-199"></a>
<a name="line-200"></a><a name="isTyConAssoc"></a><span class='hs-comment'>-- | Are we able to extract informationa 'TyVar' to class argument list</span>
<a name="line-201"></a><span class='hs-comment'>-- mappping from a given 'TyCon'?</span>
<a name="line-202"></a><span class='hs-definition'>isTyConAssoc</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-203"></a><span class='hs-definition'>isTyConAssoc</span> <span class='hs-varid'>tc</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>isJust</span> <span class='hs-layout'>(</span><span class='hs-varid'>tyConAssoc_maybe</span> <span class='hs-varid'>tc</span><span class='hs-layout'>)</span>
<a name="line-204"></a>
<a name="line-205"></a><a name="tyConAssoc_maybe"></a><span class='hs-definition'>tyConAssoc_maybe</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>Class</span>
<a name="line-206"></a><span class='hs-definition'>tyConAssoc_maybe</span> <span class='hs-varid'>tc</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>tyConParent</span> <span class='hs-varid'>tc</span> <span class='hs-keyword'>of</span>
<a name="line-207"></a>                        <span class='hs-conid'>AssocFamilyTyCon</span> <span class='hs-varid'>cls</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>cls</span>
<a name="line-208"></a>                        <span class='hs-keyword'>_</span>                    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Nothing</span>
<a name="line-209"></a>
<a name="line-210"></a><a name="isTupleTyCon"></a><span class='hs-comment'>-- The unit tycon didn't used to be classed as a tuple tycon</span>
<a name="line-211"></a><span class='hs-comment'>-- but I thought that was silly so I've undone it</span>
<a name="line-212"></a><span class='hs-comment'>-- If it can't be for some reason, it should be a AlgTyCon</span>
<a name="line-213"></a><span class='hs-definition'>isTupleTyCon</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-214"></a><span class='hs-comment'>-- ^ Does this 'TyCon' represent a tuple?</span>
<a name="line-215"></a><span class='hs-comment'>--</span>
<a name="line-216"></a><span class='hs-comment'>-- NB: when compiling @Data.Tuple@, the tycons won't reply @True@ to</span>
<a name="line-217"></a><span class='hs-comment'>-- 'isTupleTyCon', because they are built as 'AlgTyCons'.  However they</span>
<a name="line-218"></a><span class='hs-comment'>-- get spat into the interface file as tuple tycons, so I don't think</span>
<a name="line-219"></a><span class='hs-comment'>-- it matters.</span>
<a name="line-220"></a><span class='hs-definition'>isTupleTyCon</span> <span class='hs-layout'>(</span><span class='hs-conid'>TupleTyCon</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-221"></a><span class='hs-definition'>isTupleTyCon</span> <span class='hs-keyword'>_</span>               <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-222"></a>
<a name="line-223"></a><a name="isUnboxedTupleTyCon"></a><span class='hs-comment'>-- | Is this the 'TyCon' for an unboxed tuple?</span>
<a name="line-224"></a><span class='hs-definition'>isUnboxedTupleTyCon</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-225"></a><span class='hs-definition'>isUnboxedTupleTyCon</span> <span class='hs-layout'>(</span><span class='hs-conid'>TupleTyCon</span> <span class='hs-layout'>{</span><span class='hs-varid'>tyConTupleSort</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sort</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>not</span> <span class='hs-layout'>(</span><span class='hs-varid'>isBoxed</span> <span class='hs-layout'>(</span><span class='hs-varid'>tupleSortBoxity</span> <span class='hs-varid'>sort</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-226"></a><span class='hs-definition'>isUnboxedTupleTyCon</span> <span class='hs-keyword'>_</span>                                    <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-227"></a>
<a name="line-228"></a><a name="isBoxedTupleTyCon"></a><span class='hs-comment'>-- | Is this the 'TyCon' for a boxed tuple?</span>
<a name="line-229"></a><span class='hs-definition'>isBoxedTupleTyCon</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-230"></a><span class='hs-definition'>isBoxedTupleTyCon</span> <span class='hs-layout'>(</span><span class='hs-conid'>TupleTyCon</span> <span class='hs-layout'>{</span><span class='hs-varid'>tyConTupleSort</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sort</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>isBoxed</span> <span class='hs-layout'>(</span><span class='hs-varid'>tupleSortBoxity</span> <span class='hs-varid'>sort</span><span class='hs-layout'>)</span>
<a name="line-231"></a><span class='hs-definition'>isBoxedTupleTyCon</span> <span class='hs-keyword'>_</span>                                    <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-232"></a>
<a name="line-233"></a><a name="tupleTyConBoxity"></a><span class='hs-comment'>-- | Extract the boxity of the given 'TyCon', if it is a 'TupleTyCon'.</span>
<a name="line-234"></a><span class='hs-comment'>-- Panics otherwise</span>
<a name="line-235"></a><span class='hs-definition'>tupleTyConBoxity</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Boxity</span>
<a name="line-236"></a><span class='hs-definition'>tupleTyConBoxity</span> <span class='hs-varid'>tc</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tupleSortBoxity</span> <span class='hs-layout'>(</span><span class='hs-varid'>tyConTupleSort</span> <span class='hs-varid'>tc</span><span class='hs-layout'>)</span>
<a name="line-237"></a>
<a name="line-238"></a><a name="tupleTyConSort"></a><span class='hs-comment'>-- | Extract the 'TupleSort' of the given 'TyCon', if it is a 'TupleTyCon'.</span>
<a name="line-239"></a><span class='hs-comment'>-- Panics otherwise</span>
<a name="line-240"></a><span class='hs-definition'>tupleTyConSort</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TupleSort</span>
<a name="line-241"></a><span class='hs-definition'>tupleTyConSort</span> <span class='hs-varid'>tc</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tyConTupleSort</span> <span class='hs-varid'>tc</span>
<a name="line-242"></a>
<a name="line-243"></a><a name="tupleTyConArity"></a><span class='hs-comment'>-- | Extract the arity of the given 'TyCon', if it is a 'TupleTyCon'.</span>
<a name="line-244"></a><span class='hs-comment'>-- Panics otherwise</span>
<a name="line-245"></a><span class='hs-definition'>tupleTyConArity</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Arity</span>
<a name="line-246"></a><span class='hs-definition'>tupleTyConArity</span> <span class='hs-varid'>tc</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tyConArity</span> <span class='hs-varid'>tc</span>
<a name="line-247"></a>
<a name="line-248"></a><a name="isRecursiveTyCon"></a><span class='hs-comment'>-- | Is this a recursive 'TyCon'?</span>
<a name="line-249"></a><span class='hs-definition'>isRecursiveTyCon</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-250"></a><span class='hs-definition'>isRecursiveTyCon</span> <span class='hs-layout'>(</span><span class='hs-conid'>AlgTyCon</span> <span class='hs-layout'>{</span><span class='hs-varid'>algTcRec</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Recursive</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-251"></a><span class='hs-definition'>isRecursiveTyCon</span> <span class='hs-keyword'>_</span>                                 <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-252"></a>
<a name="line-253"></a><a name="promotableTyCon_maybe"></a><span class='hs-definition'>promotableTyCon_maybe</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>TyCon</span>
<a name="line-254"></a><span class='hs-definition'>promotableTyCon_maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>AlgTyCon</span> <span class='hs-layout'>{</span> <span class='hs-varid'>tcPromoted</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>prom</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>prom</span>
<a name="line-255"></a><span class='hs-definition'>promotableTyCon_maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>TupleTyCon</span> <span class='hs-layout'>{</span> <span class='hs-varid'>tcPromoted</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>prom</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>prom</span>
<a name="line-256"></a><span class='hs-definition'>promotableTyCon_maybe</span> <span class='hs-keyword'>_</span>                                  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-257"></a>
<a name="line-258"></a><a name="promoteTyCon"></a><span class='hs-definition'>promoteTyCon</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TyCon</span>
<a name="line-259"></a><span class='hs-definition'>promoteTyCon</span> <span class='hs-varid'>tc</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>promotableTyCon_maybe</span> <span class='hs-varid'>tc</span> <span class='hs-keyword'>of</span>
<a name="line-260"></a>                    <span class='hs-conid'>Just</span> <span class='hs-varid'>prom_tc</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>prom_tc</span>
<a name="line-261"></a>                    <span class='hs-conid'>Nothing</span>      <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>pprPanic</span> <span class='hs-str'>"promoteTyCon"</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>tc</span><span class='hs-layout'>)</span>
<a name="line-262"></a>
<a name="line-263"></a><a name="isForeignTyCon"></a><span class='hs-comment'>-- | Is this the 'TyCon' of a foreign-imported type constructor?</span>
<a name="line-264"></a><span class='hs-definition'>isForeignTyCon</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-265"></a><span class='hs-definition'>isForeignTyCon</span> <span class='hs-layout'>(</span><span class='hs-conid'>PrimTyCon</span> <span class='hs-layout'>{</span><span class='hs-varid'>tyConExtName</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-keyword'>_</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-266"></a><span class='hs-definition'>isForeignTyCon</span> <span class='hs-keyword'>_</span>                                   <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-267"></a>
<a name="line-268"></a><a name="isPromotedTyCon"></a><span class='hs-comment'>-- | Is this a PromotedTyCon?</span>
<a name="line-269"></a><span class='hs-definition'>isPromotedTyCon</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-270"></a><span class='hs-definition'>isPromotedTyCon</span> <span class='hs-layout'>(</span><span class='hs-conid'>PromotedTyCon</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-271"></a><span class='hs-definition'>isPromotedTyCon</span> <span class='hs-keyword'>_</span>                  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-272"></a>
<a name="line-273"></a><a name="isPromotedTyCon_maybe"></a><span class='hs-comment'>-- | Retrieves the promoted TyCon if this is a PromotedTyCon;</span>
<a name="line-274"></a><span class='hs-definition'>isPromotedTyCon_maybe</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>TyCon</span>
<a name="line-275"></a><span class='hs-definition'>isPromotedTyCon_maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>PromotedTyCon</span> <span class='hs-layout'>{</span> <span class='hs-varid'>ty_con</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tc</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>tc</span>
<a name="line-276"></a><span class='hs-definition'>isPromotedTyCon_maybe</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-277"></a>
<a name="line-278"></a><a name="isPromotedDataCon"></a><span class='hs-comment'>-- | Is this a PromotedDataCon?</span>
<a name="line-279"></a><span class='hs-definition'>isPromotedDataCon</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-280"></a><span class='hs-definition'>isPromotedDataCon</span> <span class='hs-layout'>(</span><span class='hs-conid'>PromotedDataCon</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-281"></a><span class='hs-definition'>isPromotedDataCon</span> <span class='hs-keyword'>_</span>                    <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-282"></a>
<a name="line-283"></a><a name="isPromotedDataCon_maybe"></a><span class='hs-comment'>-- | Retrieves the promoted DataCon if this is a PromotedDataCon;</span>
<a name="line-284"></a><span class='hs-definition'>isPromotedDataCon_maybe</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>DataCon</span>
<a name="line-285"></a><span class='hs-definition'>isPromotedDataCon_maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>PromotedDataCon</span> <span class='hs-layout'>{</span> <span class='hs-varid'>dataCon</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>dc</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>dc</span>
<a name="line-286"></a><span class='hs-definition'>isPromotedDataCon_maybe</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-287"></a>
<a name="line-288"></a><a name="isImplicitTyCon"></a><span class='hs-comment'>-- | Identifies implicit tycons that, in particular, do not go into interface</span>
<a name="line-289"></a><span class='hs-comment'>-- files (because they are implicitly reconstructed when the interface is</span>
<a name="line-290"></a><span class='hs-comment'>-- read).</span>
<a name="line-291"></a><span class='hs-comment'>--</span>
<a name="line-292"></a><span class='hs-comment'>-- Note that:</span>
<a name="line-293"></a><span class='hs-comment'>--</span>
<a name="line-294"></a><span class='hs-comment'>-- * Associated families are implicit, as they are re-constructed from</span>
<a name="line-295"></a><span class='hs-comment'>--   the class declaration in which they reside, and</span>
<a name="line-296"></a><span class='hs-comment'>--</span>
<a name="line-297"></a><span class='hs-comment'>-- * Family instances are /not/ implicit as they represent the instance body</span>
<a name="line-298"></a><span class='hs-comment'>--   (similar to a @dfun@ does that for a class instance).</span>
<a name="line-299"></a><span class='hs-definition'>isImplicitTyCon</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-300"></a><span class='hs-definition'>isImplicitTyCon</span> <span class='hs-layout'>(</span><span class='hs-conid'>FunTyCon</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>        <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-301"></a><span class='hs-definition'>isImplicitTyCon</span> <span class='hs-layout'>(</span><span class='hs-conid'>TupleTyCon</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>      <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-302"></a><span class='hs-definition'>isImplicitTyCon</span> <span class='hs-layout'>(</span><span class='hs-conid'>PrimTyCon</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>       <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-303"></a><span class='hs-definition'>isImplicitTyCon</span> <span class='hs-layout'>(</span><span class='hs-conid'>PromotedDataCon</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-304"></a><span class='hs-definition'>isImplicitTyCon</span> <span class='hs-layout'>(</span><span class='hs-conid'>PromotedTyCon</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-305"></a><span class='hs-definition'>isImplicitTyCon</span> <span class='hs-layout'>(</span><span class='hs-conid'>AlgTyCon</span> <span class='hs-layout'>{</span> <span class='hs-varid'>algTcParent</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AssocFamilyTyCon</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-306"></a><span class='hs-definition'>isImplicitTyCon</span> <span class='hs-layout'>(</span><span class='hs-conid'>AlgTyCon</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>                                    <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-307"></a><span class='hs-definition'>isImplicitTyCon</span> <span class='hs-layout'>(</span><span class='hs-conid'>SynTyCon</span> <span class='hs-layout'>{</span> <span class='hs-varid'>synTcParent</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AssocFamilyTyCon</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-308"></a><span class='hs-definition'>isImplicitTyCon</span> <span class='hs-layout'>(</span><span class='hs-conid'>SynTyCon</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>                                    <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-309"></a>
<a name="line-310"></a><a name="tyConCType_maybe"></a><span class='hs-definition'>tyConCType_maybe</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>CType</span>
<a name="line-311"></a><span class='hs-definition'>tyConCType_maybe</span> <span class='hs-varid'>tc</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-conid'>AlgTyCon</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tyConCType</span> <span class='hs-varid'>tc</span>
<a name="line-312"></a><span class='hs-definition'>tyConCType_maybe</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
</pre>\end{code}


-----------------------------------------------
--      Expand type-constructor applications
-----------------------------------------------

\begin{code}
<pre><a name="line-1"></a><a name="tcExpandTyCon_maybe"></a><span class='hs-definition'>tcExpandTyCon_maybe</span><span class='hs-layout'>,</span> <span class='hs-varid'>coreExpandTyCon_maybe</span>
<a name="line-2"></a>        <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span>
<a name="line-3"></a>        <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>tyco</span><span class='hs-keyglyph'>]</span>                 <span class='hs-comment'>-- ^ Arguments to 'TyCon'</span>
<a name="line-4"></a>        <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>[</span><span class='hs-layout'>(</span><span class='hs-conid'>TyVar</span><span class='hs-layout'>,</span><span class='hs-varid'>tyco</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span>
<a name="line-5"></a>                  <span class='hs-conid'>Type</span><span class='hs-layout'>,</span>
<a name="line-6"></a>                  <span class='hs-keyglyph'>[</span><span class='hs-varid'>tyco</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>         <span class='hs-comment'>-- ^ Returns a 'TyVar' substitution, the body type</span>
<a name="line-7"></a>                                  <span class='hs-comment'>-- of the synonym (not yet substituted) and any arguments</span>
<a name="line-8"></a>                                  <span class='hs-comment'>-- remaining from the application</span>
<a name="line-9"></a>
<a name="line-10"></a><span class='hs-comment'>-- ^ Used to create the view the /typechecker/ has on 'TyCon's.</span>
<a name="line-11"></a><span class='hs-comment'>-- We expand (closed) synonyms only, cf. 'coreExpandTyCon_maybe'</span>
<a name="line-12"></a><span class='hs-definition'>tcExpandTyCon_maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>SynTyCon</span> <span class='hs-layout'>{</span><span class='hs-varid'>tyConTyVars</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tvs</span><span class='hs-layout'>,</span>
<a name="line-13"></a>                               <span class='hs-varid'>synTcRhs</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>SynonymTyCon</span> <span class='hs-varid'>rhs</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-varid'>tys</span>
<a name="line-14"></a>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>expand</span> <span class='hs-varid'>tvs</span> <span class='hs-varid'>rhs</span> <span class='hs-varid'>tys</span>
<a name="line-15"></a><span class='hs-definition'>tcExpandTyCon_maybe</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-16"></a>
<a name="line-17"></a><span class='hs-comment'>---------------</span>
<a name="line-18"></a>
<a name="line-19"></a><a name="coreExpandTyCon_maybe"></a><span class='hs-comment'>-- ^ Used to create the view /Core/ has on 'TyCon's. We expand</span>
<a name="line-20"></a><span class='hs-comment'>-- not only closed synonyms like 'tcExpandTyCon_maybe',</span>
<a name="line-21"></a><span class='hs-comment'>-- but also non-recursive @newtype@s</span>
<a name="line-22"></a><span class='hs-definition'>coreExpandTyCon_maybe</span> <span class='hs-varid'>tycon</span> <span class='hs-varid'>tys</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tcExpandTyCon_maybe</span> <span class='hs-varid'>tycon</span> <span class='hs-varid'>tys</span>
<a name="line-23"></a>
<a name="line-24"></a>
<a name="line-25"></a><a name="expand"></a><span class='hs-comment'>----------------</span>
<a name="line-26"></a><span class='hs-definition'>expand</span>  <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>TyVar</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Type</span>                 <span class='hs-comment'>-- Template</span>
<a name="line-27"></a>        <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span>                             <span class='hs-comment'>-- Args</span>
<a name="line-28"></a>        <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>[</span><span class='hs-layout'>(</span><span class='hs-conid'>TyVar</span><span class='hs-layout'>,</span><span class='hs-varid'>a</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span> <span class='hs-conid'>Type</span><span class='hs-layout'>,</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>  <span class='hs-comment'>-- Expansion</span>
<a name="line-29"></a><span class='hs-definition'>expand</span> <span class='hs-varid'>tvs</span> <span class='hs-varid'>rhs</span> <span class='hs-varid'>tys</span>
<a name="line-30"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>n_tvs</span> <span class='hs-varop'>`compare`</span> <span class='hs-varid'>length</span> <span class='hs-varid'>tys</span> <span class='hs-keyword'>of</span>
<a name="line-31"></a>        <span class='hs-conid'>LT</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-varid'>tvs</span> <span class='hs-varop'>`zip`</span> <span class='hs-varid'>tys</span><span class='hs-layout'>,</span> <span class='hs-varid'>rhs</span><span class='hs-layout'>,</span> <span class='hs-varid'>drop</span> <span class='hs-varid'>n_tvs</span> <span class='hs-varid'>tys</span><span class='hs-layout'>)</span>
<a name="line-32"></a>        <span class='hs-conid'>EQ</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-varid'>tvs</span> <span class='hs-varop'>`zip`</span> <span class='hs-varid'>tys</span><span class='hs-layout'>,</span> <span class='hs-varid'>rhs</span><span class='hs-layout'>,</span> <span class='hs-conid'>[]</span><span class='hs-layout'>)</span>
<a name="line-33"></a>        <span class='hs-conid'>GT</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Nothing</span>
<a name="line-34"></a>   <span class='hs-keyword'>where</span>
<a name="line-35"></a>     <span class='hs-varid'>n_tvs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>length</span> <span class='hs-varid'>tvs</span>
</pre>\end{code}

\begin{code}
<pre><a name="line-1"></a><a name="tyConKind"></a><span class='hs-definition'>tyConKind</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Kind</span>
<a name="line-2"></a><span class='hs-definition'>tyConKind</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tc_kind</span>
<a name="line-3"></a>
<a name="line-4"></a><a name="tyConDataCons"></a><span class='hs-comment'>-- | As 'tyConDataCons_maybe', but returns the empty list of constructors if no constructors</span>
<a name="line-5"></a><span class='hs-comment'>-- could be found</span>
<a name="line-6"></a><span class='hs-definition'>tyConDataCons</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>DataCon</span><span class='hs-keyglyph'>]</span>
<a name="line-7"></a><span class='hs-comment'>-- It's convenient for tyConDataCons to return the</span>
<a name="line-8"></a><span class='hs-comment'>-- empty list for type synonyms etc</span>
<a name="line-9"></a><span class='hs-definition'>tyConDataCons</span> <span class='hs-varid'>tycon</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tyConDataCons_maybe</span> <span class='hs-varid'>tycon</span> <span class='hs-varop'>`orElse`</span> <span class='hs-conid'>[]</span>
<a name="line-10"></a>
<a name="line-11"></a><a name="tyConDataCons_maybe"></a><span class='hs-comment'>-- | Determine the 'DataCon's originating from the given 'TyCon', if the 'TyCon' is the</span>
<a name="line-12"></a><span class='hs-comment'>-- sort that can have any constructors (note: this does not include abstract algebraic types)</span>
<a name="line-13"></a><span class='hs-definition'>tyConDataCons_maybe</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>DataCon</span><span class='hs-keyglyph'>]</span>
<a name="line-14"></a><span class='hs-definition'>tyConDataCons_maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>AlgTyCon</span> <span class='hs-layout'>{</span><span class='hs-varid'>algTcRhs</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>DataTyCon</span> <span class='hs-layout'>{</span> <span class='hs-varid'>data_cons</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>cons</span> <span class='hs-layout'>}</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>cons</span>
<a name="line-15"></a><span class='hs-definition'>tyConDataCons_maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>AlgTyCon</span> <span class='hs-layout'>{</span><span class='hs-varid'>algTcRhs</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>NewTyCon</span> <span class='hs-layout'>{</span> <span class='hs-varid'>data_con</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>con</span> <span class='hs-layout'>}</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>    <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>con</span><span class='hs-keyglyph'>]</span>
<a name="line-16"></a><span class='hs-definition'>tyConDataCons_maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>TupleTyCon</span> <span class='hs-layout'>{</span><span class='hs-varid'>dataCon</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>con</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>                           <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>con</span><span class='hs-keyglyph'>]</span>
<a name="line-17"></a><span class='hs-definition'>tyConDataCons_maybe</span> <span class='hs-keyword'>_</span>                                                      <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-18"></a>
<a name="line-19"></a><a name="tyConFamilySize"></a><span class='hs-comment'>-- | Determine the number of value constructors a 'TyCon' has. Panics if the 'TyCon'</span>
<a name="line-20"></a><span class='hs-comment'>-- is not algebraic or a tuple</span>
<a name="line-21"></a><span class='hs-definition'>tyConFamilySize</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span>
<a name="line-22"></a><span class='hs-definition'>tyConFamilySize</span> <span class='hs-layout'>(</span><span class='hs-conid'>AlgTyCon</span>   <span class='hs-layout'>{</span><span class='hs-varid'>algTcRhs</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>DataTyCon</span> <span class='hs-layout'>{</span><span class='hs-varid'>data_cons</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>cons</span><span class='hs-layout'>}</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-23"></a>  <span class='hs-varid'>length</span> <span class='hs-varid'>cons</span>
<a name="line-24"></a><span class='hs-definition'>tyConFamilySize</span> <span class='hs-layout'>(</span><span class='hs-conid'>AlgTyCon</span>   <span class='hs-layout'>{</span><span class='hs-varid'>algTcRhs</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>NewTyCon</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>        <span class='hs-keyglyph'>=</span> <span class='hs-num'>1</span>
<a name="line-25"></a><span class='hs-definition'>tyConFamilySize</span> <span class='hs-layout'>(</span><span class='hs-conid'>AlgTyCon</span>   <span class='hs-layout'>{</span><span class='hs-varid'>algTcRhs</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>DataFamilyTyCon</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-num'>0</span>
<a name="line-26"></a><span class='hs-definition'>tyConFamilySize</span> <span class='hs-layout'>(</span><span class='hs-conid'>TupleTyCon</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>                              <span class='hs-keyglyph'>=</span> <span class='hs-num'>1</span>
<a name="line-27"></a><span class='hs-definition'>tyConFamilySize</span> <span class='hs-varid'>other</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprPanic</span> <span class='hs-str'>"tyConFamilySize:"</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>other</span><span class='hs-layout'>)</span>
<a name="line-28"></a>
<a name="line-29"></a><a name="algTyConRhs"></a><span class='hs-comment'>-- | Extract an 'AlgTyConRhs' with information about data constructors from an algebraic or tuple</span>
<a name="line-30"></a><span class='hs-comment'>-- 'TyCon'. Panics for any other sort of 'TyCon'</span>
<a name="line-31"></a><span class='hs-definition'>algTyConRhs</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>AlgTyConRhs</span>
<a name="line-32"></a><span class='hs-definition'>algTyConRhs</span> <span class='hs-layout'>(</span><span class='hs-conid'>AlgTyCon</span> <span class='hs-layout'>{</span><span class='hs-varid'>algTcRhs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>rhs</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>rhs</span>
<a name="line-33"></a><span class='hs-definition'>algTyConRhs</span> <span class='hs-layout'>(</span><span class='hs-conid'>TupleTyCon</span> <span class='hs-layout'>{</span><span class='hs-varid'>dataCon</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>con</span><span class='hs-layout'>,</span> <span class='hs-varid'>tyConArity</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>arity</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-34"></a>    <span class='hs-keyglyph'>=</span> <span class='hs-conid'>DataTyCon</span> <span class='hs-layout'>{</span> <span class='hs-varid'>data_cons</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>con</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span> <span class='hs-varid'>is_enum</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>arity</span> <span class='hs-varop'>==</span> <span class='hs-num'>0</span> <span class='hs-layout'>}</span>
<a name="line-35"></a><span class='hs-definition'>algTyConRhs</span> <span class='hs-varid'>other</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprPanic</span> <span class='hs-str'>"algTyConRhs"</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>other</span><span class='hs-layout'>)</span>
<a name="line-36"></a>
<a name="line-37"></a><a name="tyConRoles"></a><span class='hs-comment'>-- | Get the list of roles for the type parameters of a TyCon</span>
<a name="line-38"></a><span class='hs-definition'>tyConRoles</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Role</span><span class='hs-keyglyph'>]</span>
<a name="line-39"></a><span class='hs-comment'>-- See also Note [TyCon Role signatures]</span>
<a name="line-40"></a><span class='hs-definition'>tyConRoles</span> <span class='hs-varid'>tc</span>
<a name="line-41"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>tc</span> <span class='hs-keyword'>of</span>
<a name="line-42"></a>    <span class='hs-layout'>{</span> <span class='hs-conid'>FunTyCon</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span>                          <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>const_role</span> <span class='hs-conid'>Representational</span>
<a name="line-43"></a>    <span class='hs-layout'>;</span> <span class='hs-conid'>AlgTyCon</span> <span class='hs-layout'>{</span> <span class='hs-varid'>tc_roles</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>roles</span> <span class='hs-layout'>}</span>        <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>roles</span>
<a name="line-44"></a>    <span class='hs-layout'>;</span> <span class='hs-conid'>TupleTyCon</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span>                        <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>const_role</span> <span class='hs-conid'>Representational</span>
<a name="line-45"></a>    <span class='hs-layout'>;</span> <span class='hs-conid'>SynTyCon</span> <span class='hs-layout'>{</span> <span class='hs-varid'>tc_roles</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>roles</span> <span class='hs-layout'>}</span>        <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>roles</span>
<a name="line-46"></a>    <span class='hs-layout'>;</span> <span class='hs-conid'>PrimTyCon</span> <span class='hs-layout'>{</span> <span class='hs-varid'>tc_roles</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>roles</span> <span class='hs-layout'>}</span>       <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>roles</span>
<a name="line-47"></a>    <span class='hs-layout'>;</span> <span class='hs-conid'>PromotedDataCon</span> <span class='hs-layout'>{</span> <span class='hs-varid'>tc_roles</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>roles</span> <span class='hs-layout'>}</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>roles</span>
<a name="line-48"></a>    <span class='hs-layout'>;</span> <span class='hs-conid'>PromotedTyCon</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span>                     <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>const_role</span> <span class='hs-conid'>Nominal</span>
<a name="line-49"></a>    <span class='hs-layout'>}</span>
<a name="line-50"></a>  <span class='hs-keyword'>where</span>
<a name="line-51"></a>    <span class='hs-varid'>const_role</span> <span class='hs-varid'>r</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>replicate</span> <span class='hs-layout'>(</span><span class='hs-varid'>tyConArity</span> <span class='hs-varid'>tc</span><span class='hs-layout'>)</span> <span class='hs-varid'>r</span>
<a name="line-52"></a>
</pre>\end{code}

\begin{code}
<pre><a name="line-1"></a><a name="newTyConRhs"></a><span class='hs-comment'>-- | Extract the bound type variables and type expansion of a type synonym 'TyCon'. Panics if the</span>
<a name="line-2"></a><span class='hs-comment'>-- 'TyCon' is not a synonym</span>
<a name="line-3"></a><span class='hs-definition'>newTyConRhs</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>[</span><span class='hs-conid'>TyVar</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span> <span class='hs-conid'>Type</span><span class='hs-layout'>)</span>
<a name="line-4"></a><span class='hs-definition'>newTyConRhs</span> <span class='hs-layout'>(</span><span class='hs-conid'>AlgTyCon</span> <span class='hs-layout'>{</span><span class='hs-varid'>tyConTyVars</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tvs</span><span class='hs-layout'>,</span> <span class='hs-varid'>algTcRhs</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>NewTyCon</span> <span class='hs-layout'>{</span> <span class='hs-varid'>nt_rhs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>rhs</span> <span class='hs-layout'>}</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>tvs</span><span class='hs-layout'>,</span> <span class='hs-varid'>rhs</span><span class='hs-layout'>)</span>
<a name="line-5"></a><span class='hs-definition'>newTyConRhs</span> <span class='hs-varid'>tycon</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprPanic</span> <span class='hs-str'>"newTyConRhs"</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>tycon</span><span class='hs-layout'>)</span>
<a name="line-6"></a>
<a name="line-7"></a><a name="newTyConEtadArity"></a><span class='hs-comment'>-- | The number of type parameters that need to be passed to a newtype to resolve it. May be less than in the definition if it can be eta-contracted.</span>
<a name="line-8"></a><span class='hs-definition'>newTyConEtadArity</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span>
<a name="line-9"></a><span class='hs-definition'>newTyConEtadArity</span> <span class='hs-layout'>(</span><span class='hs-conid'>AlgTyCon</span> <span class='hs-layout'>{</span><span class='hs-varid'>algTcRhs</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>NewTyCon</span> <span class='hs-layout'>{</span> <span class='hs-varid'>nt_etad_rhs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tvs_rhs</span> <span class='hs-layout'>}</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-10"></a>        <span class='hs-keyglyph'>=</span> <span class='hs-varid'>length</span> <span class='hs-layout'>(</span><span class='hs-varid'>fst</span> <span class='hs-varid'>tvs_rhs</span><span class='hs-layout'>)</span>
<a name="line-11"></a><span class='hs-definition'>newTyConEtadArity</span> <span class='hs-varid'>tycon</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprPanic</span> <span class='hs-str'>"newTyConEtadArity"</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>tycon</span><span class='hs-layout'>)</span>
<a name="line-12"></a>
<a name="line-13"></a><a name="newTyConEtadRhs"></a><span class='hs-comment'>-- | Extract the bound type variables and type expansion of an eta-contracted type synonym 'TyCon'.</span>
<a name="line-14"></a><span class='hs-comment'>-- Panics if the 'TyCon' is not a synonym</span>
<a name="line-15"></a><span class='hs-definition'>newTyConEtadRhs</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>[</span><span class='hs-conid'>TyVar</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span> <span class='hs-conid'>Type</span><span class='hs-layout'>)</span>
<a name="line-16"></a><span class='hs-definition'>newTyConEtadRhs</span> <span class='hs-layout'>(</span><span class='hs-conid'>AlgTyCon</span> <span class='hs-layout'>{</span><span class='hs-varid'>algTcRhs</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>NewTyCon</span> <span class='hs-layout'>{</span> <span class='hs-varid'>nt_etad_rhs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tvs_rhs</span> <span class='hs-layout'>}</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tvs_rhs</span>
<a name="line-17"></a><span class='hs-definition'>newTyConEtadRhs</span> <span class='hs-varid'>tycon</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprPanic</span> <span class='hs-str'>"newTyConEtadRhs"</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>tycon</span><span class='hs-layout'>)</span>
<a name="line-18"></a>
<a name="line-19"></a><a name="newTyConCo_maybe"></a><span class='hs-comment'>-- | Extracts the @newtype@ coercion from such a 'TyCon', which can be used to construct something</span>
<a name="line-20"></a><span class='hs-comment'>-- with the @newtype@s type from its representation type (right hand side). If the supplied 'TyCon'</span>
<a name="line-21"></a><span class='hs-comment'>-- is not a @newtype@, returns @Nothing@</span>
<a name="line-22"></a><span class='hs-definition'>newTyConCo_maybe</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>CoAxiom</span> <span class='hs-conid'>Unbranched</span><span class='hs-layout'>)</span>
<a name="line-23"></a><span class='hs-definition'>newTyConCo_maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>AlgTyCon</span> <span class='hs-layout'>{</span><span class='hs-varid'>algTcRhs</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>NewTyCon</span> <span class='hs-layout'>{</span> <span class='hs-varid'>nt_co</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>co</span> <span class='hs-layout'>}</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>co</span>
<a name="line-24"></a><span class='hs-definition'>newTyConCo_maybe</span> <span class='hs-keyword'>_</span>                                               <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-25"></a>
<a name="line-26"></a><a name="newTyConCo"></a><span class='hs-definition'>newTyConCo</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>CoAxiom</span> <span class='hs-conid'>Unbranched</span>
<a name="line-27"></a><span class='hs-definition'>newTyConCo</span> <span class='hs-varid'>tc</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>newTyConCo_maybe</span> <span class='hs-varid'>tc</span> <span class='hs-keyword'>of</span>
<a name="line-28"></a>                 <span class='hs-conid'>Just</span> <span class='hs-varid'>co</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>co</span>
<a name="line-29"></a>                 <span class='hs-conid'>Nothing</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>pprPanic</span> <span class='hs-str'>"newTyConCo"</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>tc</span><span class='hs-layout'>)</span>
<a name="line-30"></a>
<a name="line-31"></a><a name="tyConPrimRep"></a><span class='hs-comment'>-- | Find the primitive representation of a 'TyCon'</span>
<a name="line-32"></a><span class='hs-definition'>tyConPrimRep</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>PrimRep</span>
<a name="line-33"></a><span class='hs-definition'>tyConPrimRep</span> <span class='hs-layout'>(</span><span class='hs-conid'>PrimTyCon</span> <span class='hs-layout'>{</span><span class='hs-varid'>primTyConRep</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>rep</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>rep</span>
<a name="line-34"></a><span class='hs-definition'>tyConPrimRep</span> <span class='hs-varid'>tc</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ASSERT</span><span class='hs-layout'>(</span><span class='hs-varid'>not</span> <span class='hs-layout'>(</span><span class='hs-varid'>isUnboxedTupleTyCon</span> <span class='hs-varid'>tc</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-conid'>PtrRep</span>
</pre>\end{code}

\begin{code}
<pre><a name="line-1"></a><a name="tyConStupidTheta"></a><span class='hs-comment'>-- | Find the \"stupid theta\" of the 'TyCon'. A \"stupid theta\" is the context to the left of</span>
<a name="line-2"></a><span class='hs-comment'>-- an algebraic type declaration, e.g. @Eq a@ in the declaration @data Eq a =&gt; T a ...@</span>
<a name="line-3"></a><span class='hs-definition'>tyConStupidTheta</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>PredType</span><span class='hs-keyglyph'>]</span>
<a name="line-4"></a><span class='hs-definition'>tyConStupidTheta</span> <span class='hs-layout'>(</span><span class='hs-conid'>AlgTyCon</span> <span class='hs-layout'>{</span><span class='hs-varid'>algTcStupidTheta</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>stupid</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>stupid</span>
<a name="line-5"></a><span class='hs-definition'>tyConStupidTheta</span> <span class='hs-layout'>(</span><span class='hs-conid'>TupleTyCon</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>                        <span class='hs-keyglyph'>=</span> <span class='hs-conid'>[]</span>
<a name="line-6"></a><span class='hs-definition'>tyConStupidTheta</span> <span class='hs-varid'>tycon</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprPanic</span> <span class='hs-str'>"tyConStupidTheta"</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>tycon</span><span class='hs-layout'>)</span>
</pre>\end{code}

\begin{code}
<pre><a name="line-1"></a><a name="synTyConDefn_maybe"></a><span class='hs-comment'>-- | Extract the 'TyVar's bound by a vanilla type synonym (not familiy)</span>
<a name="line-2"></a><span class='hs-comment'>-- and the corresponding (unsubstituted) right hand side.</span>
<a name="line-3"></a><span class='hs-definition'>synTyConDefn_maybe</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>[</span><span class='hs-conid'>TyVar</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span> <span class='hs-conid'>Type</span><span class='hs-layout'>)</span>
<a name="line-4"></a><span class='hs-definition'>synTyConDefn_maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>SynTyCon</span> <span class='hs-layout'>{</span><span class='hs-varid'>tyConTyVars</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tyvars</span><span class='hs-layout'>,</span> <span class='hs-varid'>synTcRhs</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>SynonymTyCon</span> <span class='hs-varid'>ty</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-5"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-varid'>tyvars</span><span class='hs-layout'>,</span> <span class='hs-varid'>ty</span><span class='hs-layout'>)</span>
<a name="line-6"></a><span class='hs-definition'>synTyConDefn_maybe</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-7"></a>
<a name="line-8"></a><a name="synTyConRhs_maybe"></a><span class='hs-comment'>-- | Extract the information pertaining to the right hand side of a type synonym (@type@) declaration.</span>
<a name="line-9"></a><span class='hs-definition'>synTyConRhs_maybe</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>SynTyConRhs</span>
<a name="line-10"></a><span class='hs-definition'>synTyConRhs_maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>SynTyCon</span> <span class='hs-layout'>{</span><span class='hs-varid'>synTcRhs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>rhs</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>rhs</span>
<a name="line-11"></a><span class='hs-definition'>synTyConRhs_maybe</span> <span class='hs-keyword'>_</span>                           <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
</pre>\end{code}

\begin{code}
<pre><a name="line-1"></a><a name="tyConSingleDataCon_maybe"></a><span class='hs-comment'>-- | If the given 'TyCon' has a /single/ data constructor, i.e. it is a @data@ type with one</span>
<a name="line-2"></a><span class='hs-comment'>-- alternative, a tuple type or a @newtype@ then that constructor is returned. If the 'TyCon'</span>
<a name="line-3"></a><span class='hs-comment'>-- has more than one constructor, or represents a primitive or function type constructor then</span>
<a name="line-4"></a><span class='hs-comment'>-- @Nothing@ is returned. In any other case, the function panics</span>
<a name="line-5"></a><span class='hs-definition'>tyConSingleDataCon_maybe</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>DataCon</span>
<a name="line-6"></a><span class='hs-definition'>tyConSingleDataCon_maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>TupleTyCon</span> <span class='hs-layout'>{</span><span class='hs-varid'>dataCon</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>c</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>                            <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>c</span>
<a name="line-7"></a><span class='hs-definition'>tyConSingleDataCon_maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>AlgTyCon</span> <span class='hs-layout'>{</span><span class='hs-varid'>algTcRhs</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>DataTyCon</span> <span class='hs-layout'>{</span> <span class='hs-varid'>data_cons</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>c</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>}</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>c</span>
<a name="line-8"></a><span class='hs-definition'>tyConSingleDataCon_maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>AlgTyCon</span> <span class='hs-layout'>{</span><span class='hs-varid'>algTcRhs</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>NewTyCon</span> <span class='hs-layout'>{</span> <span class='hs-varid'>data_con</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>c</span> <span class='hs-layout'>}</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>     <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>c</span>
<a name="line-9"></a><span class='hs-definition'>tyConSingleDataCon_maybe</span> <span class='hs-keyword'>_</span>                                                     <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-10"></a>
<a name="line-11"></a><a name="tyConSingleAlgDataCon_maybe"></a><span class='hs-definition'>tyConSingleAlgDataCon_maybe</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>DataCon</span>
<a name="line-12"></a><span class='hs-comment'>-- Returns (Just con) for single-constructor *algebraic* data types</span>
<a name="line-13"></a><span class='hs-comment'>-- *not* newtypes</span>
<a name="line-14"></a><span class='hs-definition'>tyConSingleAlgDataCon_maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>TupleTyCon</span> <span class='hs-layout'>{</span><span class='hs-varid'>dataCon</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>c</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>                            <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>c</span>
<a name="line-15"></a><span class='hs-definition'>tyConSingleAlgDataCon_maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>AlgTyCon</span> <span class='hs-layout'>{</span><span class='hs-varid'>algTcRhs</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>DataTyCon</span> <span class='hs-layout'>{</span> <span class='hs-varid'>data_cons</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>c</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>}</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>c</span>
<a name="line-16"></a><span class='hs-definition'>tyConSingleAlgDataCon_maybe</span> <span class='hs-keyword'>_</span>                                                     <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
</pre>\end{code}

\begin{code}
<pre><a name="line-1"></a><a name="isClassTyCon"></a><span class='hs-comment'>-- | Is this 'TyCon' that for a class instance?</span>
<a name="line-2"></a><span class='hs-definition'>isClassTyCon</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-3"></a><span class='hs-definition'>isClassTyCon</span> <span class='hs-layout'>(</span><span class='hs-conid'>AlgTyCon</span> <span class='hs-layout'>{</span><span class='hs-varid'>algTcParent</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ClassTyCon</span> <span class='hs-keyword'>_</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-4"></a><span class='hs-definition'>isClassTyCon</span> <span class='hs-keyword'>_</span>                                       <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-5"></a>
<a name="line-6"></a><a name="tyConClass_maybe"></a><span class='hs-comment'>-- | If this 'TyCon' is that for a class instance, return the class it is for.</span>
<a name="line-7"></a><span class='hs-comment'>-- Otherwise returns @Nothing@</span>
<a name="line-8"></a><span class='hs-definition'>tyConClass_maybe</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>Class</span>
<a name="line-9"></a><span class='hs-definition'>tyConClass_maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>AlgTyCon</span> <span class='hs-layout'>{</span><span class='hs-varid'>algTcParent</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ClassTyCon</span> <span class='hs-varid'>clas</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>clas</span>
<a name="line-10"></a><span class='hs-definition'>tyConClass_maybe</span> <span class='hs-keyword'>_</span>                                          <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-11"></a>
<a name="line-12"></a><a name="tyConTuple_maybe"></a><span class='hs-definition'>tyConTuple_maybe</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>TupleSort</span>
<a name="line-13"></a><span class='hs-definition'>tyConTuple_maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>TupleTyCon</span> <span class='hs-layout'>{</span><span class='hs-varid'>tyConTupleSort</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sort</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>sort</span>
<a name="line-14"></a><span class='hs-definition'>tyConTuple_maybe</span> <span class='hs-keyword'>_</span>                                    <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-15"></a>
<a name="line-16"></a><a name="tyConParent"></a><span class='hs-comment'>----------------------------------------------------------------------------</span>
<a name="line-17"></a><span class='hs-definition'>tyConParent</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TyConParent</span>
<a name="line-18"></a><span class='hs-definition'>tyConParent</span> <span class='hs-layout'>(</span><span class='hs-conid'>AlgTyCon</span> <span class='hs-layout'>{</span><span class='hs-varid'>algTcParent</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>parent</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>parent</span>
<a name="line-19"></a><span class='hs-definition'>tyConParent</span> <span class='hs-layout'>(</span><span class='hs-conid'>SynTyCon</span> <span class='hs-layout'>{</span><span class='hs-varid'>synTcParent</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>parent</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>parent</span>
<a name="line-20"></a><span class='hs-definition'>tyConParent</span> <span class='hs-keyword'>_</span>                                 <span class='hs-keyglyph'>=</span> <span class='hs-conid'>NoParentTyCon</span>
<a name="line-21"></a>
<a name="line-22"></a><a name="isFamInstTyCon"></a><span class='hs-comment'>----------------------------------------------------------------------------</span>
<a name="line-23"></a><span class='hs-comment'>-- | Is this 'TyCon' that for a data family instance?</span>
<a name="line-24"></a><span class='hs-definition'>isFamInstTyCon</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-25"></a><span class='hs-definition'>isFamInstTyCon</span> <span class='hs-varid'>tc</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>tyConParent</span> <span class='hs-varid'>tc</span> <span class='hs-keyword'>of</span>
<a name="line-26"></a>                      <span class='hs-conid'>FamInstTyCon</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>True</span>
<a name="line-27"></a>                      <span class='hs-keyword'>_</span>               <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>False</span>
<a name="line-28"></a>
<a name="line-29"></a><a name="tyConFamInstSig_maybe"></a><span class='hs-definition'>tyConFamInstSig_maybe</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>TyCon</span><span class='hs-layout'>,</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Type</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span> <span class='hs-conid'>CoAxiom</span> <span class='hs-conid'>Unbranched</span><span class='hs-layout'>)</span>
<a name="line-30"></a><span class='hs-definition'>tyConFamInstSig_maybe</span> <span class='hs-varid'>tc</span>
<a name="line-31"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>tyConParent</span> <span class='hs-varid'>tc</span> <span class='hs-keyword'>of</span>
<a name="line-32"></a>      <span class='hs-conid'>FamInstTyCon</span> <span class='hs-varid'>ax</span> <span class='hs-varid'>f</span> <span class='hs-varid'>ts</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span><span class='hs-layout'>,</span> <span class='hs-varid'>ts</span><span class='hs-layout'>,</span> <span class='hs-varid'>ax</span><span class='hs-layout'>)</span>
<a name="line-33"></a>      <span class='hs-keyword'>_</span>                    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Nothing</span>
<a name="line-34"></a>
<a name="line-35"></a><a name="tyConFamInst_maybe"></a><span class='hs-comment'>-- | If this 'TyCon' is that of a family instance, return the family in question</span>
<a name="line-36"></a><span class='hs-comment'>-- and the instance types. Otherwise, return @Nothing@</span>
<a name="line-37"></a><span class='hs-definition'>tyConFamInst_maybe</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>TyCon</span><span class='hs-layout'>,</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Type</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-38"></a><span class='hs-definition'>tyConFamInst_maybe</span> <span class='hs-varid'>tc</span>
<a name="line-39"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>tyConParent</span> <span class='hs-varid'>tc</span> <span class='hs-keyword'>of</span>
<a name="line-40"></a>      <span class='hs-conid'>FamInstTyCon</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>f</span> <span class='hs-varid'>ts</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span><span class='hs-layout'>,</span> <span class='hs-varid'>ts</span><span class='hs-layout'>)</span>
<a name="line-41"></a>      <span class='hs-keyword'>_</span>                   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Nothing</span>
<a name="line-42"></a>
<a name="line-43"></a><a name="tyConFamilyCoercion_maybe"></a><span class='hs-comment'>-- | If this 'TyCon' is that of a family instance, return a 'TyCon' which represents</span>
<a name="line-44"></a><span class='hs-comment'>-- a coercion identifying the representation type with the type instance family.</span>
<a name="line-45"></a><span class='hs-comment'>-- Otherwise, return @Nothing@</span>
<a name="line-46"></a><span class='hs-definition'>tyConFamilyCoercion_maybe</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>CoAxiom</span> <span class='hs-conid'>Unbranched</span><span class='hs-layout'>)</span>
<a name="line-47"></a><span class='hs-definition'>tyConFamilyCoercion_maybe</span> <span class='hs-varid'>tc</span>
<a name="line-48"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>tyConParent</span> <span class='hs-varid'>tc</span> <span class='hs-keyword'>of</span>
<a name="line-49"></a>      <span class='hs-conid'>FamInstTyCon</span> <span class='hs-varid'>co</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>co</span>
<a name="line-50"></a>      <span class='hs-keyword'>_</span>                   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Nothing</span>
</pre>\end{code}


%************************************************************************
%*                                                                      *
\subsection[TyCon-instances]{Instance declarations for @TyCon@}
%*                                                                      *
%************************************************************************

@TyCon@s are compared by comparing their @Unique@s.

The strictness analyser needs @Ord@. It is a lexicographic order with
the property @(a<=b) || (b<=a)@.

\begin{code}
<pre><a name="line-1"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Eq</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyword'>where</span>
<a name="line-2"></a>    <span class='hs-varid'>a</span> <span class='hs-varop'>==</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-varop'>`compare`</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyword'>of</span> <span class='hs-layout'>{</span> <span class='hs-conid'>EQ</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>True</span><span class='hs-layout'>;</span>   <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>False</span> <span class='hs-layout'>}</span>
<a name="line-3"></a>    <span class='hs-varid'>a</span> <span class='hs-varop'>/=</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-varop'>`compare`</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyword'>of</span> <span class='hs-layout'>{</span> <span class='hs-conid'>EQ</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>False</span><span class='hs-layout'>;</span>  <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>True</span>  <span class='hs-layout'>}</span>
<a name="line-4"></a>
<a name="line-5"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Ord</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyword'>where</span>
<a name="line-6"></a>    <span class='hs-varid'>a</span> <span class='hs-varop'>&lt;=</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-varop'>`compare`</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyword'>of</span> <span class='hs-layout'>{</span> <span class='hs-conid'>LT</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>True</span><span class='hs-layout'>;</span>  <span class='hs-conid'>EQ</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>True</span><span class='hs-layout'>;</span>  <span class='hs-conid'>GT</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>False</span> <span class='hs-layout'>}</span>
<a name="line-7"></a>    <span class='hs-varid'>a</span> <span class='hs-varop'>&lt;</span>  <span class='hs-varid'>b</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-varop'>`compare`</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyword'>of</span> <span class='hs-layout'>{</span> <span class='hs-conid'>LT</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>True</span><span class='hs-layout'>;</span>  <span class='hs-conid'>EQ</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>False</span><span class='hs-layout'>;</span> <span class='hs-conid'>GT</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>False</span> <span class='hs-layout'>}</span>
<a name="line-8"></a>    <span class='hs-varid'>a</span> <span class='hs-varop'>&gt;=</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-varop'>`compare`</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyword'>of</span> <span class='hs-layout'>{</span> <span class='hs-conid'>LT</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>False</span><span class='hs-layout'>;</span> <span class='hs-conid'>EQ</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>True</span><span class='hs-layout'>;</span>  <span class='hs-conid'>GT</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>True</span>  <span class='hs-layout'>}</span>
<a name="line-9"></a>    <span class='hs-varid'>a</span> <span class='hs-varop'>&gt;</span>  <span class='hs-varid'>b</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-varop'>`compare`</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyword'>of</span> <span class='hs-layout'>{</span> <span class='hs-conid'>LT</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>False</span><span class='hs-layout'>;</span> <span class='hs-conid'>EQ</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>False</span><span class='hs-layout'>;</span> <span class='hs-conid'>GT</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>True</span>  <span class='hs-layout'>}</span>
<a name="line-10"></a>    <span class='hs-varid'>compare</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getUnique</span> <span class='hs-varid'>a</span> <span class='hs-varop'>`compare`</span> <span class='hs-varid'>getUnique</span> <span class='hs-varid'>b</span>
<a name="line-11"></a>
<a name="line-12"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Uniquable</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyword'>where</span>
<a name="line-13"></a>    <span class='hs-varid'>getUnique</span> <span class='hs-varid'>tc</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tyConUnique</span> <span class='hs-varid'>tc</span>
<a name="line-14"></a>
<a name="line-15"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Outputable</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyword'>where</span>
<a name="line-16"></a>  <span class='hs-comment'>-- At the moment a promoted TyCon has the same Name as its</span>
<a name="line-17"></a>  <span class='hs-comment'>-- corresponding TyCon, so we add the quote to distinguish it here</span>
<a name="line-18"></a>  <span class='hs-varid'>ppr</span> <span class='hs-varid'>tc</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprPromotionQuote</span> <span class='hs-varid'>tc</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-varid'>tyConName</span> <span class='hs-varid'>tc</span><span class='hs-layout'>)</span>
<a name="line-19"></a>
<a name="line-20"></a><a name="pprPromotionQuote"></a><span class='hs-definition'>pprPromotionQuote</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-21"></a><span class='hs-definition'>pprPromotionQuote</span> <span class='hs-layout'>(</span><span class='hs-conid'>PromotedDataCon</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'\''</span>   <span class='hs-comment'>-- Quote promoted DataCons in types</span>
<a name="line-22"></a><span class='hs-definition'>pprPromotionQuote</span> <span class='hs-layout'>(</span><span class='hs-conid'>PromotedTyCon</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ifPprDebug</span> <span class='hs-layout'>(</span><span class='hs-varid'>char</span> <span class='hs-chr'>'\''</span><span class='hs-layout'>)</span> 
<a name="line-23"></a><span class='hs-definition'>pprPromotionQuote</span> <span class='hs-keyword'>_</span>                    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>empty</span>       <span class='hs-comment'>-- However, we don't quote TyCons in kinds</span>
<a name="line-24"></a>                                                     <span class='hs-comment'>-- e.g.   type family T a :: Bool -&gt; *</span>
<a name="line-25"></a>                                                     <span class='hs-comment'>-- cf Trac #5952.  Except with -dppr-debug</span>
<a name="line-26"></a>
<a name="line-27"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>NamedThing</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyword'>where</span>
<a name="line-28"></a>    <span class='hs-varid'>getName</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tyConName</span>
<a name="line-29"></a>
<a name="line-30"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Data</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyword'>where</span>
<a name="line-31"></a>    <span class='hs-comment'>-- don't traverse?</span>
<a name="line-32"></a>    <span class='hs-varid'>toConstr</span> <span class='hs-keyword'>_</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>abstractConstr</span> <span class='hs-str'>"TyCon"</span>
<a name="line-33"></a>    <span class='hs-varid'>gunfold</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>error</span> <span class='hs-str'>"gunfold"</span>
<a name="line-34"></a>    <span class='hs-varid'>dataTypeOf</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkNoRepType</span> <span class='hs-str'>"TyCon"</span>
<a name="line-35"></a>
</pre>\end{code}

%************************************************************************
%*                                                                      *
           Walking over recursive TyCons
%*                                                                      *
%************************************************************************

Note [Expanding newtypes and products]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
When expanding a type to expose a data-type constructor, we need to be
careful about newtypes, lest we fall into an infinite loop. Here are
the key examples:

  newtype Id  x = MkId x
  newtype Fix f = MkFix (f (Fix f))
  newtype T     = MkT (T -> T)

  Type           Expansion
 --------------------------
  T              T -> T
  Fix Maybe      Maybe (Fix Maybe)
  Id (Id Int)    Int
  Fix Id         NO NO NO

Notice that we can expand T, even though it's recursive.
And we can expand Id (Id Int), even though the Id shows up
twice at the outer level.

So, when expanding, we keep track of when we've seen a recursive
newtype at outermost level; and bale out if we see it again.

We sometimes want to do the same for product types, so that the 
strictness analyser doesn't unbox infinitely deeply.

The function that manages this is checkRecTc.

\begin{code}
<pre><a name="line-1"></a><a name="RecTcChecker"></a><span class='hs-keyword'>newtype</span> <span class='hs-conid'>RecTcChecker</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>RC</span> <span class='hs-conid'>NameSet</span>
<a name="line-2"></a>
<a name="line-3"></a><a name="initRecTc"></a><span class='hs-definition'>initRecTc</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>RecTcChecker</span> 
<a name="line-4"></a><span class='hs-definition'>initRecTc</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>RC</span> <span class='hs-varid'>emptyNameSet</span>
<a name="line-5"></a>
<a name="line-6"></a><a name="checkRecTc"></a><span class='hs-definition'>checkRecTc</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>RecTcChecker</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>RecTcChecker</span>
<a name="line-7"></a><span class='hs-comment'>-- Nothing      =&gt; Recursion detected</span>
<a name="line-8"></a><span class='hs-comment'>-- Just rec_tcs =&gt; Keep going</span>
<a name="line-9"></a><span class='hs-definition'>checkRecTc</span> <span class='hs-layout'>(</span><span class='hs-conid'>RC</span> <span class='hs-varid'>rec_nts</span><span class='hs-layout'>)</span> <span class='hs-varid'>tc</span>
<a name="line-10"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>not</span> <span class='hs-layout'>(</span><span class='hs-varid'>isRecursiveTyCon</span> <span class='hs-varid'>tc</span><span class='hs-layout'>)</span>     <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-conid'>RC</span> <span class='hs-varid'>rec_nts</span><span class='hs-layout'>)</span>
<a name="line-11"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>tc_name</span> <span class='hs-varop'>`elemNameSet`</span> <span class='hs-varid'>rec_nts</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-12"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>                     <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-conid'>RC</span> <span class='hs-layout'>(</span><span class='hs-varid'>addOneToNameSet</span> <span class='hs-varid'>rec_nts</span> <span class='hs-varid'>tc_name</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-13"></a>  <span class='hs-keyword'>where</span>
<a name="line-14"></a>    <span class='hs-varid'>tc_name</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tyConName</span> <span class='hs-varid'>tc</span>
</pre>\end{code}
</body>
</html>
