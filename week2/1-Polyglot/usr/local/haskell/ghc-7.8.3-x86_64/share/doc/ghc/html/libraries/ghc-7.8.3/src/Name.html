<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>basicTypes/Name.lhs</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
%
% (c) The University of Glasgow 2006
% (c) The GRASP/AQUA Project, Glasgow University, 1992-1998
%
\section[Name]{@Name@: to transmit name info from renamer to typechecker}

\begin{code}
<pre><a name="line-1"></a><span class='hs-comment'>-- |</span>
<a name="line-2"></a><span class='hs-comment'>-- #name_types#</span>
<a name="line-3"></a><span class='hs-comment'>-- GHC uses several kinds of name internally:</span>
<a name="line-4"></a><span class='hs-comment'>--</span>
<a name="line-5"></a><span class='hs-comment'>-- * 'OccName.OccName': see "OccName#name_types"</span>
<a name="line-6"></a><span class='hs-comment'>--</span>
<a name="line-7"></a><span class='hs-comment'>-- * 'RdrName.RdrName': see "RdrName#name_types"</span>
<a name="line-8"></a><span class='hs-comment'>--</span>
<a name="line-9"></a><span class='hs-comment'>-- *  'Name.Name' is the type of names that have had their scoping and binding resolved. They</span>
<a name="line-10"></a><span class='hs-comment'>--   have an 'OccName.OccName' but also a 'Unique.Unique' that disambiguates Names that have</span>
<a name="line-11"></a><span class='hs-comment'>--   the same 'OccName.OccName' and indeed is used for all 'Name.Name' comparison. Names</span>
<a name="line-12"></a><span class='hs-comment'>--   also contain information about where they originated from, see "Name#name_sorts"</span>
<a name="line-13"></a><span class='hs-comment'>--</span>
<a name="line-14"></a><span class='hs-comment'>-- * 'Id.Id': see "Id#name_types"</span>
<a name="line-15"></a><span class='hs-comment'>--</span>
<a name="line-16"></a><span class='hs-comment'>-- * 'Var.Var': see "Var#name_types"</span>
<a name="line-17"></a><span class='hs-comment'>--</span>
<a name="line-18"></a><span class='hs-comment'>-- #name_sorts#</span>
<a name="line-19"></a><span class='hs-comment'>-- Names are one of:</span>
<a name="line-20"></a><span class='hs-comment'>--</span>
<a name="line-21"></a><span class='hs-comment'>--  * External, if they name things declared in other modules. Some external</span>
<a name="line-22"></a><span class='hs-comment'>--    Names are wired in, i.e. they name primitives defined in the compiler itself</span>
<a name="line-23"></a><span class='hs-comment'>--</span>
<a name="line-24"></a><span class='hs-comment'>--  * Internal, if they name things in the module being compiled. Some internal</span>
<a name="line-25"></a><span class='hs-comment'>--    Names are system names, if they are names manufactured by the compiler</span>
<a name="line-26"></a>
<a name="line-27"></a><span class='hs-keyword'>module</span> <span class='hs-conid'>Name</span> <span class='hs-layout'>(</span>
<a name="line-28"></a>        <span class='hs-comment'>-- * The main types</span>
<a name="line-29"></a>        <span class='hs-conid'>Name</span><span class='hs-layout'>,</span>                                   <span class='hs-comment'>-- Abstract</span>
<a name="line-30"></a>        <span class='hs-conid'>BuiltInSyntax</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-31"></a>
<a name="line-32"></a>        <span class='hs-comment'>-- ** Creating 'Name's</span>
<a name="line-33"></a>        <span class='hs-varid'>mkSystemName</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkSystemNameAt</span><span class='hs-layout'>,</span>
<a name="line-34"></a>        <span class='hs-varid'>mkInternalName</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkClonedInternalName</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkDerivedInternalName</span><span class='hs-layout'>,</span>
<a name="line-35"></a>        <span class='hs-varid'>mkSystemVarName</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkSysTvName</span><span class='hs-layout'>,</span>
<a name="line-36"></a>        <span class='hs-varid'>mkFCallName</span><span class='hs-layout'>,</span>
<a name="line-37"></a>        <span class='hs-varid'>mkExternalName</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkWiredInName</span><span class='hs-layout'>,</span>
<a name="line-38"></a>
<a name="line-39"></a>        <span class='hs-comment'>-- ** Manipulating and deconstructing 'Name's</span>
<a name="line-40"></a>        <span class='hs-varid'>nameUnique</span><span class='hs-layout'>,</span> <span class='hs-varid'>setNameUnique</span><span class='hs-layout'>,</span>
<a name="line-41"></a>        <span class='hs-varid'>nameOccName</span><span class='hs-layout'>,</span> <span class='hs-varid'>nameModule</span><span class='hs-layout'>,</span> <span class='hs-varid'>nameModule_maybe</span><span class='hs-layout'>,</span>
<a name="line-42"></a>        <span class='hs-varid'>tidyNameOcc</span><span class='hs-layout'>,</span>
<a name="line-43"></a>        <span class='hs-varid'>hashName</span><span class='hs-layout'>,</span> <span class='hs-varid'>localiseName</span><span class='hs-layout'>,</span>
<a name="line-44"></a>        <span class='hs-varid'>mkLocalisedOccName</span><span class='hs-layout'>,</span>
<a name="line-45"></a>
<a name="line-46"></a>        <span class='hs-varid'>nameSrcLoc</span><span class='hs-layout'>,</span> <span class='hs-varid'>nameSrcSpan</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprNameDefnLoc</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprDefinedAt</span><span class='hs-layout'>,</span>
<a name="line-47"></a>
<a name="line-48"></a>        <span class='hs-comment'>-- ** Predicates on 'Name's</span>
<a name="line-49"></a>        <span class='hs-varid'>isSystemName</span><span class='hs-layout'>,</span> <span class='hs-varid'>isInternalName</span><span class='hs-layout'>,</span> <span class='hs-varid'>isExternalName</span><span class='hs-layout'>,</span>
<a name="line-50"></a>        <span class='hs-varid'>isTyVarName</span><span class='hs-layout'>,</span> <span class='hs-varid'>isTyConName</span><span class='hs-layout'>,</span> <span class='hs-varid'>isDataConName</span><span class='hs-layout'>,</span>
<a name="line-51"></a>        <span class='hs-varid'>isValName</span><span class='hs-layout'>,</span> <span class='hs-varid'>isVarName</span><span class='hs-layout'>,</span>
<a name="line-52"></a>        <span class='hs-varid'>isWiredInName</span><span class='hs-layout'>,</span> <span class='hs-varid'>isBuiltInSyntax</span><span class='hs-layout'>,</span>
<a name="line-53"></a>        <span class='hs-varid'>wiredInNameTyThing_maybe</span><span class='hs-layout'>,</span>
<a name="line-54"></a>        <span class='hs-varid'>nameIsLocalOrFrom</span><span class='hs-layout'>,</span> <span class='hs-varid'>stableNameCmp</span><span class='hs-layout'>,</span>
<a name="line-55"></a>
<a name="line-56"></a>        <span class='hs-comment'>-- * Class 'NamedThing' and overloaded friends</span>
<a name="line-57"></a>        <span class='hs-conid'>NamedThing</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-58"></a>        <span class='hs-varid'>getSrcLoc</span><span class='hs-layout'>,</span> <span class='hs-varid'>getSrcSpan</span><span class='hs-layout'>,</span> <span class='hs-varid'>getOccString</span><span class='hs-layout'>,</span>
<a name="line-59"></a>
<a name="line-60"></a>        <span class='hs-varid'>pprInfixName</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprPrefixName</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprModulePrefix</span><span class='hs-layout'>,</span>
<a name="line-61"></a>
<a name="line-62"></a>        <span class='hs-comment'>-- Re-export the OccName stuff</span>
<a name="line-63"></a>        <span class='hs-keyword'>module</span> <span class='hs-conid'>OccName</span>
<a name="line-64"></a>    <span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-65"></a>
<a name="line-66"></a><span class='hs-keyword'>import</span> <span class='hs-comment'>{-# SOURCE #-}</span> <span class='hs-conid'>TypeRep</span><span class='hs-layout'>(</span> <span class='hs-conid'>TyThing</span> <span class='hs-layout'>)</span>
<a name="line-67"></a><span class='hs-keyword'>import</span> <span class='hs-comment'>{-# SOURCE #-}</span> <span class='hs-conid'>PrelNames</span><span class='hs-layout'>(</span> <span class='hs-varid'>liftedTypeKindTyConKey</span> <span class='hs-layout'>)</span>
<a name="line-68"></a>
<a name="line-69"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>OccName</span>
<a name="line-70"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Module</span>
<a name="line-71"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>SrcLoc</span>
<a name="line-72"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Unique</span>
<a name="line-73"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Util</span>
<a name="line-74"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Maybes</span>
<a name="line-75"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Binary</span>
<a name="line-76"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>DynFlags</span>
<a name="line-77"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>FastTypes</span>
<a name="line-78"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>FastString</span>
<a name="line-79"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Outputable</span>
<a name="line-80"></a>
<a name="line-81"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Data</span>
</pre>\end{code}

%************************************************************************
%*                                                                      *
\subsection[Name-datatype]{The @Name@ datatype, and name construction}
%*                                                                      *
%************************************************************************

\begin{code}
<pre><a name="line-1"></a><a name="Name"></a><span class='hs-comment'>-- | A unique, unambigious name for something, containing information about where</span>
<a name="line-2"></a><a name="Name"></a><span class='hs-comment'>-- that thing originated.</span>
<a name="line-3"></a><a name="Name"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Name</span> <span class='hs-layout'>{</span>
<a name="line-4"></a>                <span class='hs-varid'>n_sort</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>NameSort</span><span class='hs-layout'>,</span>     <span class='hs-comment'>-- What sort of name it is</span>
<a name="line-5"></a>                <span class='hs-varid'>n_occ</span>  <span class='hs-keyglyph'>::</span> <span class='hs-varop'>!</span><span class='hs-conid'>OccName</span><span class='hs-layout'>,</span>     <span class='hs-comment'>-- Its occurrence name</span>
<a name="line-6"></a>                <span class='hs-varid'>n_uniq</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>FastInt</span><span class='hs-layout'>,</span>      <span class='hs-comment'>-- UNPACK doesn't work, recursive type</span>
<a name="line-7"></a><span class='hs-comment'>--(note later when changing Int# -&gt; FastInt: is that still true about UNPACK?)</span>
<a name="line-8"></a>                <span class='hs-varid'>n_loc</span>  <span class='hs-keyglyph'>::</span> <span class='hs-varop'>!</span><span class='hs-conid'>SrcSpan</span>      <span class='hs-comment'>-- Definition site</span>
<a name="line-9"></a>            <span class='hs-layout'>}</span>
<a name="line-10"></a>    <span class='hs-keyword'>deriving</span> <span class='hs-conid'>Typeable</span>
<a name="line-11"></a>
<a name="line-12"></a><span class='hs-comment'>-- NOTE: we make the n_loc field strict to eliminate some potential</span>
<a name="line-13"></a><span class='hs-comment'>-- (and real!) space leaks, due to the fact that we don't look at</span>
<a name="line-14"></a><span class='hs-comment'>-- the SrcLoc in a Name all that often.</span>
<a name="line-15"></a>
<a name="line-16"></a><a name="NameSort"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>NameSort</span>
<a name="line-17"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>External</span> <span class='hs-conid'>Module</span>
<a name="line-18"></a>
<a name="line-19"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>WiredIn</span> <span class='hs-conid'>Module</span> <span class='hs-conid'>TyThing</span> <span class='hs-conid'>BuiltInSyntax</span>
<a name="line-20"></a>        <span class='hs-comment'>-- A variant of External, for wired-in things</span>
<a name="line-21"></a>
<a name="line-22"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Internal</span>            <span class='hs-comment'>-- A user-defined Id or TyVar</span>
<a name="line-23"></a>                        <span class='hs-comment'>-- defined in the module being compiled</span>
<a name="line-24"></a>
<a name="line-25"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>System</span>              <span class='hs-comment'>-- A system-defined Id or TyVar.  Typically the</span>
<a name="line-26"></a>                        <span class='hs-comment'>-- OccName is very uninformative (like 's')</span>
<a name="line-27"></a>
<a name="line-28"></a><a name="BuiltInSyntax"></a><span class='hs-comment'>-- | BuiltInSyntax is for things like @(:)@, @[]@ and tuples,</span>
<a name="line-29"></a><a name="BuiltInSyntax"></a><span class='hs-comment'>-- which have special syntactic forms.  They aren't in scope</span>
<a name="line-30"></a><a name="BuiltInSyntax"></a><span class='hs-comment'>-- as such.</span>
<a name="line-31"></a><a name="BuiltInSyntax"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>BuiltInSyntax</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>BuiltInSyntax</span> <span class='hs-keyglyph'>|</span> <span class='hs-conid'>UserSyntax</span>
</pre>\end{code}

Notes about the NameSorts:

1.  Initially, top-level Ids (including locally-defined ones) get External names,
    and all other local Ids get Internal names

2.  In any invocation of GHC, an External Name for "M.x" has one and only one
    unique.  This unique association is ensured via the Name Cache; 
    see Note [The Name Cache] in IfaceEnv.

3.  Things with a External name are given C static labels, so they finally
    appear in the .o file's symbol table.  They appear in the symbol table
    in the form M.n.  If originally-local things have this property they
    must be made @External@ first.

4.  In the tidy-core phase, a External that is not visible to an importer
    is changed to Internal, and a Internal that is visible is changed to External

5.  A System Name differs in the following ways:
        a) has unique attached when printing dumps
        b) unifier eliminates sys tyvars in favour of user provs where possible

    Before anything gets printed in interface files or output code, it's
    fed through a 'tidy' processor, which zaps the OccNames to have
    unique names; and converts all sys-locals to user locals
    If any desugarer sys-locals have survived that far, they get changed to
    "ds1", "ds2", etc.

Built-in syntax => It's a syntactic form, not "in scope" (e.g. [])

Wired-in thing  => The thing (Id, TyCon) is fully known to the compiler,
                   not read from an interface file.
                   E.g. Bool, True, Int, Float, and many others

All built-in syntax is for wired-in things.

\begin{code}
<pre><a name="line-1"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>HasOccName</span> <span class='hs-conid'>Name</span> <span class='hs-keyword'>where</span>
<a name="line-2"></a>  <span class='hs-varid'>occName</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>nameOccName</span>
<a name="line-3"></a>
<a name="line-4"></a><a name="nameUnique"></a><span class='hs-definition'>nameUnique</span>              <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Unique</span>
<a name="line-5"></a><a name="nameOccName"></a><span class='hs-definition'>nameOccName</span>             <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>OccName</span>
<a name="line-6"></a><a name="nameModule"></a><span class='hs-definition'>nameModule</span>              <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Module</span>
<a name="line-7"></a><a name="nameSrcLoc"></a><span class='hs-definition'>nameSrcLoc</span>              <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SrcLoc</span>
<a name="line-8"></a><a name="nameSrcSpan"></a><span class='hs-definition'>nameSrcSpan</span>             <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SrcSpan</span>
<a name="line-9"></a>
<a name="line-10"></a><span class='hs-definition'>nameUnique</span>  <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkUniqueGrimily</span> <span class='hs-layout'>(</span><span class='hs-varid'>iBox</span> <span class='hs-layout'>(</span><span class='hs-varid'>n_uniq</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-11"></a><span class='hs-definition'>nameOccName</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>n_occ</span>  <span class='hs-varid'>name</span>
<a name="line-12"></a><span class='hs-definition'>nameSrcLoc</span>  <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>srcSpanStart</span> <span class='hs-layout'>(</span><span class='hs-varid'>n_loc</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>
<a name="line-13"></a><span class='hs-definition'>nameSrcSpan</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>n_loc</span>  <span class='hs-varid'>name</span>
</pre>\end{code}

%************************************************************************
%*                                                                      *
\subsection{Predicates on names}
%*                                                                      *
%************************************************************************

\begin{code}
<pre><a name="line-1"></a><a name="nameIsLocalOrFrom"></a><span class='hs-definition'>nameIsLocalOrFrom</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Module</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-2"></a><a name="isInternalName"></a><span class='hs-definition'>isInternalName</span>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-3"></a><a name="isExternalName"></a><span class='hs-definition'>isExternalName</span>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-4"></a><a name="isSystemName"></a><span class='hs-definition'>isSystemName</span>      <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-5"></a><a name="isWiredInName"></a><span class='hs-definition'>isWiredInName</span>     <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-6"></a>
<a name="line-7"></a><span class='hs-definition'>isWiredInName</span> <span class='hs-layout'>(</span><span class='hs-conid'>Name</span> <span class='hs-layout'>{</span><span class='hs-varid'>n_sort</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>WiredIn</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-8"></a><span class='hs-definition'>isWiredInName</span> <span class='hs-keyword'>_</span>                               <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-9"></a>
<a name="line-10"></a><a name="wiredInNameTyThing_maybe"></a><span class='hs-definition'>wiredInNameTyThing_maybe</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>TyThing</span>
<a name="line-11"></a><span class='hs-definition'>wiredInNameTyThing_maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>Name</span> <span class='hs-layout'>{</span><span class='hs-varid'>n_sort</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>WiredIn</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>thing</span> <span class='hs-keyword'>_</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>thing</span>
<a name="line-12"></a><span class='hs-definition'>wiredInNameTyThing_maybe</span> <span class='hs-keyword'>_</span>                                   <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-13"></a>
<a name="line-14"></a><a name="isBuiltInSyntax"></a><span class='hs-definition'>isBuiltInSyntax</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-15"></a><span class='hs-definition'>isBuiltInSyntax</span> <span class='hs-layout'>(</span><span class='hs-conid'>Name</span> <span class='hs-layout'>{</span><span class='hs-varid'>n_sort</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>WiredIn</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-conid'>BuiltInSyntax</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-16"></a><span class='hs-definition'>isBuiltInSyntax</span> <span class='hs-keyword'>_</span>                                           <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-17"></a>
<a name="line-18"></a><span class='hs-definition'>isExternalName</span> <span class='hs-layout'>(</span><span class='hs-conid'>Name</span> <span class='hs-layout'>{</span><span class='hs-varid'>n_sort</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>External</span> <span class='hs-keyword'>_</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>    <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-19"></a><span class='hs-definition'>isExternalName</span> <span class='hs-layout'>(</span><span class='hs-conid'>Name</span> <span class='hs-layout'>{</span><span class='hs-varid'>n_sort</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>WiredIn</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-20"></a><span class='hs-definition'>isExternalName</span> <span class='hs-keyword'>_</span>                               <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-21"></a>
<a name="line-22"></a><span class='hs-definition'>isInternalName</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>not</span> <span class='hs-layout'>(</span><span class='hs-varid'>isExternalName</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>
<a name="line-23"></a>
<a name="line-24"></a><a name="nameModule"></a><span class='hs-definition'>nameModule</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>nameModule_maybe</span> <span class='hs-varid'>name</span> <span class='hs-varop'>`orElse`</span> <span class='hs-varid'>pprPanic</span> <span class='hs-str'>"nameModule"</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>
<a name="line-25"></a><a name="nameModule_maybe"></a><span class='hs-definition'>nameModule_maybe</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>Module</span>
<a name="line-26"></a><span class='hs-definition'>nameModule_maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>Name</span> <span class='hs-layout'>{</span> <span class='hs-varid'>n_sort</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>External</span> <span class='hs-varid'>mod</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>    <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>mod</span>
<a name="line-27"></a><span class='hs-definition'>nameModule_maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>Name</span> <span class='hs-layout'>{</span> <span class='hs-varid'>n_sort</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>WiredIn</span> <span class='hs-varid'>mod</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>mod</span>
<a name="line-28"></a><span class='hs-definition'>nameModule_maybe</span> <span class='hs-keyword'>_</span>                                  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-29"></a>
<a name="line-30"></a><span class='hs-definition'>nameIsLocalOrFrom</span> <span class='hs-varid'>from</span> <span class='hs-varid'>name</span>
<a name="line-31"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>isExternalName</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>from</span> <span class='hs-varop'>==</span> <span class='hs-varid'>nameModule</span> <span class='hs-varid'>name</span>
<a name="line-32"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>           <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-33"></a>
<a name="line-34"></a><a name="isTyVarName"></a><span class='hs-definition'>isTyVarName</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-35"></a><span class='hs-definition'>isTyVarName</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>isTvOcc</span> <span class='hs-layout'>(</span><span class='hs-varid'>nameOccName</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>
<a name="line-36"></a>
<a name="line-37"></a><a name="isTyConName"></a><span class='hs-definition'>isTyConName</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-38"></a><span class='hs-definition'>isTyConName</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>isTcOcc</span> <span class='hs-layout'>(</span><span class='hs-varid'>nameOccName</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>
<a name="line-39"></a>
<a name="line-40"></a><a name="isDataConName"></a><span class='hs-definition'>isDataConName</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-41"></a><span class='hs-definition'>isDataConName</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>isDataOcc</span> <span class='hs-layout'>(</span><span class='hs-varid'>nameOccName</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>
<a name="line-42"></a>
<a name="line-43"></a><a name="isValName"></a><span class='hs-definition'>isValName</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-44"></a><span class='hs-definition'>isValName</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>isValOcc</span> <span class='hs-layout'>(</span><span class='hs-varid'>nameOccName</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>
<a name="line-45"></a>
<a name="line-46"></a><a name="isVarName"></a><span class='hs-definition'>isVarName</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-47"></a><span class='hs-definition'>isVarName</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>isVarOcc</span> <span class='hs-varop'>.</span> <span class='hs-varid'>nameOccName</span>
<a name="line-48"></a>
<a name="line-49"></a><span class='hs-definition'>isSystemName</span> <span class='hs-layout'>(</span><span class='hs-conid'>Name</span> <span class='hs-layout'>{</span><span class='hs-varid'>n_sort</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>System</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-50"></a><span class='hs-definition'>isSystemName</span> <span class='hs-keyword'>_</span>                        <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
</pre>\end{code}


%************************************************************************
%*                                                                      *
\subsection{Making names}
%*                                                                      *
%************************************************************************

\begin{code}
<pre><a name="line-1"></a><a name="mkInternalName"></a><span class='hs-comment'>-- | Create a name which is (for now at least) local to the current module and hence</span>
<a name="line-2"></a><span class='hs-comment'>-- does not need a 'Module' to disambiguate it from other 'Name's</span>
<a name="line-3"></a><span class='hs-definition'>mkInternalName</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Unique</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>OccName</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SrcSpan</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Name</span>
<a name="line-4"></a><span class='hs-definition'>mkInternalName</span> <span class='hs-varid'>uniq</span> <span class='hs-varid'>occ</span> <span class='hs-varid'>loc</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Name</span> <span class='hs-layout'>{</span> <span class='hs-varid'>n_uniq</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getKeyFastInt</span> <span class='hs-varid'>uniq</span>
<a name="line-5"></a>                                   <span class='hs-layout'>,</span> <span class='hs-varid'>n_sort</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Internal</span>
<a name="line-6"></a>                                   <span class='hs-layout'>,</span> <span class='hs-varid'>n_occ</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>occ</span>
<a name="line-7"></a>                                   <span class='hs-layout'>,</span> <span class='hs-varid'>n_loc</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>loc</span> <span class='hs-layout'>}</span>
<a name="line-8"></a>        <span class='hs-comment'>-- NB: You might worry that after lots of huffing and</span>
<a name="line-9"></a>        <span class='hs-comment'>-- puffing we might end up with two local names with distinct</span>
<a name="line-10"></a>        <span class='hs-comment'>-- uniques, but the same OccName.  Indeed we can, but that's ok</span>
<a name="line-11"></a>        <span class='hs-comment'>--      * the insides of the compiler don't care: they use the Unique</span>
<a name="line-12"></a>        <span class='hs-comment'>--      * when printing for -ddump-xxx you can switch on -dppr-debug to get the</span>
<a name="line-13"></a>        <span class='hs-comment'>--        uniques if you get confused</span>
<a name="line-14"></a>        <span class='hs-comment'>--      * for interface files we tidyCore first, which makes</span>
<a name="line-15"></a>        <span class='hs-comment'>--        the OccNames distinct when they need to be</span>
<a name="line-16"></a>
<a name="line-17"></a><a name="mkClonedInternalName"></a><span class='hs-definition'>mkClonedInternalName</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Unique</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Name</span>
<a name="line-18"></a><span class='hs-definition'>mkClonedInternalName</span> <span class='hs-varid'>uniq</span> <span class='hs-layout'>(</span><span class='hs-conid'>Name</span> <span class='hs-layout'>{</span> <span class='hs-varid'>n_occ</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>occ</span><span class='hs-layout'>,</span> <span class='hs-varid'>n_loc</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>loc</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-19"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Name</span> <span class='hs-layout'>{</span> <span class='hs-varid'>n_uniq</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getKeyFastInt</span> <span class='hs-varid'>uniq</span><span class='hs-layout'>,</span> <span class='hs-varid'>n_sort</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Internal</span>
<a name="line-20"></a>         <span class='hs-layout'>,</span> <span class='hs-varid'>n_occ</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>occ</span><span class='hs-layout'>,</span> <span class='hs-varid'>n_loc</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>loc</span> <span class='hs-layout'>}</span>
<a name="line-21"></a>
<a name="line-22"></a><a name="mkDerivedInternalName"></a><span class='hs-definition'>mkDerivedInternalName</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>OccName</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>OccName</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Unique</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Name</span>
<a name="line-23"></a><span class='hs-definition'>mkDerivedInternalName</span> <span class='hs-varid'>derive_occ</span> <span class='hs-varid'>uniq</span> <span class='hs-layout'>(</span><span class='hs-conid'>Name</span> <span class='hs-layout'>{</span> <span class='hs-varid'>n_occ</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>occ</span><span class='hs-layout'>,</span> <span class='hs-varid'>n_loc</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>loc</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-24"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Name</span> <span class='hs-layout'>{</span> <span class='hs-varid'>n_uniq</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getKeyFastInt</span> <span class='hs-varid'>uniq</span><span class='hs-layout'>,</span> <span class='hs-varid'>n_sort</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Internal</span>
<a name="line-25"></a>         <span class='hs-layout'>,</span> <span class='hs-varid'>n_occ</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>derive_occ</span> <span class='hs-varid'>occ</span><span class='hs-layout'>,</span> <span class='hs-varid'>n_loc</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>loc</span> <span class='hs-layout'>}</span>
<a name="line-26"></a>
<a name="line-27"></a><a name="mkExternalName"></a><span class='hs-comment'>-- | Create a name which definitely originates in the given module</span>
<a name="line-28"></a><span class='hs-definition'>mkExternalName</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Unique</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Module</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>OccName</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SrcSpan</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Name</span>
<a name="line-29"></a><span class='hs-comment'>-- WATCH OUT! External Names should be in the Name Cache</span>
<a name="line-30"></a><span class='hs-comment'>-- (see Note [The Name Cache] in IfaceEnv), so don't just call mkExternalName</span>
<a name="line-31"></a><span class='hs-comment'>-- with some fresh unique without populating the Name Cache</span>
<a name="line-32"></a><span class='hs-definition'>mkExternalName</span> <span class='hs-varid'>uniq</span> <span class='hs-varid'>mod</span> <span class='hs-varid'>occ</span> <span class='hs-varid'>loc</span>
<a name="line-33"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Name</span> <span class='hs-layout'>{</span> <span class='hs-varid'>n_uniq</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getKeyFastInt</span> <span class='hs-varid'>uniq</span><span class='hs-layout'>,</span> <span class='hs-varid'>n_sort</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>External</span> <span class='hs-varid'>mod</span><span class='hs-layout'>,</span>
<a name="line-34"></a>           <span class='hs-varid'>n_occ</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>occ</span><span class='hs-layout'>,</span> <span class='hs-varid'>n_loc</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>loc</span> <span class='hs-layout'>}</span>
<a name="line-35"></a>
<a name="line-36"></a><a name="mkWiredInName"></a><span class='hs-comment'>-- | Create a name which is actually defined by the compiler itself</span>
<a name="line-37"></a><span class='hs-definition'>mkWiredInName</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Module</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>OccName</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Unique</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TyThing</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>BuiltInSyntax</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Name</span>
<a name="line-38"></a><span class='hs-definition'>mkWiredInName</span> <span class='hs-varid'>mod</span> <span class='hs-varid'>occ</span> <span class='hs-varid'>uniq</span> <span class='hs-varid'>thing</span> <span class='hs-varid'>built_in</span>
<a name="line-39"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Name</span> <span class='hs-layout'>{</span> <span class='hs-varid'>n_uniq</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getKeyFastInt</span> <span class='hs-varid'>uniq</span><span class='hs-layout'>,</span>
<a name="line-40"></a>           <span class='hs-varid'>n_sort</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>WiredIn</span> <span class='hs-varid'>mod</span> <span class='hs-varid'>thing</span> <span class='hs-varid'>built_in</span><span class='hs-layout'>,</span>
<a name="line-41"></a>           <span class='hs-varid'>n_occ</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>occ</span><span class='hs-layout'>,</span> <span class='hs-varid'>n_loc</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>wiredInSrcSpan</span> <span class='hs-layout'>}</span>
<a name="line-42"></a>
<a name="line-43"></a><a name="mkSystemName"></a><span class='hs-comment'>-- | Create a name brought into being by the compiler</span>
<a name="line-44"></a><span class='hs-definition'>mkSystemName</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Unique</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>OccName</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Name</span>
<a name="line-45"></a><span class='hs-definition'>mkSystemName</span> <span class='hs-varid'>uniq</span> <span class='hs-varid'>occ</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkSystemNameAt</span> <span class='hs-varid'>uniq</span> <span class='hs-varid'>occ</span> <span class='hs-varid'>noSrcSpan</span>
<a name="line-46"></a>
<a name="line-47"></a><a name="mkSystemNameAt"></a><span class='hs-definition'>mkSystemNameAt</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Unique</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>OccName</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SrcSpan</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Name</span>
<a name="line-48"></a><span class='hs-definition'>mkSystemNameAt</span> <span class='hs-varid'>uniq</span> <span class='hs-varid'>occ</span> <span class='hs-varid'>loc</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Name</span> <span class='hs-layout'>{</span> <span class='hs-varid'>n_uniq</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getKeyFastInt</span> <span class='hs-varid'>uniq</span><span class='hs-layout'>,</span> <span class='hs-varid'>n_sort</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>System</span>
<a name="line-49"></a>                                   <span class='hs-layout'>,</span> <span class='hs-varid'>n_occ</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>occ</span><span class='hs-layout'>,</span> <span class='hs-varid'>n_loc</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>loc</span> <span class='hs-layout'>}</span>
<a name="line-50"></a>
<a name="line-51"></a><a name="mkSystemVarName"></a><span class='hs-definition'>mkSystemVarName</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Unique</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>FastString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Name</span>
<a name="line-52"></a><span class='hs-definition'>mkSystemVarName</span> <span class='hs-varid'>uniq</span> <span class='hs-varid'>fs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkSystemName</span> <span class='hs-varid'>uniq</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkVarOccFS</span> <span class='hs-varid'>fs</span><span class='hs-layout'>)</span>
<a name="line-53"></a>
<a name="line-54"></a><a name="mkSysTvName"></a><span class='hs-definition'>mkSysTvName</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Unique</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>FastString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Name</span>
<a name="line-55"></a><span class='hs-definition'>mkSysTvName</span> <span class='hs-varid'>uniq</span> <span class='hs-varid'>fs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkSystemName</span> <span class='hs-varid'>uniq</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkOccNameFS</span> <span class='hs-varid'>tvName</span> <span class='hs-varid'>fs</span><span class='hs-layout'>)</span>
<a name="line-56"></a>
<a name="line-57"></a><a name="mkFCallName"></a><span class='hs-comment'>-- | Make a name for a foreign call</span>
<a name="line-58"></a><span class='hs-definition'>mkFCallName</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Unique</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Name</span>
<a name="line-59"></a><span class='hs-definition'>mkFCallName</span> <span class='hs-varid'>uniq</span> <span class='hs-varid'>str</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkInternalName</span> <span class='hs-varid'>uniq</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkVarOcc</span> <span class='hs-varid'>str</span><span class='hs-layout'>)</span> <span class='hs-varid'>noSrcSpan</span>
<a name="line-60"></a>   <span class='hs-comment'>-- The encoded string completely describes the ccall</span>
</pre>\end{code}

\begin{code}
<pre><a name="line-1"></a><a name="setNameUnique"></a><span class='hs-comment'>-- When we renumber/rename things, we need to be</span>
<a name="line-2"></a><span class='hs-comment'>-- able to change a Name's Unique to match the cached</span>
<a name="line-3"></a><span class='hs-comment'>-- one in the thing it's the name of.  If you know what I mean.</span>
<a name="line-4"></a><span class='hs-definition'>setNameUnique</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Unique</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Name</span>
<a name="line-5"></a><span class='hs-definition'>setNameUnique</span> <span class='hs-varid'>name</span> <span class='hs-varid'>uniq</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>name</span> <span class='hs-layout'>{</span><span class='hs-varid'>n_uniq</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getKeyFastInt</span> <span class='hs-varid'>uniq</span><span class='hs-layout'>}</span>
<a name="line-6"></a>
<a name="line-7"></a><a name="tidyNameOcc"></a><span class='hs-definition'>tidyNameOcc</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>OccName</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Name</span>
<a name="line-8"></a><span class='hs-comment'>-- We set the OccName of a Name when tidying</span>
<a name="line-9"></a><span class='hs-comment'>-- In doing so, we change System --&gt; Internal, so that when we print</span>
<a name="line-10"></a><span class='hs-comment'>-- it we don't get the unique by default.  It's tidy now!</span>
<a name="line-11"></a><span class='hs-definition'>tidyNameOcc</span> <span class='hs-varid'>name</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-conid'>Name</span> <span class='hs-layout'>{</span> <span class='hs-varid'>n_sort</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>System</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-varid'>occ</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>name</span> <span class='hs-layout'>{</span> <span class='hs-varid'>n_occ</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>occ</span><span class='hs-layout'>,</span> <span class='hs-varid'>n_sort</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Internal</span><span class='hs-layout'>}</span>
<a name="line-12"></a><span class='hs-definition'>tidyNameOcc</span> <span class='hs-varid'>name</span>                            <span class='hs-varid'>occ</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>name</span> <span class='hs-layout'>{</span> <span class='hs-varid'>n_occ</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>occ</span> <span class='hs-layout'>}</span>
<a name="line-13"></a>
<a name="line-14"></a><a name="localiseName"></a><span class='hs-comment'>-- | Make the 'Name' into an internal name, regardless of what it was to begin with</span>
<a name="line-15"></a><span class='hs-definition'>localiseName</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Name</span>
<a name="line-16"></a><span class='hs-definition'>localiseName</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>n</span> <span class='hs-layout'>{</span> <span class='hs-varid'>n_sort</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Internal</span> <span class='hs-layout'>}</span>
</pre>\end{code}

\begin{code}
<pre><a name="line-1"></a><a name="mkLocalisedOccName"></a><span class='hs-comment'>-- |Create a localised variant of a name.</span>
<a name="line-2"></a><span class='hs-comment'>--</span>
<a name="line-3"></a><span class='hs-comment'>-- If the name is external, encode the original's module name to disambiguate.</span>
<a name="line-4"></a><span class='hs-comment'>--</span>
<a name="line-5"></a><span class='hs-definition'>mkLocalisedOccName</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Module</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>OccName</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>OccName</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>OccName</span>
<a name="line-6"></a><span class='hs-definition'>mkLocalisedOccName</span> <span class='hs-varid'>this_mod</span> <span class='hs-varid'>mk_occ</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mk_occ</span> <span class='hs-varid'>origin</span> <span class='hs-layout'>(</span><span class='hs-varid'>nameOccName</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>
<a name="line-7"></a>  <span class='hs-keyword'>where</span>
<a name="line-8"></a>    <span class='hs-varid'>origin</span>
<a name="line-9"></a>      <span class='hs-keyglyph'>|</span> <span class='hs-varid'>nameIsLocalOrFrom</span> <span class='hs-varid'>this_mod</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-10"></a>      <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>                       <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-varid'>moduleNameColons</span> <span class='hs-varop'>.</span> <span class='hs-varid'>moduleName</span> <span class='hs-varop'>.</span> <span class='hs-varid'>nameModule</span> <span class='hs-varop'>$</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>
</pre>\end{code}

%************************************************************************
%*                                                                      *
\subsection{Hashing and comparison}
%*                                                                      *
%************************************************************************

\begin{code}
<pre><a name="line-1"></a><a name="hashName"></a><span class='hs-definition'>hashName</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span>         <span class='hs-comment'>-- ToDo: should really be Word</span>
<a name="line-2"></a><span class='hs-definition'>hashName</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getKey</span> <span class='hs-layout'>(</span><span class='hs-varid'>nameUnique</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-varop'>+</span> <span class='hs-num'>1</span>
<a name="line-3"></a>        <span class='hs-comment'>-- The +1 avoids keys with lots of zeros in the ls bits, which</span>
<a name="line-4"></a>        <span class='hs-comment'>-- interacts badly with the cheap and cheerful multiplication in</span>
<a name="line-5"></a>        <span class='hs-comment'>-- hashExpr</span>
<a name="line-6"></a>
<a name="line-7"></a><a name="cmpName"></a><span class='hs-definition'>cmpName</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Ordering</span>
<a name="line-8"></a><span class='hs-definition'>cmpName</span> <span class='hs-varid'>n1</span> <span class='hs-varid'>n2</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>iBox</span> <span class='hs-layout'>(</span><span class='hs-varid'>n_uniq</span> <span class='hs-varid'>n1</span><span class='hs-layout'>)</span> <span class='hs-varop'>`compare`</span> <span class='hs-varid'>iBox</span> <span class='hs-layout'>(</span><span class='hs-varid'>n_uniq</span> <span class='hs-varid'>n2</span><span class='hs-layout'>)</span>
<a name="line-9"></a>
<a name="line-10"></a><a name="stableNameCmp"></a><span class='hs-definition'>stableNameCmp</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Ordering</span>
<a name="line-11"></a><span class='hs-comment'>-- Compare lexicographically</span>
<a name="line-12"></a><span class='hs-definition'>stableNameCmp</span> <span class='hs-layout'>(</span><span class='hs-conid'>Name</span> <span class='hs-layout'>{</span> <span class='hs-varid'>n_sort</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>s1</span><span class='hs-layout'>,</span> <span class='hs-varid'>n_occ</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>occ1</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-13"></a>              <span class='hs-layout'>(</span><span class='hs-conid'>Name</span> <span class='hs-layout'>{</span> <span class='hs-varid'>n_sort</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>s2</span><span class='hs-layout'>,</span> <span class='hs-varid'>n_occ</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>occ2</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-14"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>s1</span> <span class='hs-varop'>`sort_cmp`</span> <span class='hs-varid'>s2</span><span class='hs-layout'>)</span> <span class='hs-varop'>`thenCmp`</span> <span class='hs-layout'>(</span><span class='hs-varid'>occ1</span> <span class='hs-varop'>`compare`</span> <span class='hs-varid'>occ2</span><span class='hs-layout'>)</span>
<a name="line-15"></a>    <span class='hs-comment'>-- The ordinary compare on OccNames is lexicogrpahic</span>
<a name="line-16"></a>  <span class='hs-keyword'>where</span>
<a name="line-17"></a>    <span class='hs-comment'>-- Later constructors are bigger</span>
<a name="line-18"></a>    <span class='hs-varid'>sort_cmp</span> <span class='hs-layout'>(</span><span class='hs-conid'>External</span> <span class='hs-varid'>m1</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>External</span> <span class='hs-varid'>m2</span><span class='hs-layout'>)</span>       <span class='hs-keyglyph'>=</span> <span class='hs-varid'>m1</span> <span class='hs-varop'>`stableModuleCmp`</span> <span class='hs-varid'>m2</span>
<a name="line-19"></a>    <span class='hs-varid'>sort_cmp</span> <span class='hs-layout'>(</span><span class='hs-conid'>External</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyword'>_</span>                   <span class='hs-keyglyph'>=</span> <span class='hs-conid'>LT</span>
<a name="line-20"></a>    <span class='hs-varid'>sort_cmp</span> <span class='hs-layout'>(</span><span class='hs-conid'>WiredIn</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>External</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>        <span class='hs-keyglyph'>=</span> <span class='hs-conid'>GT</span>
<a name="line-21"></a>    <span class='hs-varid'>sort_cmp</span> <span class='hs-layout'>(</span><span class='hs-conid'>WiredIn</span> <span class='hs-varid'>m1</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>WiredIn</span> <span class='hs-varid'>m2</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>m1</span> <span class='hs-varop'>`stableModuleCmp`</span> <span class='hs-varid'>m2</span>
<a name="line-22"></a>    <span class='hs-varid'>sort_cmp</span> <span class='hs-layout'>(</span><span class='hs-conid'>WiredIn</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>     <span class='hs-keyword'>_</span>                <span class='hs-keyglyph'>=</span> <span class='hs-conid'>LT</span>
<a name="line-23"></a>    <span class='hs-varid'>sort_cmp</span> <span class='hs-conid'>Internal</span>         <span class='hs-layout'>(</span><span class='hs-conid'>External</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>    <span class='hs-keyglyph'>=</span> <span class='hs-conid'>GT</span>
<a name="line-24"></a>    <span class='hs-varid'>sort_cmp</span> <span class='hs-conid'>Internal</span>         <span class='hs-layout'>(</span><span class='hs-conid'>WiredIn</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>     <span class='hs-keyglyph'>=</span> <span class='hs-conid'>GT</span>
<a name="line-25"></a>    <span class='hs-varid'>sort_cmp</span> <span class='hs-conid'>Internal</span>         <span class='hs-conid'>Internal</span>         <span class='hs-keyglyph'>=</span> <span class='hs-conid'>EQ</span>
<a name="line-26"></a>    <span class='hs-varid'>sort_cmp</span> <span class='hs-conid'>Internal</span>         <span class='hs-conid'>System</span>           <span class='hs-keyglyph'>=</span> <span class='hs-conid'>LT</span>
<a name="line-27"></a>    <span class='hs-varid'>sort_cmp</span> <span class='hs-conid'>System</span>           <span class='hs-conid'>System</span>           <span class='hs-keyglyph'>=</span> <span class='hs-conid'>EQ</span>
<a name="line-28"></a>    <span class='hs-varid'>sort_cmp</span> <span class='hs-conid'>System</span>           <span class='hs-keyword'>_</span>                <span class='hs-keyglyph'>=</span> <span class='hs-conid'>GT</span>
</pre>\end{code}

%************************************************************************
%*                                                                      *
\subsection[Name-instances]{Instance declarations}
%*                                                                      *
%************************************************************************

\begin{code}
<pre><a name="line-1"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Eq</span> <span class='hs-conid'>Name</span> <span class='hs-keyword'>where</span>
<a name="line-2"></a>    <span class='hs-varid'>a</span> <span class='hs-varop'>==</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-varop'>`compare`</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyword'>of</span> <span class='hs-layout'>{</span> <span class='hs-conid'>EQ</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>True</span><span class='hs-layout'>;</span>  <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>False</span> <span class='hs-layout'>}</span>
<a name="line-3"></a>    <span class='hs-varid'>a</span> <span class='hs-varop'>/=</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-varop'>`compare`</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyword'>of</span> <span class='hs-layout'>{</span> <span class='hs-conid'>EQ</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>False</span><span class='hs-layout'>;</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>True</span> <span class='hs-layout'>}</span>
<a name="line-4"></a>
<a name="line-5"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Ord</span> <span class='hs-conid'>Name</span> <span class='hs-keyword'>where</span>
<a name="line-6"></a>    <span class='hs-varid'>a</span> <span class='hs-varop'>&lt;=</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-varop'>`compare`</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyword'>of</span> <span class='hs-layout'>{</span> <span class='hs-conid'>LT</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>True</span><span class='hs-layout'>;</span>  <span class='hs-conid'>EQ</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>True</span><span class='hs-layout'>;</span>  <span class='hs-conid'>GT</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>False</span> <span class='hs-layout'>}</span>
<a name="line-7"></a>    <span class='hs-varid'>a</span> <span class='hs-varop'>&lt;</span>  <span class='hs-varid'>b</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-varop'>`compare`</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyword'>of</span> <span class='hs-layout'>{</span> <span class='hs-conid'>LT</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>True</span><span class='hs-layout'>;</span>  <span class='hs-conid'>EQ</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>False</span><span class='hs-layout'>;</span> <span class='hs-conid'>GT</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>False</span> <span class='hs-layout'>}</span>
<a name="line-8"></a>    <span class='hs-varid'>a</span> <span class='hs-varop'>&gt;=</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-varop'>`compare`</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyword'>of</span> <span class='hs-layout'>{</span> <span class='hs-conid'>LT</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>False</span><span class='hs-layout'>;</span> <span class='hs-conid'>EQ</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>True</span><span class='hs-layout'>;</span>  <span class='hs-conid'>GT</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>True</span>  <span class='hs-layout'>}</span>
<a name="line-9"></a>    <span class='hs-varid'>a</span> <span class='hs-varop'>&gt;</span>  <span class='hs-varid'>b</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-varop'>`compare`</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyword'>of</span> <span class='hs-layout'>{</span> <span class='hs-conid'>LT</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>False</span><span class='hs-layout'>;</span> <span class='hs-conid'>EQ</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>False</span><span class='hs-layout'>;</span> <span class='hs-conid'>GT</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>True</span>  <span class='hs-layout'>}</span>
<a name="line-10"></a>    <span class='hs-varid'>compare</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>cmpName</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span>
<a name="line-11"></a>
<a name="line-12"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Uniquable</span> <span class='hs-conid'>Name</span> <span class='hs-keyword'>where</span>
<a name="line-13"></a>    <span class='hs-varid'>getUnique</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>nameUnique</span>
<a name="line-14"></a>
<a name="line-15"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>NamedThing</span> <span class='hs-conid'>Name</span> <span class='hs-keyword'>where</span>
<a name="line-16"></a>    <span class='hs-varid'>getName</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>n</span>
<a name="line-17"></a>
<a name="line-18"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Data</span> <span class='hs-conid'>Name</span> <span class='hs-keyword'>where</span>
<a name="line-19"></a>  <span class='hs-comment'>-- don't traverse?</span>
<a name="line-20"></a>  <span class='hs-varid'>toConstr</span> <span class='hs-keyword'>_</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>abstractConstr</span> <span class='hs-str'>"Name"</span>
<a name="line-21"></a>  <span class='hs-varid'>gunfold</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>error</span> <span class='hs-str'>"gunfold"</span>
<a name="line-22"></a>  <span class='hs-varid'>dataTypeOf</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkNoRepType</span> <span class='hs-str'>"Name"</span>
</pre>\end{code}

%************************************************************************
%*                                                                      *
\subsection{Binary}
%*                                                                      *
%************************************************************************

\begin{code}
<pre><a name="line-1"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Binary</span> <span class='hs-conid'>Name</span> <span class='hs-keyword'>where</span>
<a name="line-2"></a>   <span class='hs-varid'>put_</span> <span class='hs-varid'>bh</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=</span>
<a name="line-3"></a>      <span class='hs-keyword'>case</span> <span class='hs-varid'>getUserData</span> <span class='hs-varid'>bh</span> <span class='hs-keyword'>of</span>
<a name="line-4"></a>        <span class='hs-conid'>UserData</span><span class='hs-layout'>{</span> <span class='hs-varid'>ud_put_name</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>put_name</span> <span class='hs-layout'>}</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>put_name</span> <span class='hs-varid'>bh</span> <span class='hs-varid'>name</span>
<a name="line-5"></a>
<a name="line-6"></a>   <span class='hs-varid'>get</span> <span class='hs-varid'>bh</span> <span class='hs-keyglyph'>=</span>
<a name="line-7"></a>      <span class='hs-keyword'>case</span> <span class='hs-varid'>getUserData</span> <span class='hs-varid'>bh</span> <span class='hs-keyword'>of</span>
<a name="line-8"></a>        <span class='hs-conid'>UserData</span> <span class='hs-layout'>{</span> <span class='hs-varid'>ud_get_name</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>get_name</span> <span class='hs-layout'>}</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>get_name</span> <span class='hs-varid'>bh</span>
</pre>\end{code}

%************************************************************************
%*                                                                      *
\subsection{Pretty printing}
%*                                                                      *
%************************************************************************

\begin{code}
<pre><a name="line-1"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Outputable</span> <span class='hs-conid'>Name</span> <span class='hs-keyword'>where</span>
<a name="line-2"></a>    <span class='hs-varid'>ppr</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprName</span> <span class='hs-varid'>name</span>
<a name="line-3"></a>
<a name="line-4"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>OutputableBndr</span> <span class='hs-conid'>Name</span> <span class='hs-keyword'>where</span>
<a name="line-5"></a>    <span class='hs-varid'>pprBndr</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprName</span> <span class='hs-varid'>name</span>
<a name="line-6"></a>    <span class='hs-varid'>pprInfixOcc</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprInfixName</span>
<a name="line-7"></a>    <span class='hs-varid'>pprPrefixOcc</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprPrefixName</span>
<a name="line-8"></a>
<a name="line-9"></a>
<a name="line-10"></a><a name="pprName"></a><span class='hs-definition'>pprName</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-11"></a><span class='hs-definition'>pprName</span> <span class='hs-layout'>(</span><span class='hs-conid'>Name</span> <span class='hs-layout'>{</span><span class='hs-varid'>n_sort</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sort</span><span class='hs-layout'>,</span> <span class='hs-varid'>n_uniq</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>u</span><span class='hs-layout'>,</span> <span class='hs-varid'>n_occ</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>occ</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-12"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getPprStyle</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span> <span class='hs-varid'>sty</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-13"></a>    <span class='hs-keyword'>case</span> <span class='hs-varid'>sort</span> <span class='hs-keyword'>of</span>
<a name="line-14"></a>      <span class='hs-conid'>WiredIn</span> <span class='hs-varid'>mod</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>builtin</span>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>pprExternal</span> <span class='hs-varid'>sty</span> <span class='hs-varid'>uniq</span> <span class='hs-varid'>mod</span> <span class='hs-varid'>occ</span> <span class='hs-conid'>True</span>  <span class='hs-varid'>builtin</span>
<a name="line-15"></a>      <span class='hs-conid'>External</span> <span class='hs-varid'>mod</span>            <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>pprExternal</span> <span class='hs-varid'>sty</span> <span class='hs-varid'>uniq</span> <span class='hs-varid'>mod</span> <span class='hs-varid'>occ</span> <span class='hs-conid'>False</span> <span class='hs-conid'>UserSyntax</span>
<a name="line-16"></a>      <span class='hs-conid'>System</span>                  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>pprSystem</span> <span class='hs-varid'>sty</span> <span class='hs-varid'>uniq</span> <span class='hs-varid'>occ</span>
<a name="line-17"></a>      <span class='hs-conid'>Internal</span>                <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>pprInternal</span> <span class='hs-varid'>sty</span> <span class='hs-varid'>uniq</span> <span class='hs-varid'>occ</span>
<a name="line-18"></a>  <span class='hs-keyword'>where</span> <span class='hs-varid'>uniq</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkUniqueGrimily</span> <span class='hs-layout'>(</span><span class='hs-varid'>iBox</span> <span class='hs-varid'>u</span><span class='hs-layout'>)</span>
<a name="line-19"></a>
<a name="line-20"></a><a name="pprExternal"></a><span class='hs-definition'>pprExternal</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>PprStyle</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Unique</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Module</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>OccName</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>BuiltInSyntax</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-21"></a><span class='hs-definition'>pprExternal</span> <span class='hs-varid'>sty</span> <span class='hs-varid'>uniq</span> <span class='hs-varid'>mod</span> <span class='hs-varid'>occ</span> <span class='hs-varid'>is_wired</span> <span class='hs-varid'>is_builtin</span>
<a name="line-22"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>codeStyle</span> <span class='hs-varid'>sty</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>mod</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'_'</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>ppr_z_occ_name</span> <span class='hs-varid'>occ</span>
<a name="line-23"></a>        <span class='hs-comment'>-- In code style, always qualify</span>
<a name="line-24"></a>        <span class='hs-comment'>-- ToDo: maybe we could print all wired-in things unqualified</span>
<a name="line-25"></a>        <span class='hs-comment'>--       in code style, to reduce symbol table bloat?</span>
<a name="line-26"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>debugStyle</span> <span class='hs-varid'>sty</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pp_mod</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>ppr_occ_name</span> <span class='hs-varid'>occ</span>
<a name="line-27"></a>                     <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>braces</span> <span class='hs-layout'>(</span><span class='hs-varid'>hsep</span> <span class='hs-keyglyph'>[</span><span class='hs-keyword'>if</span> <span class='hs-varid'>is_wired</span> <span class='hs-keyword'>then</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"(w)"</span><span class='hs-layout'>)</span> <span class='hs-keyword'>else</span> <span class='hs-varid'>empty</span><span class='hs-layout'>,</span>
<a name="line-28"></a>                                      <span class='hs-varid'>pprNameSpaceBrief</span> <span class='hs-layout'>(</span><span class='hs-varid'>occNameSpace</span> <span class='hs-varid'>occ</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-29"></a>                                      <span class='hs-varid'>pprUnique</span> <span class='hs-varid'>uniq</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-30"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>BuiltInSyntax</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>is_builtin</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr_occ_name</span> <span class='hs-varid'>occ</span>  <span class='hs-comment'>-- Never qualify builtin syntax</span>
<a name="line-31"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>                   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprModulePrefix</span> <span class='hs-varid'>sty</span> <span class='hs-varid'>mod</span> <span class='hs-varid'>occ</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>ppr_occ_name</span> <span class='hs-varid'>occ</span>
<a name="line-32"></a>  <span class='hs-keyword'>where</span>
<a name="line-33"></a>    <span class='hs-varid'>pp_mod</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sdocWithDynFlags</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>dflags</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-34"></a>             <span class='hs-keyword'>if</span> <span class='hs-varid'>gopt</span> <span class='hs-conid'>Opt_SuppressModulePrefixes</span> <span class='hs-varid'>dflags</span>
<a name="line-35"></a>             <span class='hs-keyword'>then</span> <span class='hs-varid'>empty</span>
<a name="line-36"></a>             <span class='hs-keyword'>else</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>mod</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>dot</span>
<a name="line-37"></a>
<a name="line-38"></a><a name="pprInternal"></a><span class='hs-definition'>pprInternal</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>PprStyle</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Unique</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>OccName</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-39"></a><span class='hs-definition'>pprInternal</span> <span class='hs-varid'>sty</span> <span class='hs-varid'>uniq</span> <span class='hs-varid'>occ</span>
<a name="line-40"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>codeStyle</span> <span class='hs-varid'>sty</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprUnique</span> <span class='hs-varid'>uniq</span>
<a name="line-41"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>debugStyle</span> <span class='hs-varid'>sty</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr_occ_name</span> <span class='hs-varid'>occ</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>braces</span> <span class='hs-layout'>(</span><span class='hs-varid'>hsep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>pprNameSpaceBrief</span> <span class='hs-layout'>(</span><span class='hs-varid'>occNameSpace</span> <span class='hs-varid'>occ</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-42"></a>                                                       <span class='hs-varid'>pprUnique</span> <span class='hs-varid'>uniq</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-43"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>dumpStyle</span> <span class='hs-varid'>sty</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr_occ_name</span> <span class='hs-varid'>occ</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>ppr_underscore_unique</span> <span class='hs-varid'>uniq</span>
<a name="line-44"></a>                        <span class='hs-comment'>-- For debug dumps, we're not necessarily dumping</span>
<a name="line-45"></a>                        <span class='hs-comment'>-- tidied code, so we need to print the uniques.</span>
<a name="line-46"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr_occ_name</span> <span class='hs-varid'>occ</span>   <span class='hs-comment'>-- User style</span>
<a name="line-47"></a>
<a name="line-48"></a><a name="pprSystem"></a><span class='hs-comment'>-- Like Internal, except that we only omit the unique in Iface style</span>
<a name="line-49"></a><span class='hs-definition'>pprSystem</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>PprStyle</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Unique</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>OccName</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-50"></a><span class='hs-definition'>pprSystem</span> <span class='hs-varid'>sty</span> <span class='hs-varid'>uniq</span> <span class='hs-varid'>occ</span>
<a name="line-51"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>codeStyle</span> <span class='hs-varid'>sty</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprUnique</span> <span class='hs-varid'>uniq</span>
<a name="line-52"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>debugStyle</span> <span class='hs-varid'>sty</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr_occ_name</span> <span class='hs-varid'>occ</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>ppr_underscore_unique</span> <span class='hs-varid'>uniq</span>
<a name="line-53"></a>                     <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>braces</span> <span class='hs-layout'>(</span><span class='hs-varid'>pprNameSpaceBrief</span> <span class='hs-layout'>(</span><span class='hs-varid'>occNameSpace</span> <span class='hs-varid'>occ</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-54"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr_occ_name</span> <span class='hs-varid'>occ</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>ppr_underscore_unique</span> <span class='hs-varid'>uniq</span>
<a name="line-55"></a>                                <span class='hs-comment'>-- If the tidy phase hasn't run, the OccName</span>
<a name="line-56"></a>                                <span class='hs-comment'>-- is unlikely to be informative (like 's'),</span>
<a name="line-57"></a>                                <span class='hs-comment'>-- so print the unique</span>
<a name="line-58"></a>
<a name="line-59"></a>
<a name="line-60"></a><a name="pprModulePrefix"></a><span class='hs-definition'>pprModulePrefix</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>PprStyle</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Module</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>OccName</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-61"></a><span class='hs-comment'>-- Print the "M." part of a name, based on whether it's in scope or not</span>
<a name="line-62"></a><span class='hs-comment'>-- See Note [Printing original names] in HscTypes</span>
<a name="line-63"></a><span class='hs-definition'>pprModulePrefix</span> <span class='hs-varid'>sty</span> <span class='hs-varid'>mod</span> <span class='hs-varid'>occ</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sdocWithDynFlags</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>dflags</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-64"></a>  <span class='hs-keyword'>if</span> <span class='hs-varid'>gopt</span> <span class='hs-conid'>Opt_SuppressModulePrefixes</span> <span class='hs-varid'>dflags</span>
<a name="line-65"></a>  <span class='hs-keyword'>then</span> <span class='hs-varid'>empty</span>
<a name="line-66"></a>  <span class='hs-keyword'>else</span>
<a name="line-67"></a>    <span class='hs-keyword'>case</span> <span class='hs-varid'>qualName</span> <span class='hs-varid'>sty</span> <span class='hs-varid'>mod</span> <span class='hs-varid'>occ</span> <span class='hs-keyword'>of</span>              <span class='hs-comment'>-- See Outputable.QualifyName:</span>
<a name="line-68"></a>      <span class='hs-conid'>NameQual</span> <span class='hs-varid'>modname</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>modname</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>dot</span>       <span class='hs-comment'>-- Name is in scope</span>
<a name="line-69"></a>      <span class='hs-conid'>NameNotInScope1</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>mod</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>dot</span>           <span class='hs-comment'>-- Not in scope</span>
<a name="line-70"></a>      <span class='hs-conid'>NameNotInScope2</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-varid'>modulePackageId</span> <span class='hs-varid'>mod</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>colon</span>     <span class='hs-comment'>-- Module not in</span>
<a name="line-71"></a>                          <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-varid'>moduleName</span> <span class='hs-varid'>mod</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>dot</span>         <span class='hs-comment'>-- scope either</span>
<a name="line-72"></a>      <span class='hs-sel'>_otherwise</span>       <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>empty</span>
<a name="line-73"></a>
<a name="line-74"></a><a name="ppr_underscore_unique"></a><span class='hs-definition'>ppr_underscore_unique</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Unique</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-75"></a><span class='hs-comment'>-- Print an underscore separating the name from its unique</span>
<a name="line-76"></a><span class='hs-comment'>-- But suppress it if we aren't printing the uniques anyway</span>
<a name="line-77"></a><span class='hs-definition'>ppr_underscore_unique</span> <span class='hs-varid'>uniq</span>
<a name="line-78"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sdocWithDynFlags</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>dflags</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-79"></a>    <span class='hs-keyword'>if</span> <span class='hs-varid'>gopt</span> <span class='hs-conid'>Opt_SuppressUniques</span> <span class='hs-varid'>dflags</span>
<a name="line-80"></a>    <span class='hs-keyword'>then</span> <span class='hs-varid'>empty</span>
<a name="line-81"></a>    <span class='hs-keyword'>else</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'_'</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>pprUnique</span> <span class='hs-varid'>uniq</span>
<a name="line-82"></a>
<a name="line-83"></a><a name="ppr_occ_name"></a><span class='hs-definition'>ppr_occ_name</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>OccName</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-84"></a><span class='hs-definition'>ppr_occ_name</span> <span class='hs-varid'>occ</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ftext</span> <span class='hs-layout'>(</span><span class='hs-varid'>occNameFS</span> <span class='hs-varid'>occ</span><span class='hs-layout'>)</span>
<a name="line-85"></a>        <span class='hs-comment'>-- Don't use pprOccName; instead, just print the string of the OccName;</span>
<a name="line-86"></a>        <span class='hs-comment'>-- we print the namespace in the debug stuff above</span>
<a name="line-87"></a>
<a name="line-88"></a><a name="ppr_z_occ_name"></a><span class='hs-comment'>-- In code style, we Z-encode the strings.  The results of Z-encoding each FastString are</span>
<a name="line-89"></a><span class='hs-comment'>-- cached behind the scenes in the FastString implementation.</span>
<a name="line-90"></a><span class='hs-definition'>ppr_z_occ_name</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>OccName</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-91"></a><span class='hs-definition'>ppr_z_occ_name</span> <span class='hs-varid'>occ</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ztext</span> <span class='hs-layout'>(</span><span class='hs-varid'>zEncodeFS</span> <span class='hs-layout'>(</span><span class='hs-varid'>occNameFS</span> <span class='hs-varid'>occ</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-92"></a>
<a name="line-93"></a><a name="pprDefinedAt"></a><span class='hs-comment'>-- Prints (if mod information is available) "Defined at &lt;loc&gt;" or</span>
<a name="line-94"></a><span class='hs-comment'>--  "Defined in &lt;mod&gt;" information for a Name.</span>
<a name="line-95"></a><span class='hs-definition'>pprDefinedAt</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-96"></a><span class='hs-definition'>pprDefinedAt</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"Defined"</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>pprNameDefnLoc</span> <span class='hs-varid'>name</span>
<a name="line-97"></a>
<a name="line-98"></a><a name="pprNameDefnLoc"></a><span class='hs-definition'>pprNameDefnLoc</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-99"></a><span class='hs-comment'>-- Prints "at &lt;loc&gt;" or</span>
<a name="line-100"></a><span class='hs-comment'>--     or "in &lt;mod&gt;" depending on what info is available</span>
<a name="line-101"></a><span class='hs-definition'>pprNameDefnLoc</span> <span class='hs-varid'>name</span>
<a name="line-102"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>nameSrcLoc</span> <span class='hs-varid'>name</span> <span class='hs-keyword'>of</span>
<a name="line-103"></a>         <span class='hs-comment'>-- nameSrcLoc rather than nameSrcSpan</span>
<a name="line-104"></a>         <span class='hs-comment'>-- It seems less cluttered to show a location</span>
<a name="line-105"></a>         <span class='hs-comment'>-- rather than a span for the definition point</span>
<a name="line-106"></a>       <span class='hs-conid'>RealSrcLoc</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"at"</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>s</span>
<a name="line-107"></a>       <span class='hs-conid'>UnhelpfulLoc</span> <span class='hs-varid'>s</span>
<a name="line-108"></a>         <span class='hs-keyglyph'>|</span> <span class='hs-varid'>isInternalName</span> <span class='hs-varid'>name</span> <span class='hs-varop'>||</span> <span class='hs-varid'>isSystemName</span> <span class='hs-varid'>name</span>
<a name="line-109"></a>         <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"at"</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ftext</span> <span class='hs-varid'>s</span>
<a name="line-110"></a>         <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>
<a name="line-111"></a>         <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"in"</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>quotes</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-varid'>nameModule</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
</pre>\end{code}

%************************************************************************
%*                                                                      *
\subsection{Overloaded functions related to Names}
%*                                                                      *
%************************************************************************

\begin{code}
<pre><a name="line-1"></a><a name="NamedThing"></a><span class='hs-comment'>-- | A class allowing convenient access to the 'Name' of various datatypes</span>
<a name="line-2"></a><a name="NamedThing"></a><span class='hs-keyword'>class</span> <span class='hs-conid'>NamedThing</span> <span class='hs-varid'>a</span> <span class='hs-keyword'>where</span>
<a name="line-3"></a>    <span class='hs-varid'>getOccName</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>OccName</span>
<a name="line-4"></a>    <span class='hs-varid'>getName</span>    <span class='hs-keyglyph'>::</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Name</span>
<a name="line-5"></a>
<a name="line-6"></a>    <span class='hs-varid'>getOccName</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>nameOccName</span> <span class='hs-layout'>(</span><span class='hs-varid'>getName</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span>      <span class='hs-comment'>-- Default method</span>
</pre>\end{code}

\begin{code}
<pre><a name="line-1"></a><a name="getSrcLoc"></a><span class='hs-definition'>getSrcLoc</span>           <span class='hs-keyglyph'>::</span> <span class='hs-conid'>NamedThing</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SrcLoc</span>
<a name="line-2"></a><a name="getSrcSpan"></a><span class='hs-definition'>getSrcSpan</span>          <span class='hs-keyglyph'>::</span> <span class='hs-conid'>NamedThing</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SrcSpan</span>
<a name="line-3"></a><a name="getOccString"></a><span class='hs-definition'>getOccString</span>        <span class='hs-keyglyph'>::</span> <span class='hs-conid'>NamedThing</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>String</span>
<a name="line-4"></a>
<a name="line-5"></a><span class='hs-definition'>getSrcLoc</span>           <span class='hs-keyglyph'>=</span> <span class='hs-varid'>nameSrcLoc</span>           <span class='hs-varop'>.</span> <span class='hs-varid'>getName</span>
<a name="line-6"></a><span class='hs-definition'>getSrcSpan</span>          <span class='hs-keyglyph'>=</span> <span class='hs-varid'>nameSrcSpan</span>          <span class='hs-varop'>.</span> <span class='hs-varid'>getName</span>
<a name="line-7"></a><span class='hs-definition'>getOccString</span>        <span class='hs-keyglyph'>=</span> <span class='hs-varid'>occNameString</span>        <span class='hs-varop'>.</span> <span class='hs-varid'>getOccName</span>
<a name="line-8"></a>
<a name="line-9"></a><a name="pprInfixName"></a><span class='hs-definition'>pprInfixName</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprPrefixName</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Outputable</span> <span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-conid'>NamedThing</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-10"></a><span class='hs-comment'>-- See Outputable.pprPrefixVar, pprInfixVar;</span>
<a name="line-11"></a><span class='hs-comment'>-- add parens or back-quotes as appropriate</span>
<a name="line-12"></a><span class='hs-definition'>pprInfixName</span>  <span class='hs-varid'>n</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprInfixVar</span> <span class='hs-layout'>(</span><span class='hs-varid'>isSymOcc</span> <span class='hs-layout'>(</span><span class='hs-varid'>getOccName</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span>
<a name="line-13"></a>
<a name="line-14"></a><a name="pprPrefixName"></a><span class='hs-definition'>pprPrefixName</span> <span class='hs-varid'>thing</span> 
<a name="line-15"></a> <span class='hs-keyglyph'>|</span>  <span class='hs-varid'>name</span> <span class='hs-varop'>`hasKey`</span> <span class='hs-varid'>liftedTypeKindTyConKey</span> 
<a name="line-16"></a> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>name</span>   <span class='hs-comment'>-- See Note [Special treatment for kind *]</span>
<a name="line-17"></a> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>
<a name="line-18"></a> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprPrefixVar</span> <span class='hs-layout'>(</span><span class='hs-varid'>isSymOcc</span> <span class='hs-layout'>(</span><span class='hs-varid'>nameOccName</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>
<a name="line-19"></a> <span class='hs-keyword'>where</span>
<a name="line-20"></a>   <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getName</span> <span class='hs-varid'>thing</span>
</pre>\end{code}

Note [Special treatment for kind *]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Do not put parens around the kind '*'.  Even though it looks like
an operator, it is really a special case.

This pprPrefixName stuff is really only used when printing HsSyn,
which has to be polymorphic in the name type, and hence has to go via
the overloaded function pprPrefixOcc.  It's easier where we know the
type being pretty printed; eg the pretty-printing code in TypeRep.

See Trac #7645, which led to this.

</body>
</html>
