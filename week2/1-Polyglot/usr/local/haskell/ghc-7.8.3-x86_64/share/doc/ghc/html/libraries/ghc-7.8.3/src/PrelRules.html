<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>prelude/PrelRules.lhs</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
%
% (c) The GRASP/AQUA Project, Glasgow University, 1992-1998
%
\section[ConFold]{Constant Folder}

Conceptually, constant folding should be parameterized with the kind
of target machine to get identical behaviour during compilation time
and runtime. We cheat a little bit here...

ToDo:
   check boundaries before folding, e.g. we can fold the Float addition
   (i1 + i2) only if it results in a valid Float.

\begin{code}
<pre><a name="line-1"></a><span class='hs-comment'>{-# LANGUAGE RankNTypes #-}</span>
<a name="line-2"></a><span class='hs-comment'>{-# OPTIONS -optc-DNON_POSIX_SOURCE #-}</span>
<a name="line-3"></a>
<a name="line-4"></a><span class='hs-keyword'>module</span> <span class='hs-conid'>PrelRules</span> <span class='hs-layout'>(</span> <span class='hs-varid'>primOpRules</span><span class='hs-layout'>,</span> <span class='hs-varid'>builtinRules</span> <span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-5"></a>
<a name="line-6"></a><span class='hs-cpp'>#include "HsVersions.h"</span>
<a name="line-7"></a><span class='hs-cpp'>#include "../includes/MachDeps.h"</span>
<a name="line-8"></a>
<a name="line-9"></a><span class='hs-keyword'>import</span> <span class='hs-comment'>{-# SOURCE #-}</span> <span class='hs-conid'>MkId</span> <span class='hs-layout'>(</span> <span class='hs-varid'>mkPrimOpId</span><span class='hs-layout'>,</span> <span class='hs-varid'>magicDictId</span> <span class='hs-layout'>)</span>
<a name="line-10"></a>
<a name="line-11"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>CoreSyn</span>
<a name="line-12"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>MkCore</span>
<a name="line-13"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Id</span>
<a name="line-14"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Literal</span>
<a name="line-15"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>CoreSubst</span>   <span class='hs-layout'>(</span> <span class='hs-varid'>exprIsLiteral_maybe</span> <span class='hs-layout'>)</span>
<a name="line-16"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>PrimOp</span>      <span class='hs-layout'>(</span> <span class='hs-conid'>PrimOp</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>tagToEnumKey</span> <span class='hs-layout'>)</span>
<a name="line-17"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>TysWiredIn</span>
<a name="line-18"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>TysPrim</span>
<a name="line-19"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>TyCon</span>       <span class='hs-layout'>(</span> <span class='hs-varid'>tyConDataCons_maybe</span><span class='hs-layout'>,</span> <span class='hs-varid'>isEnumerationTyCon</span><span class='hs-layout'>,</span> <span class='hs-varid'>isNewTyCon</span><span class='hs-layout'>,</span> <span class='hs-varid'>unwrapNewTyCon_maybe</span> <span class='hs-layout'>)</span>
<a name="line-20"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>DataCon</span>     <span class='hs-layout'>(</span> <span class='hs-varid'>dataConTag</span><span class='hs-layout'>,</span> <span class='hs-varid'>dataConTyCon</span><span class='hs-layout'>,</span> <span class='hs-varid'>dataConWorkId</span> <span class='hs-layout'>)</span>
<a name="line-21"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>CoreUtils</span>   <span class='hs-layout'>(</span> <span class='hs-varid'>cheapEqExpr</span><span class='hs-layout'>,</span> <span class='hs-varid'>exprIsHNF</span> <span class='hs-layout'>)</span>
<a name="line-22"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>CoreUnfold</span>  <span class='hs-layout'>(</span> <span class='hs-varid'>exprIsConApp_maybe</span> <span class='hs-layout'>)</span>
<a name="line-23"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Type</span>
<a name="line-24"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>TypeRep</span>
<a name="line-25"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>OccName</span>     <span class='hs-layout'>(</span> <span class='hs-varid'>occNameFS</span> <span class='hs-layout'>)</span>
<a name="line-26"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>PrelNames</span>
<a name="line-27"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Maybes</span>      <span class='hs-layout'>(</span> <span class='hs-varid'>orElse</span> <span class='hs-layout'>)</span>
<a name="line-28"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Name</span>        <span class='hs-layout'>(</span> <span class='hs-conid'>Name</span><span class='hs-layout'>,</span> <span class='hs-varid'>nameOccName</span> <span class='hs-layout'>)</span>
<a name="line-29"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Outputable</span>
<a name="line-30"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>FastString</span>
<a name="line-31"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>BasicTypes</span>
<a name="line-32"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>DynFlags</span>
<a name="line-33"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Platform</span>
<a name="line-34"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Util</span>
<a name="line-35"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Coercion</span>     <span class='hs-layout'>(</span><span class='hs-varid'>mkUnbranchedAxInstCo</span><span class='hs-layout'>,</span><span class='hs-varid'>mkSymCo</span><span class='hs-layout'>,</span><span class='hs-conid'>Role</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-36"></a>
<a name="line-37"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Control</span><span class='hs-varop'>.</span><span class='hs-conid'>Applicative</span> <span class='hs-layout'>(</span> <span class='hs-conid'>Applicative</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>Alternative</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span> <span class='hs-layout'>)</span>
<a name="line-38"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Control</span><span class='hs-varop'>.</span><span class='hs-conid'>Monad</span>
<a name="line-39"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Bits</span> <span class='hs-keyword'>as</span> <span class='hs-conid'>Bits</span>
<a name="line-40"></a><span class='hs-keyword'>import</span> <span class='hs-keyword'>qualified</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>ByteString</span> <span class='hs-keyword'>as</span> <span class='hs-conid'>BS</span>
<a name="line-41"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Int</span>
<a name="line-42"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Ratio</span>
<a name="line-43"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Word</span>
</pre>\end{code}


Note [Constant folding]
~~~~~~~~~~~~~~~~~~~~~~~
primOpRules generates a rewrite rule for each primop
These rules do what is often called "constant folding"
E.g. the rules for +# might say
        4 +# 5 = 9
Well, of course you'd need a lot of rules if you did it
like that, so we use a BuiltinRule instead, so that we
can match in any two literal values.  So the rule is really
more like
        (Lit x) +# (Lit y) = Lit (x+#y)
where the (+#) on the rhs is done at compile time

That is why these rules are built in here.


\begin{code}
<pre><a name="line-1"></a><a name="primOpRules"></a><span class='hs-definition'>primOpRules</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>PrimOp</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>CoreRule</span>
<a name="line-2"></a>    <span class='hs-comment'>-- ToDo: something for integer-shift ops?</span>
<a name="line-3"></a>    <span class='hs-comment'>--       NotOp</span>
<a name="line-4"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>TagToEnumOp</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkPrimOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-num'>2</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>tagToEnumRule</span> <span class='hs-keyglyph'>]</span>
<a name="line-5"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>DataToTagOp</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkPrimOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-num'>2</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>dataToTagRule</span> <span class='hs-keyglyph'>]</span>
<a name="line-6"></a>
<a name="line-7"></a><span class='hs-comment'>-- Int operations</span>
<a name="line-8"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>IntAddOp</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkPrimOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-num'>2</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>binaryLit</span> <span class='hs-layout'>(</span><span class='hs-varid'>intOp2</span> <span class='hs-layout'>(</span><span class='hs-varop'>+</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-9"></a>                                               <span class='hs-layout'>,</span> <span class='hs-varid'>identityDynFlags</span> <span class='hs-varid'>zeroi</span> <span class='hs-keyglyph'>]</span>
<a name="line-10"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>IntSubOp</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkPrimOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-num'>2</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>binaryLit</span> <span class='hs-layout'>(</span><span class='hs-varid'>intOp2</span> <span class='hs-layout'>(</span><span class='hs-comment'>-</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-11"></a>                                               <span class='hs-layout'>,</span> <span class='hs-varid'>rightIdentityDynFlags</span> <span class='hs-varid'>zeroi</span>
<a name="line-12"></a>                                               <span class='hs-layout'>,</span> <span class='hs-varid'>equalArgs</span> <span class='hs-varop'>&gt;&gt;</span> <span class='hs-varid'>retLit</span> <span class='hs-varid'>zeroi</span> <span class='hs-keyglyph'>]</span>
<a name="line-13"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>IntMulOp</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkPrimOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-num'>2</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>binaryLit</span> <span class='hs-layout'>(</span><span class='hs-varid'>intOp2</span> <span class='hs-layout'>(</span><span class='hs-varop'>*</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-14"></a>                                               <span class='hs-layout'>,</span> <span class='hs-varid'>zeroElem</span> <span class='hs-varid'>zeroi</span>
<a name="line-15"></a>                                               <span class='hs-layout'>,</span> <span class='hs-varid'>identityDynFlags</span> <span class='hs-varid'>onei</span> <span class='hs-keyglyph'>]</span>
<a name="line-16"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>IntQuotOp</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkPrimOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-num'>2</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>nonZeroLit</span> <span class='hs-num'>1</span> <span class='hs-varop'>&gt;&gt;</span> <span class='hs-varid'>binaryLit</span> <span class='hs-layout'>(</span><span class='hs-varid'>intOp2</span> <span class='hs-varid'>quot</span><span class='hs-layout'>)</span>
<a name="line-17"></a>                                               <span class='hs-layout'>,</span> <span class='hs-varid'>leftZero</span> <span class='hs-varid'>zeroi</span>
<a name="line-18"></a>                                               <span class='hs-layout'>,</span> <span class='hs-varid'>rightIdentityDynFlags</span> <span class='hs-varid'>onei</span>
<a name="line-19"></a>                                               <span class='hs-layout'>,</span> <span class='hs-varid'>equalArgs</span> <span class='hs-varop'>&gt;&gt;</span> <span class='hs-varid'>retLit</span> <span class='hs-varid'>onei</span> <span class='hs-keyglyph'>]</span>
<a name="line-20"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>IntRemOp</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkPrimOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-num'>2</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>nonZeroLit</span> <span class='hs-num'>1</span> <span class='hs-varop'>&gt;&gt;</span> <span class='hs-varid'>binaryLit</span> <span class='hs-layout'>(</span><span class='hs-varid'>intOp2</span> <span class='hs-varid'>rem</span><span class='hs-layout'>)</span>
<a name="line-21"></a>                                               <span class='hs-layout'>,</span> <span class='hs-varid'>leftZero</span> <span class='hs-varid'>zeroi</span>
<a name="line-22"></a>                                               <span class='hs-layout'>,</span> <span class='hs-keyword'>do</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getLiteral</span> <span class='hs-num'>1</span>
<a name="line-23"></a>                                                    <span class='hs-varid'>dflags</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getDynFlags</span>
<a name="line-24"></a>                                                    <span class='hs-varid'>guard</span> <span class='hs-layout'>(</span><span class='hs-varid'>l</span> <span class='hs-varop'>==</span> <span class='hs-varid'>onei</span> <span class='hs-varid'>dflags</span><span class='hs-layout'>)</span>
<a name="line-25"></a>                                                    <span class='hs-varid'>retLit</span> <span class='hs-varid'>zeroi</span>
<a name="line-26"></a>                                               <span class='hs-layout'>,</span> <span class='hs-varid'>equalArgs</span> <span class='hs-varop'>&gt;&gt;</span> <span class='hs-varid'>retLit</span> <span class='hs-varid'>zeroi</span>
<a name="line-27"></a>                                               <span class='hs-layout'>,</span> <span class='hs-varid'>equalArgs</span> <span class='hs-varop'>&gt;&gt;</span> <span class='hs-varid'>retLit</span> <span class='hs-varid'>zeroi</span> <span class='hs-keyglyph'>]</span>
<a name="line-28"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>AndIOp</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkPrimOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-num'>2</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>binaryLit</span> <span class='hs-layout'>(</span><span class='hs-varid'>intOp2</span> <span class='hs-layout'>(</span><span class='hs-varop'>.&amp;.</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-29"></a>                                               <span class='hs-layout'>,</span> <span class='hs-varid'>idempotent</span>
<a name="line-30"></a>                                               <span class='hs-layout'>,</span> <span class='hs-varid'>zeroElem</span> <span class='hs-varid'>zeroi</span> <span class='hs-keyglyph'>]</span>
<a name="line-31"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>OrIOp</span>       <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkPrimOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-num'>2</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>binaryLit</span> <span class='hs-layout'>(</span><span class='hs-varid'>intOp2</span> <span class='hs-layout'>(</span><span class='hs-varop'>.|.</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-32"></a>                                               <span class='hs-layout'>,</span> <span class='hs-varid'>idempotent</span>
<a name="line-33"></a>                                               <span class='hs-layout'>,</span> <span class='hs-varid'>identityDynFlags</span> <span class='hs-varid'>zeroi</span> <span class='hs-keyglyph'>]</span>
<a name="line-34"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>XorIOp</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkPrimOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-num'>2</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>binaryLit</span> <span class='hs-layout'>(</span><span class='hs-varid'>intOp2</span> <span class='hs-varid'>xor</span><span class='hs-layout'>)</span>
<a name="line-35"></a>                                               <span class='hs-layout'>,</span> <span class='hs-varid'>identityDynFlags</span> <span class='hs-varid'>zeroi</span>
<a name="line-36"></a>                                               <span class='hs-layout'>,</span> <span class='hs-varid'>equalArgs</span> <span class='hs-varop'>&gt;&gt;</span> <span class='hs-varid'>retLit</span> <span class='hs-varid'>zeroi</span> <span class='hs-keyglyph'>]</span>
<a name="line-37"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>IntNegOp</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkPrimOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-num'>1</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>unaryLit</span> <span class='hs-varid'>negOp</span>
<a name="line-38"></a>                                               <span class='hs-layout'>,</span> <span class='hs-varid'>inversePrimOp</span> <span class='hs-conid'>IntNegOp</span> <span class='hs-keyglyph'>]</span>
<a name="line-39"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>ISllOp</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkPrimOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-num'>2</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>binaryLit</span> <span class='hs-layout'>(</span><span class='hs-varid'>intOp2</span> <span class='hs-conid'>Bits</span><span class='hs-varop'>.</span><span class='hs-varid'>shiftL</span><span class='hs-layout'>)</span>
<a name="line-40"></a>                                               <span class='hs-layout'>,</span> <span class='hs-varid'>rightIdentityDynFlags</span> <span class='hs-varid'>zeroi</span> <span class='hs-keyglyph'>]</span>
<a name="line-41"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>ISraOp</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkPrimOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-num'>2</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>binaryLit</span> <span class='hs-layout'>(</span><span class='hs-varid'>intOp2</span> <span class='hs-conid'>Bits</span><span class='hs-varop'>.</span><span class='hs-varid'>shiftR</span><span class='hs-layout'>)</span>
<a name="line-42"></a>                                               <span class='hs-layout'>,</span> <span class='hs-varid'>rightIdentityDynFlags</span> <span class='hs-varid'>zeroi</span> <span class='hs-keyglyph'>]</span>
<a name="line-43"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>ISrlOp</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkPrimOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-num'>2</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>binaryLit</span> <span class='hs-layout'>(</span><span class='hs-varid'>intOp2</span> <span class='hs-varid'>shiftRightLogical</span><span class='hs-layout'>)</span>
<a name="line-44"></a>                                               <span class='hs-layout'>,</span> <span class='hs-varid'>rightIdentityDynFlags</span> <span class='hs-varid'>zeroi</span> <span class='hs-keyglyph'>]</span>
<a name="line-45"></a>
<a name="line-46"></a><span class='hs-comment'>-- Word operations</span>
<a name="line-47"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>WordAddOp</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkPrimOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-num'>2</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>binaryLit</span> <span class='hs-layout'>(</span><span class='hs-varid'>wordOp2</span> <span class='hs-layout'>(</span><span class='hs-varop'>+</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-48"></a>                                               <span class='hs-layout'>,</span> <span class='hs-varid'>identityDynFlags</span> <span class='hs-varid'>zerow</span> <span class='hs-keyglyph'>]</span>
<a name="line-49"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>WordSubOp</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkPrimOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-num'>2</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>binaryLit</span> <span class='hs-layout'>(</span><span class='hs-varid'>wordOp2</span> <span class='hs-layout'>(</span><span class='hs-comment'>-</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-50"></a>                                               <span class='hs-layout'>,</span> <span class='hs-varid'>rightIdentityDynFlags</span> <span class='hs-varid'>zerow</span>
<a name="line-51"></a>                                               <span class='hs-layout'>,</span> <span class='hs-varid'>equalArgs</span> <span class='hs-varop'>&gt;&gt;</span> <span class='hs-varid'>retLit</span> <span class='hs-varid'>zerow</span> <span class='hs-keyglyph'>]</span>
<a name="line-52"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>WordMulOp</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkPrimOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-num'>2</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>binaryLit</span> <span class='hs-layout'>(</span><span class='hs-varid'>wordOp2</span> <span class='hs-layout'>(</span><span class='hs-varop'>*</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-53"></a>                                               <span class='hs-layout'>,</span> <span class='hs-varid'>identityDynFlags</span> <span class='hs-varid'>onew</span> <span class='hs-keyglyph'>]</span>
<a name="line-54"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>WordQuotOp</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkPrimOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-num'>2</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>nonZeroLit</span> <span class='hs-num'>1</span> <span class='hs-varop'>&gt;&gt;</span> <span class='hs-varid'>binaryLit</span> <span class='hs-layout'>(</span><span class='hs-varid'>wordOp2</span> <span class='hs-varid'>quot</span><span class='hs-layout'>)</span>
<a name="line-55"></a>                                               <span class='hs-layout'>,</span> <span class='hs-varid'>rightIdentityDynFlags</span> <span class='hs-varid'>onew</span> <span class='hs-keyglyph'>]</span>
<a name="line-56"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>WordRemOp</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkPrimOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-num'>2</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>nonZeroLit</span> <span class='hs-num'>1</span> <span class='hs-varop'>&gt;&gt;</span> <span class='hs-varid'>binaryLit</span> <span class='hs-layout'>(</span><span class='hs-varid'>wordOp2</span> <span class='hs-varid'>rem</span><span class='hs-layout'>)</span>
<a name="line-57"></a>                                               <span class='hs-layout'>,</span> <span class='hs-varid'>rightIdentityDynFlags</span> <span class='hs-varid'>onew</span> <span class='hs-keyglyph'>]</span>
<a name="line-58"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>AndOp</span>       <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkPrimOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-num'>2</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>binaryLit</span> <span class='hs-layout'>(</span><span class='hs-varid'>wordOp2</span> <span class='hs-layout'>(</span><span class='hs-varop'>.&amp;.</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-59"></a>                                               <span class='hs-layout'>,</span> <span class='hs-varid'>idempotent</span>
<a name="line-60"></a>                                               <span class='hs-layout'>,</span> <span class='hs-varid'>zeroElem</span> <span class='hs-varid'>zerow</span> <span class='hs-keyglyph'>]</span>
<a name="line-61"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>OrOp</span>        <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkPrimOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-num'>2</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>binaryLit</span> <span class='hs-layout'>(</span><span class='hs-varid'>wordOp2</span> <span class='hs-layout'>(</span><span class='hs-varop'>.|.</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-62"></a>                                               <span class='hs-layout'>,</span> <span class='hs-varid'>idempotent</span>
<a name="line-63"></a>                                               <span class='hs-layout'>,</span> <span class='hs-varid'>identityDynFlags</span> <span class='hs-varid'>zerow</span> <span class='hs-keyglyph'>]</span>
<a name="line-64"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>XorOp</span>       <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkPrimOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-num'>2</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>binaryLit</span> <span class='hs-layout'>(</span><span class='hs-varid'>wordOp2</span> <span class='hs-varid'>xor</span><span class='hs-layout'>)</span>
<a name="line-65"></a>                                               <span class='hs-layout'>,</span> <span class='hs-varid'>identityDynFlags</span> <span class='hs-varid'>zerow</span>
<a name="line-66"></a>                                               <span class='hs-layout'>,</span> <span class='hs-varid'>equalArgs</span> <span class='hs-varop'>&gt;&gt;</span> <span class='hs-varid'>retLit</span> <span class='hs-varid'>zerow</span> <span class='hs-keyglyph'>]</span>
<a name="line-67"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>SllOp</span>       <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkPrimOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-num'>2</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>wordShiftRule</span> <span class='hs-conid'>Bits</span><span class='hs-varop'>.</span><span class='hs-varid'>shiftL</span> <span class='hs-keyglyph'>]</span>
<a name="line-68"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>SrlOp</span>       <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkPrimOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-num'>2</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>wordShiftRule</span> <span class='hs-varid'>shiftRightLogical</span> <span class='hs-keyglyph'>]</span>
<a name="line-69"></a>
<a name="line-70"></a><span class='hs-comment'>-- coercions</span>
<a name="line-71"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>Word2IntOp</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkPrimOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-num'>1</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>liftLitDynFlags</span> <span class='hs-varid'>word2IntLit</span>
<a name="line-72"></a>                                                  <span class='hs-layout'>,</span> <span class='hs-varid'>inversePrimOp</span> <span class='hs-conid'>Int2WordOp</span> <span class='hs-keyglyph'>]</span>
<a name="line-73"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>Int2WordOp</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkPrimOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-num'>1</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>liftLitDynFlags</span> <span class='hs-varid'>int2WordLit</span>
<a name="line-74"></a>                                                  <span class='hs-layout'>,</span> <span class='hs-varid'>inversePrimOp</span> <span class='hs-conid'>Word2IntOp</span> <span class='hs-keyglyph'>]</span>
<a name="line-75"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>Narrow8IntOp</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkPrimOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-num'>1</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>liftLit</span> <span class='hs-varid'>narrow8IntLit</span>
<a name="line-76"></a>                                                  <span class='hs-layout'>,</span> <span class='hs-varid'>subsumedByPrimOp</span> <span class='hs-conid'>Narrow8IntOp</span>
<a name="line-77"></a>                                                  <span class='hs-layout'>,</span> <span class='hs-conid'>Narrow8IntOp</span> <span class='hs-varop'>`subsumesPrimOp`</span> <span class='hs-conid'>Narrow16IntOp</span>
<a name="line-78"></a>                                                  <span class='hs-layout'>,</span> <span class='hs-conid'>Narrow8IntOp</span> <span class='hs-varop'>`subsumesPrimOp`</span> <span class='hs-conid'>Narrow32IntOp</span> <span class='hs-keyglyph'>]</span>
<a name="line-79"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>Narrow16IntOp</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkPrimOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-num'>1</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>liftLit</span> <span class='hs-varid'>narrow16IntLit</span>
<a name="line-80"></a>                                                  <span class='hs-layout'>,</span> <span class='hs-varid'>subsumedByPrimOp</span> <span class='hs-conid'>Narrow8IntOp</span>
<a name="line-81"></a>                                                  <span class='hs-layout'>,</span> <span class='hs-varid'>subsumedByPrimOp</span> <span class='hs-conid'>Narrow16IntOp</span>
<a name="line-82"></a>                                                  <span class='hs-layout'>,</span> <span class='hs-conid'>Narrow16IntOp</span> <span class='hs-varop'>`subsumesPrimOp`</span> <span class='hs-conid'>Narrow32IntOp</span> <span class='hs-keyglyph'>]</span>
<a name="line-83"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>Narrow32IntOp</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkPrimOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-num'>1</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>liftLit</span> <span class='hs-varid'>narrow32IntLit</span>
<a name="line-84"></a>                                                  <span class='hs-layout'>,</span> <span class='hs-varid'>subsumedByPrimOp</span> <span class='hs-conid'>Narrow8IntOp</span>
<a name="line-85"></a>                                                  <span class='hs-layout'>,</span> <span class='hs-varid'>subsumedByPrimOp</span> <span class='hs-conid'>Narrow16IntOp</span>
<a name="line-86"></a>                                                  <span class='hs-layout'>,</span> <span class='hs-varid'>subsumedByPrimOp</span> <span class='hs-conid'>Narrow32IntOp</span>
<a name="line-87"></a>                                                  <span class='hs-layout'>,</span> <span class='hs-varid'>removeOp32</span> <span class='hs-keyglyph'>]</span>
<a name="line-88"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>Narrow8WordOp</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkPrimOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-num'>1</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>liftLit</span> <span class='hs-varid'>narrow8WordLit</span>
<a name="line-89"></a>                                                  <span class='hs-layout'>,</span> <span class='hs-varid'>subsumedByPrimOp</span> <span class='hs-conid'>Narrow8WordOp</span>
<a name="line-90"></a>                                                  <span class='hs-layout'>,</span> <span class='hs-conid'>Narrow8WordOp</span> <span class='hs-varop'>`subsumesPrimOp`</span> <span class='hs-conid'>Narrow16WordOp</span>
<a name="line-91"></a>                                                  <span class='hs-layout'>,</span> <span class='hs-conid'>Narrow8WordOp</span> <span class='hs-varop'>`subsumesPrimOp`</span> <span class='hs-conid'>Narrow32WordOp</span> <span class='hs-keyglyph'>]</span>
<a name="line-92"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>Narrow16WordOp</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkPrimOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-num'>1</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>liftLit</span> <span class='hs-varid'>narrow16WordLit</span>
<a name="line-93"></a>                                                  <span class='hs-layout'>,</span> <span class='hs-varid'>subsumedByPrimOp</span> <span class='hs-conid'>Narrow8WordOp</span>
<a name="line-94"></a>                                                  <span class='hs-layout'>,</span> <span class='hs-varid'>subsumedByPrimOp</span> <span class='hs-conid'>Narrow16WordOp</span>
<a name="line-95"></a>                                                  <span class='hs-layout'>,</span> <span class='hs-conid'>Narrow16WordOp</span> <span class='hs-varop'>`subsumesPrimOp`</span> <span class='hs-conid'>Narrow32WordOp</span> <span class='hs-keyglyph'>]</span>
<a name="line-96"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>Narrow32WordOp</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkPrimOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-num'>1</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>liftLit</span> <span class='hs-varid'>narrow32WordLit</span>
<a name="line-97"></a>                                                  <span class='hs-layout'>,</span> <span class='hs-varid'>subsumedByPrimOp</span> <span class='hs-conid'>Narrow8WordOp</span>
<a name="line-98"></a>                                                  <span class='hs-layout'>,</span> <span class='hs-varid'>subsumedByPrimOp</span> <span class='hs-conid'>Narrow16WordOp</span>
<a name="line-99"></a>                                                  <span class='hs-layout'>,</span> <span class='hs-varid'>subsumedByPrimOp</span> <span class='hs-conid'>Narrow32WordOp</span>
<a name="line-100"></a>                                                  <span class='hs-layout'>,</span> <span class='hs-varid'>removeOp32</span> <span class='hs-keyglyph'>]</span>
<a name="line-101"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>OrdOp</span>          <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkPrimOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-num'>1</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>liftLit</span> <span class='hs-varid'>char2IntLit</span>
<a name="line-102"></a>                                                  <span class='hs-layout'>,</span> <span class='hs-varid'>inversePrimOp</span> <span class='hs-conid'>ChrOp</span> <span class='hs-keyglyph'>]</span>
<a name="line-103"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>ChrOp</span>          <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkPrimOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-num'>1</span> <span class='hs-keyglyph'>[</span> <span class='hs-keyword'>do</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Lit</span> <span class='hs-varid'>lit</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getArgs</span>
<a name="line-104"></a>                                                       <span class='hs-varid'>guard</span> <span class='hs-layout'>(</span><span class='hs-varid'>litFitsInChar</span> <span class='hs-varid'>lit</span><span class='hs-layout'>)</span>
<a name="line-105"></a>                                                       <span class='hs-varid'>liftLit</span> <span class='hs-varid'>int2CharLit</span>
<a name="line-106"></a>                                                  <span class='hs-layout'>,</span> <span class='hs-varid'>inversePrimOp</span> <span class='hs-conid'>OrdOp</span> <span class='hs-keyglyph'>]</span>
<a name="line-107"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>Float2IntOp</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkPrimOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-num'>1</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>liftLit</span> <span class='hs-varid'>float2IntLit</span> <span class='hs-keyglyph'>]</span>
<a name="line-108"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>Int2FloatOp</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkPrimOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-num'>1</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>liftLit</span> <span class='hs-varid'>int2FloatLit</span> <span class='hs-keyglyph'>]</span>
<a name="line-109"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>Double2IntOp</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkPrimOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-num'>1</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>liftLit</span> <span class='hs-varid'>double2IntLit</span> <span class='hs-keyglyph'>]</span>
<a name="line-110"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>Int2DoubleOp</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkPrimOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-num'>1</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>liftLit</span> <span class='hs-varid'>int2DoubleLit</span> <span class='hs-keyglyph'>]</span>
<a name="line-111"></a><span class='hs-comment'>-- SUP: Not sure what the standard says about precision in the following 2 cases</span>
<a name="line-112"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>Float2DoubleOp</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkPrimOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-num'>1</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>liftLit</span> <span class='hs-varid'>float2DoubleLit</span> <span class='hs-keyglyph'>]</span>
<a name="line-113"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>Double2FloatOp</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkPrimOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-num'>1</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>liftLit</span> <span class='hs-varid'>double2FloatLit</span> <span class='hs-keyglyph'>]</span>
<a name="line-114"></a>
<a name="line-115"></a><span class='hs-comment'>-- Float</span>
<a name="line-116"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>FloatAddOp</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkPrimOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-num'>2</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>binaryLit</span> <span class='hs-layout'>(</span><span class='hs-varid'>floatOp2</span> <span class='hs-layout'>(</span><span class='hs-varop'>+</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-117"></a>                                                <span class='hs-layout'>,</span> <span class='hs-varid'>identity</span> <span class='hs-varid'>zerof</span> <span class='hs-keyglyph'>]</span>
<a name="line-118"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>FloatSubOp</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkPrimOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-num'>2</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>binaryLit</span> <span class='hs-layout'>(</span><span class='hs-varid'>floatOp2</span> <span class='hs-layout'>(</span><span class='hs-comment'>-</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-119"></a>                                                <span class='hs-layout'>,</span> <span class='hs-varid'>rightIdentity</span> <span class='hs-varid'>zerof</span> <span class='hs-keyglyph'>]</span>
<a name="line-120"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>FloatMulOp</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkPrimOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-num'>2</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>binaryLit</span> <span class='hs-layout'>(</span><span class='hs-varid'>floatOp2</span> <span class='hs-layout'>(</span><span class='hs-varop'>*</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-121"></a>                                                <span class='hs-layout'>,</span> <span class='hs-varid'>identity</span> <span class='hs-varid'>onef</span>
<a name="line-122"></a>                                                <span class='hs-layout'>,</span> <span class='hs-varid'>strengthReduction</span> <span class='hs-varid'>twof</span> <span class='hs-conid'>FloatAddOp</span>  <span class='hs-keyglyph'>]</span>
<a name="line-123"></a>                         <span class='hs-comment'>-- zeroElem zerof doesn't hold because of NaN</span>
<a name="line-124"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>FloatDivOp</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkPrimOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-num'>2</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>guardFloatDiv</span> <span class='hs-varop'>&gt;&gt;</span> <span class='hs-varid'>binaryLit</span> <span class='hs-layout'>(</span><span class='hs-varid'>floatOp2</span> <span class='hs-layout'>(</span><span class='hs-varop'>/</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-125"></a>                                                <span class='hs-layout'>,</span> <span class='hs-varid'>rightIdentity</span> <span class='hs-varid'>onef</span> <span class='hs-keyglyph'>]</span>
<a name="line-126"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>FloatNegOp</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkPrimOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-num'>1</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>unaryLit</span> <span class='hs-varid'>negOp</span>
<a name="line-127"></a>                                                <span class='hs-layout'>,</span> <span class='hs-varid'>inversePrimOp</span> <span class='hs-conid'>FloatNegOp</span> <span class='hs-keyglyph'>]</span>
<a name="line-128"></a>
<a name="line-129"></a><span class='hs-comment'>-- Double</span>
<a name="line-130"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>DoubleAddOp</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkPrimOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-num'>2</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>binaryLit</span> <span class='hs-layout'>(</span><span class='hs-varid'>doubleOp2</span> <span class='hs-layout'>(</span><span class='hs-varop'>+</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-131"></a>                                                 <span class='hs-layout'>,</span> <span class='hs-varid'>identity</span> <span class='hs-varid'>zerod</span> <span class='hs-keyglyph'>]</span>
<a name="line-132"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>DoubleSubOp</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkPrimOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-num'>2</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>binaryLit</span> <span class='hs-layout'>(</span><span class='hs-varid'>doubleOp2</span> <span class='hs-layout'>(</span><span class='hs-comment'>-</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-133"></a>                                                 <span class='hs-layout'>,</span> <span class='hs-varid'>rightIdentity</span> <span class='hs-varid'>zerod</span> <span class='hs-keyglyph'>]</span>
<a name="line-134"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>DoubleMulOp</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkPrimOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-num'>2</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>binaryLit</span> <span class='hs-layout'>(</span><span class='hs-varid'>doubleOp2</span> <span class='hs-layout'>(</span><span class='hs-varop'>*</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-135"></a>                                                 <span class='hs-layout'>,</span> <span class='hs-varid'>identity</span> <span class='hs-varid'>oned</span>
<a name="line-136"></a>                                                 <span class='hs-layout'>,</span> <span class='hs-varid'>strengthReduction</span> <span class='hs-varid'>twod</span> <span class='hs-conid'>DoubleAddOp</span>  <span class='hs-keyglyph'>]</span>
<a name="line-137"></a>                          <span class='hs-comment'>-- zeroElem zerod doesn't hold because of NaN</span>
<a name="line-138"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>DoubleDivOp</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkPrimOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-num'>2</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>guardDoubleDiv</span> <span class='hs-varop'>&gt;&gt;</span> <span class='hs-varid'>binaryLit</span> <span class='hs-layout'>(</span><span class='hs-varid'>doubleOp2</span> <span class='hs-layout'>(</span><span class='hs-varop'>/</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-139"></a>                                                 <span class='hs-layout'>,</span> <span class='hs-varid'>rightIdentity</span> <span class='hs-varid'>oned</span> <span class='hs-keyglyph'>]</span>
<a name="line-140"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>DoubleNegOp</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkPrimOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-num'>1</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>unaryLit</span> <span class='hs-varid'>negOp</span>
<a name="line-141"></a>                                                 <span class='hs-layout'>,</span> <span class='hs-varid'>inversePrimOp</span> <span class='hs-conid'>DoubleNegOp</span> <span class='hs-keyglyph'>]</span>
<a name="line-142"></a>
<a name="line-143"></a><span class='hs-comment'>-- Relational operators</span>
<a name="line-144"></a>
<a name="line-145"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>IntEqOp</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkRelOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-layout'>(</span><span class='hs-varop'>==</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>litEq</span> <span class='hs-conid'>True</span> <span class='hs-keyglyph'>]</span>
<a name="line-146"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>IntNeOp</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkRelOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-layout'>(</span><span class='hs-varop'>/=</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>litEq</span> <span class='hs-conid'>False</span> <span class='hs-keyglyph'>]</span>
<a name="line-147"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>CharEqOp</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkRelOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-layout'>(</span><span class='hs-varop'>==</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>litEq</span> <span class='hs-conid'>True</span> <span class='hs-keyglyph'>]</span>
<a name="line-148"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>CharNeOp</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkRelOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-layout'>(</span><span class='hs-varop'>/=</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>litEq</span> <span class='hs-conid'>False</span> <span class='hs-keyglyph'>]</span>
<a name="line-149"></a>
<a name="line-150"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>IntGtOp</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkRelOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-layout'>(</span><span class='hs-varop'>&gt;</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>[</span> <span class='hs-varid'>boundsCmp</span> <span class='hs-conid'>Gt</span> <span class='hs-keyglyph'>]</span>
<a name="line-151"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>IntGeOp</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkRelOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-layout'>(</span><span class='hs-varop'>&gt;=</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>boundsCmp</span> <span class='hs-conid'>Ge</span> <span class='hs-keyglyph'>]</span>
<a name="line-152"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>IntLeOp</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkRelOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-layout'>(</span><span class='hs-varop'>&lt;=</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>boundsCmp</span> <span class='hs-conid'>Le</span> <span class='hs-keyglyph'>]</span>
<a name="line-153"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>IntLtOp</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkRelOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-layout'>(</span><span class='hs-varop'>&lt;</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>[</span> <span class='hs-varid'>boundsCmp</span> <span class='hs-conid'>Lt</span> <span class='hs-keyglyph'>]</span>
<a name="line-154"></a>
<a name="line-155"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>CharGtOp</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkRelOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-layout'>(</span><span class='hs-varop'>&gt;</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>[</span> <span class='hs-varid'>boundsCmp</span> <span class='hs-conid'>Gt</span> <span class='hs-keyglyph'>]</span>
<a name="line-156"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>CharGeOp</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkRelOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-layout'>(</span><span class='hs-varop'>&gt;=</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>boundsCmp</span> <span class='hs-conid'>Ge</span> <span class='hs-keyglyph'>]</span>
<a name="line-157"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>CharLeOp</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkRelOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-layout'>(</span><span class='hs-varop'>&lt;=</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>boundsCmp</span> <span class='hs-conid'>Le</span> <span class='hs-keyglyph'>]</span>
<a name="line-158"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>CharLtOp</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkRelOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-layout'>(</span><span class='hs-varop'>&lt;</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>[</span> <span class='hs-varid'>boundsCmp</span> <span class='hs-conid'>Lt</span> <span class='hs-keyglyph'>]</span>
<a name="line-159"></a>
<a name="line-160"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>FloatGtOp</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkFloatingRelOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-layout'>(</span><span class='hs-varop'>&gt;</span><span class='hs-layout'>)</span>  <span class='hs-conid'>[]</span>
<a name="line-161"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>FloatGeOp</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkFloatingRelOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-layout'>(</span><span class='hs-varop'>&gt;=</span><span class='hs-layout'>)</span> <span class='hs-conid'>[]</span>
<a name="line-162"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>FloatLeOp</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkFloatingRelOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-layout'>(</span><span class='hs-varop'>&lt;=</span><span class='hs-layout'>)</span> <span class='hs-conid'>[]</span>
<a name="line-163"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>FloatLtOp</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkFloatingRelOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-layout'>(</span><span class='hs-varop'>&lt;</span><span class='hs-layout'>)</span>  <span class='hs-conid'>[]</span>
<a name="line-164"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>FloatEqOp</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkFloatingRelOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-layout'>(</span><span class='hs-varop'>==</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>litEq</span> <span class='hs-conid'>True</span> <span class='hs-keyglyph'>]</span>
<a name="line-165"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>FloatNeOp</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkFloatingRelOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-layout'>(</span><span class='hs-varop'>/=</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>litEq</span> <span class='hs-conid'>False</span> <span class='hs-keyglyph'>]</span>
<a name="line-166"></a>
<a name="line-167"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>DoubleGtOp</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkFloatingRelOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-layout'>(</span><span class='hs-varop'>&gt;</span><span class='hs-layout'>)</span>  <span class='hs-conid'>[]</span>
<a name="line-168"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>DoubleGeOp</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkFloatingRelOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-layout'>(</span><span class='hs-varop'>&gt;=</span><span class='hs-layout'>)</span> <span class='hs-conid'>[]</span>
<a name="line-169"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>DoubleLeOp</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkFloatingRelOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-layout'>(</span><span class='hs-varop'>&lt;=</span><span class='hs-layout'>)</span> <span class='hs-conid'>[]</span>
<a name="line-170"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>DoubleLtOp</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkFloatingRelOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-layout'>(</span><span class='hs-varop'>&lt;</span><span class='hs-layout'>)</span>  <span class='hs-conid'>[]</span>
<a name="line-171"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>DoubleEqOp</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkFloatingRelOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-layout'>(</span><span class='hs-varop'>==</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>litEq</span> <span class='hs-conid'>True</span> <span class='hs-keyglyph'>]</span>
<a name="line-172"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>DoubleNeOp</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkFloatingRelOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-layout'>(</span><span class='hs-varop'>/=</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>litEq</span> <span class='hs-conid'>False</span> <span class='hs-keyglyph'>]</span>
<a name="line-173"></a>
<a name="line-174"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>WordGtOp</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkRelOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-layout'>(</span><span class='hs-varop'>&gt;</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>[</span> <span class='hs-varid'>boundsCmp</span> <span class='hs-conid'>Gt</span> <span class='hs-keyglyph'>]</span>
<a name="line-175"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>WordGeOp</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkRelOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-layout'>(</span><span class='hs-varop'>&gt;=</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>boundsCmp</span> <span class='hs-conid'>Ge</span> <span class='hs-keyglyph'>]</span>
<a name="line-176"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>WordLeOp</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkRelOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-layout'>(</span><span class='hs-varop'>&lt;=</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>boundsCmp</span> <span class='hs-conid'>Le</span> <span class='hs-keyglyph'>]</span>
<a name="line-177"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>WordLtOp</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkRelOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-layout'>(</span><span class='hs-varop'>&lt;</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>[</span> <span class='hs-varid'>boundsCmp</span> <span class='hs-conid'>Lt</span> <span class='hs-keyglyph'>]</span>
<a name="line-178"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>WordEqOp</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkRelOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-layout'>(</span><span class='hs-varop'>==</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>litEq</span> <span class='hs-conid'>True</span> <span class='hs-keyglyph'>]</span>
<a name="line-179"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>WordNeOp</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkRelOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-layout'>(</span><span class='hs-varop'>/=</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>litEq</span> <span class='hs-conid'>False</span> <span class='hs-keyglyph'>]</span>
<a name="line-180"></a>
<a name="line-181"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>AddrAddOp</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkPrimOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-num'>2</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>rightIdentityDynFlags</span> <span class='hs-varid'>zeroi</span> <span class='hs-keyglyph'>]</span>
<a name="line-182"></a>
<a name="line-183"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>SeqOp</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkPrimOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-num'>4</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>seqRule</span> <span class='hs-keyglyph'>]</span>
<a name="line-184"></a><span class='hs-definition'>primOpRules</span> <span class='hs-varid'>nm</span> <span class='hs-conid'>SparkOp</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkPrimOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-num'>4</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>sparkRule</span> <span class='hs-keyglyph'>]</span>
<a name="line-185"></a>
<a name="line-186"></a><span class='hs-definition'>primOpRules</span> <span class='hs-keyword'>_</span>  <span class='hs-keyword'>_</span>          <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-187"></a>
</pre>\end{code}

%************************************************************************
%*                                                                      *
\subsection{Doing the business}
%*                                                                      *
%************************************************************************

\begin{code}
<pre><a name="line-1"></a>
<a name="line-2"></a><a name="mkPrimOpRule"></a><span class='hs-comment'>-- useful shorthands</span>
<a name="line-3"></a><span class='hs-definition'>mkPrimOpRule</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>RuleM</span> <span class='hs-conid'>CoreExpr</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>CoreRule</span>
<a name="line-4"></a><span class='hs-definition'>mkPrimOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-varid'>arity</span> <span class='hs-varid'>rules</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-varid'>mkBasicRule</span> <span class='hs-varid'>nm</span> <span class='hs-varid'>arity</span> <span class='hs-layout'>(</span><span class='hs-varid'>msum</span> <span class='hs-varid'>rules</span><span class='hs-layout'>)</span>
<a name="line-5"></a>
<a name="line-6"></a><a name="mkRelOpRule"></a><span class='hs-definition'>mkRelOpRule</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-keyword'>forall</span> <span class='hs-varid'>a</span> <span class='hs-varop'>.</span> <span class='hs-conid'>Ord</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span><span class='hs-layout'>)</span>
<a name="line-7"></a>            <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>RuleM</span> <span class='hs-conid'>CoreExpr</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>CoreRule</span>
<a name="line-8"></a><span class='hs-definition'>mkRelOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-varid'>cmp</span> <span class='hs-varid'>extra</span>
<a name="line-9"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkPrimOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-num'>2</span> <span class='hs-varop'>$</span> <span class='hs-varid'>rules</span> <span class='hs-varop'>++</span> <span class='hs-varid'>extra</span>
<a name="line-10"></a>  <span class='hs-keyword'>where</span>
<a name="line-11"></a>    <span class='hs-varid'>rules</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>binaryCmpLit</span> <span class='hs-varid'>cmp</span>
<a name="line-12"></a>            <span class='hs-layout'>,</span> <span class='hs-keyword'>do</span> <span class='hs-varid'>equalArgs</span>
<a name="line-13"></a>              <span class='hs-comment'>-- x `cmp` x does not depend on x, so</span>
<a name="line-14"></a>              <span class='hs-comment'>-- compute it for the arbitrary value 'True'</span>
<a name="line-15"></a>              <span class='hs-comment'>-- and use that result</span>
<a name="line-16"></a>                 <span class='hs-varid'>dflags</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getDynFlags</span>
<a name="line-17"></a>                 <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-keyword'>if</span> <span class='hs-varid'>cmp</span> <span class='hs-conid'>True</span> <span class='hs-conid'>True</span>
<a name="line-18"></a>                         <span class='hs-keyword'>then</span> <span class='hs-varid'>trueValInt</span>  <span class='hs-varid'>dflags</span>
<a name="line-19"></a>                         <span class='hs-keyword'>else</span> <span class='hs-varid'>falseValInt</span> <span class='hs-varid'>dflags</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>]</span>
<a name="line-20"></a>
<a name="line-21"></a><span class='hs-comment'>-- Note [Rules for floating-point comparisons]</span>
<a name="line-22"></a><span class='hs-comment'>-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
<a name="line-23"></a><span class='hs-comment'>--</span>
<a name="line-24"></a><span class='hs-comment'>-- We need different rules for floating-point values because for floats</span>
<a name="line-25"></a><span class='hs-comment'>-- it is not true that x = x. The special case when this does not occur</span>
<a name="line-26"></a><span class='hs-comment'>-- are NaNs.</span>
<a name="line-27"></a>
<a name="line-28"></a><a name="mkFloatingRelOpRule"></a><span class='hs-definition'>mkFloatingRelOpRule</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-keyword'>forall</span> <span class='hs-varid'>a</span> <span class='hs-varop'>.</span> <span class='hs-conid'>Ord</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span><span class='hs-layout'>)</span>
<a name="line-29"></a>                    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>RuleM</span> <span class='hs-conid'>CoreExpr</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>CoreRule</span>
<a name="line-30"></a><span class='hs-definition'>mkFloatingRelOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-varid'>cmp</span> <span class='hs-varid'>extra</span> <span class='hs-comment'>-- See Note [Rules for floating-point comparisons]</span>
<a name="line-31"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkPrimOpRule</span> <span class='hs-varid'>nm</span> <span class='hs-num'>2</span> <span class='hs-varop'>$</span> <span class='hs-varid'>binaryCmpLit</span> <span class='hs-varid'>cmp</span> <span class='hs-conop'>:</span> <span class='hs-varid'>extra</span>
<a name="line-32"></a>
<a name="line-33"></a><a name="zeroi"></a><span class='hs-comment'>-- common constants</span>
<a name="line-34"></a><span class='hs-definition'>zeroi</span><span class='hs-layout'>,</span> <span class='hs-varid'>onei</span><span class='hs-layout'>,</span> <span class='hs-varid'>zerow</span><span class='hs-layout'>,</span> <span class='hs-varid'>onew</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>DynFlags</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Literal</span>
<a name="line-35"></a><span class='hs-definition'>zeroi</span> <span class='hs-varid'>dflags</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkMachInt</span>  <span class='hs-varid'>dflags</span> <span class='hs-num'>0</span>
<a name="line-36"></a><a name="onei"></a><span class='hs-definition'>onei</span>  <span class='hs-varid'>dflags</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkMachInt</span>  <span class='hs-varid'>dflags</span> <span class='hs-num'>1</span>
<a name="line-37"></a><a name="zerow"></a><span class='hs-definition'>zerow</span> <span class='hs-varid'>dflags</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkMachWord</span> <span class='hs-varid'>dflags</span> <span class='hs-num'>0</span>
<a name="line-38"></a><a name="onew"></a><span class='hs-definition'>onew</span>  <span class='hs-varid'>dflags</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkMachWord</span> <span class='hs-varid'>dflags</span> <span class='hs-num'>1</span>
<a name="line-39"></a>
<a name="line-40"></a><a name="zerof"></a><span class='hs-definition'>zerof</span><span class='hs-layout'>,</span> <span class='hs-varid'>onef</span><span class='hs-layout'>,</span> <span class='hs-varid'>twof</span><span class='hs-layout'>,</span> <span class='hs-varid'>zerod</span><span class='hs-layout'>,</span> <span class='hs-varid'>oned</span><span class='hs-layout'>,</span> <span class='hs-varid'>twod</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Literal</span>
<a name="line-41"></a><span class='hs-definition'>zerof</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkMachFloat</span> <span class='hs-num'>0.0</span>
<a name="line-42"></a><a name="onef"></a><span class='hs-definition'>onef</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkMachFloat</span> <span class='hs-num'>1.0</span>
<a name="line-43"></a><a name="twof"></a><span class='hs-definition'>twof</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkMachFloat</span> <span class='hs-num'>2.0</span>
<a name="line-44"></a><a name="zerod"></a><span class='hs-definition'>zerod</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkMachDouble</span> <span class='hs-num'>0.0</span>
<a name="line-45"></a><a name="oned"></a><span class='hs-definition'>oned</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkMachDouble</span> <span class='hs-num'>1.0</span>
<a name="line-46"></a><a name="twod"></a><span class='hs-definition'>twod</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkMachDouble</span> <span class='hs-num'>2.0</span>
<a name="line-47"></a>
<a name="line-48"></a><a name="cmpOp"></a><span class='hs-definition'>cmpOp</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>DynFlags</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-keyword'>forall</span> <span class='hs-varid'>a</span> <span class='hs-varop'>.</span> <span class='hs-conid'>Ord</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span><span class='hs-layout'>)</span>
<a name="line-49"></a>      <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Literal</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Literal</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>CoreExpr</span>
<a name="line-50"></a><span class='hs-definition'>cmpOp</span> <span class='hs-varid'>dflags</span> <span class='hs-varid'>cmp</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>go</span>
<a name="line-51"></a>  <span class='hs-keyword'>where</span>
<a name="line-52"></a>    <span class='hs-varid'>done</span> <span class='hs-conid'>True</span>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-varid'>trueValInt</span>  <span class='hs-varid'>dflags</span>
<a name="line-53"></a>    <span class='hs-varid'>done</span> <span class='hs-conid'>False</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-varid'>falseValInt</span> <span class='hs-varid'>dflags</span>
<a name="line-54"></a>
<a name="line-55"></a>    <span class='hs-comment'>-- These compares are at different types</span>
<a name="line-56"></a>    <span class='hs-varid'>go</span> <span class='hs-layout'>(</span><span class='hs-conid'>MachChar</span> <span class='hs-varid'>i1</span><span class='hs-layout'>)</span>   <span class='hs-layout'>(</span><span class='hs-conid'>MachChar</span> <span class='hs-varid'>i2</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>done</span> <span class='hs-layout'>(</span><span class='hs-varid'>i1</span> <span class='hs-varop'>`cmp`</span> <span class='hs-varid'>i2</span><span class='hs-layout'>)</span>
<a name="line-57"></a>    <span class='hs-varid'>go</span> <span class='hs-layout'>(</span><span class='hs-conid'>MachInt</span> <span class='hs-varid'>i1</span><span class='hs-layout'>)</span>    <span class='hs-layout'>(</span><span class='hs-conid'>MachInt</span> <span class='hs-varid'>i2</span><span class='hs-layout'>)</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>done</span> <span class='hs-layout'>(</span><span class='hs-varid'>i1</span> <span class='hs-varop'>`cmp`</span> <span class='hs-varid'>i2</span><span class='hs-layout'>)</span>
<a name="line-58"></a>    <span class='hs-varid'>go</span> <span class='hs-layout'>(</span><span class='hs-conid'>MachInt64</span> <span class='hs-varid'>i1</span><span class='hs-layout'>)</span>  <span class='hs-layout'>(</span><span class='hs-conid'>MachInt64</span> <span class='hs-varid'>i2</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>done</span> <span class='hs-layout'>(</span><span class='hs-varid'>i1</span> <span class='hs-varop'>`cmp`</span> <span class='hs-varid'>i2</span><span class='hs-layout'>)</span>
<a name="line-59"></a>    <span class='hs-varid'>go</span> <span class='hs-layout'>(</span><span class='hs-conid'>MachWord</span> <span class='hs-varid'>i1</span><span class='hs-layout'>)</span>   <span class='hs-layout'>(</span><span class='hs-conid'>MachWord</span> <span class='hs-varid'>i2</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>done</span> <span class='hs-layout'>(</span><span class='hs-varid'>i1</span> <span class='hs-varop'>`cmp`</span> <span class='hs-varid'>i2</span><span class='hs-layout'>)</span>
<a name="line-60"></a>    <span class='hs-varid'>go</span> <span class='hs-layout'>(</span><span class='hs-conid'>MachWord64</span> <span class='hs-varid'>i1</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>MachWord64</span> <span class='hs-varid'>i2</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>done</span> <span class='hs-layout'>(</span><span class='hs-varid'>i1</span> <span class='hs-varop'>`cmp`</span> <span class='hs-varid'>i2</span><span class='hs-layout'>)</span>
<a name="line-61"></a>    <span class='hs-varid'>go</span> <span class='hs-layout'>(</span><span class='hs-conid'>MachFloat</span> <span class='hs-varid'>i1</span><span class='hs-layout'>)</span>  <span class='hs-layout'>(</span><span class='hs-conid'>MachFloat</span> <span class='hs-varid'>i2</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>done</span> <span class='hs-layout'>(</span><span class='hs-varid'>i1</span> <span class='hs-varop'>`cmp`</span> <span class='hs-varid'>i2</span><span class='hs-layout'>)</span>
<a name="line-62"></a>    <span class='hs-varid'>go</span> <span class='hs-layout'>(</span><span class='hs-conid'>MachDouble</span> <span class='hs-varid'>i1</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>MachDouble</span> <span class='hs-varid'>i2</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>done</span> <span class='hs-layout'>(</span><span class='hs-varid'>i1</span> <span class='hs-varop'>`cmp`</span> <span class='hs-varid'>i2</span><span class='hs-layout'>)</span>
<a name="line-63"></a>    <span class='hs-varid'>go</span> <span class='hs-keyword'>_</span>               <span class='hs-keyword'>_</span>               <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-64"></a>
<a name="line-65"></a><span class='hs-comment'>--------------------------</span>
<a name="line-66"></a>
<a name="line-67"></a><a name="negOp"></a><span class='hs-definition'>negOp</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>DynFlags</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Literal</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>CoreExpr</span>  <span class='hs-comment'>-- Negate</span>
<a name="line-68"></a><span class='hs-definition'>negOp</span> <span class='hs-keyword'>_</span>      <span class='hs-layout'>(</span><span class='hs-conid'>MachFloat</span> <span class='hs-num'>0.0</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>  <span class='hs-comment'>-- can't represent -0.0 as a Rational</span>
<a name="line-69"></a><span class='hs-definition'>negOp</span> <span class='hs-varid'>dflags</span> <span class='hs-layout'>(</span><span class='hs-conid'>MachFloat</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span>    <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkFloatVal</span> <span class='hs-varid'>dflags</span> <span class='hs-layout'>(</span><span class='hs-comment'>-</span><span class='hs-varid'>f</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-70"></a><span class='hs-definition'>negOp</span> <span class='hs-keyword'>_</span>      <span class='hs-layout'>(</span><span class='hs-conid'>MachDouble</span> <span class='hs-num'>0.0</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-71"></a><span class='hs-definition'>negOp</span> <span class='hs-varid'>dflags</span> <span class='hs-layout'>(</span><span class='hs-conid'>MachDouble</span> <span class='hs-varid'>d</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkDoubleVal</span> <span class='hs-varid'>dflags</span> <span class='hs-layout'>(</span><span class='hs-comment'>-</span><span class='hs-varid'>d</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-72"></a><span class='hs-definition'>negOp</span> <span class='hs-varid'>dflags</span> <span class='hs-layout'>(</span><span class='hs-conid'>MachInt</span> <span class='hs-varid'>i</span><span class='hs-layout'>)</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>intResult</span> <span class='hs-varid'>dflags</span> <span class='hs-layout'>(</span><span class='hs-comment'>-</span><span class='hs-varid'>i</span><span class='hs-layout'>)</span>
<a name="line-73"></a><span class='hs-definition'>negOp</span> <span class='hs-keyword'>_</span>      <span class='hs-keyword'>_</span>                <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-74"></a>
<a name="line-75"></a><a name="intOp2"></a><span class='hs-comment'>--------------------------</span>
<a name="line-76"></a><span class='hs-definition'>intOp2</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Integral</span> <span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-conid'>Integral</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span>
<a name="line-77"></a>       <span class='hs-keyglyph'>=&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Integer</span><span class='hs-layout'>)</span>
<a name="line-78"></a>       <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>DynFlags</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Literal</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Literal</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>CoreExpr</span>
<a name="line-79"></a><span class='hs-definition'>intOp2</span> <span class='hs-varid'>op</span> <span class='hs-varid'>dflags</span> <span class='hs-layout'>(</span><span class='hs-conid'>MachInt</span> <span class='hs-varid'>i1</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>MachInt</span> <span class='hs-varid'>i2</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>intResult</span> <span class='hs-varid'>dflags</span> <span class='hs-layout'>(</span><span class='hs-varid'>fromInteger</span> <span class='hs-varid'>i1</span> <span class='hs-varop'>`op`</span> <span class='hs-varid'>fromInteger</span> <span class='hs-varid'>i2</span><span class='hs-layout'>)</span>
<a name="line-80"></a><span class='hs-definition'>intOp2</span> <span class='hs-keyword'>_</span>  <span class='hs-keyword'>_</span>      <span class='hs-keyword'>_</span>            <span class='hs-keyword'>_</span>            <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>  <span class='hs-comment'>-- Could find LitLit</span>
<a name="line-81"></a>
<a name="line-82"></a><a name="shiftRightLogical"></a><span class='hs-definition'>shiftRightLogical</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Integer</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Integer</span>
<a name="line-83"></a><span class='hs-comment'>-- Shift right, putting zeros in rather than sign-propagating as Bits.shiftR would do</span>
<a name="line-84"></a><span class='hs-comment'>-- Do this by converting to Word and back.  Obviously this won't work for big</span>
<a name="line-85"></a><span class='hs-comment'>-- values, but its ok as we use it here</span>
<a name="line-86"></a><span class='hs-definition'>shiftRightLogical</span> <span class='hs-varid'>x</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fromIntegral</span> <span class='hs-layout'>(</span><span class='hs-varid'>fromInteger</span> <span class='hs-varid'>x</span> <span class='hs-varop'>`shiftR`</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Word</span><span class='hs-layout'>)</span>
<a name="line-87"></a>
<a name="line-88"></a>
<a name="line-89"></a><a name="retLit"></a><span class='hs-comment'>--------------------------</span>
<a name="line-90"></a><span class='hs-definition'>retLit</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>DynFlags</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Literal</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>RuleM</span> <span class='hs-conid'>CoreExpr</span>
<a name="line-91"></a><span class='hs-definition'>retLit</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span> <span class='hs-varid'>dflags</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getDynFlags</span>
<a name="line-92"></a>              <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Lit</span> <span class='hs-varop'>$</span> <span class='hs-varid'>l</span> <span class='hs-varid'>dflags</span>
<a name="line-93"></a>
<a name="line-94"></a><a name="wordOp2"></a><span class='hs-definition'>wordOp2</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Integral</span> <span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-conid'>Integral</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span>
<a name="line-95"></a>        <span class='hs-keyglyph'>=&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Integer</span><span class='hs-layout'>)</span>
<a name="line-96"></a>        <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>DynFlags</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Literal</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Literal</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>CoreExpr</span>
<a name="line-97"></a><span class='hs-definition'>wordOp2</span> <span class='hs-varid'>op</span> <span class='hs-varid'>dflags</span> <span class='hs-layout'>(</span><span class='hs-conid'>MachWord</span> <span class='hs-varid'>w1</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>MachWord</span> <span class='hs-varid'>w2</span><span class='hs-layout'>)</span>
<a name="line-98"></a>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>wordResult</span> <span class='hs-varid'>dflags</span> <span class='hs-layout'>(</span><span class='hs-varid'>fromInteger</span> <span class='hs-varid'>w1</span> <span class='hs-varop'>`op`</span> <span class='hs-varid'>fromInteger</span> <span class='hs-varid'>w2</span><span class='hs-layout'>)</span>
<a name="line-99"></a><span class='hs-definition'>wordOp2</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>  <span class='hs-comment'>-- Could find LitLit</span>
<a name="line-100"></a>
<a name="line-101"></a><a name="wordShiftRule"></a><span class='hs-definition'>wordShiftRule</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Integer</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Integer</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>RuleM</span> <span class='hs-conid'>CoreExpr</span>
<a name="line-102"></a>                 <span class='hs-comment'>-- Shifts take an Int; hence second arg of op is Int</span>
<a name="line-103"></a><span class='hs-comment'>-- See Note [Guarding against silly shifts]</span>
<a name="line-104"></a><span class='hs-definition'>wordShiftRule</span> <span class='hs-varid'>shift_op</span>
<a name="line-105"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span> <span class='hs-layout'>{</span> <span class='hs-varid'>dflags</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getDynFlags</span>
<a name="line-106"></a>       <span class='hs-layout'>;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>e1</span><span class='hs-layout'>,</span> <span class='hs-conid'>Lit</span> <span class='hs-layout'>(</span><span class='hs-conid'>MachInt</span> <span class='hs-varid'>shift_len</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getArgs</span>
<a name="line-107"></a>       <span class='hs-layout'>;</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>e1</span> <span class='hs-keyword'>of</span>
<a name="line-108"></a>           <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>shift_len</span> <span class='hs-varop'>==</span> <span class='hs-num'>0</span> 
<a name="line-109"></a>             <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-varid'>e1</span>
<a name="line-110"></a>             <span class='hs-keyglyph'>|</span> <span class='hs-varid'>shift_len</span> <span class='hs-varop'>&lt;</span> <span class='hs-num'>0</span> <span class='hs-varop'>||</span> <span class='hs-varid'>wordSizeInBits</span> <span class='hs-varid'>dflags</span> <span class='hs-varop'>&lt;</span> <span class='hs-varid'>shift_len</span>
<a name="line-111"></a>             <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkRuntimeErrorApp</span> <span class='hs-varid'>rUNTIME_ERROR_ID</span> <span class='hs-varid'>wordPrimTy</span> 
<a name="line-112"></a>                                        <span class='hs-layout'>(</span><span class='hs-str'>"Bad shift length"</span> <span class='hs-varop'>++</span> <span class='hs-varid'>show</span> <span class='hs-varid'>shift_len</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-113"></a>           <span class='hs-conid'>Lit</span> <span class='hs-layout'>(</span><span class='hs-conid'>MachWord</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span>
<a name="line-114"></a>             <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>liftMaybe</span> <span class='hs-varop'>$</span> <span class='hs-varid'>wordResult</span> <span class='hs-varid'>dflags</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span> <span class='hs-varop'>`shift_op`</span> <span class='hs-varid'>fromInteger</span> <span class='hs-varid'>shift_len</span><span class='hs-layout'>)</span> 
<a name="line-115"></a>                    <span class='hs-comment'>-- Do the shift at type Integer, but shift length is Int</span>
<a name="line-116"></a>           <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>mzero</span> <span class='hs-layout'>}</span>
<a name="line-117"></a>
<a name="line-118"></a><a name="wordSizeInBits"></a><span class='hs-definition'>wordSizeInBits</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>DynFlags</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Integer</span>
<a name="line-119"></a><span class='hs-definition'>wordSizeInBits</span> <span class='hs-varid'>dflags</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>toInteger</span> <span class='hs-layout'>(</span><span class='hs-varid'>platformWordSize</span> <span class='hs-layout'>(</span><span class='hs-varid'>targetPlatform</span> <span class='hs-varid'>dflags</span><span class='hs-layout'>)</span> <span class='hs-varop'>`shiftL`</span> <span class='hs-num'>3</span><span class='hs-layout'>)</span>
<a name="line-120"></a>
<a name="line-121"></a><a name="floatOp2"></a><span class='hs-comment'>--------------------------</span>
<a name="line-122"></a><span class='hs-definition'>floatOp2</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Rational</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Rational</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Rational</span><span class='hs-layout'>)</span>
<a name="line-123"></a>         <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>DynFlags</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Literal</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Literal</span>
<a name="line-124"></a>         <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>Expr</span> <span class='hs-conid'>CoreBndr</span><span class='hs-layout'>)</span>
<a name="line-125"></a><span class='hs-definition'>floatOp2</span> <span class='hs-varid'>op</span> <span class='hs-varid'>dflags</span> <span class='hs-layout'>(</span><span class='hs-conid'>MachFloat</span> <span class='hs-varid'>f1</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>MachFloat</span> <span class='hs-varid'>f2</span><span class='hs-layout'>)</span>
<a name="line-126"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkFloatVal</span> <span class='hs-varid'>dflags</span> <span class='hs-layout'>(</span><span class='hs-varid'>f1</span> <span class='hs-varop'>`op`</span> <span class='hs-varid'>f2</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-127"></a><span class='hs-definition'>floatOp2</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-128"></a>
<a name="line-129"></a><a name="doubleOp2"></a><span class='hs-comment'>--------------------------</span>
<a name="line-130"></a><span class='hs-definition'>doubleOp2</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Rational</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Rational</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Rational</span><span class='hs-layout'>)</span>
<a name="line-131"></a>          <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>DynFlags</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Literal</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Literal</span>
<a name="line-132"></a>          <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>Expr</span> <span class='hs-conid'>CoreBndr</span><span class='hs-layout'>)</span>
<a name="line-133"></a><span class='hs-definition'>doubleOp2</span> <span class='hs-varid'>op</span> <span class='hs-varid'>dflags</span> <span class='hs-layout'>(</span><span class='hs-conid'>MachDouble</span> <span class='hs-varid'>f1</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>MachDouble</span> <span class='hs-varid'>f2</span><span class='hs-layout'>)</span>
<a name="line-134"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkDoubleVal</span> <span class='hs-varid'>dflags</span> <span class='hs-layout'>(</span><span class='hs-varid'>f1</span> <span class='hs-varop'>`op`</span> <span class='hs-varid'>f2</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-135"></a><span class='hs-definition'>doubleOp2</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-136"></a>
<a name="line-137"></a><span class='hs-comment'>--------------------------</span>
<a name="line-138"></a><span class='hs-comment'>-- This stuff turns</span>
<a name="line-139"></a><span class='hs-comment'>--      n ==# 3#</span>
<a name="line-140"></a><span class='hs-comment'>-- into</span>
<a name="line-141"></a><span class='hs-comment'>--      case n of</span>
<a name="line-142"></a><span class='hs-comment'>--        3# -&gt; True</span>
<a name="line-143"></a><span class='hs-comment'>--        m  -&gt; False</span>
<a name="line-144"></a><span class='hs-comment'>--</span>
<a name="line-145"></a><span class='hs-comment'>-- This is a Good Thing, because it allows case-of case things</span>
<a name="line-146"></a><span class='hs-comment'>-- to happen, and case-default absorption to happen.  For</span>
<a name="line-147"></a><span class='hs-comment'>-- example:</span>
<a name="line-148"></a><span class='hs-comment'>--</span>
<a name="line-149"></a><span class='hs-comment'>--      if (n ==# 3#) || (n ==# 4#) then e1 else e2</span>
<a name="line-150"></a><span class='hs-comment'>-- will transform to</span>
<a name="line-151"></a><span class='hs-comment'>--      case n of</span>
<a name="line-152"></a><span class='hs-comment'>--        3# -&gt; e1</span>
<a name="line-153"></a><span class='hs-comment'>--        4# -&gt; e1</span>
<a name="line-154"></a><span class='hs-comment'>--        m  -&gt; e2</span>
<a name="line-155"></a><span class='hs-comment'>-- (modulo the usual precautions to avoid duplicating e1)</span>
<a name="line-156"></a>
<a name="line-157"></a><a name="litEq"></a><span class='hs-definition'>litEq</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Bool</span>  <span class='hs-comment'>-- True &lt;=&gt; equality, False &lt;=&gt; inequality</span>
<a name="line-158"></a>      <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>RuleM</span> <span class='hs-conid'>CoreExpr</span>
<a name="line-159"></a><span class='hs-definition'>litEq</span> <span class='hs-varid'>is_eq</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>msum</span>
<a name="line-160"></a>  <span class='hs-keyglyph'>[</span> <span class='hs-keyword'>do</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Lit</span> <span class='hs-varid'>lit</span><span class='hs-layout'>,</span> <span class='hs-varid'>expr</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getArgs</span>
<a name="line-161"></a>       <span class='hs-varid'>dflags</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getDynFlags</span>
<a name="line-162"></a>       <span class='hs-varid'>do_lit_eq</span> <span class='hs-varid'>dflags</span> <span class='hs-varid'>lit</span> <span class='hs-varid'>expr</span>
<a name="line-163"></a>  <span class='hs-layout'>,</span> <span class='hs-keyword'>do</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>expr</span><span class='hs-layout'>,</span> <span class='hs-conid'>Lit</span> <span class='hs-varid'>lit</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getArgs</span>
<a name="line-164"></a>       <span class='hs-varid'>dflags</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getDynFlags</span>
<a name="line-165"></a>       <span class='hs-varid'>do_lit_eq</span> <span class='hs-varid'>dflags</span> <span class='hs-varid'>lit</span> <span class='hs-varid'>expr</span> <span class='hs-keyglyph'>]</span>
<a name="line-166"></a>  <span class='hs-keyword'>where</span>
<a name="line-167"></a>    <span class='hs-varid'>do_lit_eq</span> <span class='hs-varid'>dflags</span> <span class='hs-varid'>lit</span> <span class='hs-varid'>expr</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-168"></a>      <span class='hs-varid'>guard</span> <span class='hs-layout'>(</span><span class='hs-varid'>not</span> <span class='hs-layout'>(</span><span class='hs-varid'>litIsLifted</span> <span class='hs-varid'>lit</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-169"></a>      <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkWildCase</span> <span class='hs-varid'>expr</span> <span class='hs-layout'>(</span><span class='hs-varid'>literalType</span> <span class='hs-varid'>lit</span><span class='hs-layout'>)</span> <span class='hs-varid'>intPrimTy</span>
<a name="line-170"></a>                    <span class='hs-keyglyph'>[</span><span class='hs-layout'>(</span><span class='hs-conid'>DEFAULT</span><span class='hs-layout'>,</span>    <span class='hs-conid'>[]</span><span class='hs-layout'>,</span> <span class='hs-varid'>val_if_neq</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-171"></a>                     <span class='hs-layout'>(</span><span class='hs-conid'>LitAlt</span> <span class='hs-varid'>lit</span><span class='hs-layout'>,</span> <span class='hs-conid'>[]</span><span class='hs-layout'>,</span> <span class='hs-varid'>val_if_eq</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-172"></a>      <span class='hs-keyword'>where</span>
<a name="line-173"></a>        <span class='hs-varid'>val_if_eq</span>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>is_eq</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>trueValInt</span>  <span class='hs-varid'>dflags</span>
<a name="line-174"></a>                   <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>falseValInt</span> <span class='hs-varid'>dflags</span>
<a name="line-175"></a>        <span class='hs-varid'>val_if_neq</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>is_eq</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>falseValInt</span> <span class='hs-varid'>dflags</span>
<a name="line-176"></a>                   <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>trueValInt</span>  <span class='hs-varid'>dflags</span>
<a name="line-177"></a>
<a name="line-178"></a>
<a name="line-179"></a><a name="boundsCmp"></a><span class='hs-comment'>-- | Check if there is comparison with minBound or maxBound, that is</span>
<a name="line-180"></a><span class='hs-comment'>-- always true or false. For instance, an Int cannot be smaller than its</span>
<a name="line-181"></a><span class='hs-comment'>-- minBound, so we can replace such comparison with False.</span>
<a name="line-182"></a><span class='hs-definition'>boundsCmp</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Comparison</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>RuleM</span> <span class='hs-conid'>CoreExpr</span>
<a name="line-183"></a><span class='hs-definition'>boundsCmp</span> <span class='hs-varid'>op</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-184"></a>  <span class='hs-varid'>dflags</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getDynFlags</span>
<a name="line-185"></a>  <span class='hs-keyglyph'>[</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-varid'>b</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getArgs</span>
<a name="line-186"></a>  <span class='hs-varid'>liftMaybe</span> <span class='hs-varop'>$</span> <span class='hs-varid'>mkRuleFn</span> <span class='hs-varid'>dflags</span> <span class='hs-varid'>op</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span>
<a name="line-187"></a>
<a name="line-188"></a><a name="Comparison"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>Comparison</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Gt</span> <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Ge</span> <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Lt</span> <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Le</span>
<a name="line-189"></a>
<a name="line-190"></a><a name="mkRuleFn"></a><span class='hs-definition'>mkRuleFn</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>DynFlags</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Comparison</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>CoreExpr</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>CoreExpr</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>CoreExpr</span>
<a name="line-191"></a><span class='hs-definition'>mkRuleFn</span> <span class='hs-varid'>dflags</span> <span class='hs-conid'>Gt</span> <span class='hs-layout'>(</span><span class='hs-conid'>Lit</span> <span class='hs-varid'>lit</span><span class='hs-layout'>)</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>isMinBound</span> <span class='hs-varid'>dflags</span> <span class='hs-varid'>lit</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-varid'>falseValInt</span> <span class='hs-varid'>dflags</span>
<a name="line-192"></a><span class='hs-definition'>mkRuleFn</span> <span class='hs-varid'>dflags</span> <span class='hs-conid'>Le</span> <span class='hs-layout'>(</span><span class='hs-conid'>Lit</span> <span class='hs-varid'>lit</span><span class='hs-layout'>)</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>isMinBound</span> <span class='hs-varid'>dflags</span> <span class='hs-varid'>lit</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-varid'>trueValInt</span>  <span class='hs-varid'>dflags</span>
<a name="line-193"></a><span class='hs-definition'>mkRuleFn</span> <span class='hs-varid'>dflags</span> <span class='hs-conid'>Ge</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>Lit</span> <span class='hs-varid'>lit</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>isMinBound</span> <span class='hs-varid'>dflags</span> <span class='hs-varid'>lit</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-varid'>trueValInt</span>  <span class='hs-varid'>dflags</span>
<a name="line-194"></a><span class='hs-definition'>mkRuleFn</span> <span class='hs-varid'>dflags</span> <span class='hs-conid'>Lt</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>Lit</span> <span class='hs-varid'>lit</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>isMinBound</span> <span class='hs-varid'>dflags</span> <span class='hs-varid'>lit</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-varid'>falseValInt</span> <span class='hs-varid'>dflags</span>
<a name="line-195"></a><span class='hs-definition'>mkRuleFn</span> <span class='hs-varid'>dflags</span> <span class='hs-conid'>Ge</span> <span class='hs-layout'>(</span><span class='hs-conid'>Lit</span> <span class='hs-varid'>lit</span><span class='hs-layout'>)</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>isMaxBound</span> <span class='hs-varid'>dflags</span> <span class='hs-varid'>lit</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-varid'>trueValInt</span>  <span class='hs-varid'>dflags</span>
<a name="line-196"></a><span class='hs-definition'>mkRuleFn</span> <span class='hs-varid'>dflags</span> <span class='hs-conid'>Lt</span> <span class='hs-layout'>(</span><span class='hs-conid'>Lit</span> <span class='hs-varid'>lit</span><span class='hs-layout'>)</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>isMaxBound</span> <span class='hs-varid'>dflags</span> <span class='hs-varid'>lit</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-varid'>falseValInt</span> <span class='hs-varid'>dflags</span>
<a name="line-197"></a><span class='hs-definition'>mkRuleFn</span> <span class='hs-varid'>dflags</span> <span class='hs-conid'>Gt</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>Lit</span> <span class='hs-varid'>lit</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>isMaxBound</span> <span class='hs-varid'>dflags</span> <span class='hs-varid'>lit</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-varid'>falseValInt</span> <span class='hs-varid'>dflags</span>
<a name="line-198"></a><span class='hs-definition'>mkRuleFn</span> <span class='hs-varid'>dflags</span> <span class='hs-conid'>Le</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>Lit</span> <span class='hs-varid'>lit</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>isMaxBound</span> <span class='hs-varid'>dflags</span> <span class='hs-varid'>lit</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-varid'>trueValInt</span>  <span class='hs-varid'>dflags</span>
<a name="line-199"></a><span class='hs-definition'>mkRuleFn</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span>                                       <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-200"></a>
<a name="line-201"></a><a name="isMinBound"></a><span class='hs-definition'>isMinBound</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>DynFlags</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Literal</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-202"></a><span class='hs-definition'>isMinBound</span> <span class='hs-keyword'>_</span>      <span class='hs-layout'>(</span><span class='hs-conid'>MachChar</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>c</span> <span class='hs-varop'>==</span> <span class='hs-varid'>minBound</span>
<a name="line-203"></a><span class='hs-definition'>isMinBound</span> <span class='hs-varid'>dflags</span> <span class='hs-layout'>(</span><span class='hs-conid'>MachInt</span> <span class='hs-varid'>i</span><span class='hs-layout'>)</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>i</span> <span class='hs-varop'>==</span> <span class='hs-varid'>tARGET_MIN_INT</span> <span class='hs-varid'>dflags</span>
<a name="line-204"></a><span class='hs-definition'>isMinBound</span> <span class='hs-keyword'>_</span>      <span class='hs-layout'>(</span><span class='hs-conid'>MachInt64</span> <span class='hs-varid'>i</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>i</span> <span class='hs-varop'>==</span> <span class='hs-varid'>toInteger</span> <span class='hs-layout'>(</span><span class='hs-varid'>minBound</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int64</span><span class='hs-layout'>)</span>
<a name="line-205"></a><span class='hs-definition'>isMinBound</span> <span class='hs-keyword'>_</span>      <span class='hs-layout'>(</span><span class='hs-conid'>MachWord</span> <span class='hs-varid'>i</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>i</span> <span class='hs-varop'>==</span> <span class='hs-num'>0</span>
<a name="line-206"></a><span class='hs-definition'>isMinBound</span> <span class='hs-keyword'>_</span>      <span class='hs-layout'>(</span><span class='hs-conid'>MachWord64</span> <span class='hs-varid'>i</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>i</span> <span class='hs-varop'>==</span> <span class='hs-num'>0</span>
<a name="line-207"></a><span class='hs-definition'>isMinBound</span> <span class='hs-keyword'>_</span>      <span class='hs-keyword'>_</span>              <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-208"></a>
<a name="line-209"></a><a name="isMaxBound"></a><span class='hs-definition'>isMaxBound</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>DynFlags</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Literal</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-210"></a><span class='hs-definition'>isMaxBound</span> <span class='hs-keyword'>_</span>      <span class='hs-layout'>(</span><span class='hs-conid'>MachChar</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>c</span> <span class='hs-varop'>==</span> <span class='hs-varid'>maxBound</span>
<a name="line-211"></a><span class='hs-definition'>isMaxBound</span> <span class='hs-varid'>dflags</span> <span class='hs-layout'>(</span><span class='hs-conid'>MachInt</span> <span class='hs-varid'>i</span><span class='hs-layout'>)</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>i</span> <span class='hs-varop'>==</span> <span class='hs-varid'>tARGET_MAX_INT</span> <span class='hs-varid'>dflags</span>
<a name="line-212"></a><span class='hs-definition'>isMaxBound</span> <span class='hs-keyword'>_</span>      <span class='hs-layout'>(</span><span class='hs-conid'>MachInt64</span> <span class='hs-varid'>i</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>i</span> <span class='hs-varop'>==</span> <span class='hs-varid'>toInteger</span> <span class='hs-layout'>(</span><span class='hs-varid'>maxBound</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int64</span><span class='hs-layout'>)</span>
<a name="line-213"></a><span class='hs-definition'>isMaxBound</span> <span class='hs-varid'>dflags</span> <span class='hs-layout'>(</span><span class='hs-conid'>MachWord</span> <span class='hs-varid'>i</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>i</span> <span class='hs-varop'>==</span> <span class='hs-varid'>tARGET_MAX_WORD</span> <span class='hs-varid'>dflags</span>
<a name="line-214"></a><span class='hs-definition'>isMaxBound</span> <span class='hs-keyword'>_</span>      <span class='hs-layout'>(</span><span class='hs-conid'>MachWord64</span> <span class='hs-varid'>i</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>i</span> <span class='hs-varop'>==</span> <span class='hs-varid'>toInteger</span> <span class='hs-layout'>(</span><span class='hs-varid'>maxBound</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Word64</span><span class='hs-layout'>)</span>
<a name="line-215"></a><span class='hs-definition'>isMaxBound</span> <span class='hs-keyword'>_</span>      <span class='hs-keyword'>_</span>              <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-216"></a>
<a name="line-217"></a>
<a name="line-218"></a><a name="intResult"></a><span class='hs-comment'>-- Note that we *don't* warn the user about overflow. It's not done at</span>
<a name="line-219"></a><span class='hs-comment'>-- runtime either, and compilation of completely harmless things like</span>
<a name="line-220"></a><span class='hs-comment'>--    ((124076834 :: Word32) + (2147483647 :: Word32))</span>
<a name="line-221"></a><span class='hs-comment'>-- would yield a warning. Instead we simply squash the value into the</span>
<a name="line-222"></a><span class='hs-comment'>-- *target* Int/Word range.</span>
<a name="line-223"></a><span class='hs-definition'>intResult</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>DynFlags</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Integer</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>CoreExpr</span>
<a name="line-224"></a><span class='hs-definition'>intResult</span> <span class='hs-varid'>dflags</span> <span class='hs-varid'>result</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkIntVal</span> <span class='hs-varid'>dflags</span> <span class='hs-varid'>result'</span><span class='hs-layout'>)</span>
<a name="line-225"></a>    <span class='hs-keyword'>where</span> <span class='hs-varid'>result'</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>platformWordSize</span> <span class='hs-layout'>(</span><span class='hs-varid'>targetPlatform</span> <span class='hs-varid'>dflags</span><span class='hs-layout'>)</span> <span class='hs-keyword'>of</span>
<a name="line-226"></a>                    <span class='hs-num'>4</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>toInteger</span> <span class='hs-layout'>(</span><span class='hs-varid'>fromInteger</span> <span class='hs-varid'>result</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int32</span><span class='hs-layout'>)</span>
<a name="line-227"></a>                    <span class='hs-num'>8</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>toInteger</span> <span class='hs-layout'>(</span><span class='hs-varid'>fromInteger</span> <span class='hs-varid'>result</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int64</span><span class='hs-layout'>)</span>
<a name="line-228"></a>                    <span class='hs-varid'>w</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>panic</span> <span class='hs-layout'>(</span><span class='hs-str'>"intResult: Unknown platformWordSize: "</span> <span class='hs-varop'>++</span> <span class='hs-varid'>show</span> <span class='hs-varid'>w</span><span class='hs-layout'>)</span>
<a name="line-229"></a>
<a name="line-230"></a><a name="wordResult"></a><span class='hs-definition'>wordResult</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>DynFlags</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Integer</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>CoreExpr</span>
<a name="line-231"></a><span class='hs-definition'>wordResult</span> <span class='hs-varid'>dflags</span> <span class='hs-varid'>result</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkWordVal</span> <span class='hs-varid'>dflags</span> <span class='hs-varid'>result'</span><span class='hs-layout'>)</span>
<a name="line-232"></a>    <span class='hs-keyword'>where</span> <span class='hs-varid'>result'</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>platformWordSize</span> <span class='hs-layout'>(</span><span class='hs-varid'>targetPlatform</span> <span class='hs-varid'>dflags</span><span class='hs-layout'>)</span> <span class='hs-keyword'>of</span>
<a name="line-233"></a>                    <span class='hs-num'>4</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>toInteger</span> <span class='hs-layout'>(</span><span class='hs-varid'>fromInteger</span> <span class='hs-varid'>result</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Word32</span><span class='hs-layout'>)</span>
<a name="line-234"></a>                    <span class='hs-num'>8</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>toInteger</span> <span class='hs-layout'>(</span><span class='hs-varid'>fromInteger</span> <span class='hs-varid'>result</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Word64</span><span class='hs-layout'>)</span>
<a name="line-235"></a>                    <span class='hs-varid'>w</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>panic</span> <span class='hs-layout'>(</span><span class='hs-str'>"wordResult: Unknown platformWordSize: "</span> <span class='hs-varop'>++</span> <span class='hs-varid'>show</span> <span class='hs-varid'>w</span><span class='hs-layout'>)</span>
<a name="line-236"></a>
<a name="line-237"></a><a name="inversePrimOp"></a><span class='hs-definition'>inversePrimOp</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>PrimOp</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>RuleM</span> <span class='hs-conid'>CoreExpr</span>
<a name="line-238"></a><span class='hs-definition'>inversePrimOp</span> <span class='hs-varid'>primop</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-239"></a>  <span class='hs-keyglyph'>[</span><span class='hs-conid'>Var</span> <span class='hs-varid'>primop_id</span> <span class='hs-varop'>`App`</span> <span class='hs-varid'>e</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getArgs</span>
<a name="line-240"></a>  <span class='hs-varid'>matchPrimOpId</span> <span class='hs-varid'>primop</span> <span class='hs-varid'>primop_id</span>
<a name="line-241"></a>  <span class='hs-varid'>return</span> <span class='hs-varid'>e</span>
<a name="line-242"></a>
<a name="line-243"></a><a name="subsumesPrimOp"></a><span class='hs-definition'>subsumesPrimOp</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>PrimOp</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>PrimOp</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>RuleM</span> <span class='hs-conid'>CoreExpr</span>
<a name="line-244"></a><a name="subsumesPrimOp"></a><span class='hs-definition'>this</span> <span class='hs-varop'>`subsumesPrimOp`</span> <span class='hs-varid'>that</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-245"></a>  <span class='hs-keyglyph'>[</span><span class='hs-conid'>Var</span> <span class='hs-varid'>primop_id</span> <span class='hs-varop'>`App`</span> <span class='hs-varid'>e</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getArgs</span>
<a name="line-246"></a>  <span class='hs-varid'>matchPrimOpId</span> <span class='hs-varid'>that</span> <span class='hs-varid'>primop_id</span>
<a name="line-247"></a>  <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-conid'>Var</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkPrimOpId</span> <span class='hs-varid'>this</span><span class='hs-layout'>)</span> <span class='hs-varop'>`App`</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>
<a name="line-248"></a>
<a name="line-249"></a><a name="subsumedByPrimOp"></a><span class='hs-definition'>subsumedByPrimOp</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>PrimOp</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>RuleM</span> <span class='hs-conid'>CoreExpr</span>
<a name="line-250"></a><span class='hs-definition'>subsumedByPrimOp</span> <span class='hs-varid'>primop</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-251"></a>  <span class='hs-keyglyph'>[</span><span class='hs-varid'>e</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-conid'>Var</span> <span class='hs-varid'>primop_id</span> <span class='hs-varop'>`App`</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getArgs</span>
<a name="line-252"></a>  <span class='hs-varid'>matchPrimOpId</span> <span class='hs-varid'>primop</span> <span class='hs-varid'>primop_id</span>
<a name="line-253"></a>  <span class='hs-varid'>return</span> <span class='hs-varid'>e</span>
<a name="line-254"></a>
<a name="line-255"></a><a name="idempotent"></a><span class='hs-definition'>idempotent</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>RuleM</span> <span class='hs-conid'>CoreExpr</span>
<a name="line-256"></a><span class='hs-definition'>idempotent</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>e1</span><span class='hs-layout'>,</span> <span class='hs-varid'>e2</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getArgs</span>
<a name="line-257"></a>                <span class='hs-varid'>guard</span> <span class='hs-varop'>$</span> <span class='hs-varid'>cheapEqExpr</span> <span class='hs-varid'>e1</span> <span class='hs-varid'>e2</span>
<a name="line-258"></a>                <span class='hs-varid'>return</span> <span class='hs-varid'>e1</span>
</pre>\end{code}

Note [Guarding against silly shifts]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider this code:

  import Data.Bits( (.|.), shiftL )
  chunkToBitmap :: [Bool] -> Word32
  chunkToBitmap chunk = foldr (.|.) 0 [ 1 `shiftL` n | (True,n) <- zip chunk [0..] ]

This optimises to:
Shift.$wgo = \ (w_sCS :: GHC.Prim.Int#) (w1_sCT :: [GHC.Types.Bool]) ->
    case w1_sCT of _ {
      [] -> __word 0;
      : x_aAW xs_aAX ->
        case x_aAW of _ {
          GHC.Types.False ->
            case w_sCS of wild2_Xh {
              __DEFAULT -> Shift.$wgo (GHC.Prim.+# wild2_Xh 1) xs_aAX;
              9223372036854775807 -> __word 0  };
          GHC.Types.True ->
            case GHC.Prim.>=# w_sCS 64 of _ {
              GHC.Types.False ->
                case w_sCS of wild3_Xh {
                  __DEFAULT ->
                    case Shift.$wgo (GHC.Prim.+# wild3_Xh 1) xs_aAX of ww_sCW { __DEFAULT ->
                      GHC.Prim.or# (GHC.Prim.narrow32Word#
                                      (GHC.Prim.uncheckedShiftL# (__word 1) wild3_Xh))
                                   ww_sCW
                     };
                  9223372036854775807 ->
                    GHC.Prim.narrow32Word#
!!!!-->                  (GHC.Prim.uncheckedShiftL# (__word 1) 9223372036854775807)
                };
              GHC.Types.True ->
                case w_sCS of wild3_Xh {
                  __DEFAULT -> Shift.$wgo (GHC.Prim.+# wild3_Xh 1) xs_aAX;
                  9223372036854775807 -> __word 0
                } } } }

Note the massive shift on line "!!!!".  It can't happen, because we've checked 
that w < 64, but the optimiser didn't spot that. We DO NO want to constant-fold this!
Moreover, if the programmer writes (n `uncheckedShiftL` 9223372036854775807), we
can't constant fold it, but if it gets to the assember we get
     Error: operand type mismatch for `shl'

So the best thing to do is to rewrite the shift with a call to error,
when the second arg is stupid.

%************************************************************************
%*                                                                      *
\subsection{Vaguely generic functions}
%*                                                                      *
%************************************************************************

\begin{code}
<pre><a name="line-1"></a><a name="mkBasicRule"></a><span class='hs-definition'>mkBasicRule</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>RuleM</span> <span class='hs-conid'>CoreExpr</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>CoreRule</span>
<a name="line-2"></a><span class='hs-comment'>-- Gives the Rule the same name as the primop itself</span>
<a name="line-3"></a><span class='hs-definition'>mkBasicRule</span> <span class='hs-varid'>op_name</span> <span class='hs-varid'>n_args</span> <span class='hs-varid'>rm</span>
<a name="line-4"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>BuiltinRule</span> <span class='hs-layout'>{</span> <span class='hs-varid'>ru_name</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>occNameFS</span> <span class='hs-layout'>(</span><span class='hs-varid'>nameOccName</span> <span class='hs-varid'>op_name</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-5"></a>                  <span class='hs-varid'>ru_fn</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>op_name</span><span class='hs-layout'>,</span>
<a name="line-6"></a>                  <span class='hs-varid'>ru_nargs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>n_args</span><span class='hs-layout'>,</span>
<a name="line-7"></a>                  <span class='hs-varid'>ru_try</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>\</span> <span class='hs-varid'>dflags</span> <span class='hs-varid'>in_scope</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>runRuleM</span> <span class='hs-varid'>rm</span> <span class='hs-varid'>dflags</span> <span class='hs-varid'>in_scope</span> <span class='hs-layout'>}</span>
<a name="line-8"></a>
<a name="line-9"></a><a name="RuleM"></a><span class='hs-keyword'>newtype</span> <span class='hs-conid'>RuleM</span> <span class='hs-varid'>r</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>RuleM</span>
<a name="line-10"></a>  <span class='hs-layout'>{</span> <span class='hs-varid'>runRuleM</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>DynFlags</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>InScopeEnv</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>CoreExpr</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-varid'>r</span> <span class='hs-layout'>}</span>
<a name="line-11"></a>
<a name="line-12"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Functor</span> <span class='hs-conid'>RuleM</span> <span class='hs-keyword'>where</span>
<a name="line-13"></a>    <span class='hs-varid'>fmap</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>liftM</span>
<a name="line-14"></a>
<a name="line-15"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Applicative</span> <span class='hs-conid'>RuleM</span> <span class='hs-keyword'>where</span>
<a name="line-16"></a>    <span class='hs-varid'>pure</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>return</span>
<a name="line-17"></a>    <span class='hs-layout'>(</span><span class='hs-varop'>&lt;*&gt;</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ap</span>
<a name="line-18"></a>
<a name="line-19"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Monad</span> <span class='hs-conid'>RuleM</span> <span class='hs-keyword'>where</span>
<a name="line-20"></a>  <span class='hs-varid'>return</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>RuleM</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>x</span>
<a name="line-21"></a>  <span class='hs-conid'>RuleM</span> <span class='hs-varid'>f</span> <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-varid'>g</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>RuleM</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>dflags</span> <span class='hs-varid'>iu</span> <span class='hs-varid'>e</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>f</span> <span class='hs-varid'>dflags</span> <span class='hs-varid'>iu</span> <span class='hs-varid'>e</span> <span class='hs-keyword'>of</span>
<a name="line-22"></a>    <span class='hs-conid'>Nothing</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Nothing</span>
<a name="line-23"></a>    <span class='hs-conid'>Just</span> <span class='hs-varid'>r</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>runRuleM</span> <span class='hs-layout'>(</span><span class='hs-varid'>g</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span> <span class='hs-varid'>dflags</span> <span class='hs-varid'>iu</span> <span class='hs-varid'>e</span>
<a name="line-24"></a>  <span class='hs-varid'>fail</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mzero</span>
<a name="line-25"></a>
<a name="line-26"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Alternative</span> <span class='hs-conid'>RuleM</span> <span class='hs-keyword'>where</span>
<a name="line-27"></a>    <span class='hs-varid'>empty</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mzero</span>
<a name="line-28"></a>    <span class='hs-layout'>(</span><span class='hs-varop'>&lt;|&gt;</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mplus</span>
<a name="line-29"></a>
<a name="line-30"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>MonadPlus</span> <span class='hs-conid'>RuleM</span> <span class='hs-keyword'>where</span>
<a name="line-31"></a>  <span class='hs-varid'>mzero</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>RuleM</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Nothing</span>
<a name="line-32"></a>  <span class='hs-varid'>mplus</span> <span class='hs-layout'>(</span><span class='hs-conid'>RuleM</span> <span class='hs-varid'>f1</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>RuleM</span> <span class='hs-varid'>f2</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>RuleM</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>dflags</span> <span class='hs-varid'>iu</span> <span class='hs-varid'>args</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-33"></a>    <span class='hs-varid'>f1</span> <span class='hs-varid'>dflags</span> <span class='hs-varid'>iu</span> <span class='hs-varid'>args</span> <span class='hs-varop'>`mplus`</span> <span class='hs-varid'>f2</span> <span class='hs-varid'>dflags</span> <span class='hs-varid'>iu</span> <span class='hs-varid'>args</span>
<a name="line-34"></a>
<a name="line-35"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>HasDynFlags</span> <span class='hs-conid'>RuleM</span> <span class='hs-keyword'>where</span>
<a name="line-36"></a>    <span class='hs-varid'>getDynFlags</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>RuleM</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>dflags</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>dflags</span>
<a name="line-37"></a>
<a name="line-38"></a><a name="liftMaybe"></a><span class='hs-definition'>liftMaybe</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>RuleM</span> <span class='hs-varid'>a</span>
<a name="line-39"></a><span class='hs-definition'>liftMaybe</span> <span class='hs-conid'>Nothing</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mzero</span>
<a name="line-40"></a><span class='hs-definition'>liftMaybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>return</span> <span class='hs-varid'>x</span>
<a name="line-41"></a>
<a name="line-42"></a><a name="liftLit"></a><span class='hs-definition'>liftLit</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Literal</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Literal</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>RuleM</span> <span class='hs-conid'>CoreExpr</span>
<a name="line-43"></a><span class='hs-definition'>liftLit</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>liftLitDynFlags</span> <span class='hs-layout'>(</span><span class='hs-varid'>const</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span>
<a name="line-44"></a>
<a name="line-45"></a><a name="liftLitDynFlags"></a><span class='hs-definition'>liftLitDynFlags</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>DynFlags</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Literal</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Literal</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>RuleM</span> <span class='hs-conid'>CoreExpr</span>
<a name="line-46"></a><span class='hs-definition'>liftLitDynFlags</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-47"></a>  <span class='hs-varid'>dflags</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getDynFlags</span>
<a name="line-48"></a>  <span class='hs-keyglyph'>[</span><span class='hs-conid'>Lit</span> <span class='hs-varid'>lit</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getArgs</span>
<a name="line-49"></a>  <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Lit</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-varid'>dflags</span> <span class='hs-varid'>lit</span><span class='hs-layout'>)</span>
<a name="line-50"></a>
<a name="line-51"></a><a name="removeOp32"></a><span class='hs-definition'>removeOp32</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>RuleM</span> <span class='hs-conid'>CoreExpr</span>
<a name="line-52"></a><span class='hs-cpp'>#if WORD_SIZE_IN_BITS == 32</span>
<a name="line-53"></a><span class='hs-definition'>removeOp32</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-54"></a>  <span class='hs-keyglyph'>[</span><span class='hs-varid'>e</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getArgs</span>
<a name="line-55"></a>  <span class='hs-varid'>return</span> <span class='hs-varid'>e</span>
<a name="line-56"></a><span class='hs-cpp'>#else</span>
<a name="line-57"></a><span class='hs-definition'>removeOp32</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mzero</span>
<a name="line-58"></a><span class='hs-cpp'>#endif</span>
<a name="line-59"></a>
<a name="line-60"></a><a name="getArgs"></a><span class='hs-definition'>getArgs</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>RuleM</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>CoreExpr</span><span class='hs-keyglyph'>]</span>
<a name="line-61"></a><span class='hs-definition'>getArgs</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>RuleM</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>args</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>args</span>
<a name="line-62"></a>
<a name="line-63"></a><a name="getInScopeEnv"></a><span class='hs-definition'>getInScopeEnv</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>RuleM</span> <span class='hs-conid'>InScopeEnv</span>
<a name="line-64"></a><span class='hs-definition'>getInScopeEnv</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>RuleM</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-keyword'>_</span> <span class='hs-varid'>iu</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>iu</span>
<a name="line-65"></a>
<a name="line-66"></a><a name="getLiteral"></a><span class='hs-comment'>-- return the n-th argument of this rule, if it is a literal</span>
<a name="line-67"></a><span class='hs-comment'>-- argument indices start from 0</span>
<a name="line-68"></a><span class='hs-definition'>getLiteral</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>RuleM</span> <span class='hs-conid'>Literal</span>
<a name="line-69"></a><span class='hs-definition'>getLiteral</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>RuleM</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>exprs</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>drop</span> <span class='hs-varid'>n</span> <span class='hs-varid'>exprs</span> <span class='hs-keyword'>of</span>
<a name="line-70"></a>  <span class='hs-layout'>(</span><span class='hs-conid'>Lit</span> <span class='hs-varid'>l</span><span class='hs-conop'>:</span><span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>l</span>
<a name="line-71"></a>  <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Nothing</span>
<a name="line-72"></a>
<a name="line-73"></a><a name="unaryLit"></a><span class='hs-definition'>unaryLit</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>DynFlags</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Literal</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>CoreExpr</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>RuleM</span> <span class='hs-conid'>CoreExpr</span>
<a name="line-74"></a><span class='hs-definition'>unaryLit</span> <span class='hs-varid'>op</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-75"></a>  <span class='hs-varid'>dflags</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getDynFlags</span>
<a name="line-76"></a>  <span class='hs-keyglyph'>[</span><span class='hs-conid'>Lit</span> <span class='hs-varid'>l</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getArgs</span>
<a name="line-77"></a>  <span class='hs-varid'>liftMaybe</span> <span class='hs-varop'>$</span> <span class='hs-varid'>op</span> <span class='hs-varid'>dflags</span> <span class='hs-layout'>(</span><span class='hs-varid'>convFloating</span> <span class='hs-varid'>dflags</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span>
<a name="line-78"></a>
<a name="line-79"></a><a name="binaryLit"></a><span class='hs-definition'>binaryLit</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>DynFlags</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Literal</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Literal</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>CoreExpr</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>RuleM</span> <span class='hs-conid'>CoreExpr</span>
<a name="line-80"></a><span class='hs-definition'>binaryLit</span> <span class='hs-varid'>op</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-81"></a>  <span class='hs-varid'>dflags</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getDynFlags</span>
<a name="line-82"></a>  <span class='hs-keyglyph'>[</span><span class='hs-conid'>Lit</span> <span class='hs-varid'>l1</span><span class='hs-layout'>,</span> <span class='hs-conid'>Lit</span> <span class='hs-varid'>l2</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getArgs</span>
<a name="line-83"></a>  <span class='hs-varid'>liftMaybe</span> <span class='hs-varop'>$</span> <span class='hs-varid'>op</span> <span class='hs-varid'>dflags</span> <span class='hs-layout'>(</span><span class='hs-varid'>convFloating</span> <span class='hs-varid'>dflags</span> <span class='hs-varid'>l1</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>convFloating</span> <span class='hs-varid'>dflags</span> <span class='hs-varid'>l2</span><span class='hs-layout'>)</span>
<a name="line-84"></a>
<a name="line-85"></a><a name="binaryCmpLit"></a><span class='hs-definition'>binaryCmpLit</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-keyword'>forall</span> <span class='hs-varid'>a</span> <span class='hs-varop'>.</span> <span class='hs-conid'>Ord</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>RuleM</span> <span class='hs-conid'>CoreExpr</span>
<a name="line-86"></a><span class='hs-definition'>binaryCmpLit</span> <span class='hs-varid'>op</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-87"></a>  <span class='hs-varid'>dflags</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getDynFlags</span>
<a name="line-88"></a>  <span class='hs-varid'>binaryLit</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>cmpOp</span> <span class='hs-varid'>dflags</span> <span class='hs-varid'>op</span><span class='hs-layout'>)</span>
<a name="line-89"></a>
<a name="line-90"></a><a name="leftIdentity"></a><span class='hs-definition'>leftIdentity</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Literal</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>RuleM</span> <span class='hs-conid'>CoreExpr</span>
<a name="line-91"></a><span class='hs-definition'>leftIdentity</span> <span class='hs-varid'>id_lit</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>leftIdentityDynFlags</span> <span class='hs-layout'>(</span><span class='hs-varid'>const</span> <span class='hs-varid'>id_lit</span><span class='hs-layout'>)</span>
<a name="line-92"></a>
<a name="line-93"></a><a name="rightIdentity"></a><span class='hs-definition'>rightIdentity</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Literal</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>RuleM</span> <span class='hs-conid'>CoreExpr</span>
<a name="line-94"></a><span class='hs-definition'>rightIdentity</span> <span class='hs-varid'>id_lit</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>rightIdentityDynFlags</span> <span class='hs-layout'>(</span><span class='hs-varid'>const</span> <span class='hs-varid'>id_lit</span><span class='hs-layout'>)</span>
<a name="line-95"></a>
<a name="line-96"></a><a name="identity"></a><span class='hs-definition'>identity</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Literal</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>RuleM</span> <span class='hs-conid'>CoreExpr</span>
<a name="line-97"></a><span class='hs-definition'>identity</span> <span class='hs-varid'>lit</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>leftIdentity</span> <span class='hs-varid'>lit</span> <span class='hs-varop'>`mplus`</span> <span class='hs-varid'>rightIdentity</span> <span class='hs-varid'>lit</span>
<a name="line-98"></a>
<a name="line-99"></a><a name="leftIdentityDynFlags"></a><span class='hs-definition'>leftIdentityDynFlags</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>DynFlags</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Literal</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>RuleM</span> <span class='hs-conid'>CoreExpr</span>
<a name="line-100"></a><span class='hs-definition'>leftIdentityDynFlags</span> <span class='hs-varid'>id_lit</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-101"></a>  <span class='hs-varid'>dflags</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getDynFlags</span>
<a name="line-102"></a>  <span class='hs-keyglyph'>[</span><span class='hs-conid'>Lit</span> <span class='hs-varid'>l1</span><span class='hs-layout'>,</span> <span class='hs-varid'>e2</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getArgs</span>
<a name="line-103"></a>  <span class='hs-varid'>guard</span> <span class='hs-varop'>$</span> <span class='hs-varid'>l1</span> <span class='hs-varop'>==</span> <span class='hs-varid'>id_lit</span> <span class='hs-varid'>dflags</span>
<a name="line-104"></a>  <span class='hs-varid'>return</span> <span class='hs-varid'>e2</span>
<a name="line-105"></a>
<a name="line-106"></a><a name="rightIdentityDynFlags"></a><span class='hs-definition'>rightIdentityDynFlags</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>DynFlags</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Literal</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>RuleM</span> <span class='hs-conid'>CoreExpr</span>
<a name="line-107"></a><span class='hs-definition'>rightIdentityDynFlags</span> <span class='hs-varid'>id_lit</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-108"></a>  <span class='hs-varid'>dflags</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getDynFlags</span>
<a name="line-109"></a>  <span class='hs-keyglyph'>[</span><span class='hs-varid'>e1</span><span class='hs-layout'>,</span> <span class='hs-conid'>Lit</span> <span class='hs-varid'>l2</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getArgs</span>
<a name="line-110"></a>  <span class='hs-varid'>guard</span> <span class='hs-varop'>$</span> <span class='hs-varid'>l2</span> <span class='hs-varop'>==</span> <span class='hs-varid'>id_lit</span> <span class='hs-varid'>dflags</span>
<a name="line-111"></a>  <span class='hs-varid'>return</span> <span class='hs-varid'>e1</span>
<a name="line-112"></a>
<a name="line-113"></a><a name="identityDynFlags"></a><span class='hs-definition'>identityDynFlags</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>DynFlags</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Literal</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>RuleM</span> <span class='hs-conid'>CoreExpr</span>
<a name="line-114"></a><span class='hs-definition'>identityDynFlags</span> <span class='hs-varid'>lit</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>leftIdentityDynFlags</span> <span class='hs-varid'>lit</span> <span class='hs-varop'>`mplus`</span> <span class='hs-varid'>rightIdentityDynFlags</span> <span class='hs-varid'>lit</span>
<a name="line-115"></a>
<a name="line-116"></a><a name="leftZero"></a><span class='hs-definition'>leftZero</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>DynFlags</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Literal</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>RuleM</span> <span class='hs-conid'>CoreExpr</span>
<a name="line-117"></a><span class='hs-definition'>leftZero</span> <span class='hs-varid'>zero</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-118"></a>  <span class='hs-varid'>dflags</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getDynFlags</span>
<a name="line-119"></a>  <span class='hs-keyglyph'>[</span><span class='hs-conid'>Lit</span> <span class='hs-varid'>l1</span><span class='hs-layout'>,</span> <span class='hs-keyword'>_</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getArgs</span>
<a name="line-120"></a>  <span class='hs-varid'>guard</span> <span class='hs-varop'>$</span> <span class='hs-varid'>l1</span> <span class='hs-varop'>==</span> <span class='hs-varid'>zero</span> <span class='hs-varid'>dflags</span>
<a name="line-121"></a>  <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Lit</span> <span class='hs-varid'>l1</span>
<a name="line-122"></a>
<a name="line-123"></a><a name="rightZero"></a><span class='hs-definition'>rightZero</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>DynFlags</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Literal</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>RuleM</span> <span class='hs-conid'>CoreExpr</span>
<a name="line-124"></a><span class='hs-definition'>rightZero</span> <span class='hs-varid'>zero</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-125"></a>  <span class='hs-varid'>dflags</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getDynFlags</span>
<a name="line-126"></a>  <span class='hs-keyglyph'>[</span><span class='hs-keyword'>_</span><span class='hs-layout'>,</span> <span class='hs-conid'>Lit</span> <span class='hs-varid'>l2</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getArgs</span>
<a name="line-127"></a>  <span class='hs-varid'>guard</span> <span class='hs-varop'>$</span> <span class='hs-varid'>l2</span> <span class='hs-varop'>==</span> <span class='hs-varid'>zero</span> <span class='hs-varid'>dflags</span>
<a name="line-128"></a>  <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Lit</span> <span class='hs-varid'>l2</span>
<a name="line-129"></a>
<a name="line-130"></a><a name="zeroElem"></a><span class='hs-definition'>zeroElem</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>DynFlags</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Literal</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>RuleM</span> <span class='hs-conid'>CoreExpr</span>
<a name="line-131"></a><span class='hs-definition'>zeroElem</span> <span class='hs-varid'>lit</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>leftZero</span> <span class='hs-varid'>lit</span> <span class='hs-varop'>`mplus`</span> <span class='hs-varid'>rightZero</span> <span class='hs-varid'>lit</span>
<a name="line-132"></a>
<a name="line-133"></a><a name="equalArgs"></a><span class='hs-definition'>equalArgs</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>RuleM</span> <span class='hs-conid'>()</span>
<a name="line-134"></a><span class='hs-definition'>equalArgs</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-135"></a>  <span class='hs-keyglyph'>[</span><span class='hs-varid'>e1</span><span class='hs-layout'>,</span> <span class='hs-varid'>e2</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getArgs</span>
<a name="line-136"></a>  <span class='hs-varid'>guard</span> <span class='hs-varop'>$</span> <span class='hs-varid'>e1</span> <span class='hs-varop'>`cheapEqExpr`</span> <span class='hs-varid'>e2</span>
<a name="line-137"></a>
<a name="line-138"></a><a name="nonZeroLit"></a><span class='hs-definition'>nonZeroLit</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>RuleM</span> <span class='hs-conid'>()</span>
<a name="line-139"></a><span class='hs-definition'>nonZeroLit</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getLiteral</span> <span class='hs-varid'>n</span> <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-varid'>guard</span> <span class='hs-varop'>.</span> <span class='hs-varid'>not</span> <span class='hs-varop'>.</span> <span class='hs-varid'>isZeroLit</span>
<a name="line-140"></a>
<a name="line-141"></a><a name="convFloating"></a><span class='hs-comment'>-- When excess precision is not requested, cut down the precision of the</span>
<a name="line-142"></a><span class='hs-comment'>-- Rational value to that of Float/Double. We confuse host architecture</span>
<a name="line-143"></a><span class='hs-comment'>-- and target architecture here, but it's convenient (and wrong :-).</span>
<a name="line-144"></a><span class='hs-definition'>convFloating</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>DynFlags</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Literal</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Literal</span>
<a name="line-145"></a><span class='hs-definition'>convFloating</span> <span class='hs-varid'>dflags</span> <span class='hs-layout'>(</span><span class='hs-conid'>MachFloat</span>  <span class='hs-varid'>f</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>not</span> <span class='hs-layout'>(</span><span class='hs-varid'>gopt</span> <span class='hs-conid'>Opt_ExcessPrecision</span> <span class='hs-varid'>dflags</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-146"></a>   <span class='hs-conid'>MachFloat</span>  <span class='hs-layout'>(</span><span class='hs-varid'>toRational</span> <span class='hs-layout'>(</span><span class='hs-varid'>fromRational</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Float</span> <span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-147"></a><span class='hs-definition'>convFloating</span> <span class='hs-varid'>dflags</span> <span class='hs-layout'>(</span><span class='hs-conid'>MachDouble</span> <span class='hs-varid'>d</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>not</span> <span class='hs-layout'>(</span><span class='hs-varid'>gopt</span> <span class='hs-conid'>Opt_ExcessPrecision</span> <span class='hs-varid'>dflags</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-148"></a>   <span class='hs-conid'>MachDouble</span> <span class='hs-layout'>(</span><span class='hs-varid'>toRational</span> <span class='hs-layout'>(</span><span class='hs-varid'>fromRational</span> <span class='hs-varid'>d</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Double</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-149"></a><span class='hs-definition'>convFloating</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>l</span>
<a name="line-150"></a>
<a name="line-151"></a><a name="guardFloatDiv"></a><span class='hs-definition'>guardFloatDiv</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>RuleM</span> <span class='hs-conid'>()</span>
<a name="line-152"></a><span class='hs-definition'>guardFloatDiv</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-153"></a>  <span class='hs-keyglyph'>[</span><span class='hs-conid'>Lit</span> <span class='hs-layout'>(</span><span class='hs-conid'>MachFloat</span> <span class='hs-varid'>f1</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>Lit</span> <span class='hs-layout'>(</span><span class='hs-conid'>MachFloat</span> <span class='hs-varid'>f2</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getArgs</span>
<a name="line-154"></a>  <span class='hs-varid'>guard</span> <span class='hs-varop'>$</span> <span class='hs-layout'>(</span><span class='hs-varid'>f1</span> <span class='hs-varop'>/=</span><span class='hs-num'>0</span> <span class='hs-varop'>||</span> <span class='hs-varid'>f2</span> <span class='hs-varop'>&gt;</span> <span class='hs-num'>0</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- see Note [negative zero]</span>
<a name="line-155"></a>       <span class='hs-varop'>&amp;&amp;</span> <span class='hs-varid'>f2</span> <span class='hs-varop'>/=</span> <span class='hs-num'>0</span>            <span class='hs-comment'>-- avoid NaN and Infinity/-Infinity</span>
<a name="line-156"></a>
<a name="line-157"></a><a name="guardDoubleDiv"></a><span class='hs-definition'>guardDoubleDiv</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>RuleM</span> <span class='hs-conid'>()</span>
<a name="line-158"></a><span class='hs-definition'>guardDoubleDiv</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-159"></a>  <span class='hs-keyglyph'>[</span><span class='hs-conid'>Lit</span> <span class='hs-layout'>(</span><span class='hs-conid'>MachDouble</span> <span class='hs-varid'>d1</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>Lit</span> <span class='hs-layout'>(</span><span class='hs-conid'>MachDouble</span> <span class='hs-varid'>d2</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getArgs</span>
<a name="line-160"></a>  <span class='hs-varid'>guard</span> <span class='hs-varop'>$</span> <span class='hs-layout'>(</span><span class='hs-varid'>d1</span> <span class='hs-varop'>/=</span><span class='hs-num'>0</span> <span class='hs-varop'>||</span> <span class='hs-varid'>d2</span> <span class='hs-varop'>&gt;</span> <span class='hs-num'>0</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- see Note [negative zero]</span>
<a name="line-161"></a>       <span class='hs-varop'>&amp;&amp;</span> <span class='hs-varid'>d2</span> <span class='hs-varop'>/=</span> <span class='hs-num'>0</span>            <span class='hs-comment'>-- avoid NaN and Infinity/-Infinity</span>
<a name="line-162"></a><span class='hs-comment'>-- Note [negative zero] Avoid (0 / -d), otherwise 0/(-1) reduces to</span>
<a name="line-163"></a><span class='hs-comment'>-- zero, but we might want to preserve the negative zero here which</span>
<a name="line-164"></a><span class='hs-comment'>-- is representable in Float/Double but not in (normalised)</span>
<a name="line-165"></a><span class='hs-comment'>-- Rational. (#3676) Perhaps we should generate (0 :% (-1)) instead?</span>
<a name="line-166"></a>
<a name="line-167"></a><a name="strengthReduction"></a><span class='hs-definition'>strengthReduction</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Literal</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>PrimOp</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>RuleM</span> <span class='hs-conid'>CoreExpr</span>
<a name="line-168"></a><span class='hs-definition'>strengthReduction</span> <span class='hs-varid'>two_lit</span> <span class='hs-varid'>add_op</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span> <span class='hs-comment'>-- Note [Strength reduction]</span>
<a name="line-169"></a>  <span class='hs-varid'>arg</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>msum</span> <span class='hs-keyglyph'>[</span> <span class='hs-keyword'>do</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>arg</span><span class='hs-layout'>,</span> <span class='hs-conid'>Lit</span> <span class='hs-varid'>mult_lit</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getArgs</span>
<a name="line-170"></a>                   <span class='hs-varid'>guard</span> <span class='hs-layout'>(</span><span class='hs-varid'>mult_lit</span> <span class='hs-varop'>==</span> <span class='hs-varid'>two_lit</span><span class='hs-layout'>)</span>
<a name="line-171"></a>                   <span class='hs-varid'>return</span> <span class='hs-varid'>arg</span>
<a name="line-172"></a>              <span class='hs-layout'>,</span> <span class='hs-keyword'>do</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Lit</span> <span class='hs-varid'>mult_lit</span><span class='hs-layout'>,</span> <span class='hs-varid'>arg</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getArgs</span>
<a name="line-173"></a>                   <span class='hs-varid'>guard</span> <span class='hs-layout'>(</span><span class='hs-varid'>mult_lit</span> <span class='hs-varop'>==</span> <span class='hs-varid'>two_lit</span><span class='hs-layout'>)</span>
<a name="line-174"></a>                   <span class='hs-varid'>return</span> <span class='hs-varid'>arg</span> <span class='hs-keyglyph'>]</span>
<a name="line-175"></a>  <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Var</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkPrimOpId</span> <span class='hs-varid'>add_op</span><span class='hs-layout'>)</span> <span class='hs-varop'>`App`</span> <span class='hs-varid'>arg</span> <span class='hs-varop'>`App`</span> <span class='hs-varid'>arg</span>
<a name="line-176"></a>
<a name="line-177"></a><span class='hs-comment'>-- Note [Strength reduction]</span>
<a name="line-178"></a><span class='hs-comment'>-- ~~~~~~~~~~~~~~~~~~~~~~~~~</span>
<a name="line-179"></a><span class='hs-comment'>--</span>
<a name="line-180"></a><span class='hs-comment'>-- This rule turns floating point multiplications of the form 2.0 * x and</span>
<a name="line-181"></a><span class='hs-comment'>-- x * 2.0 into x + x addition, because addition costs less than multiplication.</span>
<a name="line-182"></a><span class='hs-comment'>-- See #7116</span>
<a name="line-183"></a>
<a name="line-184"></a><span class='hs-comment'>-- Note [What's true and false]</span>
<a name="line-185"></a><span class='hs-comment'>-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
<a name="line-186"></a><span class='hs-comment'>--</span>
<a name="line-187"></a><span class='hs-comment'>-- trueValInt and falseValInt represent true and false values returned by</span>
<a name="line-188"></a><span class='hs-comment'>-- comparison primops for Char, Int, Word, Integer, Double, Float and Addr.</span>
<a name="line-189"></a><span class='hs-comment'>-- True is represented as an unboxed 1# literal, while false is represented</span>
<a name="line-190"></a><span class='hs-comment'>-- as 0# literal.</span>
<a name="line-191"></a><span class='hs-comment'>-- We still need Bool data constructors (True and False) to use in a rule</span>
<a name="line-192"></a><span class='hs-comment'>-- for constant folding of equal Strings</span>
<a name="line-193"></a>
<a name="line-194"></a><a name="trueValInt"></a><span class='hs-definition'>trueValInt</span><span class='hs-layout'>,</span> <span class='hs-varid'>falseValInt</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>DynFlags</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Expr</span> <span class='hs-conid'>CoreBndr</span>
<a name="line-195"></a><span class='hs-definition'>trueValInt</span>  <span class='hs-varid'>dflags</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Lit</span> <span class='hs-varop'>$</span> <span class='hs-varid'>onei</span>  <span class='hs-varid'>dflags</span> <span class='hs-comment'>-- see Note [What's true and false]</span>
<a name="line-196"></a><a name="falseValInt"></a><span class='hs-definition'>falseValInt</span> <span class='hs-varid'>dflags</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Lit</span> <span class='hs-varop'>$</span> <span class='hs-varid'>zeroi</span> <span class='hs-varid'>dflags</span>
<a name="line-197"></a>
<a name="line-198"></a><a name="trueValBool"></a><span class='hs-definition'>trueValBool</span><span class='hs-layout'>,</span> <span class='hs-varid'>falseValBool</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Expr</span> <span class='hs-conid'>CoreBndr</span>
<a name="line-199"></a><span class='hs-definition'>trueValBool</span>   <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Var</span> <span class='hs-varid'>trueDataConId</span> <span class='hs-comment'>-- see Note [What's true and false]</span>
<a name="line-200"></a><a name="falseValBool"></a><span class='hs-definition'>falseValBool</span>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Var</span> <span class='hs-varid'>falseDataConId</span>
<a name="line-201"></a>
<a name="line-202"></a><a name="ltVal"></a><span class='hs-definition'>ltVal</span><span class='hs-layout'>,</span> <span class='hs-varid'>eqVal</span><span class='hs-layout'>,</span> <span class='hs-varid'>gtVal</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Expr</span> <span class='hs-conid'>CoreBndr</span>
<a name="line-203"></a><span class='hs-definition'>ltVal</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Var</span> <span class='hs-varid'>ltDataConId</span>
<a name="line-204"></a><a name="eqVal"></a><span class='hs-definition'>eqVal</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Var</span> <span class='hs-varid'>eqDataConId</span>
<a name="line-205"></a><a name="gtVal"></a><span class='hs-definition'>gtVal</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Var</span> <span class='hs-varid'>gtDataConId</span>
<a name="line-206"></a>
<a name="line-207"></a><a name="mkIntVal"></a><span class='hs-definition'>mkIntVal</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>DynFlags</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Integer</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Expr</span> <span class='hs-conid'>CoreBndr</span>
<a name="line-208"></a><span class='hs-definition'>mkIntVal</span> <span class='hs-varid'>dflags</span> <span class='hs-varid'>i</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Lit</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkMachInt</span> <span class='hs-varid'>dflags</span> <span class='hs-varid'>i</span><span class='hs-layout'>)</span>
<a name="line-209"></a><a name="mkWordVal"></a><span class='hs-definition'>mkWordVal</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>DynFlags</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Integer</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Expr</span> <span class='hs-conid'>CoreBndr</span>
<a name="line-210"></a><span class='hs-definition'>mkWordVal</span> <span class='hs-varid'>dflags</span> <span class='hs-varid'>w</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Lit</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkMachWord</span> <span class='hs-varid'>dflags</span> <span class='hs-varid'>w</span><span class='hs-layout'>)</span>
<a name="line-211"></a><a name="mkFloatVal"></a><span class='hs-definition'>mkFloatVal</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>DynFlags</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Rational</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Expr</span> <span class='hs-conid'>CoreBndr</span>
<a name="line-212"></a><span class='hs-definition'>mkFloatVal</span> <span class='hs-varid'>dflags</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Lit</span> <span class='hs-layout'>(</span><span class='hs-varid'>convFloating</span> <span class='hs-varid'>dflags</span> <span class='hs-layout'>(</span><span class='hs-conid'>MachFloat</span>  <span class='hs-varid'>f</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-213"></a><a name="mkDoubleVal"></a><span class='hs-definition'>mkDoubleVal</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>DynFlags</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Rational</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Expr</span> <span class='hs-conid'>CoreBndr</span>
<a name="line-214"></a><span class='hs-definition'>mkDoubleVal</span> <span class='hs-varid'>dflags</span> <span class='hs-varid'>d</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Lit</span> <span class='hs-layout'>(</span><span class='hs-varid'>convFloating</span> <span class='hs-varid'>dflags</span> <span class='hs-layout'>(</span><span class='hs-conid'>MachDouble</span> <span class='hs-varid'>d</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-215"></a>
<a name="line-216"></a><a name="matchPrimOpId"></a><span class='hs-definition'>matchPrimOpId</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>PrimOp</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>RuleM</span> <span class='hs-conid'>()</span>
<a name="line-217"></a><span class='hs-definition'>matchPrimOpId</span> <span class='hs-varid'>op</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-218"></a>  <span class='hs-varid'>op'</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>liftMaybe</span> <span class='hs-varop'>$</span> <span class='hs-varid'>isPrimOpId_maybe</span> <span class='hs-varid'>id</span>
<a name="line-219"></a>  <span class='hs-varid'>guard</span> <span class='hs-varop'>$</span> <span class='hs-varid'>op</span> <span class='hs-varop'>==</span> <span class='hs-varid'>op'</span>
<a name="line-220"></a>
</pre>\end{code}

%************************************************************************
%*                                                                      *
\subsection{Special rules for seq, tagToEnum, dataToTag}
%*                                                                      *
%************************************************************************

Note [tagToEnum#]
~~~~~~~~~~~~~~~~~
Nasty check to ensure that tagToEnum# is applied to a type that is an
enumeration TyCon.  Unification may refine the type later, but this
check won't see that, alas.  It's crude but it works.

Here's are two cases that should fail
        f :: forall a. a
        f = tagToEnum# 0        -- Can't do tagToEnum# at a type variable

        g :: Int
        g = tagToEnum# 0        -- Int is not an enumeration

We used to make this check in the type inference engine, but it's quite
ugly to do so, because the delayed constraint solving means that we don't
really know what's going on until the end. It's very much a corner case
because we don't expect the user to call tagToEnum# at all; we merely
generate calls in derived instances of Enum.  So we compromise: a
rewrite rule rewrites a bad instance of tagToEnum# to an error call,
and emits a warning.

\begin{code}
<pre><a name="line-1"></a><a name="tagToEnumRule"></a><span class='hs-definition'>tagToEnumRule</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>RuleM</span> <span class='hs-conid'>CoreExpr</span>
<a name="line-2"></a><span class='hs-comment'>-- If     data T a = A | B | C</span>
<a name="line-3"></a><span class='hs-comment'>-- then   tag2Enum# (T ty) 2# --&gt;  B ty</span>
<a name="line-4"></a><span class='hs-definition'>tagToEnumRule</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-5"></a>  <span class='hs-keyglyph'>[</span><span class='hs-conid'>Type</span> <span class='hs-varid'>ty</span><span class='hs-layout'>,</span> <span class='hs-conid'>Lit</span> <span class='hs-layout'>(</span><span class='hs-conid'>MachInt</span> <span class='hs-varid'>i</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getArgs</span>
<a name="line-6"></a>  <span class='hs-keyword'>case</span> <span class='hs-varid'>splitTyConApp_maybe</span> <span class='hs-varid'>ty</span> <span class='hs-keyword'>of</span>
<a name="line-7"></a>    <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-varid'>tycon</span><span class='hs-layout'>,</span> <span class='hs-varid'>tc_args</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>isEnumerationTyCon</span> <span class='hs-varid'>tycon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<a name="line-8"></a>      <span class='hs-keyword'>let</span> <span class='hs-varid'>tag</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fromInteger</span> <span class='hs-varid'>i</span>
<a name="line-9"></a>          <span class='hs-varid'>correct_tag</span> <span class='hs-varid'>dc</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>dataConTag</span> <span class='hs-varid'>dc</span> <span class='hs-comment'>-</span> <span class='hs-varid'>fIRST_TAG</span><span class='hs-layout'>)</span> <span class='hs-varop'>==</span> <span class='hs-varid'>tag</span>
<a name="line-10"></a>      <span class='hs-layout'>(</span><span class='hs-varid'>dc</span><span class='hs-conop'>:</span><span class='hs-varid'>rest</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-varid'>filter</span> <span class='hs-varid'>correct_tag</span> <span class='hs-layout'>(</span><span class='hs-varid'>tyConDataCons_maybe</span> <span class='hs-varid'>tycon</span> <span class='hs-varop'>`orElse`</span> <span class='hs-conid'>[]</span><span class='hs-layout'>)</span>
<a name="line-11"></a>      <span class='hs-conid'>ASSERT</span><span class='hs-layout'>(</span><span class='hs-varid'>null</span> <span class='hs-varid'>rest</span><span class='hs-layout'>)</span> <span class='hs-varid'>return</span> <span class='hs-conid'>()</span>
<a name="line-12"></a>      <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-varid'>mkTyApps</span> <span class='hs-layout'>(</span><span class='hs-conid'>Var</span> <span class='hs-layout'>(</span><span class='hs-varid'>dataConWorkId</span> <span class='hs-varid'>dc</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varid'>tc_args</span>
<a name="line-13"></a>
<a name="line-14"></a>    <span class='hs-comment'>-- See Note [tagToEnum#]</span>
<a name="line-15"></a>    <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>WARN</span><span class='hs-layout'>(</span> <span class='hs-conid'>True</span><span class='hs-layout'>,</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"tagToEnum# on non-enumeration type"</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>ty</span> <span class='hs-layout'>)</span>
<a name="line-16"></a>         <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-varid'>mkRuntimeErrorApp</span> <span class='hs-varid'>rUNTIME_ERROR_ID</span> <span class='hs-varid'>ty</span> <span class='hs-str'>"tagToEnum# on non-enumeration type"</span>
</pre>\end{code}


For dataToTag#, we can reduce if either

        (a) the argument is a constructor
        (b) the argument is a variable whose unfolding is a known constructor

\begin{code}
<pre><a name="line-1"></a><a name="dataToTagRule"></a><span class='hs-definition'>dataToTagRule</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>RuleM</span> <span class='hs-conid'>CoreExpr</span>
<a name="line-2"></a><span class='hs-definition'>dataToTagRule</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>a</span> <span class='hs-varop'>`mplus`</span> <span class='hs-varid'>b</span>
<a name="line-3"></a>  <span class='hs-keyword'>where</span>
<a name="line-4"></a>    <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-5"></a>      <span class='hs-keyglyph'>[</span><span class='hs-conid'>Type</span> <span class='hs-varid'>ty1</span><span class='hs-layout'>,</span> <span class='hs-conid'>Var</span> <span class='hs-varid'>tag_to_enum</span> <span class='hs-varop'>`App`</span> <span class='hs-conid'>Type</span> <span class='hs-varid'>ty2</span> <span class='hs-varop'>`App`</span> <span class='hs-varid'>tag</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getArgs</span>
<a name="line-6"></a>      <span class='hs-varid'>guard</span> <span class='hs-varop'>$</span> <span class='hs-varid'>tag_to_enum</span> <span class='hs-varop'>`hasKey`</span> <span class='hs-varid'>tagToEnumKey</span>
<a name="line-7"></a>      <span class='hs-varid'>guard</span> <span class='hs-varop'>$</span> <span class='hs-varid'>ty1</span> <span class='hs-varop'>`eqType`</span> <span class='hs-varid'>ty2</span>
<a name="line-8"></a>      <span class='hs-varid'>return</span> <span class='hs-varid'>tag</span> <span class='hs-comment'>-- dataToTag (tagToEnum x)   ==&gt;   x</span>
<a name="line-9"></a>    <span class='hs-varid'>b</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-10"></a>      <span class='hs-varid'>dflags</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getDynFlags</span>
<a name="line-11"></a>      <span class='hs-keyglyph'>[</span><span class='hs-keyword'>_</span><span class='hs-layout'>,</span> <span class='hs-varid'>val_arg</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getArgs</span>
<a name="line-12"></a>      <span class='hs-varid'>in_scope</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getInScopeEnv</span>
<a name="line-13"></a>      <span class='hs-layout'>(</span><span class='hs-varid'>dc</span><span class='hs-layout'>,</span><span class='hs-keyword'>_</span><span class='hs-layout'>,</span><span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>liftMaybe</span> <span class='hs-varop'>$</span> <span class='hs-varid'>exprIsConApp_maybe</span> <span class='hs-varid'>in_scope</span> <span class='hs-varid'>val_arg</span>
<a name="line-14"></a>      <span class='hs-conid'>ASSERT</span><span class='hs-layout'>(</span> <span class='hs-varid'>not</span> <span class='hs-layout'>(</span><span class='hs-varid'>isNewTyCon</span> <span class='hs-layout'>(</span><span class='hs-varid'>dataConTyCon</span> <span class='hs-varid'>dc</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-layout'>)</span> <span class='hs-varid'>return</span> <span class='hs-conid'>()</span>
<a name="line-15"></a>      <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-varid'>mkIntVal</span> <span class='hs-varid'>dflags</span> <span class='hs-layout'>(</span><span class='hs-varid'>toInteger</span> <span class='hs-layout'>(</span><span class='hs-varid'>dataConTag</span> <span class='hs-varid'>dc</span> <span class='hs-comment'>-</span> <span class='hs-varid'>fIRST_TAG</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
</pre>\end{code}

%************************************************************************
%*                                                                      *
\subsection{Rules for seq# and spark#}
%*                                                                      *
%************************************************************************

\begin{code}
<pre><a name="line-1"></a><a name="seqRule"></a><span class='hs-comment'>-- seq# :: forall a s . a -&gt; State# s -&gt; (# State# s, a #)</span>
<a name="line-2"></a><span class='hs-definition'>seqRule</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>RuleM</span> <span class='hs-conid'>CoreExpr</span>
<a name="line-3"></a><span class='hs-definition'>seqRule</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-4"></a>  <span class='hs-keyglyph'>[</span><span class='hs-varid'>ty_a</span><span class='hs-layout'>,</span> <span class='hs-conid'>Type</span> <span class='hs-varid'>ty_s</span><span class='hs-layout'>,</span> <span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-varid'>s</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getArgs</span>
<a name="line-5"></a>  <span class='hs-varid'>guard</span> <span class='hs-varop'>$</span> <span class='hs-varid'>exprIsHNF</span> <span class='hs-varid'>a</span>
<a name="line-6"></a>  <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-varid'>mkConApp</span> <span class='hs-layout'>(</span><span class='hs-varid'>tupleCon</span> <span class='hs-conid'>UnboxedTuple</span> <span class='hs-num'>2</span><span class='hs-layout'>)</span>
<a name="line-7"></a>    <span class='hs-keyglyph'>[</span><span class='hs-conid'>Type</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkStatePrimTy</span> <span class='hs-varid'>ty_s</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>ty_a</span><span class='hs-layout'>,</span> <span class='hs-varid'>s</span><span class='hs-layout'>,</span> <span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span>
<a name="line-8"></a>
<a name="line-9"></a><a name="sparkRule"></a><span class='hs-comment'>-- spark# :: forall a s . a -&gt; State# s -&gt; (# State# s, a #)</span>
<a name="line-10"></a><span class='hs-definition'>sparkRule</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>RuleM</span> <span class='hs-conid'>CoreExpr</span>
<a name="line-11"></a><span class='hs-definition'>sparkRule</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>seqRule</span> <span class='hs-comment'>-- reduce on HNF, just the same</span>
<a name="line-12"></a>  <span class='hs-comment'>-- XXX perhaps we shouldn't do this, because a spark eliminated by</span>
<a name="line-13"></a>  <span class='hs-comment'>-- this rule won't be counted as a dud at runtime?</span>
</pre>\end{code}

%************************************************************************
%*                                                                      *
\subsection{Built in rules}
%*                                                                      *
%************************************************************************

Note [Scoping for Builtin rules]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
When compiling a (base-package) module that defines one of the
functions mentioned in the RHS of a built-in rule, there's a danger
that we'll see

        f = ...(eq String x)....

        ....and lower down...

        eqString = ...

Then a rewrite would give

        f = ...(eqString x)...
        ....and lower down...
        eqString = ...

and lo, eqString is not in scope.  This only really matters when we get to code
generation.  With -O we do a GlomBinds step that does a new SCC analysis on the whole
set of bindings, which sorts out the dependency.  Without -O we don't do any rule
rewriting so again we are fine.

(This whole thing doesn't show up for non-built-in rules because their dependencies
are explicit.)


\begin{code}
<pre><a name="line-1"></a><a name="builtinRules"></a><span class='hs-definition'>builtinRules</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>CoreRule</span><span class='hs-keyglyph'>]</span>
<a name="line-2"></a><span class='hs-comment'>-- Rules for non-primops that can't be expressed using a RULE pragma</span>
<a name="line-3"></a><span class='hs-definition'>builtinRules</span>
<a name="line-4"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>BuiltinRule</span> <span class='hs-layout'>{</span> <span class='hs-varid'>ru_name</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fsLit</span> <span class='hs-str'>"AppendLitString"</span><span class='hs-layout'>,</span>
<a name="line-5"></a>                   <span class='hs-varid'>ru_fn</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>unpackCStringFoldrName</span><span class='hs-layout'>,</span>
<a name="line-6"></a>                   <span class='hs-varid'>ru_nargs</span> <span class='hs-keyglyph'>=</span> <span class='hs-num'>4</span><span class='hs-layout'>,</span> <span class='hs-varid'>ru_try</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>\</span><span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>match_append_lit</span> <span class='hs-layout'>}</span><span class='hs-layout'>,</span>
<a name="line-7"></a>     <span class='hs-conid'>BuiltinRule</span> <span class='hs-layout'>{</span> <span class='hs-varid'>ru_name</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fsLit</span> <span class='hs-str'>"EqString"</span><span class='hs-layout'>,</span> <span class='hs-varid'>ru_fn</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>eqStringName</span><span class='hs-layout'>,</span>
<a name="line-8"></a>                   <span class='hs-varid'>ru_nargs</span> <span class='hs-keyglyph'>=</span> <span class='hs-num'>2</span><span class='hs-layout'>,</span> <span class='hs-varid'>ru_try</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>dflags</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>match_eq_string</span> <span class='hs-varid'>dflags</span> <span class='hs-layout'>}</span><span class='hs-layout'>,</span>
<a name="line-9"></a>     <span class='hs-conid'>BuiltinRule</span> <span class='hs-layout'>{</span> <span class='hs-varid'>ru_name</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fsLit</span> <span class='hs-str'>"Inline"</span><span class='hs-layout'>,</span> <span class='hs-varid'>ru_fn</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>inlineIdName</span><span class='hs-layout'>,</span>
<a name="line-10"></a>                   <span class='hs-varid'>ru_nargs</span> <span class='hs-keyglyph'>=</span> <span class='hs-num'>2</span><span class='hs-layout'>,</span> <span class='hs-varid'>ru_try</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>\</span><span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>match_inline</span> <span class='hs-layout'>}</span><span class='hs-layout'>,</span>
<a name="line-11"></a>     <span class='hs-conid'>BuiltinRule</span> <span class='hs-layout'>{</span> <span class='hs-varid'>ru_name</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fsLit</span> <span class='hs-str'>"MagicDict"</span><span class='hs-layout'>,</span> <span class='hs-varid'>ru_fn</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>idName</span> <span class='hs-varid'>magicDictId</span><span class='hs-layout'>,</span>
<a name="line-12"></a>                   <span class='hs-varid'>ru_nargs</span> <span class='hs-keyglyph'>=</span> <span class='hs-num'>4</span><span class='hs-layout'>,</span> <span class='hs-varid'>ru_try</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>\</span><span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>match_magicDict</span> <span class='hs-layout'>}</span>
<a name="line-13"></a>     <span class='hs-keyglyph'>]</span>
<a name="line-14"></a> <span class='hs-varop'>++</span> <span class='hs-varid'>builtinIntegerRules</span>
<a name="line-15"></a>
<a name="line-16"></a><a name="builtinIntegerRules"></a><span class='hs-definition'>builtinIntegerRules</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>CoreRule</span><span class='hs-keyglyph'>]</span>
<a name="line-17"></a><span class='hs-definition'>builtinIntegerRules</span> <span class='hs-keyglyph'>=</span>
<a name="line-18"></a> <span class='hs-keyglyph'>[</span><span class='hs-varid'>rule_IntToInteger</span>   <span class='hs-str'>"smallInteger"</span>        <span class='hs-varid'>smallIntegerName</span><span class='hs-layout'>,</span>
<a name="line-19"></a>  <span class='hs-varid'>rule_WordToInteger</span>  <span class='hs-str'>"wordToInteger"</span>       <span class='hs-varid'>wordToIntegerName</span><span class='hs-layout'>,</span>
<a name="line-20"></a>  <span class='hs-varid'>rule_Int64ToInteger</span>  <span class='hs-str'>"int64ToInteger"</span>     <span class='hs-varid'>int64ToIntegerName</span><span class='hs-layout'>,</span>
<a name="line-21"></a>  <span class='hs-varid'>rule_Word64ToInteger</span> <span class='hs-str'>"word64ToInteger"</span>    <span class='hs-varid'>word64ToIntegerName</span><span class='hs-layout'>,</span>
<a name="line-22"></a>  <span class='hs-varid'>rule_convert</span>        <span class='hs-str'>"integerToWord"</span>       <span class='hs-varid'>integerToWordName</span>       <span class='hs-varid'>mkWordLitWord</span><span class='hs-layout'>,</span>
<a name="line-23"></a>  <span class='hs-varid'>rule_convert</span>        <span class='hs-str'>"integerToInt"</span>        <span class='hs-varid'>integerToIntName</span>        <span class='hs-varid'>mkIntLitInt</span><span class='hs-layout'>,</span>
<a name="line-24"></a>  <span class='hs-varid'>rule_convert</span>        <span class='hs-str'>"integerToWord64"</span>     <span class='hs-varid'>integerToWord64Name</span>     <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>mkWord64LitWord64</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-25"></a>  <span class='hs-varid'>rule_convert</span>        <span class='hs-str'>"integerToInt64"</span>      <span class='hs-varid'>integerToInt64Name</span>      <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>mkInt64LitInt64</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-26"></a>  <span class='hs-varid'>rule_binop</span>          <span class='hs-str'>"plusInteger"</span>         <span class='hs-varid'>plusIntegerName</span>         <span class='hs-layout'>(</span><span class='hs-varop'>+</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-27"></a>  <span class='hs-varid'>rule_binop</span>          <span class='hs-str'>"minusInteger"</span>        <span class='hs-varid'>minusIntegerName</span>        <span class='hs-layout'>(</span><span class='hs-comment'>-</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-28"></a>  <span class='hs-varid'>rule_binop</span>          <span class='hs-str'>"timesInteger"</span>        <span class='hs-varid'>timesIntegerName</span>        <span class='hs-layout'>(</span><span class='hs-varop'>*</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-29"></a>  <span class='hs-varid'>rule_unop</span>           <span class='hs-str'>"negateInteger"</span>       <span class='hs-varid'>negateIntegerName</span>       <span class='hs-varid'>negate</span><span class='hs-layout'>,</span>
<a name="line-30"></a>  <span class='hs-varid'>rule_binop_Prim</span>     <span class='hs-str'>"eqInteger#"</span>          <span class='hs-varid'>eqIntegerPrimName</span>       <span class='hs-layout'>(</span><span class='hs-varop'>==</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-31"></a>  <span class='hs-varid'>rule_binop_Prim</span>     <span class='hs-str'>"neqInteger#"</span>         <span class='hs-varid'>neqIntegerPrimName</span>      <span class='hs-layout'>(</span><span class='hs-varop'>/=</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-32"></a>  <span class='hs-varid'>rule_unop</span>           <span class='hs-str'>"absInteger"</span>          <span class='hs-varid'>absIntegerName</span>          <span class='hs-varid'>abs</span><span class='hs-layout'>,</span>
<a name="line-33"></a>  <span class='hs-varid'>rule_unop</span>           <span class='hs-str'>"signumInteger"</span>       <span class='hs-varid'>signumIntegerName</span>       <span class='hs-varid'>signum</span><span class='hs-layout'>,</span>
<a name="line-34"></a>  <span class='hs-varid'>rule_binop_Prim</span>     <span class='hs-str'>"leInteger#"</span>          <span class='hs-varid'>leIntegerPrimName</span>       <span class='hs-layout'>(</span><span class='hs-varop'>&lt;=</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-35"></a>  <span class='hs-varid'>rule_binop_Prim</span>     <span class='hs-str'>"gtInteger#"</span>          <span class='hs-varid'>gtIntegerPrimName</span>       <span class='hs-layout'>(</span><span class='hs-varop'>&gt;</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-36"></a>  <span class='hs-varid'>rule_binop_Prim</span>     <span class='hs-str'>"ltInteger#"</span>          <span class='hs-varid'>ltIntegerPrimName</span>       <span class='hs-layout'>(</span><span class='hs-varop'>&lt;</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-37"></a>  <span class='hs-varid'>rule_binop_Prim</span>     <span class='hs-str'>"geInteger#"</span>          <span class='hs-varid'>geIntegerPrimName</span>       <span class='hs-layout'>(</span><span class='hs-varop'>&gt;=</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-38"></a>  <span class='hs-varid'>rule_binop_Ordering</span> <span class='hs-str'>"compareInteger"</span>      <span class='hs-varid'>compareIntegerName</span>      <span class='hs-varid'>compare</span><span class='hs-layout'>,</span>
<a name="line-39"></a>  <span class='hs-varid'>rule_encodeFloat</span>    <span class='hs-str'>"encodeFloatInteger"</span>  <span class='hs-varid'>encodeFloatIntegerName</span>  <span class='hs-varid'>mkFloatLitFloat</span><span class='hs-layout'>,</span>
<a name="line-40"></a>  <span class='hs-varid'>rule_convert</span>        <span class='hs-str'>"floatFromInteger"</span>    <span class='hs-varid'>floatFromIntegerName</span>    <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>mkFloatLitFloat</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-41"></a>  <span class='hs-varid'>rule_encodeFloat</span>    <span class='hs-str'>"encodeDoubleInteger"</span> <span class='hs-varid'>encodeDoubleIntegerName</span> <span class='hs-varid'>mkDoubleLitDouble</span><span class='hs-layout'>,</span>
<a name="line-42"></a>  <span class='hs-varid'>rule_decodeDouble</span>   <span class='hs-str'>"decodeDoubleInteger"</span> <span class='hs-varid'>decodeDoubleIntegerName</span><span class='hs-layout'>,</span>
<a name="line-43"></a>  <span class='hs-varid'>rule_convert</span>        <span class='hs-str'>"doubleFromInteger"</span>   <span class='hs-varid'>doubleFromIntegerName</span>   <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>mkDoubleLitDouble</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-44"></a>  <span class='hs-varid'>rule_rationalTo</span>     <span class='hs-str'>"rationalToFloat"</span>     <span class='hs-varid'>rationalToFloatName</span>     <span class='hs-varid'>mkFloatExpr</span><span class='hs-layout'>,</span>
<a name="line-45"></a>  <span class='hs-varid'>rule_rationalTo</span>     <span class='hs-str'>"rationalToDouble"</span>    <span class='hs-varid'>rationalToDoubleName</span>    <span class='hs-varid'>mkDoubleExpr</span><span class='hs-layout'>,</span>
<a name="line-46"></a>  <span class='hs-varid'>rule_binop</span>          <span class='hs-str'>"gcdInteger"</span>          <span class='hs-varid'>gcdIntegerName</span>          <span class='hs-varid'>gcd</span><span class='hs-layout'>,</span>
<a name="line-47"></a>  <span class='hs-varid'>rule_binop</span>          <span class='hs-str'>"lcmInteger"</span>          <span class='hs-varid'>lcmIntegerName</span>          <span class='hs-varid'>lcm</span><span class='hs-layout'>,</span>
<a name="line-48"></a>  <span class='hs-varid'>rule_binop</span>          <span class='hs-str'>"andInteger"</span>          <span class='hs-varid'>andIntegerName</span>          <span class='hs-layout'>(</span><span class='hs-varop'>.&amp;.</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-49"></a>  <span class='hs-varid'>rule_binop</span>          <span class='hs-str'>"orInteger"</span>           <span class='hs-varid'>orIntegerName</span>           <span class='hs-layout'>(</span><span class='hs-varop'>.|.</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-50"></a>  <span class='hs-varid'>rule_binop</span>          <span class='hs-str'>"xorInteger"</span>          <span class='hs-varid'>xorIntegerName</span>          <span class='hs-varid'>xor</span><span class='hs-layout'>,</span>
<a name="line-51"></a>  <span class='hs-varid'>rule_unop</span>           <span class='hs-str'>"complementInteger"</span>   <span class='hs-varid'>complementIntegerName</span>   <span class='hs-varid'>complement</span><span class='hs-layout'>,</span>
<a name="line-52"></a>  <span class='hs-varid'>rule_Int_binop</span>      <span class='hs-str'>"shiftLInteger"</span>       <span class='hs-varid'>shiftLIntegerName</span>       <span class='hs-varid'>shiftL</span><span class='hs-layout'>,</span>
<a name="line-53"></a>  <span class='hs-varid'>rule_Int_binop</span>      <span class='hs-str'>"shiftRInteger"</span>       <span class='hs-varid'>shiftRIntegerName</span>       <span class='hs-varid'>shiftR</span><span class='hs-layout'>,</span>
<a name="line-54"></a>  <span class='hs-comment'>-- See Note [Integer division constant folding] in libraries/base/GHC/Real.lhs</span>
<a name="line-55"></a>  <span class='hs-varid'>rule_divop_one</span>      <span class='hs-str'>"quotInteger"</span>         <span class='hs-varid'>quotIntegerName</span>         <span class='hs-varid'>quot</span><span class='hs-layout'>,</span>
<a name="line-56"></a>  <span class='hs-varid'>rule_divop_one</span>      <span class='hs-str'>"remInteger"</span>          <span class='hs-varid'>remIntegerName</span>          <span class='hs-varid'>rem</span><span class='hs-layout'>,</span>
<a name="line-57"></a>  <span class='hs-varid'>rule_divop_one</span>      <span class='hs-str'>"divInteger"</span>          <span class='hs-varid'>divIntegerName</span>          <span class='hs-varid'>div</span><span class='hs-layout'>,</span>
<a name="line-58"></a>  <span class='hs-varid'>rule_divop_one</span>      <span class='hs-str'>"modInteger"</span>          <span class='hs-varid'>modIntegerName</span>          <span class='hs-varid'>mod</span><span class='hs-layout'>,</span>
<a name="line-59"></a>  <span class='hs-varid'>rule_divop_both</span>     <span class='hs-str'>"divModInteger"</span>       <span class='hs-varid'>divModIntegerName</span>       <span class='hs-varid'>divMod</span><span class='hs-layout'>,</span>
<a name="line-60"></a>  <span class='hs-varid'>rule_divop_both</span>     <span class='hs-str'>"quotRemInteger"</span>      <span class='hs-varid'>quotRemIntegerName</span>      <span class='hs-varid'>quotRem</span><span class='hs-layout'>,</span>
<a name="line-61"></a>  <span class='hs-comment'>-- These rules below don't actually have to be built in, but if we</span>
<a name="line-62"></a>  <span class='hs-comment'>-- put them in the Haskell source then we'd have to duplicate them</span>
<a name="line-63"></a>  <span class='hs-comment'>-- between all Integer implementations</span>
<a name="line-64"></a>  <span class='hs-varid'>rule_XToIntegerToX</span> <span class='hs-str'>"smallIntegerToInt"</span>       <span class='hs-varid'>integerToIntName</span>    <span class='hs-varid'>smallIntegerName</span><span class='hs-layout'>,</span>
<a name="line-65"></a>  <span class='hs-varid'>rule_XToIntegerToX</span> <span class='hs-str'>"wordToIntegerToWord"</span>     <span class='hs-varid'>integerToWordName</span>   <span class='hs-varid'>wordToIntegerName</span><span class='hs-layout'>,</span>
<a name="line-66"></a>  <span class='hs-varid'>rule_XToIntegerToX</span> <span class='hs-str'>"int64ToIntegerToInt64"</span>   <span class='hs-varid'>integerToInt64Name</span>  <span class='hs-varid'>int64ToIntegerName</span><span class='hs-layout'>,</span>
<a name="line-67"></a>  <span class='hs-varid'>rule_XToIntegerToX</span> <span class='hs-str'>"word64ToIntegerToWord64"</span> <span class='hs-varid'>integerToWord64Name</span> <span class='hs-varid'>word64ToIntegerName</span><span class='hs-layout'>,</span>
<a name="line-68"></a>  <span class='hs-varid'>rule_smallIntegerTo</span> <span class='hs-str'>"smallIntegerToWord"</span>   <span class='hs-varid'>integerToWordName</span>     <span class='hs-conid'>Int2WordOp</span><span class='hs-layout'>,</span>
<a name="line-69"></a>  <span class='hs-varid'>rule_smallIntegerTo</span> <span class='hs-str'>"smallIntegerToFloat"</span>  <span class='hs-varid'>floatFromIntegerName</span>  <span class='hs-conid'>Int2FloatOp</span><span class='hs-layout'>,</span>
<a name="line-70"></a>  <span class='hs-varid'>rule_smallIntegerTo</span> <span class='hs-str'>"smallIntegerToDouble"</span> <span class='hs-varid'>doubleFromIntegerName</span> <span class='hs-conid'>Int2DoubleOp</span>
<a name="line-71"></a>  <span class='hs-keyglyph'>]</span>
<a name="line-72"></a>    <span class='hs-keyword'>where</span> <span class='hs-varid'>rule_convert</span> <span class='hs-varid'>str</span> <span class='hs-varid'>name</span> <span class='hs-varid'>convert</span>
<a name="line-73"></a>           <span class='hs-keyglyph'>=</span> <span class='hs-conid'>BuiltinRule</span> <span class='hs-layout'>{</span> <span class='hs-varid'>ru_name</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fsLit</span> <span class='hs-varid'>str</span><span class='hs-layout'>,</span> <span class='hs-varid'>ru_fn</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>name</span><span class='hs-layout'>,</span> <span class='hs-varid'>ru_nargs</span> <span class='hs-keyglyph'>=</span> <span class='hs-num'>1</span><span class='hs-layout'>,</span>
<a name="line-74"></a>                           <span class='hs-varid'>ru_try</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>match_Integer_convert</span> <span class='hs-varid'>convert</span> <span class='hs-layout'>}</span>
<a name="line-75"></a>          <span class='hs-varid'>rule_IntToInteger</span> <span class='hs-varid'>str</span> <span class='hs-varid'>name</span>
<a name="line-76"></a>           <span class='hs-keyglyph'>=</span> <span class='hs-conid'>BuiltinRule</span> <span class='hs-layout'>{</span> <span class='hs-varid'>ru_name</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fsLit</span> <span class='hs-varid'>str</span><span class='hs-layout'>,</span> <span class='hs-varid'>ru_fn</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>name</span><span class='hs-layout'>,</span> <span class='hs-varid'>ru_nargs</span> <span class='hs-keyglyph'>=</span> <span class='hs-num'>1</span><span class='hs-layout'>,</span>
<a name="line-77"></a>                           <span class='hs-varid'>ru_try</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>match_IntToInteger</span> <span class='hs-layout'>}</span>
<a name="line-78"></a>          <span class='hs-varid'>rule_WordToInteger</span> <span class='hs-varid'>str</span> <span class='hs-varid'>name</span>
<a name="line-79"></a>           <span class='hs-keyglyph'>=</span> <span class='hs-conid'>BuiltinRule</span> <span class='hs-layout'>{</span> <span class='hs-varid'>ru_name</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fsLit</span> <span class='hs-varid'>str</span><span class='hs-layout'>,</span> <span class='hs-varid'>ru_fn</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>name</span><span class='hs-layout'>,</span> <span class='hs-varid'>ru_nargs</span> <span class='hs-keyglyph'>=</span> <span class='hs-num'>1</span><span class='hs-layout'>,</span>
<a name="line-80"></a>                           <span class='hs-varid'>ru_try</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>match_WordToInteger</span> <span class='hs-layout'>}</span>
<a name="line-81"></a>          <span class='hs-varid'>rule_Int64ToInteger</span> <span class='hs-varid'>str</span> <span class='hs-varid'>name</span>
<a name="line-82"></a>           <span class='hs-keyglyph'>=</span> <span class='hs-conid'>BuiltinRule</span> <span class='hs-layout'>{</span> <span class='hs-varid'>ru_name</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fsLit</span> <span class='hs-varid'>str</span><span class='hs-layout'>,</span> <span class='hs-varid'>ru_fn</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>name</span><span class='hs-layout'>,</span> <span class='hs-varid'>ru_nargs</span> <span class='hs-keyglyph'>=</span> <span class='hs-num'>1</span><span class='hs-layout'>,</span>
<a name="line-83"></a>                           <span class='hs-varid'>ru_try</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>match_Int64ToInteger</span> <span class='hs-layout'>}</span>
<a name="line-84"></a>          <span class='hs-varid'>rule_Word64ToInteger</span> <span class='hs-varid'>str</span> <span class='hs-varid'>name</span>
<a name="line-85"></a>           <span class='hs-keyglyph'>=</span> <span class='hs-conid'>BuiltinRule</span> <span class='hs-layout'>{</span> <span class='hs-varid'>ru_name</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fsLit</span> <span class='hs-varid'>str</span><span class='hs-layout'>,</span> <span class='hs-varid'>ru_fn</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>name</span><span class='hs-layout'>,</span> <span class='hs-varid'>ru_nargs</span> <span class='hs-keyglyph'>=</span> <span class='hs-num'>1</span><span class='hs-layout'>,</span>
<a name="line-86"></a>                           <span class='hs-varid'>ru_try</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>match_Word64ToInteger</span> <span class='hs-layout'>}</span>
<a name="line-87"></a>          <span class='hs-varid'>rule_unop</span> <span class='hs-varid'>str</span> <span class='hs-varid'>name</span> <span class='hs-varid'>op</span>
<a name="line-88"></a>           <span class='hs-keyglyph'>=</span> <span class='hs-conid'>BuiltinRule</span> <span class='hs-layout'>{</span> <span class='hs-varid'>ru_name</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fsLit</span> <span class='hs-varid'>str</span><span class='hs-layout'>,</span> <span class='hs-varid'>ru_fn</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>name</span><span class='hs-layout'>,</span> <span class='hs-varid'>ru_nargs</span> <span class='hs-keyglyph'>=</span> <span class='hs-num'>1</span><span class='hs-layout'>,</span>
<a name="line-89"></a>                           <span class='hs-varid'>ru_try</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>match_Integer_unop</span> <span class='hs-varid'>op</span> <span class='hs-layout'>}</span>
<a name="line-90"></a>          <span class='hs-varid'>rule_binop</span> <span class='hs-varid'>str</span> <span class='hs-varid'>name</span> <span class='hs-varid'>op</span>
<a name="line-91"></a>           <span class='hs-keyglyph'>=</span> <span class='hs-conid'>BuiltinRule</span> <span class='hs-layout'>{</span> <span class='hs-varid'>ru_name</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fsLit</span> <span class='hs-varid'>str</span><span class='hs-layout'>,</span> <span class='hs-varid'>ru_fn</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>name</span><span class='hs-layout'>,</span> <span class='hs-varid'>ru_nargs</span> <span class='hs-keyglyph'>=</span> <span class='hs-num'>2</span><span class='hs-layout'>,</span>
<a name="line-92"></a>                           <span class='hs-varid'>ru_try</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>match_Integer_binop</span> <span class='hs-varid'>op</span> <span class='hs-layout'>}</span>
<a name="line-93"></a>          <span class='hs-varid'>rule_divop_both</span> <span class='hs-varid'>str</span> <span class='hs-varid'>name</span> <span class='hs-varid'>op</span>
<a name="line-94"></a>           <span class='hs-keyglyph'>=</span> <span class='hs-conid'>BuiltinRule</span> <span class='hs-layout'>{</span> <span class='hs-varid'>ru_name</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fsLit</span> <span class='hs-varid'>str</span><span class='hs-layout'>,</span> <span class='hs-varid'>ru_fn</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>name</span><span class='hs-layout'>,</span> <span class='hs-varid'>ru_nargs</span> <span class='hs-keyglyph'>=</span> <span class='hs-num'>2</span><span class='hs-layout'>,</span>
<a name="line-95"></a>                           <span class='hs-varid'>ru_try</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>match_Integer_divop_both</span> <span class='hs-varid'>op</span> <span class='hs-layout'>}</span>
<a name="line-96"></a>          <span class='hs-varid'>rule_divop_one</span> <span class='hs-varid'>str</span> <span class='hs-varid'>name</span> <span class='hs-varid'>op</span>
<a name="line-97"></a>           <span class='hs-keyglyph'>=</span> <span class='hs-conid'>BuiltinRule</span> <span class='hs-layout'>{</span> <span class='hs-varid'>ru_name</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fsLit</span> <span class='hs-varid'>str</span><span class='hs-layout'>,</span> <span class='hs-varid'>ru_fn</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>name</span><span class='hs-layout'>,</span> <span class='hs-varid'>ru_nargs</span> <span class='hs-keyglyph'>=</span> <span class='hs-num'>2</span><span class='hs-layout'>,</span>
<a name="line-98"></a>                           <span class='hs-varid'>ru_try</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>match_Integer_divop_one</span> <span class='hs-varid'>op</span> <span class='hs-layout'>}</span>
<a name="line-99"></a>          <span class='hs-varid'>rule_Int_binop</span> <span class='hs-varid'>str</span> <span class='hs-varid'>name</span> <span class='hs-varid'>op</span>
<a name="line-100"></a>           <span class='hs-keyglyph'>=</span> <span class='hs-conid'>BuiltinRule</span> <span class='hs-layout'>{</span> <span class='hs-varid'>ru_name</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fsLit</span> <span class='hs-varid'>str</span><span class='hs-layout'>,</span> <span class='hs-varid'>ru_fn</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>name</span><span class='hs-layout'>,</span> <span class='hs-varid'>ru_nargs</span> <span class='hs-keyglyph'>=</span> <span class='hs-num'>2</span><span class='hs-layout'>,</span>
<a name="line-101"></a>                           <span class='hs-varid'>ru_try</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>match_Integer_Int_binop</span> <span class='hs-varid'>op</span> <span class='hs-layout'>}</span>
<a name="line-102"></a>          <span class='hs-varid'>rule_binop_Prim</span> <span class='hs-varid'>str</span> <span class='hs-varid'>name</span> <span class='hs-varid'>op</span>
<a name="line-103"></a>           <span class='hs-keyglyph'>=</span> <span class='hs-conid'>BuiltinRule</span> <span class='hs-layout'>{</span> <span class='hs-varid'>ru_name</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fsLit</span> <span class='hs-varid'>str</span><span class='hs-layout'>,</span> <span class='hs-varid'>ru_fn</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>name</span><span class='hs-layout'>,</span> <span class='hs-varid'>ru_nargs</span> <span class='hs-keyglyph'>=</span> <span class='hs-num'>2</span><span class='hs-layout'>,</span>
<a name="line-104"></a>                           <span class='hs-varid'>ru_try</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>match_Integer_binop_Prim</span> <span class='hs-varid'>op</span> <span class='hs-layout'>}</span>
<a name="line-105"></a>          <span class='hs-varid'>rule_binop_Ordering</span> <span class='hs-varid'>str</span> <span class='hs-varid'>name</span> <span class='hs-varid'>op</span>
<a name="line-106"></a>           <span class='hs-keyglyph'>=</span> <span class='hs-conid'>BuiltinRule</span> <span class='hs-layout'>{</span> <span class='hs-varid'>ru_name</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fsLit</span> <span class='hs-varid'>str</span><span class='hs-layout'>,</span> <span class='hs-varid'>ru_fn</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>name</span><span class='hs-layout'>,</span> <span class='hs-varid'>ru_nargs</span> <span class='hs-keyglyph'>=</span> <span class='hs-num'>2</span><span class='hs-layout'>,</span>
<a name="line-107"></a>                           <span class='hs-varid'>ru_try</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>match_Integer_binop_Ordering</span> <span class='hs-varid'>op</span> <span class='hs-layout'>}</span>
<a name="line-108"></a>          <span class='hs-varid'>rule_encodeFloat</span> <span class='hs-varid'>str</span> <span class='hs-varid'>name</span> <span class='hs-varid'>op</span>
<a name="line-109"></a>           <span class='hs-keyglyph'>=</span> <span class='hs-conid'>BuiltinRule</span> <span class='hs-layout'>{</span> <span class='hs-varid'>ru_name</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fsLit</span> <span class='hs-varid'>str</span><span class='hs-layout'>,</span> <span class='hs-varid'>ru_fn</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>name</span><span class='hs-layout'>,</span> <span class='hs-varid'>ru_nargs</span> <span class='hs-keyglyph'>=</span> <span class='hs-num'>2</span><span class='hs-layout'>,</span>
<a name="line-110"></a>                           <span class='hs-varid'>ru_try</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>match_Integer_Int_encodeFloat</span> <span class='hs-varid'>op</span> <span class='hs-layout'>}</span>
<a name="line-111"></a>          <span class='hs-varid'>rule_decodeDouble</span> <span class='hs-varid'>str</span> <span class='hs-varid'>name</span>
<a name="line-112"></a>           <span class='hs-keyglyph'>=</span> <span class='hs-conid'>BuiltinRule</span> <span class='hs-layout'>{</span> <span class='hs-varid'>ru_name</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fsLit</span> <span class='hs-varid'>str</span><span class='hs-layout'>,</span> <span class='hs-varid'>ru_fn</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>name</span><span class='hs-layout'>,</span> <span class='hs-varid'>ru_nargs</span> <span class='hs-keyglyph'>=</span> <span class='hs-num'>1</span><span class='hs-layout'>,</span>
<a name="line-113"></a>                           <span class='hs-varid'>ru_try</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>match_decodeDouble</span> <span class='hs-layout'>}</span>
<a name="line-114"></a>          <span class='hs-varid'>rule_XToIntegerToX</span> <span class='hs-varid'>str</span> <span class='hs-varid'>name</span> <span class='hs-varid'>toIntegerName</span>
<a name="line-115"></a>           <span class='hs-keyglyph'>=</span> <span class='hs-conid'>BuiltinRule</span> <span class='hs-layout'>{</span> <span class='hs-varid'>ru_name</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fsLit</span> <span class='hs-varid'>str</span><span class='hs-layout'>,</span> <span class='hs-varid'>ru_fn</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>name</span><span class='hs-layout'>,</span> <span class='hs-varid'>ru_nargs</span> <span class='hs-keyglyph'>=</span> <span class='hs-num'>1</span><span class='hs-layout'>,</span>
<a name="line-116"></a>                           <span class='hs-varid'>ru_try</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>match_XToIntegerToX</span> <span class='hs-varid'>toIntegerName</span> <span class='hs-layout'>}</span>
<a name="line-117"></a>          <span class='hs-varid'>rule_smallIntegerTo</span> <span class='hs-varid'>str</span> <span class='hs-varid'>name</span> <span class='hs-varid'>primOp</span>
<a name="line-118"></a>           <span class='hs-keyglyph'>=</span> <span class='hs-conid'>BuiltinRule</span> <span class='hs-layout'>{</span> <span class='hs-varid'>ru_name</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fsLit</span> <span class='hs-varid'>str</span><span class='hs-layout'>,</span> <span class='hs-varid'>ru_fn</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>name</span><span class='hs-layout'>,</span> <span class='hs-varid'>ru_nargs</span> <span class='hs-keyglyph'>=</span> <span class='hs-num'>1</span><span class='hs-layout'>,</span>
<a name="line-119"></a>                           <span class='hs-varid'>ru_try</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>match_smallIntegerTo</span> <span class='hs-varid'>primOp</span> <span class='hs-layout'>}</span>
<a name="line-120"></a>          <span class='hs-varid'>rule_rationalTo</span> <span class='hs-varid'>str</span> <span class='hs-varid'>name</span> <span class='hs-varid'>mkLit</span>
<a name="line-121"></a>           <span class='hs-keyglyph'>=</span> <span class='hs-conid'>BuiltinRule</span> <span class='hs-layout'>{</span> <span class='hs-varid'>ru_name</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fsLit</span> <span class='hs-varid'>str</span><span class='hs-layout'>,</span> <span class='hs-varid'>ru_fn</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>name</span><span class='hs-layout'>,</span> <span class='hs-varid'>ru_nargs</span> <span class='hs-keyglyph'>=</span> <span class='hs-num'>2</span><span class='hs-layout'>,</span>
<a name="line-122"></a>                           <span class='hs-varid'>ru_try</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>match_rationalTo</span> <span class='hs-varid'>mkLit</span> <span class='hs-layout'>}</span>
<a name="line-123"></a>
<a name="line-124"></a><span class='hs-comment'>---------------------------------------------------</span>
<a name="line-125"></a><span class='hs-comment'>-- The rule is this:</span>
<a name="line-126"></a><span class='hs-comment'>--      unpackFoldrCString# "foo" c (unpackFoldrCString# "baz" c n)</span>
<a name="line-127"></a><span class='hs-comment'>--      =  unpackFoldrCString# "foobaz" c n</span>
<a name="line-128"></a>
<a name="line-129"></a><a name="match_append_lit"></a><span class='hs-definition'>match_append_lit</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Expr</span> <span class='hs-conid'>CoreBndr</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>Expr</span> <span class='hs-conid'>CoreBndr</span><span class='hs-layout'>)</span>
<a name="line-130"></a><span class='hs-definition'>match_append_lit</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Type</span> <span class='hs-varid'>ty1</span><span class='hs-layout'>,</span>
<a name="line-131"></a>                    <span class='hs-conid'>Lit</span> <span class='hs-layout'>(</span><span class='hs-conid'>MachStr</span> <span class='hs-varid'>s1</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-132"></a>                    <span class='hs-varid'>c1</span><span class='hs-layout'>,</span>
<a name="line-133"></a>                    <span class='hs-conid'>Var</span> <span class='hs-varid'>unpk</span> <span class='hs-varop'>`App`</span> <span class='hs-conid'>Type</span> <span class='hs-varid'>ty2</span>
<a name="line-134"></a>                             <span class='hs-varop'>`App`</span> <span class='hs-conid'>Lit</span> <span class='hs-layout'>(</span><span class='hs-conid'>MachStr</span> <span class='hs-varid'>s2</span><span class='hs-layout'>)</span>
<a name="line-135"></a>                             <span class='hs-varop'>`App`</span> <span class='hs-varid'>c2</span>
<a name="line-136"></a>                             <span class='hs-varop'>`App`</span> <span class='hs-varid'>n</span>
<a name="line-137"></a>                   <span class='hs-keyglyph'>]</span>
<a name="line-138"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>unpk</span> <span class='hs-varop'>`hasKey`</span> <span class='hs-varid'>unpackCStringFoldrIdKey</span> <span class='hs-varop'>&amp;&amp;</span>
<a name="line-139"></a>    <span class='hs-varid'>c1</span> <span class='hs-varop'>`cheapEqExpr`</span> <span class='hs-varid'>c2</span>
<a name="line-140"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ASSERT</span><span class='hs-layout'>(</span> <span class='hs-varid'>ty1</span> <span class='hs-varop'>`eqType`</span> <span class='hs-varid'>ty2</span> <span class='hs-layout'>)</span>
<a name="line-141"></a>    <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-conid'>Var</span> <span class='hs-varid'>unpk</span> <span class='hs-varop'>`App`</span> <span class='hs-conid'>Type</span> <span class='hs-varid'>ty1</span>
<a name="line-142"></a>                   <span class='hs-varop'>`App`</span> <span class='hs-conid'>Lit</span> <span class='hs-layout'>(</span><span class='hs-conid'>MachStr</span> <span class='hs-layout'>(</span><span class='hs-varid'>s1</span> <span class='hs-varop'>`</span><span class='hs-conid'>BS</span><span class='hs-varop'>.</span><span class='hs-varid'>append</span><span class='hs-varop'>`</span> <span class='hs-varid'>s2</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-143"></a>                   <span class='hs-varop'>`App`</span> <span class='hs-varid'>c1</span>
<a name="line-144"></a>                   <span class='hs-varop'>`App`</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span>
<a name="line-145"></a>
<a name="line-146"></a><span class='hs-definition'>match_append_lit</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-147"></a>
<a name="line-148"></a><span class='hs-comment'>---------------------------------------------------</span>
<a name="line-149"></a><span class='hs-comment'>-- The rule is this:</span>
<a name="line-150"></a><span class='hs-comment'>--      eqString (unpackCString# (Lit s1)) (unpackCString# (Lit s2) = s1==s2</span>
<a name="line-151"></a>
<a name="line-152"></a><a name="match_eq_string"></a><span class='hs-definition'>match_eq_string</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>DynFlags</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Expr</span> <span class='hs-conid'>CoreBndr</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>Expr</span> <span class='hs-conid'>CoreBndr</span><span class='hs-layout'>)</span>
<a name="line-153"></a><span class='hs-definition'>match_eq_string</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Var</span> <span class='hs-varid'>unpk1</span> <span class='hs-varop'>`App`</span> <span class='hs-conid'>Lit</span> <span class='hs-layout'>(</span><span class='hs-conid'>MachStr</span> <span class='hs-varid'>s1</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-154"></a>                        <span class='hs-conid'>Var</span> <span class='hs-varid'>unpk2</span> <span class='hs-varop'>`App`</span> <span class='hs-conid'>Lit</span> <span class='hs-layout'>(</span><span class='hs-conid'>MachStr</span> <span class='hs-varid'>s2</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-155"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>unpk1</span> <span class='hs-varop'>`hasKey`</span> <span class='hs-varid'>unpackCStringIdKey</span><span class='hs-layout'>,</span>
<a name="line-156"></a>    <span class='hs-varid'>unpk2</span> <span class='hs-varop'>`hasKey`</span> <span class='hs-varid'>unpackCStringIdKey</span>
<a name="line-157"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-keyword'>if</span> <span class='hs-varid'>s1</span> <span class='hs-varop'>==</span> <span class='hs-varid'>s2</span> <span class='hs-keyword'>then</span> <span class='hs-varid'>trueValBool</span> <span class='hs-keyword'>else</span> <span class='hs-varid'>falseValBool</span><span class='hs-layout'>)</span>
<a name="line-158"></a>
<a name="line-159"></a><span class='hs-definition'>match_eq_string</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-160"></a>
<a name="line-161"></a>
<a name="line-162"></a><a name="match_inline"></a><span class='hs-comment'>---------------------------------------------------</span>
<a name="line-163"></a><span class='hs-comment'>-- The rule is this:</span>
<a name="line-164"></a><span class='hs-comment'>--      inline f_ty (f a b c) = &lt;f's unfolding&gt; a b c</span>
<a name="line-165"></a><span class='hs-comment'>-- (if f has an unfolding, EVEN if it's a loop breaker)</span>
<a name="line-166"></a><span class='hs-comment'>--</span>
<a name="line-167"></a><span class='hs-comment'>-- It's important to allow the argument to 'inline' to have args itself</span>
<a name="line-168"></a><span class='hs-comment'>-- (a) because its more forgiving to allow the programmer to write</span>
<a name="line-169"></a><span class='hs-comment'>--       inline f a b c</span>
<a name="line-170"></a><span class='hs-comment'>--   or  inline (f a b c)</span>
<a name="line-171"></a><span class='hs-comment'>-- (b) because a polymorphic f wll get a type argument that the</span>
<a name="line-172"></a><span class='hs-comment'>--     programmer can't avoid</span>
<a name="line-173"></a><span class='hs-comment'>--</span>
<a name="line-174"></a><span class='hs-comment'>-- Also, don't forget about 'inline's type argument!</span>
<a name="line-175"></a><span class='hs-definition'>match_inline</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Expr</span> <span class='hs-conid'>CoreBndr</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>Expr</span> <span class='hs-conid'>CoreBndr</span><span class='hs-layout'>)</span>
<a name="line-176"></a><span class='hs-definition'>match_inline</span> <span class='hs-layout'>(</span><span class='hs-conid'>Type</span> <span class='hs-keyword'>_</span> <span class='hs-conop'>:</span> <span class='hs-varid'>e</span> <span class='hs-conop'>:</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>
<a name="line-177"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-layout'>(</span><span class='hs-conid'>Var</span> <span class='hs-varid'>f</span><span class='hs-layout'>,</span> <span class='hs-varid'>args1</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>collectArgs</span> <span class='hs-varid'>e</span><span class='hs-layout'>,</span>
<a name="line-178"></a>    <span class='hs-conid'>Just</span> <span class='hs-varid'>unf</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>maybeUnfoldingTemplate</span> <span class='hs-layout'>(</span><span class='hs-varid'>realIdUnfolding</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span>
<a name="line-179"></a>             <span class='hs-comment'>-- Ignore the IdUnfoldingFun here!</span>
<a name="line-180"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkApps</span> <span class='hs-varid'>unf</span> <span class='hs-varid'>args1</span><span class='hs-layout'>)</span>
<a name="line-181"></a>
<a name="line-182"></a><span class='hs-definition'>match_inline</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-183"></a>
<a name="line-184"></a>
<a name="line-185"></a><a name="match_magicDict"></a><span class='hs-comment'>-- See Note [magicDictId magic] in `basicTypes/MkId.lhs`</span>
<a name="line-186"></a><span class='hs-comment'>-- for a description of what is going on here.</span>
<a name="line-187"></a><span class='hs-definition'>match_magicDict</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Expr</span> <span class='hs-conid'>CoreBndr</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>Expr</span> <span class='hs-conid'>CoreBndr</span><span class='hs-layout'>)</span>
<a name="line-188"></a><span class='hs-definition'>match_magicDict</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Type</span> <span class='hs-keyword'>_</span><span class='hs-layout'>,</span> <span class='hs-conid'>Var</span> <span class='hs-varid'>wrap</span> <span class='hs-varop'>`App`</span> <span class='hs-conid'>Type</span> <span class='hs-varid'>a</span> <span class='hs-varop'>`App`</span> <span class='hs-conid'>Type</span> <span class='hs-keyword'>_</span> <span class='hs-varop'>`App`</span> <span class='hs-varid'>f</span><span class='hs-layout'>,</span> <span class='hs-varid'>x</span><span class='hs-layout'>,</span> <span class='hs-varid'>y</span> <span class='hs-keyglyph'>]</span>
<a name="line-189"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-varid'>fieldTy</span><span class='hs-layout'>,</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>splitFunTy_maybe</span> <span class='hs-varop'>$</span> <span class='hs-varid'>dropForAlls</span> <span class='hs-varop'>$</span> <span class='hs-varid'>idType</span> <span class='hs-varid'>wrap</span>
<a name="line-190"></a>  <span class='hs-layout'>,</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-varid'>dictTy</span><span class='hs-layout'>,</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>    <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>splitFunTy_maybe</span> <span class='hs-varid'>fieldTy</span>
<a name="line-191"></a>  <span class='hs-layout'>,</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>dictTc</span>         <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>tyConAppTyCon_maybe</span> <span class='hs-varid'>dictTy</span>
<a name="line-192"></a>  <span class='hs-layout'>,</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-keyword'>_</span><span class='hs-layout'>,</span><span class='hs-keyword'>_</span><span class='hs-layout'>,</span><span class='hs-varid'>co</span><span class='hs-layout'>)</span>       <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>unwrapNewTyCon_maybe</span> <span class='hs-varid'>dictTc</span>
<a name="line-193"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span>
<a name="line-194"></a>  <span class='hs-varop'>$</span> <span class='hs-varid'>f</span> <span class='hs-varop'>`App`</span> <span class='hs-conid'>Cast</span> <span class='hs-varid'>x</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkSymCo</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkUnbranchedAxInstCo</span> <span class='hs-conid'>Representational</span> <span class='hs-varid'>co</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-195"></a>      <span class='hs-varop'>`App`</span> <span class='hs-varid'>y</span>
<a name="line-196"></a>
<a name="line-197"></a><span class='hs-definition'>match_magicDict</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-198"></a>
<a name="line-199"></a><span class='hs-comment'>-------------------------------------------------</span>
<a name="line-200"></a><span class='hs-comment'>-- Integer rules</span>
<a name="line-201"></a><span class='hs-comment'>--   smallInteger  (79::Int#)  = 79::Integer</span>
<a name="line-202"></a><span class='hs-comment'>--   wordToInteger (79::Word#) = 79::Integer</span>
<a name="line-203"></a><span class='hs-comment'>-- Similarly Int64, Word64</span>
<a name="line-204"></a>
<a name="line-205"></a><a name="match_IntToInteger"></a><span class='hs-definition'>match_IntToInteger</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>RuleFun</span>
<a name="line-206"></a><span class='hs-definition'>match_IntToInteger</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>id_unf</span> <span class='hs-varid'>fn</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>xl</span><span class='hs-keyglyph'>]</span>
<a name="line-207"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-conid'>MachInt</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>exprIsLiteral_maybe</span> <span class='hs-varid'>id_unf</span> <span class='hs-varid'>xl</span>
<a name="line-208"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>idType</span> <span class='hs-varid'>fn</span> <span class='hs-keyword'>of</span>
<a name="line-209"></a>    <span class='hs-conid'>FunTy</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>integerTy</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-210"></a>        <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-conid'>Lit</span> <span class='hs-layout'>(</span><span class='hs-conid'>LitInteger</span> <span class='hs-varid'>x</span> <span class='hs-varid'>integerTy</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-211"></a>    <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-212"></a>        <span class='hs-varid'>panic</span> <span class='hs-str'>"match_IntToInteger: Id has the wrong type"</span>
<a name="line-213"></a><span class='hs-definition'>match_IntToInteger</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-214"></a>
<a name="line-215"></a><a name="match_WordToInteger"></a><span class='hs-definition'>match_WordToInteger</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>RuleFun</span>
<a name="line-216"></a><span class='hs-definition'>match_WordToInteger</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>id_unf</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>xl</span><span class='hs-keyglyph'>]</span>
<a name="line-217"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-conid'>MachWord</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>exprIsLiteral_maybe</span> <span class='hs-varid'>id_unf</span> <span class='hs-varid'>xl</span>
<a name="line-218"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>idType</span> <span class='hs-varid'>id</span> <span class='hs-keyword'>of</span>
<a name="line-219"></a>    <span class='hs-conid'>FunTy</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>integerTy</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-220"></a>        <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-conid'>Lit</span> <span class='hs-layout'>(</span><span class='hs-conid'>LitInteger</span> <span class='hs-varid'>x</span> <span class='hs-varid'>integerTy</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-221"></a>    <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-222"></a>        <span class='hs-varid'>panic</span> <span class='hs-str'>"match_WordToInteger: Id has the wrong type"</span>
<a name="line-223"></a><span class='hs-definition'>match_WordToInteger</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-224"></a>
<a name="line-225"></a><a name="match_Int64ToInteger"></a><span class='hs-definition'>match_Int64ToInteger</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>RuleFun</span>
<a name="line-226"></a><span class='hs-definition'>match_Int64ToInteger</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>id_unf</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>xl</span><span class='hs-keyglyph'>]</span>
<a name="line-227"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-conid'>MachInt64</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>exprIsLiteral_maybe</span> <span class='hs-varid'>id_unf</span> <span class='hs-varid'>xl</span>
<a name="line-228"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>idType</span> <span class='hs-varid'>id</span> <span class='hs-keyword'>of</span>
<a name="line-229"></a>    <span class='hs-conid'>FunTy</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>integerTy</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-230"></a>        <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-conid'>Lit</span> <span class='hs-layout'>(</span><span class='hs-conid'>LitInteger</span> <span class='hs-varid'>x</span> <span class='hs-varid'>integerTy</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-231"></a>    <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-232"></a>        <span class='hs-varid'>panic</span> <span class='hs-str'>"match_Int64ToInteger: Id has the wrong type"</span>
<a name="line-233"></a><span class='hs-definition'>match_Int64ToInteger</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-234"></a>
<a name="line-235"></a><a name="match_Word64ToInteger"></a><span class='hs-definition'>match_Word64ToInteger</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>RuleFun</span>
<a name="line-236"></a><span class='hs-definition'>match_Word64ToInteger</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>id_unf</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>xl</span><span class='hs-keyglyph'>]</span>
<a name="line-237"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-conid'>MachWord64</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>exprIsLiteral_maybe</span> <span class='hs-varid'>id_unf</span> <span class='hs-varid'>xl</span>
<a name="line-238"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>idType</span> <span class='hs-varid'>id</span> <span class='hs-keyword'>of</span>
<a name="line-239"></a>    <span class='hs-conid'>FunTy</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>integerTy</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-240"></a>        <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-conid'>Lit</span> <span class='hs-layout'>(</span><span class='hs-conid'>LitInteger</span> <span class='hs-varid'>x</span> <span class='hs-varid'>integerTy</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-241"></a>    <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-242"></a>        <span class='hs-varid'>panic</span> <span class='hs-str'>"match_Word64ToInteger: Id has the wrong type"</span>
<a name="line-243"></a><span class='hs-definition'>match_Word64ToInteger</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-244"></a>
<a name="line-245"></a><a name="match_Integer_convert"></a><span class='hs-comment'>-------------------------------------------------</span>
<a name="line-246"></a><span class='hs-definition'>match_Integer_convert</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Num</span> <span class='hs-varid'>a</span>
<a name="line-247"></a>                      <span class='hs-keyglyph'>=&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>DynFlags</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Expr</span> <span class='hs-conid'>CoreBndr</span><span class='hs-layout'>)</span>
<a name="line-248"></a>                      <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>RuleFun</span>
<a name="line-249"></a><span class='hs-definition'>match_Integer_convert</span> <span class='hs-varid'>convert</span> <span class='hs-varid'>dflags</span> <span class='hs-varid'>id_unf</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>xl</span><span class='hs-keyglyph'>]</span>
<a name="line-250"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-conid'>LitInteger</span> <span class='hs-varid'>x</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>exprIsLiteral_maybe</span> <span class='hs-varid'>id_unf</span> <span class='hs-varid'>xl</span>
<a name="line-251"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-varid'>convert</span> <span class='hs-varid'>dflags</span> <span class='hs-layout'>(</span><span class='hs-varid'>fromInteger</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-252"></a><span class='hs-definition'>match_Integer_convert</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-253"></a>
<a name="line-254"></a><a name="match_Integer_unop"></a><span class='hs-definition'>match_Integer_unop</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Integer</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Integer</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>RuleFun</span>
<a name="line-255"></a><span class='hs-definition'>match_Integer_unop</span> <span class='hs-varid'>unop</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>id_unf</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>xl</span><span class='hs-keyglyph'>]</span>
<a name="line-256"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-conid'>LitInteger</span> <span class='hs-varid'>x</span> <span class='hs-varid'>i</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>exprIsLiteral_maybe</span> <span class='hs-varid'>id_unf</span> <span class='hs-varid'>xl</span>
<a name="line-257"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-conid'>Lit</span> <span class='hs-layout'>(</span><span class='hs-conid'>LitInteger</span> <span class='hs-layout'>(</span><span class='hs-varid'>unop</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-varid'>i</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-258"></a><span class='hs-definition'>match_Integer_unop</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-259"></a>
<a name="line-260"></a><a name="match_Integer_binop"></a><span class='hs-definition'>match_Integer_binop</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Integer</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Integer</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Integer</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>RuleFun</span>
<a name="line-261"></a><span class='hs-definition'>match_Integer_binop</span> <span class='hs-varid'>binop</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>id_unf</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>xl</span><span class='hs-layout'>,</span><span class='hs-varid'>yl</span><span class='hs-keyglyph'>]</span>
<a name="line-262"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-conid'>LitInteger</span> <span class='hs-varid'>x</span> <span class='hs-varid'>i</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>exprIsLiteral_maybe</span> <span class='hs-varid'>id_unf</span> <span class='hs-varid'>xl</span>
<a name="line-263"></a>  <span class='hs-layout'>,</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-conid'>LitInteger</span> <span class='hs-varid'>y</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>exprIsLiteral_maybe</span> <span class='hs-varid'>id_unf</span> <span class='hs-varid'>yl</span>
<a name="line-264"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-conid'>Lit</span> <span class='hs-layout'>(</span><span class='hs-conid'>LitInteger</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span> <span class='hs-varop'>`binop`</span> <span class='hs-varid'>y</span><span class='hs-layout'>)</span> <span class='hs-varid'>i</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-265"></a><span class='hs-definition'>match_Integer_binop</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-266"></a>
<a name="line-267"></a><a name="match_Integer_divop_both"></a><span class='hs-comment'>-- This helper is used for the quotRem and divMod functions</span>
<a name="line-268"></a><span class='hs-definition'>match_Integer_divop_both</span>
<a name="line-269"></a>   <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Integer</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Integer</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Integer</span><span class='hs-layout'>,</span> <span class='hs-conid'>Integer</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>RuleFun</span>
<a name="line-270"></a><span class='hs-definition'>match_Integer_divop_both</span> <span class='hs-varid'>divop</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>id_unf</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>xl</span><span class='hs-layout'>,</span><span class='hs-varid'>yl</span><span class='hs-keyglyph'>]</span>
<a name="line-271"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-conid'>LitInteger</span> <span class='hs-varid'>x</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>exprIsLiteral_maybe</span> <span class='hs-varid'>id_unf</span> <span class='hs-varid'>xl</span>
<a name="line-272"></a>  <span class='hs-layout'>,</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-conid'>LitInteger</span> <span class='hs-varid'>y</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>exprIsLiteral_maybe</span> <span class='hs-varid'>id_unf</span> <span class='hs-varid'>yl</span>
<a name="line-273"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>y</span> <span class='hs-varop'>/=</span> <span class='hs-num'>0</span>
<a name="line-274"></a>  <span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-varid'>r</span><span class='hs-layout'>,</span><span class='hs-varid'>s</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>x</span> <span class='hs-varop'>`divop`</span> <span class='hs-varid'>y</span>
<a name="line-275"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-varid'>mkConApp</span> <span class='hs-layout'>(</span><span class='hs-varid'>tupleCon</span> <span class='hs-conid'>UnboxedTuple</span> <span class='hs-num'>2</span><span class='hs-layout'>)</span>
<a name="line-276"></a>                    <span class='hs-keyglyph'>[</span><span class='hs-conid'>Type</span> <span class='hs-varid'>t</span><span class='hs-layout'>,</span>
<a name="line-277"></a>                     <span class='hs-conid'>Type</span> <span class='hs-varid'>t</span><span class='hs-layout'>,</span>
<a name="line-278"></a>                     <span class='hs-conid'>Lit</span> <span class='hs-layout'>(</span><span class='hs-conid'>LitInteger</span> <span class='hs-varid'>r</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-279"></a>                     <span class='hs-conid'>Lit</span> <span class='hs-layout'>(</span><span class='hs-conid'>LitInteger</span> <span class='hs-varid'>s</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-280"></a><span class='hs-definition'>match_Integer_divop_both</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-281"></a>
<a name="line-282"></a><a name="match_Integer_divop_one"></a><span class='hs-comment'>-- This helper is used for the quot and rem functions</span>
<a name="line-283"></a><span class='hs-definition'>match_Integer_divop_one</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Integer</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Integer</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Integer</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>RuleFun</span>
<a name="line-284"></a><span class='hs-definition'>match_Integer_divop_one</span> <span class='hs-varid'>divop</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>id_unf</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>xl</span><span class='hs-layout'>,</span><span class='hs-varid'>yl</span><span class='hs-keyglyph'>]</span>
<a name="line-285"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-conid'>LitInteger</span> <span class='hs-varid'>x</span> <span class='hs-varid'>i</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>exprIsLiteral_maybe</span> <span class='hs-varid'>id_unf</span> <span class='hs-varid'>xl</span>
<a name="line-286"></a>  <span class='hs-layout'>,</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-conid'>LitInteger</span> <span class='hs-varid'>y</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>exprIsLiteral_maybe</span> <span class='hs-varid'>id_unf</span> <span class='hs-varid'>yl</span>
<a name="line-287"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>y</span> <span class='hs-varop'>/=</span> <span class='hs-num'>0</span>
<a name="line-288"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-conid'>Lit</span> <span class='hs-layout'>(</span><span class='hs-conid'>LitInteger</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span> <span class='hs-varop'>`divop`</span> <span class='hs-varid'>y</span><span class='hs-layout'>)</span> <span class='hs-varid'>i</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-289"></a><span class='hs-definition'>match_Integer_divop_one</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-290"></a>
<a name="line-291"></a><a name="match_Integer_Int_binop"></a><span class='hs-definition'>match_Integer_Int_binop</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Integer</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Integer</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>RuleFun</span>
<a name="line-292"></a><span class='hs-definition'>match_Integer_Int_binop</span> <span class='hs-varid'>binop</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>id_unf</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>xl</span><span class='hs-layout'>,</span><span class='hs-varid'>yl</span><span class='hs-keyglyph'>]</span>
<a name="line-293"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-conid'>LitInteger</span> <span class='hs-varid'>x</span> <span class='hs-varid'>i</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>exprIsLiteral_maybe</span> <span class='hs-varid'>id_unf</span> <span class='hs-varid'>xl</span>
<a name="line-294"></a>  <span class='hs-layout'>,</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-conid'>MachInt</span> <span class='hs-varid'>y</span><span class='hs-layout'>)</span>      <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>exprIsLiteral_maybe</span> <span class='hs-varid'>id_unf</span> <span class='hs-varid'>yl</span>
<a name="line-295"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-conid'>Lit</span> <span class='hs-layout'>(</span><span class='hs-conid'>LitInteger</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span> <span class='hs-varop'>`binop`</span> <span class='hs-varid'>fromIntegral</span> <span class='hs-varid'>y</span><span class='hs-layout'>)</span> <span class='hs-varid'>i</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-296"></a><span class='hs-definition'>match_Integer_Int_binop</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-297"></a>
<a name="line-298"></a><a name="match_Integer_binop_Prim"></a><span class='hs-definition'>match_Integer_binop_Prim</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Integer</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Integer</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>RuleFun</span>
<a name="line-299"></a><span class='hs-definition'>match_Integer_binop_Prim</span> <span class='hs-varid'>binop</span> <span class='hs-varid'>dflags</span> <span class='hs-varid'>id_unf</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>xl</span><span class='hs-layout'>,</span> <span class='hs-varid'>yl</span><span class='hs-keyglyph'>]</span>
<a name="line-300"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-conid'>LitInteger</span> <span class='hs-varid'>x</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>exprIsLiteral_maybe</span> <span class='hs-varid'>id_unf</span> <span class='hs-varid'>xl</span>
<a name="line-301"></a>  <span class='hs-layout'>,</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-conid'>LitInteger</span> <span class='hs-varid'>y</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>exprIsLiteral_maybe</span> <span class='hs-varid'>id_unf</span> <span class='hs-varid'>yl</span>
<a name="line-302"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-keyword'>if</span> <span class='hs-varid'>x</span> <span class='hs-varop'>`binop`</span> <span class='hs-varid'>y</span> <span class='hs-keyword'>then</span> <span class='hs-varid'>trueValInt</span> <span class='hs-varid'>dflags</span> <span class='hs-keyword'>else</span> <span class='hs-varid'>falseValInt</span> <span class='hs-varid'>dflags</span><span class='hs-layout'>)</span>
<a name="line-303"></a><span class='hs-definition'>match_Integer_binop_Prim</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-304"></a>
<a name="line-305"></a><a name="match_Integer_binop_Ordering"></a><span class='hs-definition'>match_Integer_binop_Ordering</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Integer</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Integer</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Ordering</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>RuleFun</span>
<a name="line-306"></a><span class='hs-definition'>match_Integer_binop_Ordering</span> <span class='hs-varid'>binop</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>id_unf</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>xl</span><span class='hs-layout'>,</span> <span class='hs-varid'>yl</span><span class='hs-keyglyph'>]</span>
<a name="line-307"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-conid'>LitInteger</span> <span class='hs-varid'>x</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>exprIsLiteral_maybe</span> <span class='hs-varid'>id_unf</span> <span class='hs-varid'>xl</span>
<a name="line-308"></a>  <span class='hs-layout'>,</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-conid'>LitInteger</span> <span class='hs-varid'>y</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>exprIsLiteral_maybe</span> <span class='hs-varid'>id_unf</span> <span class='hs-varid'>yl</span>
<a name="line-309"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>x</span> <span class='hs-varop'>`binop`</span> <span class='hs-varid'>y</span> <span class='hs-keyword'>of</span>
<a name="line-310"></a>             <span class='hs-conid'>LT</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>ltVal</span>
<a name="line-311"></a>             <span class='hs-conid'>EQ</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>eqVal</span>
<a name="line-312"></a>             <span class='hs-conid'>GT</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>gtVal</span>
<a name="line-313"></a><span class='hs-definition'>match_Integer_binop_Ordering</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-314"></a>
<a name="line-315"></a><a name="match_Integer_Int_encodeFloat"></a><span class='hs-definition'>match_Integer_Int_encodeFloat</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>RealFloat</span> <span class='hs-varid'>a</span>
<a name="line-316"></a>                              <span class='hs-keyglyph'>=&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Expr</span> <span class='hs-conid'>CoreBndr</span><span class='hs-layout'>)</span>
<a name="line-317"></a>                              <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>RuleFun</span>
<a name="line-318"></a><span class='hs-definition'>match_Integer_Int_encodeFloat</span> <span class='hs-varid'>mkLit</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>id_unf</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>xl</span><span class='hs-layout'>,</span><span class='hs-varid'>yl</span><span class='hs-keyglyph'>]</span>
<a name="line-319"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-conid'>LitInteger</span> <span class='hs-varid'>x</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>exprIsLiteral_maybe</span> <span class='hs-varid'>id_unf</span> <span class='hs-varid'>xl</span>
<a name="line-320"></a>  <span class='hs-layout'>,</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-conid'>MachInt</span> <span class='hs-varid'>y</span><span class='hs-layout'>)</span>      <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>exprIsLiteral_maybe</span> <span class='hs-varid'>id_unf</span> <span class='hs-varid'>yl</span>
<a name="line-321"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkLit</span> <span class='hs-varop'>$</span> <span class='hs-varid'>encodeFloat</span> <span class='hs-varid'>x</span> <span class='hs-layout'>(</span><span class='hs-varid'>fromInteger</span> <span class='hs-varid'>y</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-322"></a><span class='hs-definition'>match_Integer_Int_encodeFloat</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-323"></a>
<a name="line-324"></a><a name="match_rationalTo"></a><span class='hs-comment'>---------------------------------------------------</span>
<a name="line-325"></a><span class='hs-comment'>-- constant folding for Float/Double</span>
<a name="line-326"></a><span class='hs-comment'>--</span>
<a name="line-327"></a><span class='hs-comment'>-- This turns</span>
<a name="line-328"></a><span class='hs-comment'>--      rationalToFloat n d</span>
<a name="line-329"></a><span class='hs-comment'>-- into a literal Float, and similarly for Doubles.</span>
<a name="line-330"></a><span class='hs-comment'>--</span>
<a name="line-331"></a><span class='hs-comment'>-- it's important to not match d == 0, because that may represent a</span>
<a name="line-332"></a><span class='hs-comment'>-- literal "0/0" or similar, and we can't produce a literal value for</span>
<a name="line-333"></a><span class='hs-comment'>-- NaN or +-Inf</span>
<a name="line-334"></a><span class='hs-definition'>match_rationalTo</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>RealFloat</span> <span class='hs-varid'>a</span>
<a name="line-335"></a>                 <span class='hs-keyglyph'>=&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Expr</span> <span class='hs-conid'>CoreBndr</span><span class='hs-layout'>)</span>
<a name="line-336"></a>                 <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>RuleFun</span>
<a name="line-337"></a><span class='hs-definition'>match_rationalTo</span> <span class='hs-varid'>mkLit</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>id_unf</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>xl</span><span class='hs-layout'>,</span> <span class='hs-varid'>yl</span><span class='hs-keyglyph'>]</span>
<a name="line-338"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-conid'>LitInteger</span> <span class='hs-varid'>x</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>exprIsLiteral_maybe</span> <span class='hs-varid'>id_unf</span> <span class='hs-varid'>xl</span>
<a name="line-339"></a>  <span class='hs-layout'>,</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-conid'>LitInteger</span> <span class='hs-varid'>y</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>exprIsLiteral_maybe</span> <span class='hs-varid'>id_unf</span> <span class='hs-varid'>yl</span>
<a name="line-340"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>y</span> <span class='hs-varop'>/=</span> <span class='hs-num'>0</span>
<a name="line-341"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkLit</span> <span class='hs-layout'>(</span><span class='hs-varid'>fromRational</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span> <span class='hs-varop'>%</span> <span class='hs-varid'>y</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-342"></a><span class='hs-definition'>match_rationalTo</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-343"></a>
<a name="line-344"></a><a name="match_decodeDouble"></a><span class='hs-definition'>match_decodeDouble</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>RuleFun</span>
<a name="line-345"></a><span class='hs-definition'>match_decodeDouble</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>id_unf</span> <span class='hs-varid'>fn</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>xl</span><span class='hs-keyglyph'>]</span>
<a name="line-346"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-conid'>MachDouble</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>exprIsLiteral_maybe</span> <span class='hs-varid'>id_unf</span> <span class='hs-varid'>xl</span>
<a name="line-347"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>idType</span> <span class='hs-varid'>fn</span> <span class='hs-keyword'>of</span>
<a name="line-348"></a>    <span class='hs-conid'>FunTy</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>TyConApp</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>integerTy</span><span class='hs-layout'>,</span> <span class='hs-varid'>intHashTy</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-349"></a>        <span class='hs-keyword'>case</span> <span class='hs-varid'>decodeFloat</span> <span class='hs-layout'>(</span><span class='hs-varid'>fromRational</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Double</span><span class='hs-layout'>)</span> <span class='hs-keyword'>of</span>
<a name="line-350"></a>        <span class='hs-layout'>(</span><span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-varid'>z</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-351"></a>            <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-varid'>mkConApp</span> <span class='hs-layout'>(</span><span class='hs-varid'>tupleCon</span> <span class='hs-conid'>UnboxedTuple</span> <span class='hs-num'>2</span><span class='hs-layout'>)</span>
<a name="line-352"></a>                            <span class='hs-keyglyph'>[</span><span class='hs-conid'>Type</span> <span class='hs-varid'>integerTy</span><span class='hs-layout'>,</span>
<a name="line-353"></a>                             <span class='hs-conid'>Type</span> <span class='hs-varid'>intHashTy</span><span class='hs-layout'>,</span>
<a name="line-354"></a>                             <span class='hs-conid'>Lit</span> <span class='hs-layout'>(</span><span class='hs-conid'>LitInteger</span> <span class='hs-varid'>y</span> <span class='hs-varid'>integerTy</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-355"></a>                             <span class='hs-conid'>Lit</span> <span class='hs-layout'>(</span><span class='hs-conid'>MachInt</span> <span class='hs-layout'>(</span><span class='hs-varid'>toInteger</span> <span class='hs-varid'>z</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-356"></a>    <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-357"></a>        <span class='hs-varid'>panic</span> <span class='hs-str'>"match_decodeDouble: Id has the wrong type"</span>
<a name="line-358"></a><span class='hs-definition'>match_decodeDouble</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-359"></a>
<a name="line-360"></a><a name="match_XToIntegerToX"></a><span class='hs-definition'>match_XToIntegerToX</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>RuleFun</span>
<a name="line-361"></a><span class='hs-definition'>match_XToIntegerToX</span> <span class='hs-varid'>n</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>App</span> <span class='hs-layout'>(</span><span class='hs-conid'>Var</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-varid'>y</span><span class='hs-keyglyph'>]</span>
<a name="line-362"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>idName</span> <span class='hs-varid'>x</span> <span class='hs-varop'>==</span> <span class='hs-varid'>n</span>
<a name="line-363"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>y</span>
<a name="line-364"></a><span class='hs-definition'>match_XToIntegerToX</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-365"></a>
<a name="line-366"></a><a name="match_smallIntegerTo"></a><span class='hs-definition'>match_smallIntegerTo</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>PrimOp</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>RuleFun</span>
<a name="line-367"></a><span class='hs-definition'>match_smallIntegerTo</span> <span class='hs-varid'>primOp</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>App</span> <span class='hs-layout'>(</span><span class='hs-conid'>Var</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-varid'>y</span><span class='hs-keyglyph'>]</span>
<a name="line-368"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>idName</span> <span class='hs-varid'>x</span> <span class='hs-varop'>==</span> <span class='hs-varid'>smallIntegerName</span>
<a name="line-369"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-conid'>App</span> <span class='hs-layout'>(</span><span class='hs-conid'>Var</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkPrimOpId</span> <span class='hs-varid'>primOp</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varid'>y</span>
<a name="line-370"></a><span class='hs-definition'>match_smallIntegerTo</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
</pre>\end{code}
</body>
</html>
