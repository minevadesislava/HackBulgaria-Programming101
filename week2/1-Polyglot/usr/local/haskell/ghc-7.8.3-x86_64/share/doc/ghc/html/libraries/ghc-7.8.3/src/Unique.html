<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>basicTypes/Unique.lhs</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
%
% (c) The University of Glasgow 2006
% (c) The GRASP/AQUA Project, Glasgow University, 1992-1998
%

@Uniques@ are used to distinguish entities in the compiler (@Ids@,
@Classes@, etc.) from each other.  Thus, @Uniques@ are the basic
comparison key in the compiler.

If there is any single operation that needs to be fast, it is @Unique@
comparison.  Unsurprisingly, there is quite a bit of huff-and-puff
directed to that end.

Some of the other hair in this code is to be able to use a
``splittable @UniqueSupply@'' if requested/possible (not standard
Haskell).

\begin{code}
<pre><a name="line-1"></a><span class='hs-comment'>{-# LANGUAGE BangPatterns #-}</span>
<a name="line-2"></a>
<a name="line-3"></a><span class='hs-keyword'>module</span> <span class='hs-conid'>Unique</span> <span class='hs-layout'>(</span>
<a name="line-4"></a>        <span class='hs-comment'>-- * Main data types</span>
<a name="line-5"></a>        <span class='hs-conid'>Unique</span><span class='hs-layout'>,</span> <span class='hs-conid'>Uniquable</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-6"></a>
<a name="line-7"></a>        <span class='hs-comment'>-- ** Constructors, desctructors and operations on 'Unique's</span>
<a name="line-8"></a>        <span class='hs-varid'>hasKey</span><span class='hs-layout'>,</span>
<a name="line-9"></a>
<a name="line-10"></a>        <span class='hs-varid'>pprUnique</span><span class='hs-layout'>,</span>
<a name="line-11"></a>
<a name="line-12"></a>        <span class='hs-varid'>mkUniqueGrimily</span><span class='hs-layout'>,</span>                <span class='hs-comment'>-- Used in UniqSupply only!</span>
<a name="line-13"></a>        <span class='hs-varid'>getKey</span><span class='hs-layout'>,</span> <span class='hs-varid'>getKeyFastInt</span><span class='hs-layout'>,</span>          <span class='hs-comment'>-- Used in Var, UniqFM, Name only!</span>
<a name="line-14"></a>        <span class='hs-varid'>mkUnique</span><span class='hs-layout'>,</span> <span class='hs-varid'>unpkUnique</span><span class='hs-layout'>,</span>           <span class='hs-comment'>-- Used in BinIface only</span>
<a name="line-15"></a>
<a name="line-16"></a>        <span class='hs-varid'>incrUnique</span><span class='hs-layout'>,</span>                     <span class='hs-comment'>-- Used for renumbering</span>
<a name="line-17"></a>        <span class='hs-varid'>deriveUnique</span><span class='hs-layout'>,</span>                   <span class='hs-comment'>-- Ditto</span>
<a name="line-18"></a>        <span class='hs-varid'>newTagUnique</span><span class='hs-layout'>,</span>                   <span class='hs-comment'>-- Used in CgCase</span>
<a name="line-19"></a>        <span class='hs-varid'>initTyVarUnique</span><span class='hs-layout'>,</span>
<a name="line-20"></a>
<a name="line-21"></a>        <span class='hs-comment'>-- ** Making built-in uniques</span>
<a name="line-22"></a>
<a name="line-23"></a>        <span class='hs-comment'>-- now all the built-in Uniques (and functions to make them)</span>
<a name="line-24"></a>        <span class='hs-comment'>-- [the Oh-So-Wonderful Haskell module system wins again...]</span>
<a name="line-25"></a>        <span class='hs-varid'>mkAlphaTyVarUnique</span><span class='hs-layout'>,</span>
<a name="line-26"></a>        <span class='hs-varid'>mkPrimOpIdUnique</span><span class='hs-layout'>,</span>
<a name="line-27"></a>        <span class='hs-varid'>mkTupleTyConUnique</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkTupleDataConUnique</span><span class='hs-layout'>,</span>
<a name="line-28"></a>        <span class='hs-varid'>mkPreludeMiscIdUnique</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkPreludeDataConUnique</span><span class='hs-layout'>,</span>
<a name="line-29"></a>        <span class='hs-varid'>mkPreludeTyConUnique</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkPreludeClassUnique</span><span class='hs-layout'>,</span>
<a name="line-30"></a>        <span class='hs-varid'>mkPArrDataConUnique</span><span class='hs-layout'>,</span>
<a name="line-31"></a>
<a name="line-32"></a>    <span class='hs-varid'>mkVarOccUnique</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkDataOccUnique</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkTvOccUnique</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkTcOccUnique</span><span class='hs-layout'>,</span>
<a name="line-33"></a>        <span class='hs-varid'>mkRegSingleUnique</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkRegPairUnique</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkRegClassUnique</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkRegSubUnique</span><span class='hs-layout'>,</span>
<a name="line-34"></a>        <span class='hs-varid'>mkCostCentreUnique</span><span class='hs-layout'>,</span>
<a name="line-35"></a>
<a name="line-36"></a>        <span class='hs-varid'>mkBuiltinUnique</span><span class='hs-layout'>,</span>
<a name="line-37"></a>        <span class='hs-varid'>mkPseudoUniqueD</span><span class='hs-layout'>,</span>
<a name="line-38"></a>        <span class='hs-varid'>mkPseudoUniqueE</span><span class='hs-layout'>,</span>
<a name="line-39"></a>        <span class='hs-varid'>mkPseudoUniqueH</span>
<a name="line-40"></a>    <span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-41"></a>
<a name="line-42"></a><span class='hs-cpp'>#include "HsVersions.h"</span>
<a name="line-43"></a>
<a name="line-44"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>BasicTypes</span>
<a name="line-45"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>FastTypes</span>
<a name="line-46"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>FastString</span>
<a name="line-47"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Outputable</span>
<a name="line-48"></a><span class='hs-comment'>-- import StaticFlags</span>
<a name="line-49"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Util</span>
<a name="line-50"></a>
<a name="line-51"></a><span class='hs-cpp'>#if defined(__GLASGOW_HASKELL__)</span>
<a name="line-52"></a><span class='hs-comment'>--just for implementing a fast [0,61) -&gt; Char function</span>
<a name="line-53"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC</span><span class='hs-varop'>.</span><span class='hs-conid'>Exts</span> <span class='hs-layout'>(</span><span class='hs-varid'>indexCharOffAddr</span><span class='hs-cpp'>#</span><span class='hs-layout'>,</span> <span class='hs-conid'>Char</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-54"></a><span class='hs-cpp'>#else</span>
<a name="line-55"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Array</span>
<a name="line-56"></a><span class='hs-cpp'>#endif</span>
<a name="line-57"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Char</span>        <span class='hs-layout'>(</span> <span class='hs-varid'>chr</span><span class='hs-layout'>,</span> <span class='hs-varid'>ord</span> <span class='hs-layout'>)</span>
</pre>\end{code}

%************************************************************************
%*                                                                      *
\subsection[Unique-type]{@Unique@ type and operations}
%*                                                                      *
%************************************************************************

The @Chars@ are ``tag letters'' that identify the @UniqueSupply@.
Fast comparison is everything on @Uniques@:

\begin{code}
<pre><a name="line-1"></a><span class='hs-comment'>--why not newtype Int?</span>
<a name="line-2"></a>
<a name="line-3"></a><a name="Unique"></a><span class='hs-comment'>-- | The type of unique identifiers that are used in many places in GHC</span>
<a name="line-4"></a><a name="Unique"></a><span class='hs-comment'>-- for fast ordering and equality tests. You should generate these with</span>
<a name="line-5"></a><a name="Unique"></a><span class='hs-comment'>-- the functions from the 'UniqSupply' module</span>
<a name="line-6"></a><a name="Unique"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>Unique</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>MkUnique</span> <span class='hs-conid'>FastInt</span>
</pre>\end{code}

Now come the functions which construct uniques from their pieces, and vice versa.
The stuff about unique *supplies* is handled further down this module.

\begin{code}
<pre><a name="line-1"></a><a name="unpkUnique"></a><span class='hs-definition'>unpkUnique</span>      <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Unique</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Char</span><span class='hs-layout'>,</span> <span class='hs-conid'>Int</span><span class='hs-layout'>)</span>        <span class='hs-comment'>-- The reverse</span>
<a name="line-2"></a>
<a name="line-3"></a><a name="mkUniqueGrimily"></a><span class='hs-definition'>mkUniqueGrimily</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Unique</span>                <span class='hs-comment'>-- A trap-door for UniqSupply</span>
<a name="line-4"></a><a name="getKey"></a><span class='hs-definition'>getKey</span>          <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Unique</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span>                <span class='hs-comment'>-- for Var</span>
<a name="line-5"></a><a name="getKeyFastInt"></a><span class='hs-definition'>getKeyFastInt</span>   <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Unique</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>FastInt</span>            <span class='hs-comment'>-- for Var</span>
<a name="line-6"></a>
<a name="line-7"></a><a name="incrUnique"></a><span class='hs-definition'>incrUnique</span>      <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Unique</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Unique</span>
<a name="line-8"></a><a name="deriveUnique"></a><span class='hs-definition'>deriveUnique</span>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Unique</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Unique</span>
<a name="line-9"></a><a name="newTagUnique"></a><span class='hs-definition'>newTagUnique</span>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Unique</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Char</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Unique</span>
</pre>\end{code}


\begin{code}
<pre><a name="line-1"></a><a name="mkUniqueGrimily"></a><span class='hs-definition'>mkUniqueGrimily</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>MkUnique</span> <span class='hs-layout'>(</span><span class='hs-varid'>iUnbox</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span>
<a name="line-2"></a>
<a name="line-3"></a><a name="getKey"></a><span class='hs-comment'>{-# INLINE getKey #-}</span>
<a name="line-4"></a><span class='hs-definition'>getKey</span> <span class='hs-layout'>(</span><span class='hs-conid'>MkUnique</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>iBox</span> <span class='hs-varid'>x</span>
<a name="line-5"></a><a name="getKeyFastInt"></a><span class='hs-comment'>{-# INLINE getKeyFastInt #-}</span>
<a name="line-6"></a><span class='hs-definition'>getKeyFastInt</span> <span class='hs-layout'>(</span><span class='hs-conid'>MkUnique</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>x</span>
<a name="line-7"></a>
<a name="line-8"></a><a name="incrUnique"></a><span class='hs-definition'>incrUnique</span> <span class='hs-layout'>(</span><span class='hs-conid'>MkUnique</span> <span class='hs-varid'>i</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>MkUnique</span> <span class='hs-layout'>(</span><span class='hs-varid'>i</span> <span class='hs-varop'>+#</span> <span class='hs-sel'>_ILIT</span><span class='hs-layout'>(</span><span class='hs-num'>1</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-9"></a>
<a name="line-10"></a><a name="deriveUnique"></a><span class='hs-comment'>-- deriveUnique uses an 'X' tag so that it won't clash with</span>
<a name="line-11"></a><span class='hs-comment'>-- any of the uniques produced any other way</span>
<a name="line-12"></a><span class='hs-definition'>deriveUnique</span> <span class='hs-layout'>(</span><span class='hs-conid'>MkUnique</span> <span class='hs-varid'>i</span><span class='hs-layout'>)</span> <span class='hs-varid'>delta</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkUnique</span> <span class='hs-chr'>'X'</span> <span class='hs-layout'>(</span><span class='hs-varid'>iBox</span> <span class='hs-varid'>i</span> <span class='hs-varop'>+</span> <span class='hs-varid'>delta</span><span class='hs-layout'>)</span>
<a name="line-13"></a>
<a name="line-14"></a><a name="newTagUnique"></a><span class='hs-comment'>-- newTagUnique changes the "domain" of a unique to a different char</span>
<a name="line-15"></a><span class='hs-definition'>newTagUnique</span> <span class='hs-varid'>u</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkUnique</span> <span class='hs-varid'>c</span> <span class='hs-varid'>i</span> <span class='hs-keyword'>where</span> <span class='hs-layout'>(</span><span class='hs-keyword'>_</span><span class='hs-layout'>,</span><span class='hs-varid'>i</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>unpkUnique</span> <span class='hs-varid'>u</span>
<a name="line-16"></a>
<a name="line-17"></a><span class='hs-comment'>-- pop the Char in the top 8 bits of the Unique(Supply)</span>
<a name="line-18"></a>
<a name="line-19"></a><span class='hs-comment'>-- No 64-bit bugs here, as long as we have at least 32 bits. --JSM</span>
<a name="line-20"></a>
<a name="line-21"></a><span class='hs-comment'>-- and as long as the Char fits in 8 bits, which we assume anyway!</span>
<a name="line-22"></a>
<a name="line-23"></a><a name="mkUnique"></a><span class='hs-definition'>mkUnique</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Char</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Unique</span>       <span class='hs-comment'>-- Builds a unique from pieces</span>
<a name="line-24"></a><span class='hs-comment'>-- NOT EXPORTED, so that we can see all the Chars that</span>
<a name="line-25"></a><span class='hs-comment'>--               are used in this one module</span>
<a name="line-26"></a><span class='hs-definition'>mkUnique</span> <span class='hs-varid'>c</span> <span class='hs-varid'>i</span>
<a name="line-27"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>MkUnique</span> <span class='hs-layout'>(</span><span class='hs-varid'>tag</span> <span class='hs-varop'>`bitOrFastInt`</span> <span class='hs-varid'>bits</span><span class='hs-layout'>)</span>
<a name="line-28"></a>  <span class='hs-keyword'>where</span>
<a name="line-29"></a>    <span class='hs-varop'>!</span><span class='hs-varid'>tag</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fastOrd</span> <span class='hs-layout'>(</span><span class='hs-varid'>cUnbox</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span> <span class='hs-varop'>`shiftLFastInt`</span> <span class='hs-sel'>_ILIT</span><span class='hs-layout'>(</span><span class='hs-num'>24</span><span class='hs-layout'>)</span>
<a name="line-30"></a>    <span class='hs-varop'>!</span><span class='hs-varid'>bits</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>iUnbox</span> <span class='hs-varid'>i</span> <span class='hs-varop'>`bitAndFastInt`</span> <span class='hs-sel'>_ILIT</span><span class='hs-layout'>(</span><span class='hs-num'>16777215</span><span class='hs-layout'>)</span><span class='hs-comment'>{-``0x00ffffff''-}</span>
<a name="line-31"></a>
<a name="line-32"></a><a name="unpkUnique"></a><span class='hs-definition'>unpkUnique</span> <span class='hs-layout'>(</span><span class='hs-conid'>MkUnique</span> <span class='hs-varid'>u</span><span class='hs-layout'>)</span>
<a name="line-33"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>let</span>
<a name="line-34"></a>        <span class='hs-comment'>-- as long as the Char may have its eighth bit set, we</span>
<a name="line-35"></a>        <span class='hs-comment'>-- really do need the logical right-shift here!</span>
<a name="line-36"></a>        <span class='hs-varid'>tag</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>cBox</span> <span class='hs-layout'>(</span><span class='hs-varid'>fastChr</span> <span class='hs-layout'>(</span><span class='hs-varid'>u</span> <span class='hs-varop'>`shiftRLFastInt`</span> <span class='hs-sel'>_ILIT</span><span class='hs-layout'>(</span><span class='hs-num'>24</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-37"></a>        <span class='hs-varid'>i</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>iBox</span> <span class='hs-layout'>(</span><span class='hs-varid'>u</span> <span class='hs-varop'>`bitAndFastInt`</span> <span class='hs-sel'>_ILIT</span><span class='hs-layout'>(</span><span class='hs-num'>16777215</span><span class='hs-layout'>)</span><span class='hs-comment'>{-``0x00ffffff''-}</span><span class='hs-layout'>)</span>
<a name="line-38"></a>    <span class='hs-keyword'>in</span>
<a name="line-39"></a>    <span class='hs-layout'>(</span><span class='hs-varid'>tag</span><span class='hs-layout'>,</span> <span class='hs-varid'>i</span><span class='hs-layout'>)</span>
</pre>\end{code}



%************************************************************************
%*                                                                      *
\subsection[Uniquable-class]{The @Uniquable@ class}
%*                                                                      *
%************************************************************************

\begin{code}
<pre><a name="line-1"></a><span class='hs-comment'>-- | Class of things that we can obtain a 'Unique' from</span>
<a name="line-2"></a><span class='hs-keyword'>class</span> <span class='hs-conid'>Uniquable</span> <span class='hs-varid'>a</span> <span class='hs-keyword'>where</span>
<a name="line-3"></a>    <span class='hs-varid'>getUnique</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Unique</span>
<a name="line-4"></a>
<a name="line-5"></a><a name="hasKey"></a><span class='hs-definition'>hasKey</span>          <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Uniquable</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Unique</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-6"></a><a name="hasKey"></a><span class='hs-definition'>x</span> <span class='hs-varop'>`hasKey`</span> <span class='hs-varid'>k</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getUnique</span> <span class='hs-varid'>x</span> <span class='hs-varop'>==</span> <span class='hs-varid'>k</span>
<a name="line-7"></a>
<a name="line-8"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Uniquable</span> <span class='hs-conid'>FastString</span> <span class='hs-keyword'>where</span>
<a name="line-9"></a> <span class='hs-varid'>getUnique</span> <span class='hs-varid'>fs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkUniqueGrimily</span> <span class='hs-layout'>(</span><span class='hs-varid'>iBox</span> <span class='hs-layout'>(</span><span class='hs-varid'>uniqueOfFS</span> <span class='hs-varid'>fs</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-10"></a>
<a name="line-11"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Uniquable</span> <span class='hs-conid'>Int</span> <span class='hs-keyword'>where</span>
<a name="line-12"></a> <span class='hs-varid'>getUnique</span> <span class='hs-varid'>i</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkUniqueGrimily</span> <span class='hs-varid'>i</span>
</pre>\end{code}


%************************************************************************
%*                                                                      *
\subsection[Unique-instances]{Instance declarations for @Unique@}
%*                                                                      *
%************************************************************************

And the whole point (besides uniqueness) is fast equality.  We don't
use `deriving' because we want {\em precise} control of ordering
(equality on @Uniques@ is v common).

\begin{code}
<pre><a name="line-1"></a><a name="eqUnique"></a><span class='hs-definition'>eqUnique</span><span class='hs-layout'>,</span> <span class='hs-varid'>ltUnique</span><span class='hs-layout'>,</span> <span class='hs-varid'>leUnique</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Unique</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Unique</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-2"></a><span class='hs-definition'>eqUnique</span> <span class='hs-layout'>(</span><span class='hs-conid'>MkUnique</span> <span class='hs-varid'>u1</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>MkUnique</span> <span class='hs-varid'>u2</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>u1</span> <span class='hs-varop'>==#</span> <span class='hs-varid'>u2</span>
<a name="line-3"></a><a name="ltUnique"></a><span class='hs-definition'>ltUnique</span> <span class='hs-layout'>(</span><span class='hs-conid'>MkUnique</span> <span class='hs-varid'>u1</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>MkUnique</span> <span class='hs-varid'>u2</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>u1</span> <span class='hs-varop'>&lt;#</span>  <span class='hs-varid'>u2</span>
<a name="line-4"></a><a name="leUnique"></a><span class='hs-definition'>leUnique</span> <span class='hs-layout'>(</span><span class='hs-conid'>MkUnique</span> <span class='hs-varid'>u1</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>MkUnique</span> <span class='hs-varid'>u2</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>u1</span> <span class='hs-varop'>&lt;=#</span> <span class='hs-varid'>u2</span>
<a name="line-5"></a>
<a name="line-6"></a><a name="cmpUnique"></a><span class='hs-definition'>cmpUnique</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Unique</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Unique</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Ordering</span>
<a name="line-7"></a><span class='hs-definition'>cmpUnique</span> <span class='hs-layout'>(</span><span class='hs-conid'>MkUnique</span> <span class='hs-varid'>u1</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>MkUnique</span> <span class='hs-varid'>u2</span><span class='hs-layout'>)</span>
<a name="line-8"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>if</span> <span class='hs-varid'>u1</span> <span class='hs-varop'>==#</span> <span class='hs-varid'>u2</span> <span class='hs-keyword'>then</span> <span class='hs-conid'>EQ</span> <span class='hs-keyword'>else</span> <span class='hs-keyword'>if</span> <span class='hs-varid'>u1</span> <span class='hs-varop'>&lt;#</span> <span class='hs-varid'>u2</span> <span class='hs-keyword'>then</span> <span class='hs-conid'>LT</span> <span class='hs-keyword'>else</span> <span class='hs-conid'>GT</span>
<a name="line-9"></a>
<a name="line-10"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Eq</span> <span class='hs-conid'>Unique</span> <span class='hs-keyword'>where</span>
<a name="line-11"></a>    <span class='hs-varid'>a</span> <span class='hs-varop'>==</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>eqUnique</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span>
<a name="line-12"></a>    <span class='hs-varid'>a</span> <span class='hs-varop'>/=</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>not</span> <span class='hs-layout'>(</span><span class='hs-varid'>eqUnique</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span>
<a name="line-13"></a>
<a name="line-14"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Ord</span> <span class='hs-conid'>Unique</span> <span class='hs-keyword'>where</span>
<a name="line-15"></a>    <span class='hs-varid'>a</span>  <span class='hs-varop'>&lt;</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ltUnique</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span>
<a name="line-16"></a>    <span class='hs-varid'>a</span> <span class='hs-varop'>&lt;=</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>leUnique</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span>
<a name="line-17"></a>    <span class='hs-varid'>a</span>  <span class='hs-varop'>&gt;</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>not</span> <span class='hs-layout'>(</span><span class='hs-varid'>leUnique</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span>
<a name="line-18"></a>    <span class='hs-varid'>a</span> <span class='hs-varop'>&gt;=</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>not</span> <span class='hs-layout'>(</span><span class='hs-varid'>ltUnique</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span>
<a name="line-19"></a>    <span class='hs-varid'>compare</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>cmpUnique</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span>
<a name="line-20"></a>
<a name="line-21"></a><span class='hs-comment'>-----------------</span>
<a name="line-22"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Uniquable</span> <span class='hs-conid'>Unique</span> <span class='hs-keyword'>where</span>
<a name="line-23"></a>    <span class='hs-varid'>getUnique</span> <span class='hs-varid'>u</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>u</span>
</pre>\end{code}

We do sometimes make strings with @Uniques@ in them:
\begin{code}
<pre><a name="line-1"></a><a name="showUnique"></a><span class='hs-definition'>showUnique</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Unique</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>String</span>
<a name="line-2"></a><span class='hs-definition'>showUnique</span> <span class='hs-varid'>uniq</span>
<a name="line-3"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>unpkUnique</span> <span class='hs-varid'>uniq</span> <span class='hs-keyword'>of</span>
<a name="line-4"></a>      <span class='hs-layout'>(</span><span class='hs-varid'>tag</span><span class='hs-layout'>,</span> <span class='hs-varid'>u</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>finish_show</span> <span class='hs-varid'>tag</span> <span class='hs-varid'>u</span> <span class='hs-layout'>(</span><span class='hs-varid'>iToBase62</span> <span class='hs-varid'>u</span><span class='hs-layout'>)</span>
<a name="line-5"></a>
<a name="line-6"></a><a name="finish_show"></a><span class='hs-definition'>finish_show</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Char</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>String</span>
<a name="line-7"></a><span class='hs-definition'>finish_show</span> <span class='hs-chr'>'t'</span> <span class='hs-varid'>u</span> <span class='hs-sel'>_pp_u</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>u</span> <span class='hs-varop'>&lt;</span> <span class='hs-num'>26</span>
<a name="line-8"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-comment'>-- Special case to make v common tyvars, t1, t2, ...</span>
<a name="line-9"></a>    <span class='hs-comment'>-- come out as a, b, ... (shorter, easier to read)</span>
<a name="line-10"></a>    <span class='hs-keyglyph'>[</span><span class='hs-varid'>chr</span> <span class='hs-layout'>(</span><span class='hs-varid'>ord</span> <span class='hs-chr'>'a'</span> <span class='hs-varop'>+</span> <span class='hs-varid'>u</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-11"></a><span class='hs-definition'>finish_show</span> <span class='hs-varid'>tag</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>pp_u</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tag</span> <span class='hs-conop'>:</span> <span class='hs-varid'>pp_u</span>
<a name="line-12"></a>
<a name="line-13"></a><a name="pprUnique"></a><span class='hs-definition'>pprUnique</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Unique</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-14"></a><span class='hs-definition'>pprUnique</span> <span class='hs-varid'>u</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-layout'>(</span><span class='hs-varid'>showUnique</span> <span class='hs-varid'>u</span><span class='hs-layout'>)</span>
<a name="line-15"></a>
<a name="line-16"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Outputable</span> <span class='hs-conid'>Unique</span> <span class='hs-keyword'>where</span>
<a name="line-17"></a>    <span class='hs-varid'>ppr</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprUnique</span>
<a name="line-18"></a>
<a name="line-19"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Show</span> <span class='hs-conid'>Unique</span> <span class='hs-keyword'>where</span>
<a name="line-20"></a>    <span class='hs-varid'>show</span> <span class='hs-varid'>uniq</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>showUnique</span> <span class='hs-varid'>uniq</span>
</pre>\end{code}

%************************************************************************
%*                                                                      *
\subsection[Utils-base62]{Base-62 numbers}
%*                                                                      *
%************************************************************************

A character-stingy way to read/write numbers (notably Uniques).
The ``62-its'' are \tr{[0-9a-zA-Z]}.  We don't handle negative Ints.
Code stolen from Lennart.

\begin{code}
<pre><a name="line-1"></a><a name="iToBase62"></a><span class='hs-definition'>iToBase62</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>String</span>
<a name="line-2"></a><span class='hs-definition'>iToBase62</span> <span class='hs-varid'>n_</span>
<a name="line-3"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ASSERT</span><span class='hs-layout'>(</span><span class='hs-varid'>n_</span> <span class='hs-varop'>&gt;=</span> <span class='hs-num'>0</span><span class='hs-layout'>)</span> <span class='hs-varid'>go</span> <span class='hs-layout'>(</span><span class='hs-varid'>iUnbox</span> <span class='hs-varid'>n_</span><span class='hs-layout'>)</span> <span class='hs-str'>""</span>
<a name="line-4"></a>  <span class='hs-keyword'>where</span>
<a name="line-5"></a>    <span class='hs-varid'>go</span> <span class='hs-varid'>n</span> <span class='hs-varid'>cs</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>n</span> <span class='hs-varop'>&lt;#</span> <span class='hs-sel'>_ILIT</span><span class='hs-layout'>(</span><span class='hs-num'>62</span><span class='hs-layout'>)</span>
<a name="line-6"></a>             <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>chooseChar62</span> <span class='hs-varid'>n</span> <span class='hs-keyword'>of</span> <span class='hs-layout'>{</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>c</span> <span class='hs-varop'>`seq`</span> <span class='hs-layout'>(</span><span class='hs-varid'>c</span> <span class='hs-conop'>:</span> <span class='hs-varid'>cs</span><span class='hs-layout'>)</span> <span class='hs-layout'>}</span>
<a name="line-7"></a>             <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>
<a name="line-8"></a>             <span class='hs-keyglyph'>=</span>  <span class='hs-keyword'>case</span> <span class='hs-layout'>(</span><span class='hs-varid'>quotRem</span> <span class='hs-layout'>(</span><span class='hs-varid'>iBox</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-num'>62</span><span class='hs-layout'>)</span> <span class='hs-keyword'>of</span> <span class='hs-layout'>{</span> <span class='hs-layout'>(</span><span class='hs-varid'>q_</span><span class='hs-layout'>,</span> <span class='hs-varid'>r_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-9"></a>                <span class='hs-keyword'>case</span> <span class='hs-varid'>iUnbox</span> <span class='hs-varid'>q_</span> <span class='hs-keyword'>of</span> <span class='hs-layout'>{</span> <span class='hs-varid'>q</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>iUnbox</span> <span class='hs-varid'>r_</span> <span class='hs-keyword'>of</span> <span class='hs-layout'>{</span> <span class='hs-varid'>r</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-10"></a>                <span class='hs-keyword'>case</span> <span class='hs-layout'>(</span><span class='hs-varid'>chooseChar62</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span> <span class='hs-keyword'>of</span> <span class='hs-layout'>{</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>c</span> <span class='hs-varop'>`seq`</span>
<a name="line-11"></a>                <span class='hs-layout'>(</span><span class='hs-varid'>go</span> <span class='hs-varid'>q</span> <span class='hs-layout'>(</span><span class='hs-varid'>c</span> <span class='hs-conop'>:</span> <span class='hs-varid'>cs</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-layout'>}</span><span class='hs-layout'>}</span><span class='hs-layout'>}</span><span class='hs-layout'>}</span>
<a name="line-12"></a>
<a name="line-13"></a>    <span class='hs-varid'>chooseChar62</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>FastInt</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Char</span>
<a name="line-14"></a>    <span class='hs-comment'>{-# INLINE chooseChar62 #-}</span>
<a name="line-15"></a><span class='hs-cpp'>#if defined(__GLASGOW_HASKELL__)</span>
<a name="line-16"></a>    <span class='hs-comment'>--then FastInt == Int#</span>
<a name="line-17"></a>    <span class='hs-varid'>chooseChar62</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>C</span><span class='hs-cpp'>#</span> <span class='hs-layout'>(</span><span class='hs-varid'>indexCharOffAddr</span><span class='hs-cpp'>#</span> <span class='hs-varid'>chars62</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span>
<a name="line-18"></a>    <span class='hs-varop'>!</span><span class='hs-varid'>chars62</span> <span class='hs-keyglyph'>=</span> <span class='hs-str'>"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"</span><span class='hs-cpp'>#</span>
<a name="line-19"></a><span class='hs-cpp'>#else</span>
<a name="line-20"></a>    <span class='hs-comment'>--Haskell98 arrays are portable</span>
<a name="line-21"></a>    <span class='hs-varid'>chooseChar62</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varop'>!</span><span class='hs-layout'>)</span> <span class='hs-varid'>chars62</span> <span class='hs-varid'>n</span>
<a name="line-22"></a>    <span class='hs-varid'>chars62</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>listArray</span> <span class='hs-layout'>(</span><span class='hs-num'>0</span><span class='hs-layout'>,</span><span class='hs-num'>61</span><span class='hs-layout'>)</span> <span class='hs-str'>"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"</span>
<a name="line-23"></a><span class='hs-cpp'>#endif</span>
</pre>\end{code}

%************************************************************************
%*                                                                      *
\subsection[Uniques-prelude]{@Uniques@ for wired-in Prelude things}
%*                                                                      *
%************************************************************************

Allocation of unique supply characters:
        v,t,u : for renumbering value-, type- and usage- vars.
        B:   builtin
        C-E: pseudo uniques     (used in native-code generator)
        X:   uniques derived by deriveUnique
        _:   unifiable tyvars   (above)
        0-9: prelude things below
             (no numbers left any more..)
        ::   (prelude) parallel array data constructors

        other a-z: lower case chars for unique supplies.  Used so far:

        d       desugarer
        f       AbsC flattener
        g       SimplStg
        n       Native codegen
        r       Hsc name cache
        s       simplifier

\begin{code}
<pre><a name="line-1"></a><a name="mkAlphaTyVarUnique"></a><span class='hs-definition'>mkAlphaTyVarUnique</span>     <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Unique</span>
<a name="line-2"></a><a name="mkPreludeClassUnique"></a><span class='hs-definition'>mkPreludeClassUnique</span>   <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Unique</span>
<a name="line-3"></a><a name="mkPreludeTyConUnique"></a><span class='hs-definition'>mkPreludeTyConUnique</span>   <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Unique</span>
<a name="line-4"></a><a name="mkTupleTyConUnique"></a><span class='hs-definition'>mkTupleTyConUnique</span>     <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TupleSort</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Unique</span>
<a name="line-5"></a><a name="mkPreludeDataConUnique"></a><span class='hs-definition'>mkPreludeDataConUnique</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Unique</span>
<a name="line-6"></a><a name="mkTupleDataConUnique"></a><span class='hs-definition'>mkTupleDataConUnique</span>   <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TupleSort</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Unique</span>
<a name="line-7"></a><a name="mkPrimOpIdUnique"></a><span class='hs-definition'>mkPrimOpIdUnique</span>       <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Unique</span>
<a name="line-8"></a><a name="mkPreludeMiscIdUnique"></a><span class='hs-definition'>mkPreludeMiscIdUnique</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Unique</span>
<a name="line-9"></a><a name="mkPArrDataConUnique"></a><span class='hs-definition'>mkPArrDataConUnique</span>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Unique</span>
<a name="line-10"></a>
<a name="line-11"></a><span class='hs-definition'>mkAlphaTyVarUnique</span> <span class='hs-varid'>i</span>            <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkUnique</span> <span class='hs-chr'>'1'</span> <span class='hs-varid'>i</span>
<a name="line-12"></a>
<a name="line-13"></a><span class='hs-definition'>mkPreludeClassUnique</span> <span class='hs-varid'>i</span>          <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkUnique</span> <span class='hs-chr'>'2'</span> <span class='hs-varid'>i</span>
<a name="line-14"></a>
<a name="line-15"></a><span class='hs-comment'>-- Prelude type constructors occupy *three* slots.</span>
<a name="line-16"></a><span class='hs-comment'>-- The first is for the tycon itself; the latter two</span>
<a name="line-17"></a><span class='hs-comment'>-- are for the generic to/from Ids.  See TysWiredIn.mk_tc_gen_info.</span>
<a name="line-18"></a>
<a name="line-19"></a><span class='hs-definition'>mkPreludeTyConUnique</span> <span class='hs-varid'>i</span>          <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkUnique</span> <span class='hs-chr'>'3'</span> <span class='hs-layout'>(</span><span class='hs-num'>3</span><span class='hs-varop'>*</span><span class='hs-varid'>i</span><span class='hs-layout'>)</span>
<a name="line-20"></a><span class='hs-definition'>mkTupleTyConUnique</span> <span class='hs-conid'>BoxedTuple</span>   <span class='hs-varid'>a</span>       <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkUnique</span> <span class='hs-chr'>'4'</span> <span class='hs-layout'>(</span><span class='hs-num'>3</span><span class='hs-varop'>*</span><span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-21"></a><span class='hs-definition'>mkTupleTyConUnique</span> <span class='hs-conid'>UnboxedTuple</span> <span class='hs-varid'>a</span>       <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkUnique</span> <span class='hs-chr'>'5'</span> <span class='hs-layout'>(</span><span class='hs-num'>3</span><span class='hs-varop'>*</span><span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-22"></a><span class='hs-definition'>mkTupleTyConUnique</span> <span class='hs-conid'>ConstraintTuple</span> <span class='hs-varid'>a</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkUnique</span> <span class='hs-chr'>'k'</span> <span class='hs-layout'>(</span><span class='hs-num'>3</span><span class='hs-varop'>*</span><span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-23"></a>
<a name="line-24"></a><span class='hs-comment'>-- Data constructor keys occupy *two* slots.  The first is used for the</span>
<a name="line-25"></a><span class='hs-comment'>-- data constructor itself and its wrapper function (the function that</span>
<a name="line-26"></a><span class='hs-comment'>-- evaluates arguments as necessary and calls the worker). The second is</span>
<a name="line-27"></a><span class='hs-comment'>-- used for the worker function (the function that builds the constructor</span>
<a name="line-28"></a><span class='hs-comment'>-- representation).</span>
<a name="line-29"></a>
<a name="line-30"></a><span class='hs-definition'>mkPreludeDataConUnique</span> <span class='hs-varid'>i</span>        <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkUnique</span> <span class='hs-chr'>'6'</span> <span class='hs-layout'>(</span><span class='hs-num'>2</span><span class='hs-varop'>*</span><span class='hs-varid'>i</span><span class='hs-layout'>)</span>    <span class='hs-comment'>-- Must be alphabetic</span>
<a name="line-31"></a><span class='hs-definition'>mkTupleDataConUnique</span> <span class='hs-conid'>BoxedTuple</span>   <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkUnique</span> <span class='hs-chr'>'7'</span> <span class='hs-layout'>(</span><span class='hs-num'>2</span><span class='hs-varop'>*</span><span class='hs-varid'>a</span><span class='hs-layout'>)</span>        <span class='hs-comment'>-- ditto (*may* be used in C labels)</span>
<a name="line-32"></a><span class='hs-definition'>mkTupleDataConUnique</span> <span class='hs-conid'>UnboxedTuple</span>    <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkUnique</span> <span class='hs-chr'>'8'</span> <span class='hs-layout'>(</span><span class='hs-num'>2</span><span class='hs-varop'>*</span><span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-33"></a><span class='hs-definition'>mkTupleDataConUnique</span> <span class='hs-conid'>ConstraintTuple</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkUnique</span> <span class='hs-chr'>'h'</span> <span class='hs-layout'>(</span><span class='hs-num'>2</span><span class='hs-varop'>*</span><span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-34"></a>
<a name="line-35"></a><span class='hs-definition'>mkPrimOpIdUnique</span> <span class='hs-varid'>op</span>         <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkUnique</span> <span class='hs-chr'>'9'</span> <span class='hs-varid'>op</span>
<a name="line-36"></a><span class='hs-definition'>mkPreludeMiscIdUnique</span>  <span class='hs-varid'>i</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkUnique</span> <span class='hs-chr'>'0'</span> <span class='hs-varid'>i</span>
<a name="line-37"></a>
<a name="line-38"></a><span class='hs-comment'>-- No numbers left anymore, so I pick something different for the character tag</span>
<a name="line-39"></a><span class='hs-definition'>mkPArrDataConUnique</span> <span class='hs-varid'>a</span>           <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkUnique</span> <span class='hs-chr'>':'</span> <span class='hs-layout'>(</span><span class='hs-num'>2</span><span class='hs-varop'>*</span><span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-40"></a>
<a name="line-41"></a><span class='hs-comment'>-- The "tyvar uniques" print specially nicely: a, b, c, etc.</span>
<a name="line-42"></a><span class='hs-comment'>-- See pprUnique for details</span>
<a name="line-43"></a>
<a name="line-44"></a><a name="initTyVarUnique"></a><span class='hs-definition'>initTyVarUnique</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Unique</span>
<a name="line-45"></a><span class='hs-definition'>initTyVarUnique</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkUnique</span> <span class='hs-chr'>'t'</span> <span class='hs-num'>0</span>
<a name="line-46"></a>
<a name="line-47"></a><a name="mkPseudoUniqueD"></a><span class='hs-definition'>mkPseudoUniqueD</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkPseudoUniqueE</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkPseudoUniqueH</span><span class='hs-layout'>,</span>
<a name="line-48"></a>   <span class='hs-varid'>mkBuiltinUnique</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Unique</span>
<a name="line-49"></a>
<a name="line-50"></a><a name="mkBuiltinUnique"></a><span class='hs-definition'>mkBuiltinUnique</span> <span class='hs-varid'>i</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkUnique</span> <span class='hs-chr'>'B'</span> <span class='hs-varid'>i</span>
<a name="line-51"></a><span class='hs-definition'>mkPseudoUniqueD</span> <span class='hs-varid'>i</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkUnique</span> <span class='hs-chr'>'D'</span> <span class='hs-varid'>i</span> <span class='hs-comment'>-- used in NCG for getUnique on RealRegs</span>
<a name="line-52"></a><a name="mkPseudoUniqueE"></a><span class='hs-definition'>mkPseudoUniqueE</span> <span class='hs-varid'>i</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkUnique</span> <span class='hs-chr'>'E'</span> <span class='hs-varid'>i</span> <span class='hs-comment'>-- used in NCG spiller to create spill VirtualRegs</span>
<a name="line-53"></a><a name="mkPseudoUniqueH"></a><span class='hs-definition'>mkPseudoUniqueH</span> <span class='hs-varid'>i</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkUnique</span> <span class='hs-chr'>'H'</span> <span class='hs-varid'>i</span> <span class='hs-comment'>-- used in NCG spiller to create spill VirtualRegs</span>
<a name="line-54"></a>
<a name="line-55"></a><a name="mkRegSingleUnique"></a><span class='hs-definition'>mkRegSingleUnique</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkRegPairUnique</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkRegSubUnique</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkRegClassUnique</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Unique</span>
<a name="line-56"></a><span class='hs-definition'>mkRegSingleUnique</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkUnique</span> <span class='hs-chr'>'R'</span>
<a name="line-57"></a><a name="mkRegSubUnique"></a><span class='hs-definition'>mkRegSubUnique</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkUnique</span> <span class='hs-chr'>'S'</span>
<a name="line-58"></a><a name="mkRegPairUnique"></a><span class='hs-definition'>mkRegPairUnique</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkUnique</span> <span class='hs-chr'>'P'</span>
<a name="line-59"></a><a name="mkRegClassUnique"></a><span class='hs-definition'>mkRegClassUnique</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkUnique</span> <span class='hs-chr'>'L'</span>
<a name="line-60"></a>
<a name="line-61"></a><a name="mkCostCentreUnique"></a><span class='hs-definition'>mkCostCentreUnique</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Unique</span>
<a name="line-62"></a><span class='hs-definition'>mkCostCentreUnique</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkUnique</span> <span class='hs-chr'>'C'</span>
<a name="line-63"></a>
<a name="line-64"></a><a name="mkVarOccUnique"></a><span class='hs-definition'>mkVarOccUnique</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkDataOccUnique</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkTvOccUnique</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkTcOccUnique</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>FastString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Unique</span>
<a name="line-65"></a><span class='hs-comment'>-- See Note [The Unique of an OccName] in OccName</span>
<a name="line-66"></a><span class='hs-definition'>mkVarOccUnique</span>  <span class='hs-varid'>fs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkUnique</span> <span class='hs-chr'>'i'</span> <span class='hs-layout'>(</span><span class='hs-varid'>iBox</span> <span class='hs-layout'>(</span><span class='hs-varid'>uniqueOfFS</span> <span class='hs-varid'>fs</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-67"></a><a name="mkDataOccUnique"></a><span class='hs-definition'>mkDataOccUnique</span> <span class='hs-varid'>fs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkUnique</span> <span class='hs-chr'>'d'</span> <span class='hs-layout'>(</span><span class='hs-varid'>iBox</span> <span class='hs-layout'>(</span><span class='hs-varid'>uniqueOfFS</span> <span class='hs-varid'>fs</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-68"></a><a name="mkTvOccUnique"></a><span class='hs-definition'>mkTvOccUnique</span>   <span class='hs-varid'>fs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkUnique</span> <span class='hs-chr'>'v'</span> <span class='hs-layout'>(</span><span class='hs-varid'>iBox</span> <span class='hs-layout'>(</span><span class='hs-varid'>uniqueOfFS</span> <span class='hs-varid'>fs</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-69"></a><a name="mkTcOccUnique"></a><span class='hs-definition'>mkTcOccUnique</span>   <span class='hs-varid'>fs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkUnique</span> <span class='hs-chr'>'c'</span> <span class='hs-layout'>(</span><span class='hs-varid'>iBox</span> <span class='hs-layout'>(</span><span class='hs-varid'>uniqueOfFS</span> <span class='hs-varid'>fs</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
</pre>\end{code}

</body>
</html>
