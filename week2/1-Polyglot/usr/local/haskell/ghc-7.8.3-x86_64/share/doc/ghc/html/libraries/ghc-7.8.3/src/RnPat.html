<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>rename/RnPat.lhs</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
%
% (c) The GRASP/AQUA Project, Glasgow University, 1992-1998
%
\section[RnPat]{Renaming of patterns}

Basically dependency analysis.

Handles @Match@, @GRHSs@, @HsExpr@, and @Qualifier@ datatypes.  In
general, all of these functions return a renamed thing, and a set of
free variables.

\begin{code}
<pre><a name="line-1"></a><span class='hs-comment'>-- The above warning supression flag is a temporary kludge.</span>
<a name="line-2"></a><span class='hs-comment'>-- While working on this module you are encouraged to remove it and</span>
<a name="line-3"></a><span class='hs-comment'>-- detab the module (please do the detabbing in a separate patch). See</span>
<a name="line-4"></a><span class='hs-comment'>--     <a href="http://ghc.haskell.org/trac/ghc/wiki/Commentary/CodingStyle#TabsvsSpaces">http://ghc.haskell.org/trac/ghc/wiki/Commentary/CodingStyle#TabsvsSpaces</a></span>
<a name="line-5"></a><span class='hs-comment'>-- for details</span>
<a name="line-6"></a>
<a name="line-7"></a><span class='hs-comment'>{-# LANGUAGE ScopedTypeVariables #-}</span>
<a name="line-8"></a><span class='hs-keyword'>module</span> <span class='hs-conid'>RnPat</span> <span class='hs-layout'>(</span><span class='hs-comment'>-- main entry points</span>
<a name="line-9"></a>              <span class='hs-varid'>rnPat</span><span class='hs-layout'>,</span> <span class='hs-varid'>rnPats</span><span class='hs-layout'>,</span> <span class='hs-varid'>rnBindPat</span><span class='hs-layout'>,</span> <span class='hs-varid'>rnPatAndThen</span><span class='hs-layout'>,</span>
<a name="line-10"></a>
<a name="line-11"></a>              <span class='hs-conid'>NameMaker</span><span class='hs-layout'>,</span> <span class='hs-varid'>applyNameMaker</span><span class='hs-layout'>,</span>     <span class='hs-comment'>-- a utility for making names:</span>
<a name="line-12"></a>              <span class='hs-varid'>localRecNameMaker</span><span class='hs-layout'>,</span> <span class='hs-varid'>topRecNameMaker</span><span class='hs-layout'>,</span>  <span class='hs-comment'>--   sometimes we want to make local names,</span>
<a name="line-13"></a>                                             <span class='hs-comment'>--   sometimes we want to make top (qualified) names.</span>
<a name="line-14"></a>              <span class='hs-varid'>isTopRecNameMaker</span><span class='hs-layout'>,</span>
<a name="line-15"></a>
<a name="line-16"></a>              <span class='hs-varid'>rnHsRecFields1</span><span class='hs-layout'>,</span> <span class='hs-conid'>HsRecFieldContext</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-17"></a>
<a name="line-18"></a>              <span class='hs-comment'>-- CpsRn monad</span>
<a name="line-19"></a>              <span class='hs-conid'>CpsRn</span><span class='hs-layout'>,</span> <span class='hs-varid'>liftCps</span><span class='hs-layout'>,</span>
<a name="line-20"></a>
<a name="line-21"></a>              <span class='hs-comment'>-- Literals</span>
<a name="line-22"></a>              <span class='hs-varid'>rnLit</span><span class='hs-layout'>,</span> <span class='hs-varid'>rnOverLit</span><span class='hs-layout'>,</span>
<a name="line-23"></a>
<a name="line-24"></a>             <span class='hs-comment'>-- Pattern Error messages that are also used elsewhere</span>
<a name="line-25"></a>             <span class='hs-varid'>checkTupSize</span><span class='hs-layout'>,</span> <span class='hs-varid'>patSigErr</span>
<a name="line-26"></a>             <span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-27"></a>
<a name="line-28"></a><span class='hs-comment'>-- ENH: thin imports to only what is necessary for patterns</span>
<a name="line-29"></a>
<a name="line-30"></a><span class='hs-keyword'>import</span> <span class='hs-comment'>{-# SOURCE #-}</span> <span class='hs-conid'>RnExpr</span> <span class='hs-layout'>(</span> <span class='hs-varid'>rnLExpr</span> <span class='hs-layout'>)</span>
<a name="line-31"></a><span class='hs-keyword'>import</span> <span class='hs-comment'>{-# SOURCE #-}</span> <span class='hs-conid'>RnSplice</span> <span class='hs-layout'>(</span> <span class='hs-varid'>rnSplicePat</span> <span class='hs-layout'>)</span>
<a name="line-32"></a><span class='hs-keyword'>import</span> <span class='hs-comment'>{-# SOURCE #-}</span> <span class='hs-conid'>TcSplice</span> <span class='hs-layout'>(</span> <span class='hs-varid'>runQuasiQuotePat</span> <span class='hs-layout'>)</span>
<a name="line-33"></a>
<a name="line-34"></a><span class='hs-cpp'>#include "HsVersions.h"</span>
<a name="line-35"></a>
<a name="line-36"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>HsSyn</span>            
<a name="line-37"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>TcRnMonad</span>
<a name="line-38"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>TcHsSyn</span>             <span class='hs-layout'>(</span> <span class='hs-varid'>hsOverLitName</span> <span class='hs-layout'>)</span>
<a name="line-39"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>RnEnv</span>
<a name="line-40"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>RnTypes</span>
<a name="line-41"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>DynFlags</span>
<a name="line-42"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>PrelNames</span>
<a name="line-43"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>TyCon</span>               <span class='hs-layout'>(</span> <span class='hs-varid'>tyConName</span> <span class='hs-layout'>)</span>
<a name="line-44"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>ConLike</span>
<a name="line-45"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>DataCon</span>             <span class='hs-layout'>(</span> <span class='hs-varid'>dataConTyCon</span> <span class='hs-layout'>)</span>
<a name="line-46"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>TypeRep</span>             <span class='hs-layout'>(</span> <span class='hs-conid'>TyThing</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span> <span class='hs-layout'>)</span>
<a name="line-47"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Name</span>
<a name="line-48"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>NameSet</span>
<a name="line-49"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>RdrName</span>
<a name="line-50"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>BasicTypes</span>
<a name="line-51"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Util</span>
<a name="line-52"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>ListSetOps</span>          <span class='hs-layout'>(</span> <span class='hs-varid'>removeDups</span> <span class='hs-layout'>)</span>
<a name="line-53"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Outputable</span>
<a name="line-54"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>SrcLoc</span>
<a name="line-55"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>FastString</span>
<a name="line-56"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Literal</span>             <span class='hs-layout'>(</span> <span class='hs-varid'>inCharRange</span> <span class='hs-layout'>)</span>
<a name="line-57"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>TysWiredIn</span>          <span class='hs-layout'>(</span> <span class='hs-varid'>nilDataCon</span> <span class='hs-layout'>)</span>
<a name="line-58"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>DataCon</span>             <span class='hs-layout'>(</span> <span class='hs-varid'>dataConName</span> <span class='hs-layout'>)</span>
<a name="line-59"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Control</span><span class='hs-varop'>.</span><span class='hs-conid'>Monad</span>       <span class='hs-layout'>(</span> <span class='hs-varid'>when</span><span class='hs-layout'>,</span> <span class='hs-varid'>liftM</span><span class='hs-layout'>,</span> <span class='hs-varid'>ap</span> <span class='hs-layout'>)</span>
<a name="line-60"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Ratio</span>
</pre>\end{code}


%*********************************************************
%*                                                      *
        The CpsRn Monad
%*                                                      *
%*********************************************************

Note [CpsRn monad]
~~~~~~~~~~~~~~~~~~
The CpsRn monad uses continuation-passing style to support this
style of programming:

        do { ...
           ; ns <- bindNames rs
           ; ...blah... }

   where rs::[RdrName], ns::[Name]

The idea is that '...blah...' 
  a) sees the bindings of ns
  b) returns the free variables it mentions
     so that bindNames can report unused ones

In particular, 
    mapM rnPatAndThen [p1, p2, p3]
has a *left-to-right* scoping: it makes the binders in 
p1 scope over p2,p3.

\begin{code}
<pre><a name="line-1"></a><a name="CpsRn"></a><span class='hs-keyword'>newtype</span> <span class='hs-conid'>CpsRn</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>CpsRn</span> <span class='hs-layout'>{</span> <span class='hs-varid'>unCpsRn</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>r</span><span class='hs-varop'>.</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>RnM</span> <span class='hs-layout'>(</span><span class='hs-varid'>r</span><span class='hs-layout'>,</span> <span class='hs-conid'>FreeVars</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-2"></a>                                            <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>RnM</span> <span class='hs-layout'>(</span><span class='hs-varid'>r</span><span class='hs-layout'>,</span> <span class='hs-conid'>FreeVars</span><span class='hs-layout'>)</span> <span class='hs-layout'>}</span>
<a name="line-3"></a>        <span class='hs-comment'>-- See Note [CpsRn monad]</span>
<a name="line-4"></a>
<a name="line-5"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Functor</span> <span class='hs-conid'>CpsRn</span> <span class='hs-keyword'>where</span>
<a name="line-6"></a>    <span class='hs-varid'>fmap</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>liftM</span>
<a name="line-7"></a>
<a name="line-8"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Applicative</span> <span class='hs-conid'>CpsRn</span> <span class='hs-keyword'>where</span>
<a name="line-9"></a>    <span class='hs-varid'>pure</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>return</span>
<a name="line-10"></a>    <span class='hs-layout'>(</span><span class='hs-varop'>&lt;*&gt;</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ap</span>
<a name="line-11"></a>
<a name="line-12"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Monad</span> <span class='hs-conid'>CpsRn</span> <span class='hs-keyword'>where</span>
<a name="line-13"></a>  <span class='hs-varid'>return</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>CpsRn</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>k</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>k</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span>
<a name="line-14"></a>  <span class='hs-layout'>(</span><span class='hs-conid'>CpsRn</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-varid'>mk</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>CpsRn</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>k</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>v</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>unCpsRn</span> <span class='hs-layout'>(</span><span class='hs-varid'>mk</span> <span class='hs-varid'>v</span><span class='hs-layout'>)</span> <span class='hs-varid'>k</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-15"></a>
<a name="line-16"></a><a name="runCps"></a><span class='hs-definition'>runCps</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>CpsRn</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>RnM</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-conid'>FreeVars</span><span class='hs-layout'>)</span>
<a name="line-17"></a><span class='hs-definition'>runCps</span> <span class='hs-layout'>(</span><span class='hs-conid'>CpsRn</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>r</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>r</span><span class='hs-layout'>,</span> <span class='hs-varid'>emptyFVs</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-18"></a>
<a name="line-19"></a><a name="liftCps"></a><span class='hs-definition'>liftCps</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>RnM</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>CpsRn</span> <span class='hs-varid'>a</span>
<a name="line-20"></a><span class='hs-definition'>liftCps</span> <span class='hs-varid'>rn_thing</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>CpsRn</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>k</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>rn_thing</span> <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-varid'>k</span><span class='hs-layout'>)</span>
<a name="line-21"></a>
<a name="line-22"></a><a name="liftCpsFV"></a><span class='hs-definition'>liftCpsFV</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>RnM</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-conid'>FreeVars</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>CpsRn</span> <span class='hs-varid'>a</span>
<a name="line-23"></a><span class='hs-definition'>liftCpsFV</span> <span class='hs-varid'>rn_thing</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>CpsRn</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>k</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span> <span class='hs-layout'>{</span> <span class='hs-layout'>(</span><span class='hs-varid'>v</span><span class='hs-layout'>,</span><span class='hs-varid'>fvs1</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>rn_thing</span>
<a name="line-24"></a>                                     <span class='hs-layout'>;</span> <span class='hs-layout'>(</span><span class='hs-varid'>r</span><span class='hs-layout'>,</span><span class='hs-varid'>fvs2</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>k</span> <span class='hs-varid'>v</span>
<a name="line-25"></a>                                     <span class='hs-layout'>;</span> <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>r</span><span class='hs-layout'>,</span> <span class='hs-varid'>fvs1</span> <span class='hs-varop'>`plusFV`</span> <span class='hs-varid'>fvs2</span><span class='hs-layout'>)</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-26"></a>
<a name="line-27"></a><a name="wrapSrcSpanCps"></a><span class='hs-definition'>wrapSrcSpanCps</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>CpsRn</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Located</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>CpsRn</span> <span class='hs-layout'>(</span><span class='hs-conid'>Located</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span>
<a name="line-28"></a><span class='hs-comment'>-- Set the location, and also wrap it around the value returned</span>
<a name="line-29"></a><span class='hs-definition'>wrapSrcSpanCps</span> <span class='hs-varid'>fn</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-varid'>loc</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-30"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>CpsRn</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>k</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>setSrcSpan</span> <span class='hs-varid'>loc</span> <span class='hs-varop'>$</span> 
<a name="line-31"></a>                 <span class='hs-varid'>unCpsRn</span> <span class='hs-layout'>(</span><span class='hs-varid'>fn</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>v</span> <span class='hs-keyglyph'>-&gt;</span> 
<a name="line-32"></a>                 <span class='hs-varid'>k</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-varid'>loc</span> <span class='hs-varid'>v</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-33"></a>
<a name="line-34"></a><a name="lookupConCps"></a><span class='hs-definition'>lookupConCps</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Located</span> <span class='hs-conid'>RdrName</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>CpsRn</span> <span class='hs-layout'>(</span><span class='hs-conid'>Located</span> <span class='hs-conid'>Name</span><span class='hs-layout'>)</span>
<a name="line-35"></a><span class='hs-definition'>lookupConCps</span> <span class='hs-varid'>con_rdr</span> 
<a name="line-36"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>CpsRn</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>k</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span> <span class='hs-layout'>{</span> <span class='hs-varid'>con_name</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>lookupLocatedOccRn</span> <span class='hs-varid'>con_rdr</span>
<a name="line-37"></a>                    <span class='hs-layout'>;</span> <span class='hs-layout'>(</span><span class='hs-varid'>r</span><span class='hs-layout'>,</span> <span class='hs-varid'>fvs</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>k</span> <span class='hs-varid'>con_name</span>
<a name="line-38"></a>                    <span class='hs-layout'>;</span> <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>r</span><span class='hs-layout'>,</span> <span class='hs-varid'>addOneFV</span> <span class='hs-varid'>fvs</span> <span class='hs-layout'>(</span><span class='hs-varid'>unLoc</span> <span class='hs-varid'>con_name</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-39"></a>    <span class='hs-comment'>-- We add the constructor name to the free vars</span>
<a name="line-40"></a>    <span class='hs-comment'>-- See Note [Patterns are uses]</span>
</pre>\end{code}

Note [Patterns are uses]
~~~~~~~~~~~~~~~~~~~~~~~~
Consider
  module Foo( f, g ) where
  data T = T1 | T2

  f T1 = True
  f T2 = False

  g _ = T1

Arguably we should report T2 as unused, even though it appears in a
pattern, because it never occurs in a constructed position.  See
Trac #7336.
However, implementing this in the face of pattern synonyms would be
less straightforward, since given two pattern synonyms

  pattern P1 <- P2
  pattern P2 <- ()

we need to observe the dependency between P1 and P2 so that type
checking can be done in the correct order (just like for value
bindings). Dependencies between bindings is analyzed in the renamer,
where we don't know yet whether P2 is a constructor or a pattern
synonym. So for now, we do report conid occurrences in patterns as
uses.

%*********************************************************
%*                                                      *
        Name makers
%*                                                      *
%*********************************************************

Externally abstract type of name makers,
which is how you go from a RdrName to a Name

\begin{code}
<pre><a name="line-1"></a><a name="NameMaker"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>NameMaker</span> 
<a name="line-2"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>LamMk</span>       <span class='hs-comment'>-- Lambdas </span>
<a name="line-3"></a>      <span class='hs-conid'>Bool</span>      <span class='hs-comment'>-- True &lt;=&gt; report unused bindings</span>
<a name="line-4"></a>                <span class='hs-comment'>--   (even if True, the warning only comes out </span>
<a name="line-5"></a>                <span class='hs-comment'>--    if -fwarn-unused-matches is on)</span>
<a name="line-6"></a>
<a name="line-7"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LetMk</span>       <span class='hs-comment'>-- Let bindings, incl top level</span>
<a name="line-8"></a>                <span class='hs-comment'>-- Do *not* check for unused bindings</span>
<a name="line-9"></a>      <span class='hs-conid'>TopLevelFlag</span>
<a name="line-10"></a>      <span class='hs-conid'>MiniFixityEnv</span>
<a name="line-11"></a>
<a name="line-12"></a><a name="topRecNameMaker"></a><span class='hs-definition'>topRecNameMaker</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>MiniFixityEnv</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>NameMaker</span>
<a name="line-13"></a><span class='hs-definition'>topRecNameMaker</span> <span class='hs-varid'>fix_env</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>LetMk</span> <span class='hs-conid'>TopLevel</span> <span class='hs-varid'>fix_env</span>
<a name="line-14"></a>
<a name="line-15"></a><a name="isTopRecNameMaker"></a><span class='hs-definition'>isTopRecNameMaker</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>NameMaker</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-16"></a><span class='hs-definition'>isTopRecNameMaker</span> <span class='hs-layout'>(</span><span class='hs-conid'>LetMk</span> <span class='hs-conid'>TopLevel</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-17"></a><span class='hs-definition'>isTopRecNameMaker</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-18"></a>
<a name="line-19"></a><a name="localRecNameMaker"></a><span class='hs-definition'>localRecNameMaker</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>MiniFixityEnv</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>NameMaker</span>
<a name="line-20"></a><span class='hs-definition'>localRecNameMaker</span> <span class='hs-varid'>fix_env</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>LetMk</span> <span class='hs-conid'>NotTopLevel</span> <span class='hs-varid'>fix_env</span> 
<a name="line-21"></a>
<a name="line-22"></a><a name="matchNameMaker"></a><span class='hs-definition'>matchNameMaker</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsMatchContext</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>NameMaker</span>
<a name="line-23"></a><span class='hs-definition'>matchNameMaker</span> <span class='hs-varid'>ctxt</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>LamMk</span> <span class='hs-varid'>report_unused</span>
<a name="line-24"></a>  <span class='hs-keyword'>where</span>
<a name="line-25"></a>    <span class='hs-comment'>-- Do not report unused names in interactive contexts</span>
<a name="line-26"></a>    <span class='hs-comment'>-- i.e. when you type 'x &lt;- e' at the GHCi prompt</span>
<a name="line-27"></a>    <span class='hs-varid'>report_unused</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>ctxt</span> <span class='hs-keyword'>of</span>
<a name="line-28"></a>                      <span class='hs-conid'>StmtCtxt</span> <span class='hs-conid'>GhciStmtCtxt</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>False</span>
<a name="line-29"></a>                      <span class='hs-keyword'>_</span>                     <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>True</span>
<a name="line-30"></a>
<a name="line-31"></a><a name="rnHsSigCps"></a><span class='hs-definition'>rnHsSigCps</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsWithBndrs</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsType</span> <span class='hs-conid'>RdrName</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>CpsRn</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsWithBndrs</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsType</span> <span class='hs-conid'>Name</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-32"></a><span class='hs-definition'>rnHsSigCps</span> <span class='hs-varid'>sig</span> 
<a name="line-33"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>CpsRn</span> <span class='hs-layout'>(</span><span class='hs-varid'>rnHsBndrSig</span> <span class='hs-conid'>PatCtx</span> <span class='hs-varid'>sig</span><span class='hs-layout'>)</span>
<a name="line-34"></a>
<a name="line-35"></a><a name="newPatName"></a><span class='hs-definition'>newPatName</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>NameMaker</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Located</span> <span class='hs-conid'>RdrName</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>CpsRn</span> <span class='hs-conid'>Name</span>
<a name="line-36"></a><span class='hs-definition'>newPatName</span> <span class='hs-layout'>(</span><span class='hs-conid'>LamMk</span> <span class='hs-varid'>report_unused</span><span class='hs-layout'>)</span> <span class='hs-varid'>rdr_name</span>
<a name="line-37"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>CpsRn</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span> <span class='hs-varid'>thing_inside</span> <span class='hs-keyglyph'>-&gt;</span> 
<a name="line-38"></a>        <span class='hs-keyword'>do</span> <span class='hs-layout'>{</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>newLocalBndrRn</span> <span class='hs-varid'>rdr_name</span>
<a name="line-39"></a>           <span class='hs-layout'>;</span> <span class='hs-layout'>(</span><span class='hs-varid'>res</span><span class='hs-layout'>,</span> <span class='hs-varid'>fvs</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>bindLocalNames</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>name</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>(</span><span class='hs-varid'>thing_inside</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>
<a name="line-40"></a>           <span class='hs-layout'>;</span> <span class='hs-varid'>when</span> <span class='hs-varid'>report_unused</span> <span class='hs-varop'>$</span> <span class='hs-varid'>warnUnusedMatches</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>name</span><span class='hs-keyglyph'>]</span> <span class='hs-varid'>fvs</span>
<a name="line-41"></a>           <span class='hs-layout'>;</span> <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>res</span><span class='hs-layout'>,</span> <span class='hs-varid'>name</span> <span class='hs-varop'>`delFV`</span> <span class='hs-varid'>fvs</span><span class='hs-layout'>)</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-42"></a>
<a name="line-43"></a><span class='hs-definition'>newPatName</span> <span class='hs-layout'>(</span><span class='hs-conid'>LetMk</span> <span class='hs-varid'>is_top</span> <span class='hs-varid'>fix_env</span><span class='hs-layout'>)</span> <span class='hs-varid'>rdr_name</span>
<a name="line-44"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>CpsRn</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span> <span class='hs-varid'>thing_inside</span> <span class='hs-keyglyph'>-&gt;</span> 
<a name="line-45"></a>        <span class='hs-keyword'>do</span> <span class='hs-layout'>{</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>is_top</span> <span class='hs-keyword'>of</span>
<a name="line-46"></a>                       <span class='hs-conid'>NotTopLevel</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>newLocalBndrRn</span> <span class='hs-varid'>rdr_name</span>
<a name="line-47"></a>                       <span class='hs-conid'>TopLevel</span>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>newTopSrcBinder</span> <span class='hs-varid'>rdr_name</span>
<a name="line-48"></a>           <span class='hs-layout'>;</span> <span class='hs-varid'>bindLocalNames</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>name</span><span class='hs-keyglyph'>]</span> <span class='hs-varop'>$</span>       <span class='hs-comment'>-- Do *not* use bindLocalNameFV here</span>
<a name="line-49"></a>                                        <span class='hs-comment'>-- See Note [View pattern usage]</span>
<a name="line-50"></a>             <span class='hs-varid'>addLocalFixities</span> <span class='hs-varid'>fix_env</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>name</span><span class='hs-keyglyph'>]</span> <span class='hs-varop'>$</span>
<a name="line-51"></a>             <span class='hs-varid'>thing_inside</span> <span class='hs-varid'>name</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-52"></a>                          
<a name="line-53"></a>    <span class='hs-comment'>-- Note: the bindLocalNames is somewhat suspicious</span>
<a name="line-54"></a>    <span class='hs-comment'>--       because it binds a top-level name as a local name.</span>
<a name="line-55"></a>    <span class='hs-comment'>--       however, this binding seems to work, and it only exists for</span>
<a name="line-56"></a>    <span class='hs-comment'>--       the duration of the patterns and the continuation;</span>
<a name="line-57"></a>    <span class='hs-comment'>--       then the top-level name is added to the global env</span>
<a name="line-58"></a>    <span class='hs-comment'>--       before going on to the RHSes (see RnSource.lhs).</span>
</pre>\end{code}

Note [View pattern usage]
~~~~~~~~~~~~~~~~~~~~~~~~~
Consider
  let (r, (r -> x)) = x in ...
Here the pattern binds 'r', and then uses it *only* in the view pattern.
We want to "see" this use, and in let-bindings we collect all uses and
report unused variables at the binding level. So we must use bindLocalNames
here, *not* bindLocalNameFV.  Trac #3943.

%*********************************************************
%*                                                      *
        External entry points
%*                                                      *
%*********************************************************

There are various entry points to renaming patterns, depending on
 (1) whether the names created should be top-level names or local names
 (2) whether the scope of the names is entirely given in a continuation
     (e.g., in a case or lambda, but not in a let or at the top-level,
      because of the way mutually recursive bindings are handled)
 (3) whether the a type signature in the pattern can bind 
        lexically-scoped type variables (for unpacking existential 
        type vars in data constructors)
 (4) whether we do duplicate and unused variable checking
 (5) whether there are fixity declarations associated with the names
     bound by the patterns that need to be brought into scope with them.
     
 Rather than burdening the clients of this module with all of these choices,
 we export the three points in this design space that we actually need:

\begin{code}
<pre><a name="line-1"></a><a name="rnPats"></a><span class='hs-comment'>-- ----------- Entry point 1: rnPats -------------------</span>
<a name="line-2"></a><span class='hs-comment'>-- Binds local names; the scope of the bindings is entirely in the thing_inside</span>
<a name="line-3"></a><span class='hs-comment'>--   * allows type sigs to bind type vars</span>
<a name="line-4"></a><span class='hs-comment'>--   * local namemaker</span>
<a name="line-5"></a><span class='hs-comment'>--   * unused and duplicate checking</span>
<a name="line-6"></a><span class='hs-comment'>--   * no fixities</span>
<a name="line-7"></a><span class='hs-definition'>rnPats</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsMatchContext</span> <span class='hs-conid'>Name</span> <span class='hs-comment'>-- for error messages</span>
<a name="line-8"></a>       <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LPat</span> <span class='hs-conid'>RdrName</span><span class='hs-keyglyph'>]</span> 
<a name="line-9"></a>       <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>[</span><span class='hs-conid'>LPat</span> <span class='hs-conid'>Name</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>RnM</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-conid'>FreeVars</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-10"></a>       <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>RnM</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-conid'>FreeVars</span><span class='hs-layout'>)</span>
<a name="line-11"></a><span class='hs-definition'>rnPats</span> <span class='hs-varid'>ctxt</span> <span class='hs-varid'>pats</span> <span class='hs-varid'>thing_inside</span>
<a name="line-12"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>  <span class='hs-layout'>{</span> <span class='hs-varid'>envs_before</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getRdrEnvs</span>
<a name="line-13"></a>
<a name="line-14"></a>          <span class='hs-comment'>-- (1) rename the patterns, bringing into scope all of the term variables</span>
<a name="line-15"></a>          <span class='hs-comment'>-- (2) then do the thing inside.</span>
<a name="line-16"></a>        <span class='hs-layout'>;</span> <span class='hs-varid'>unCpsRn</span> <span class='hs-layout'>(</span><span class='hs-varid'>rnLPatsAndThen</span> <span class='hs-layout'>(</span><span class='hs-varid'>matchNameMaker</span> <span class='hs-varid'>ctxt</span><span class='hs-layout'>)</span> <span class='hs-varid'>pats</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span> <span class='hs-varid'>pats'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<a name="line-17"></a>        <span class='hs-layout'>{</span> <span class='hs-comment'>-- Check for duplicated and shadowed names </span>
<a name="line-18"></a>          <span class='hs-comment'>-- Must do this *after* renaming the patterns</span>
<a name="line-19"></a>          <span class='hs-comment'>-- See Note [Collect binders only after renaming] in HsUtils</span>
<a name="line-20"></a>          <span class='hs-comment'>-- Because we don't bind the vars all at once, we can't</span>
<a name="line-21"></a>          <span class='hs-comment'>--    check incrementally for duplicates; </span>
<a name="line-22"></a>          <span class='hs-comment'>-- Nor can we check incrementally for shadowing, else we'll</span>
<a name="line-23"></a>          <span class='hs-comment'>--    complain *twice* about duplicates e.g. f (x,x) = ...</span>
<a name="line-24"></a>        <span class='hs-layout'>;</span> <span class='hs-varid'>addErrCtxt</span> <span class='hs-varid'>doc_pat</span> <span class='hs-varop'>$</span> 
<a name="line-25"></a>          <span class='hs-varid'>checkDupAndShadowedNames</span> <span class='hs-varid'>envs_before</span> <span class='hs-varop'>$</span>
<a name="line-26"></a>          <span class='hs-varid'>collectPatsBinders</span> <span class='hs-varid'>pats'</span>
<a name="line-27"></a>        <span class='hs-layout'>;</span> <span class='hs-varid'>thing_inside</span> <span class='hs-varid'>pats'</span> <span class='hs-layout'>}</span> <span class='hs-layout'>}</span>
<a name="line-28"></a>  <span class='hs-keyword'>where</span>
<a name="line-29"></a>    <span class='hs-varid'>doc_pat</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"In"</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>pprMatchContext</span> <span class='hs-varid'>ctxt</span>
<a name="line-30"></a>
<a name="line-31"></a><a name="rnPat"></a><span class='hs-definition'>rnPat</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsMatchContext</span> <span class='hs-conid'>Name</span> <span class='hs-comment'>-- for error messages</span>
<a name="line-32"></a>      <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LPat</span> <span class='hs-conid'>RdrName</span> 
<a name="line-33"></a>      <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>LPat</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>RnM</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-conid'>FreeVars</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-34"></a>      <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>RnM</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-conid'>FreeVars</span><span class='hs-layout'>)</span>     <span class='hs-comment'>-- Variables bound by pattern do not </span>
<a name="line-35"></a>                               <span class='hs-comment'>-- appear in the result FreeVars </span>
<a name="line-36"></a><span class='hs-definition'>rnPat</span> <span class='hs-varid'>ctxt</span> <span class='hs-varid'>pat</span> <span class='hs-varid'>thing_inside</span> 
<a name="line-37"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>rnPats</span> <span class='hs-varid'>ctxt</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>pat</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>pats'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>let</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>pat'</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pats'</span> <span class='hs-keyword'>in</span> <span class='hs-varid'>thing_inside</span> <span class='hs-varid'>pat'</span><span class='hs-layout'>)</span>
<a name="line-38"></a>
<a name="line-39"></a><a name="applyNameMaker"></a><span class='hs-definition'>applyNameMaker</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>NameMaker</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Located</span> <span class='hs-conid'>RdrName</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>RnM</span> <span class='hs-conid'>Name</span>
<a name="line-40"></a><span class='hs-definition'>applyNameMaker</span> <span class='hs-varid'>mk</span> <span class='hs-varid'>rdr</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span> <span class='hs-layout'>{</span> <span class='hs-layout'>(</span><span class='hs-varid'>n</span><span class='hs-layout'>,</span> <span class='hs-sel'>_fvs</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>runCps</span> <span class='hs-layout'>(</span><span class='hs-varid'>newPatName</span> <span class='hs-varid'>mk</span> <span class='hs-varid'>rdr</span><span class='hs-layout'>)</span><span class='hs-layout'>;</span> <span class='hs-varid'>return</span> <span class='hs-varid'>n</span> <span class='hs-layout'>}</span>
<a name="line-41"></a>
<a name="line-42"></a><a name="rnBindPat"></a><span class='hs-comment'>-- ----------- Entry point 2: rnBindPat -------------------</span>
<a name="line-43"></a><span class='hs-comment'>-- Binds local names; in a recursive scope that involves other bound vars</span>
<a name="line-44"></a><span class='hs-comment'>--      e.g let { (x, Just y) = e1; ... } in ...</span>
<a name="line-45"></a><span class='hs-comment'>--   * does NOT allows type sig to bind type vars</span>
<a name="line-46"></a><span class='hs-comment'>--   * local namemaker</span>
<a name="line-47"></a><span class='hs-comment'>--   * no unused and duplicate checking</span>
<a name="line-48"></a><span class='hs-comment'>--   * fixities might be coming in</span>
<a name="line-49"></a><span class='hs-definition'>rnBindPat</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>NameMaker</span>
<a name="line-50"></a>          <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LPat</span> <span class='hs-conid'>RdrName</span>
<a name="line-51"></a>          <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>RnM</span> <span class='hs-layout'>(</span><span class='hs-conid'>LPat</span> <span class='hs-conid'>Name</span><span class='hs-layout'>,</span> <span class='hs-conid'>FreeVars</span><span class='hs-layout'>)</span>
<a name="line-52"></a>   <span class='hs-comment'>-- Returned FreeVars are the free variables of the pattern,</span>
<a name="line-53"></a>   <span class='hs-comment'>-- of course excluding variables bound by this pattern </span>
<a name="line-54"></a>
<a name="line-55"></a><span class='hs-definition'>rnBindPat</span> <span class='hs-varid'>name_maker</span> <span class='hs-varid'>pat</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>runCps</span> <span class='hs-layout'>(</span><span class='hs-varid'>rnLPatAndThen</span> <span class='hs-varid'>name_maker</span> <span class='hs-varid'>pat</span><span class='hs-layout'>)</span>
</pre>\end{code}


%*********************************************************
%*                                                      *
        The main event
%*                                                      *
%*********************************************************

\begin{code}
<pre><a name="line-1"></a><span class='hs-comment'>-- ----------- Entry point 3: rnLPatAndThen -------------------</span>
<a name="line-2"></a><span class='hs-comment'>-- General version: parametrized by how you make new names</span>
<a name="line-3"></a>
<a name="line-4"></a><a name="rnLPatsAndThen"></a><span class='hs-definition'>rnLPatsAndThen</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>NameMaker</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LPat</span> <span class='hs-conid'>RdrName</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>CpsRn</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LPat</span> <span class='hs-conid'>Name</span><span class='hs-keyglyph'>]</span>
<a name="line-5"></a><span class='hs-definition'>rnLPatsAndThen</span> <span class='hs-varid'>mk</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mapM</span> <span class='hs-layout'>(</span><span class='hs-varid'>rnLPatAndThen</span> <span class='hs-varid'>mk</span><span class='hs-layout'>)</span>
<a name="line-6"></a>  <span class='hs-comment'>-- Despite the map, the monad ensures that each pattern binds</span>
<a name="line-7"></a>  <span class='hs-comment'>-- variables that may be mentioned in subsequent patterns in the list</span>
<a name="line-8"></a>
<a name="line-9"></a><a name="rnLPatAndThen"></a><span class='hs-comment'>--------------------</span>
<a name="line-10"></a><span class='hs-comment'>-- The workhorse</span>
<a name="line-11"></a><span class='hs-definition'>rnLPatAndThen</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>NameMaker</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LPat</span> <span class='hs-conid'>RdrName</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>CpsRn</span> <span class='hs-layout'>(</span><span class='hs-conid'>LPat</span> <span class='hs-conid'>Name</span><span class='hs-layout'>)</span>
<a name="line-12"></a><span class='hs-definition'>rnLPatAndThen</span> <span class='hs-varid'>nm</span> <span class='hs-varid'>lpat</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>wrapSrcSpanCps</span> <span class='hs-layout'>(</span><span class='hs-varid'>rnPatAndThen</span> <span class='hs-varid'>nm</span><span class='hs-layout'>)</span> <span class='hs-varid'>lpat</span>
<a name="line-13"></a>
<a name="line-14"></a><a name="rnPatAndThen"></a><span class='hs-definition'>rnPatAndThen</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>NameMaker</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Pat</span> <span class='hs-conid'>RdrName</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>CpsRn</span> <span class='hs-layout'>(</span><span class='hs-conid'>Pat</span> <span class='hs-conid'>Name</span><span class='hs-layout'>)</span>
<a name="line-15"></a><span class='hs-definition'>rnPatAndThen</span> <span class='hs-keyword'>_</span>  <span class='hs-layout'>(</span><span class='hs-conid'>WildPat</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-conid'>WildPat</span> <span class='hs-varid'>placeHolderType</span><span class='hs-layout'>)</span>
<a name="line-16"></a><span class='hs-definition'>rnPatAndThen</span> <span class='hs-varid'>mk</span> <span class='hs-layout'>(</span><span class='hs-conid'>ParPat</span> <span class='hs-varid'>pat</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span> <span class='hs-layout'>{</span> <span class='hs-varid'>pat'</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>rnLPatAndThen</span> <span class='hs-varid'>mk</span> <span class='hs-varid'>pat</span><span class='hs-layout'>;</span> <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-conid'>ParPat</span> <span class='hs-varid'>pat'</span><span class='hs-layout'>)</span> <span class='hs-layout'>}</span>
<a name="line-17"></a><span class='hs-definition'>rnPatAndThen</span> <span class='hs-varid'>mk</span> <span class='hs-layout'>(</span><span class='hs-conid'>LazyPat</span> <span class='hs-varid'>pat</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span> <span class='hs-layout'>{</span> <span class='hs-varid'>pat'</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>rnLPatAndThen</span> <span class='hs-varid'>mk</span> <span class='hs-varid'>pat</span><span class='hs-layout'>;</span> <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-conid'>LazyPat</span> <span class='hs-varid'>pat'</span><span class='hs-layout'>)</span> <span class='hs-layout'>}</span>
<a name="line-18"></a><span class='hs-definition'>rnPatAndThen</span> <span class='hs-varid'>mk</span> <span class='hs-layout'>(</span><span class='hs-conid'>BangPat</span> <span class='hs-varid'>pat</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span> <span class='hs-layout'>{</span> <span class='hs-varid'>pat'</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>rnLPatAndThen</span> <span class='hs-varid'>mk</span> <span class='hs-varid'>pat</span><span class='hs-layout'>;</span> <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-conid'>BangPat</span> <span class='hs-varid'>pat'</span><span class='hs-layout'>)</span> <span class='hs-layout'>}</span>
<a name="line-19"></a><span class='hs-definition'>rnPatAndThen</span> <span class='hs-varid'>mk</span> <span class='hs-layout'>(</span><span class='hs-conid'>VarPat</span> <span class='hs-varid'>rdr</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span> <span class='hs-layout'>{</span> <span class='hs-varid'>loc</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>liftCps</span> <span class='hs-varid'>getSrcSpanM</span>
<a name="line-20"></a>                                   <span class='hs-layout'>;</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>newPatName</span> <span class='hs-varid'>mk</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-varid'>loc</span> <span class='hs-varid'>rdr</span><span class='hs-layout'>)</span>
<a name="line-21"></a>                                   <span class='hs-layout'>;</span> <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-conid'>VarPat</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-layout'>}</span>
<a name="line-22"></a>     <span class='hs-comment'>-- we need to bind pattern variables for view pattern expressions</span>
<a name="line-23"></a>     <span class='hs-comment'>-- (e.g. in the pattern (x, x -&gt; y) x needs to be bound in the rhs of the tuple)</span>
<a name="line-24"></a>                                     
<a name="line-25"></a><span class='hs-definition'>rnPatAndThen</span> <span class='hs-varid'>mk</span> <span class='hs-layout'>(</span><span class='hs-conid'>SigPatIn</span> <span class='hs-varid'>pat</span> <span class='hs-varid'>sig</span><span class='hs-layout'>)</span>
<a name="line-26"></a>  <span class='hs-comment'>-- When renaming a pattern type signature (e.g. f (a :: T) = ...), it is</span>
<a name="line-27"></a>  <span class='hs-comment'>-- important to rename its type signature _before_ renaming the rest of the</span>
<a name="line-28"></a>  <span class='hs-comment'>-- pattern, so that type variables are first bound by the _outermost_ pattern</span>
<a name="line-29"></a>  <span class='hs-comment'>-- type signature they occur in. This keeps the type checker happy when</span>
<a name="line-30"></a>  <span class='hs-comment'>-- pattern type signatures happen to be nested (#7827)</span>
<a name="line-31"></a>  <span class='hs-comment'>--</span>
<a name="line-32"></a>  <span class='hs-comment'>-- f ((Just (x :: a) :: Maybe a)</span>
<a name="line-33"></a>  <span class='hs-comment'>-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~^       `a' is first bound here</span>
<a name="line-34"></a>  <span class='hs-comment'>-- ~~~~~~~~~~~~~~~^                   the same `a' then used here</span>
<a name="line-35"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span> <span class='hs-layout'>{</span> <span class='hs-varid'>sig'</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>rnHsSigCps</span> <span class='hs-varid'>sig</span>
<a name="line-36"></a>       <span class='hs-layout'>;</span> <span class='hs-varid'>pat'</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>rnLPatAndThen</span> <span class='hs-varid'>mk</span> <span class='hs-varid'>pat</span>
<a name="line-37"></a>       <span class='hs-layout'>;</span> <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-conid'>SigPatIn</span> <span class='hs-varid'>pat'</span> <span class='hs-varid'>sig'</span><span class='hs-layout'>)</span> <span class='hs-layout'>}</span>
<a name="line-38"></a>       
<a name="line-39"></a><span class='hs-definition'>rnPatAndThen</span> <span class='hs-varid'>mk</span> <span class='hs-layout'>(</span><span class='hs-conid'>LitPat</span> <span class='hs-varid'>lit</span><span class='hs-layout'>)</span>
<a name="line-40"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsString</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>lit</span>
<a name="line-41"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span> <span class='hs-layout'>{</span> <span class='hs-varid'>ovlStr</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>liftCps</span> <span class='hs-layout'>(</span><span class='hs-varid'>xoptM</span> <span class='hs-conid'>Opt_OverloadedStrings</span><span class='hs-layout'>)</span>
<a name="line-42"></a>       <span class='hs-layout'>;</span> <span class='hs-keyword'>if</span> <span class='hs-varid'>ovlStr</span> 
<a name="line-43"></a>         <span class='hs-keyword'>then</span> <span class='hs-varid'>rnPatAndThen</span> <span class='hs-varid'>mk</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkNPat</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkHsIsString</span> <span class='hs-varid'>s</span> <span class='hs-varid'>placeHolderType</span><span class='hs-layout'>)</span> <span class='hs-conid'>Nothing</span><span class='hs-layout'>)</span>
<a name="line-44"></a>         <span class='hs-keyword'>else</span> <span class='hs-varid'>normal_lit</span> <span class='hs-layout'>}</span>
<a name="line-45"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>normal_lit</span>
<a name="line-46"></a>  <span class='hs-keyword'>where</span>
<a name="line-47"></a>    <span class='hs-varid'>normal_lit</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span> <span class='hs-layout'>{</span> <span class='hs-varid'>liftCps</span> <span class='hs-layout'>(</span><span class='hs-varid'>rnLit</span> <span class='hs-varid'>lit</span><span class='hs-layout'>)</span><span class='hs-layout'>;</span> <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-conid'>LitPat</span> <span class='hs-varid'>lit</span><span class='hs-layout'>)</span> <span class='hs-layout'>}</span>
<a name="line-48"></a>
<a name="line-49"></a><span class='hs-definition'>rnPatAndThen</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>NPat</span> <span class='hs-varid'>lit</span> <span class='hs-varid'>mb_neg</span> <span class='hs-sel'>_eq</span><span class='hs-layout'>)</span>
<a name="line-50"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span> <span class='hs-layout'>{</span> <span class='hs-varid'>lit'</span>    <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>liftCpsFV</span> <span class='hs-varop'>$</span> <span class='hs-varid'>rnOverLit</span> <span class='hs-varid'>lit</span>
<a name="line-51"></a>       <span class='hs-layout'>;</span> <span class='hs-varid'>mb_neg'</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>liftCpsFV</span> <span class='hs-varop'>$</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>mb_neg</span> <span class='hs-keyword'>of</span>
<a name="line-52"></a>                      <span class='hs-conid'>Nothing</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-conid'>Nothing</span><span class='hs-layout'>,</span> <span class='hs-varid'>emptyFVs</span><span class='hs-layout'>)</span>
<a name="line-53"></a>                      <span class='hs-conid'>Just</span> <span class='hs-keyword'>_</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span> <span class='hs-layout'>{</span> <span class='hs-layout'>(</span><span class='hs-varid'>neg</span><span class='hs-layout'>,</span> <span class='hs-varid'>fvs</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>lookupSyntaxName</span> <span class='hs-varid'>negateName</span>
<a name="line-54"></a>                                    <span class='hs-layout'>;</span> <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-varid'>neg</span><span class='hs-layout'>,</span> <span class='hs-varid'>fvs</span><span class='hs-layout'>)</span> <span class='hs-layout'>}</span>
<a name="line-55"></a>       <span class='hs-layout'>;</span> <span class='hs-varid'>eq'</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>liftCpsFV</span> <span class='hs-varop'>$</span> <span class='hs-varid'>lookupSyntaxName</span> <span class='hs-varid'>eqName</span>
<a name="line-56"></a>       <span class='hs-layout'>;</span> <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-conid'>NPat</span> <span class='hs-varid'>lit'</span> <span class='hs-varid'>mb_neg'</span> <span class='hs-varid'>eq'</span><span class='hs-layout'>)</span> <span class='hs-layout'>}</span>
<a name="line-57"></a>
<a name="line-58"></a><span class='hs-definition'>rnPatAndThen</span> <span class='hs-varid'>mk</span> <span class='hs-layout'>(</span><span class='hs-conid'>NPlusKPat</span> <span class='hs-varid'>rdr</span> <span class='hs-varid'>lit</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>
<a name="line-59"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span> <span class='hs-layout'>{</span> <span class='hs-varid'>new_name</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>newPatName</span> <span class='hs-varid'>mk</span> <span class='hs-varid'>rdr</span>
<a name="line-60"></a>       <span class='hs-layout'>;</span> <span class='hs-varid'>lit'</span>  <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>liftCpsFV</span> <span class='hs-varop'>$</span> <span class='hs-varid'>rnOverLit</span> <span class='hs-varid'>lit</span>
<a name="line-61"></a>       <span class='hs-layout'>;</span> <span class='hs-varid'>minus</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>liftCpsFV</span> <span class='hs-varop'>$</span> <span class='hs-varid'>lookupSyntaxName</span> <span class='hs-varid'>minusName</span>
<a name="line-62"></a>       <span class='hs-layout'>;</span> <span class='hs-varid'>ge</span>    <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>liftCpsFV</span> <span class='hs-varop'>$</span> <span class='hs-varid'>lookupSyntaxName</span> <span class='hs-varid'>geName</span>
<a name="line-63"></a>       <span class='hs-layout'>;</span> <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-conid'>NPlusKPat</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-layout'>(</span><span class='hs-varid'>nameSrcSpan</span> <span class='hs-varid'>new_name</span><span class='hs-layout'>)</span> <span class='hs-varid'>new_name</span><span class='hs-layout'>)</span> <span class='hs-varid'>lit'</span> <span class='hs-varid'>ge</span> <span class='hs-varid'>minus</span><span class='hs-layout'>)</span> <span class='hs-layout'>}</span>
<a name="line-64"></a>                <span class='hs-comment'>-- The Report says that n+k patterns must be in Integral</span>
<a name="line-65"></a>
<a name="line-66"></a><span class='hs-definition'>rnPatAndThen</span> <span class='hs-varid'>mk</span> <span class='hs-layout'>(</span><span class='hs-conid'>AsPat</span> <span class='hs-varid'>rdr</span> <span class='hs-varid'>pat</span><span class='hs-layout'>)</span>
<a name="line-67"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span> <span class='hs-layout'>{</span> <span class='hs-varid'>new_name</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>newPatName</span> <span class='hs-varid'>mk</span> <span class='hs-varid'>rdr</span>
<a name="line-68"></a>       <span class='hs-layout'>;</span> <span class='hs-varid'>pat'</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>rnLPatAndThen</span> <span class='hs-varid'>mk</span> <span class='hs-varid'>pat</span>
<a name="line-69"></a>       <span class='hs-layout'>;</span> <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-conid'>AsPat</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-layout'>(</span><span class='hs-varid'>nameSrcSpan</span> <span class='hs-varid'>new_name</span><span class='hs-layout'>)</span> <span class='hs-varid'>new_name</span><span class='hs-layout'>)</span> <span class='hs-varid'>pat'</span><span class='hs-layout'>)</span> <span class='hs-layout'>}</span>
<a name="line-70"></a>
<a name="line-71"></a><span class='hs-definition'>rnPatAndThen</span> <span class='hs-varid'>mk</span> <span class='hs-varid'>p</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-conid'>ViewPat</span> <span class='hs-varid'>expr</span> <span class='hs-varid'>pat</span> <span class='hs-varid'>ty</span><span class='hs-layout'>)</span>
<a name="line-72"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span> <span class='hs-layout'>{</span> <span class='hs-varid'>liftCps</span> <span class='hs-varop'>$</span> <span class='hs-keyword'>do</span> <span class='hs-layout'>{</span> <span class='hs-varid'>vp_flag</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>xoptM</span> <span class='hs-conid'>Opt_ViewPatterns</span>
<a name="line-73"></a>                      <span class='hs-layout'>;</span> <span class='hs-varid'>checkErr</span> <span class='hs-varid'>vp_flag</span> <span class='hs-layout'>(</span><span class='hs-varid'>badViewPat</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-layout'>}</span>
<a name="line-74"></a>         <span class='hs-comment'>-- Because of the way we're arranging the recursive calls,</span>
<a name="line-75"></a>         <span class='hs-comment'>-- this will be in the right context </span>
<a name="line-76"></a>       <span class='hs-layout'>;</span> <span class='hs-varid'>expr'</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>liftCpsFV</span> <span class='hs-varop'>$</span> <span class='hs-varid'>rnLExpr</span> <span class='hs-varid'>expr</span> 
<a name="line-77"></a>       <span class='hs-layout'>;</span> <span class='hs-varid'>pat'</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>rnLPatAndThen</span> <span class='hs-varid'>mk</span> <span class='hs-varid'>pat</span>
<a name="line-78"></a>       <span class='hs-layout'>;</span> <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-conid'>ViewPat</span> <span class='hs-varid'>expr'</span> <span class='hs-varid'>pat'</span> <span class='hs-varid'>ty</span><span class='hs-layout'>)</span> <span class='hs-layout'>}</span>
<a name="line-79"></a>
<a name="line-80"></a><span class='hs-definition'>rnPatAndThen</span> <span class='hs-varid'>mk</span> <span class='hs-layout'>(</span><span class='hs-conid'>ConPatIn</span> <span class='hs-varid'>con</span> <span class='hs-varid'>stuff</span><span class='hs-layout'>)</span>
<a name="line-81"></a>   <span class='hs-comment'>-- rnConPatAndThen takes care of reconstructing the pattern</span>
<a name="line-82"></a>   <span class='hs-comment'>-- The pattern for the empty list needs to be replaced by an empty explicit list pattern when overloaded lists is turned on.</span>
<a name="line-83"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>unLoc</span> <span class='hs-varid'>con</span> <span class='hs-varop'>==</span> <span class='hs-varid'>nameRdrName</span> <span class='hs-layout'>(</span><span class='hs-varid'>dataConName</span> <span class='hs-varid'>nilDataCon</span><span class='hs-layout'>)</span> <span class='hs-keyword'>of</span>
<a name="line-84"></a>      <span class='hs-conid'>True</span>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span> <span class='hs-layout'>{</span> <span class='hs-varid'>ol_flag</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>liftCps</span> <span class='hs-varop'>$</span> <span class='hs-varid'>xoptM</span> <span class='hs-conid'>Opt_OverloadedLists</span>
<a name="line-85"></a>                    <span class='hs-layout'>;</span> <span class='hs-keyword'>if</span> <span class='hs-varid'>ol_flag</span> <span class='hs-keyword'>then</span> <span class='hs-varid'>rnPatAndThen</span> <span class='hs-varid'>mk</span> <span class='hs-layout'>(</span><span class='hs-conid'>ListPat</span> <span class='hs-conid'>[]</span> <span class='hs-varid'>placeHolderType</span> <span class='hs-conid'>Nothing</span><span class='hs-layout'>)</span>
<a name="line-86"></a>                                 <span class='hs-keyword'>else</span> <span class='hs-varid'>rnConPatAndThen</span> <span class='hs-varid'>mk</span> <span class='hs-varid'>con</span> <span class='hs-varid'>stuff</span><span class='hs-layout'>}</span> 
<a name="line-87"></a>      <span class='hs-conid'>False</span>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>rnConPatAndThen</span> <span class='hs-varid'>mk</span> <span class='hs-varid'>con</span> <span class='hs-varid'>stuff</span>
<a name="line-88"></a>
<a name="line-89"></a><span class='hs-definition'>rnPatAndThen</span> <span class='hs-varid'>mk</span> <span class='hs-layout'>(</span><span class='hs-conid'>ListPat</span> <span class='hs-varid'>pats</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>
<a name="line-90"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span> <span class='hs-layout'>{</span> <span class='hs-varid'>opt_OverloadedLists</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>liftCps</span> <span class='hs-varop'>$</span> <span class='hs-varid'>xoptM</span> <span class='hs-conid'>Opt_OverloadedLists</span>
<a name="line-91"></a>       <span class='hs-layout'>;</span> <span class='hs-varid'>pats'</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>rnLPatsAndThen</span> <span class='hs-varid'>mk</span> <span class='hs-varid'>pats</span>
<a name="line-92"></a>       <span class='hs-layout'>;</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>opt_OverloadedLists</span> <span class='hs-keyword'>of</span>
<a name="line-93"></a>          <span class='hs-conid'>True</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>   <span class='hs-layout'>{</span> <span class='hs-layout'>(</span><span class='hs-varid'>to_list_name</span><span class='hs-layout'>,</span><span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>liftCps</span> <span class='hs-varop'>$</span> <span class='hs-varid'>lookupSyntaxName</span> <span class='hs-varid'>toListName</span>
<a name="line-94"></a>                       <span class='hs-layout'>;</span> <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-conid'>ListPat</span> <span class='hs-varid'>pats'</span> <span class='hs-varid'>placeHolderType</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-varid'>placeHolderType</span><span class='hs-layout'>,</span> <span class='hs-varid'>to_list_name</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>}</span>
<a name="line-95"></a>          <span class='hs-conid'>False</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-conid'>ListPat</span> <span class='hs-varid'>pats'</span> <span class='hs-varid'>placeHolderType</span> <span class='hs-conid'>Nothing</span><span class='hs-layout'>)</span> <span class='hs-layout'>}</span>
<a name="line-96"></a>
<a name="line-97"></a><span class='hs-definition'>rnPatAndThen</span> <span class='hs-varid'>mk</span> <span class='hs-layout'>(</span><span class='hs-conid'>PArrPat</span> <span class='hs-varid'>pats</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>
<a name="line-98"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span> <span class='hs-layout'>{</span> <span class='hs-varid'>pats'</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>rnLPatsAndThen</span> <span class='hs-varid'>mk</span> <span class='hs-varid'>pats</span>
<a name="line-99"></a>       <span class='hs-layout'>;</span> <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-conid'>PArrPat</span> <span class='hs-varid'>pats'</span> <span class='hs-varid'>placeHolderType</span><span class='hs-layout'>)</span> <span class='hs-layout'>}</span>
<a name="line-100"></a>
<a name="line-101"></a><span class='hs-definition'>rnPatAndThen</span> <span class='hs-varid'>mk</span> <span class='hs-layout'>(</span><span class='hs-conid'>TuplePat</span> <span class='hs-varid'>pats</span> <span class='hs-varid'>boxed</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>
<a name="line-102"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span> <span class='hs-layout'>{</span> <span class='hs-varid'>liftCps</span> <span class='hs-varop'>$</span> <span class='hs-varid'>checkTupSize</span> <span class='hs-layout'>(</span><span class='hs-varid'>length</span> <span class='hs-varid'>pats</span><span class='hs-layout'>)</span>
<a name="line-103"></a>       <span class='hs-layout'>;</span> <span class='hs-varid'>pats'</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>rnLPatsAndThen</span> <span class='hs-varid'>mk</span> <span class='hs-varid'>pats</span>
<a name="line-104"></a>       <span class='hs-layout'>;</span> <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-conid'>TuplePat</span> <span class='hs-varid'>pats'</span> <span class='hs-varid'>boxed</span> <span class='hs-conid'>[]</span><span class='hs-layout'>)</span> <span class='hs-layout'>}</span>
<a name="line-105"></a>
<a name="line-106"></a><span class='hs-definition'>rnPatAndThen</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>SplicePat</span> <span class='hs-varid'>splice</span><span class='hs-layout'>)</span>
<a name="line-107"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span> <span class='hs-layout'>{</span> <span class='hs-comment'>-- XXX How to deal with free variables?</span>
<a name="line-108"></a>       <span class='hs-layout'>;</span> <span class='hs-layout'>(</span><span class='hs-varid'>pat</span><span class='hs-layout'>,</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>liftCps</span> <span class='hs-varop'>$</span> <span class='hs-varid'>rnSplicePat</span> <span class='hs-varid'>splice</span>
<a name="line-109"></a>       <span class='hs-layout'>;</span> <span class='hs-varid'>return</span> <span class='hs-varid'>pat</span> <span class='hs-layout'>}</span>
<a name="line-110"></a><span class='hs-definition'>rnPatAndThen</span> <span class='hs-varid'>mk</span> <span class='hs-layout'>(</span><span class='hs-conid'>QuasiQuotePat</span> <span class='hs-varid'>qq</span><span class='hs-layout'>)</span>
<a name="line-111"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span> <span class='hs-layout'>{</span> <span class='hs-varid'>pat</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>liftCps</span> <span class='hs-varop'>$</span> <span class='hs-varid'>runQuasiQuotePat</span> <span class='hs-varid'>qq</span>
<a name="line-112"></a>         <span class='hs-comment'>-- Wrap the result of the quasi-quoter in parens so that we don't</span>
<a name="line-113"></a>         <span class='hs-comment'>-- lose the outermost location set by runQuasiQuote (#7918) </span>
<a name="line-114"></a>       <span class='hs-layout'>;</span> <span class='hs-varid'>rnPatAndThen</span> <span class='hs-varid'>mk</span> <span class='hs-layout'>(</span><span class='hs-conid'>ParPat</span> <span class='hs-varid'>pat</span><span class='hs-layout'>)</span> <span class='hs-layout'>}</span>
<a name="line-115"></a>
<a name="line-116"></a><span class='hs-definition'>rnPatAndThen</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>pat</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprPanic</span> <span class='hs-str'>"rnLPatAndThen"</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>pat</span><span class='hs-layout'>)</span>
<a name="line-117"></a>
<a name="line-118"></a>
<a name="line-119"></a><a name="rnConPatAndThen"></a><span class='hs-comment'>--------------------</span>
<a name="line-120"></a><span class='hs-definition'>rnConPatAndThen</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>NameMaker</span>
<a name="line-121"></a>                <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Located</span> <span class='hs-conid'>RdrName</span>          <span class='hs-comment'>-- the constructor</span>
<a name="line-122"></a>                <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HsConPatDetails</span> <span class='hs-conid'>RdrName</span> 
<a name="line-123"></a>                <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>CpsRn</span> <span class='hs-layout'>(</span><span class='hs-conid'>Pat</span> <span class='hs-conid'>Name</span><span class='hs-layout'>)</span>
<a name="line-124"></a>
<a name="line-125"></a><span class='hs-definition'>rnConPatAndThen</span> <span class='hs-varid'>mk</span> <span class='hs-varid'>con</span> <span class='hs-layout'>(</span><span class='hs-conid'>PrefixCon</span> <span class='hs-varid'>pats</span><span class='hs-layout'>)</span>
<a name="line-126"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>  <span class='hs-layout'>{</span> <span class='hs-varid'>con'</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>lookupConCps</span> <span class='hs-varid'>con</span>
<a name="line-127"></a>        <span class='hs-layout'>;</span> <span class='hs-varid'>pats'</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>rnLPatsAndThen</span> <span class='hs-varid'>mk</span> <span class='hs-varid'>pats</span>
<a name="line-128"></a>        <span class='hs-layout'>;</span> <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-conid'>ConPatIn</span> <span class='hs-varid'>con'</span> <span class='hs-layout'>(</span><span class='hs-conid'>PrefixCon</span> <span class='hs-varid'>pats'</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-layout'>}</span>
<a name="line-129"></a>
<a name="line-130"></a><span class='hs-definition'>rnConPatAndThen</span> <span class='hs-varid'>mk</span> <span class='hs-varid'>con</span> <span class='hs-layout'>(</span><span class='hs-conid'>InfixCon</span> <span class='hs-varid'>pat1</span> <span class='hs-varid'>pat2</span><span class='hs-layout'>)</span>
<a name="line-131"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>  <span class='hs-layout'>{</span> <span class='hs-varid'>con'</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>lookupConCps</span> <span class='hs-varid'>con</span>
<a name="line-132"></a>        <span class='hs-layout'>;</span> <span class='hs-varid'>pat1'</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>rnLPatAndThen</span> <span class='hs-varid'>mk</span> <span class='hs-varid'>pat1</span>
<a name="line-133"></a>        <span class='hs-layout'>;</span> <span class='hs-varid'>pat2'</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>rnLPatAndThen</span> <span class='hs-varid'>mk</span> <span class='hs-varid'>pat2</span>
<a name="line-134"></a>        <span class='hs-layout'>;</span> <span class='hs-varid'>fixity</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>liftCps</span> <span class='hs-varop'>$</span> <span class='hs-varid'>lookupFixityRn</span> <span class='hs-layout'>(</span><span class='hs-varid'>unLoc</span> <span class='hs-varid'>con'</span><span class='hs-layout'>)</span>
<a name="line-135"></a>        <span class='hs-layout'>;</span> <span class='hs-varid'>liftCps</span> <span class='hs-varop'>$</span> <span class='hs-varid'>mkConOpPatRn</span> <span class='hs-varid'>con'</span> <span class='hs-varid'>fixity</span> <span class='hs-varid'>pat1'</span> <span class='hs-varid'>pat2'</span> <span class='hs-layout'>}</span>
<a name="line-136"></a>
<a name="line-137"></a><span class='hs-definition'>rnConPatAndThen</span> <span class='hs-varid'>mk</span> <span class='hs-varid'>con</span> <span class='hs-layout'>(</span><span class='hs-conid'>RecCon</span> <span class='hs-varid'>rpats</span><span class='hs-layout'>)</span>
<a name="line-138"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>  <span class='hs-layout'>{</span> <span class='hs-varid'>con'</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>lookupConCps</span> <span class='hs-varid'>con</span>
<a name="line-139"></a>        <span class='hs-layout'>;</span> <span class='hs-varid'>rpats'</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>rnHsRecPatsAndThen</span> <span class='hs-varid'>mk</span> <span class='hs-varid'>con'</span> <span class='hs-varid'>rpats</span>
<a name="line-140"></a>        <span class='hs-layout'>;</span> <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-conid'>ConPatIn</span> <span class='hs-varid'>con'</span> <span class='hs-layout'>(</span><span class='hs-conid'>RecCon</span> <span class='hs-varid'>rpats'</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-layout'>}</span>
<a name="line-141"></a>
<a name="line-142"></a><a name="rnHsRecPatsAndThen"></a><span class='hs-comment'>--------------------</span>
<a name="line-143"></a><span class='hs-definition'>rnHsRecPatsAndThen</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>NameMaker</span>
<a name="line-144"></a>                   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Located</span> <span class='hs-conid'>Name</span>      <span class='hs-comment'>-- Constructor</span>
<a name="line-145"></a>                   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HsRecFields</span> <span class='hs-conid'>RdrName</span> <span class='hs-layout'>(</span><span class='hs-conid'>LPat</span> <span class='hs-conid'>RdrName</span><span class='hs-layout'>)</span>
<a name="line-146"></a>                   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>CpsRn</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsRecFields</span> <span class='hs-conid'>Name</span> <span class='hs-layout'>(</span><span class='hs-conid'>LPat</span> <span class='hs-conid'>Name</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-147"></a><span class='hs-definition'>rnHsRecPatsAndThen</span> <span class='hs-varid'>mk</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>con</span><span class='hs-layout'>)</span> <span class='hs-varid'>hs_rec_fields</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-conid'>HsRecFields</span> <span class='hs-layout'>{</span> <span class='hs-varid'>rec_dotdot</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>dd</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-148"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span> <span class='hs-layout'>{</span> <span class='hs-varid'>flds</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>liftCpsFV</span> <span class='hs-varop'>$</span> <span class='hs-varid'>rnHsRecFields1</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsRecFieldPat</span> <span class='hs-varid'>con</span><span class='hs-layout'>)</span> <span class='hs-conid'>VarPat</span> <span class='hs-varid'>hs_rec_fields</span>
<a name="line-149"></a>       <span class='hs-layout'>;</span> <span class='hs-varid'>flds'</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>mapM</span> <span class='hs-varid'>rn_field</span> <span class='hs-layout'>(</span><span class='hs-varid'>flds</span> <span class='hs-varop'>`zip`</span> <span class='hs-keyglyph'>[</span><span class='hs-num'>1</span><span class='hs-keyglyph'>..</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-150"></a>       <span class='hs-layout'>;</span> <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsRecFields</span> <span class='hs-layout'>{</span> <span class='hs-varid'>rec_flds</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>flds'</span><span class='hs-layout'>,</span> <span class='hs-varid'>rec_dotdot</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>dd</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-layout'>}</span>
<a name="line-151"></a>  <span class='hs-keyword'>where</span> 
<a name="line-152"></a>    <span class='hs-varid'>rn_field</span> <span class='hs-layout'>(</span><span class='hs-varid'>fld</span><span class='hs-layout'>,</span> <span class='hs-varid'>n'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span> <span class='hs-layout'>{</span> <span class='hs-varid'>arg'</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>rnLPatAndThen</span> <span class='hs-layout'>(</span><span class='hs-varid'>nested_mk</span> <span class='hs-varid'>dd</span> <span class='hs-varid'>mk</span> <span class='hs-varid'>n'</span><span class='hs-layout'>)</span> 
<a name="line-153"></a>                                                    <span class='hs-layout'>(</span><span class='hs-varid'>hsRecFieldArg</span> <span class='hs-varid'>fld</span><span class='hs-layout'>)</span>
<a name="line-154"></a>                            <span class='hs-layout'>;</span> <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>fld</span> <span class='hs-layout'>{</span> <span class='hs-varid'>hsRecFieldArg</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>arg'</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-layout'>}</span>
<a name="line-155"></a>
<a name="line-156"></a>        <span class='hs-comment'>-- Suppress unused-match reporting for fields introduced by ".."</span>
<a name="line-157"></a>    <span class='hs-varid'>nested_mk</span> <span class='hs-conid'>Nothing</span>  <span class='hs-varid'>mk</span>                    <span class='hs-keyword'>_</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mk</span>
<a name="line-158"></a>    <span class='hs-varid'>nested_mk</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-varid'>mk</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-conid'>LetMk</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>         <span class='hs-keyword'>_</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mk</span>
<a name="line-159"></a>    <span class='hs-varid'>nested_mk</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>LamMk</span> <span class='hs-varid'>report_unused</span><span class='hs-layout'>)</span> <span class='hs-varid'>n'</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>LamMk</span> <span class='hs-layout'>(</span><span class='hs-varid'>report_unused</span> <span class='hs-varop'>&amp;&amp;</span> <span class='hs-layout'>(</span><span class='hs-varid'>n'</span> <span class='hs-varop'>&lt;=</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
</pre>\end{code}


%************************************************************************
%*                                                                      *
        Record fields
%*                                                                      *
%************************************************************************

\begin{code}
<pre><a name="line-1"></a><a name="HsRecFieldContext"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>HsRecFieldContext</span> 
<a name="line-2"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HsRecFieldCon</span> <span class='hs-conid'>Name</span>
<a name="line-3"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsRecFieldPat</span> <span class='hs-conid'>Name</span>
<a name="line-4"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsRecFieldUpd</span>
<a name="line-5"></a>
<a name="line-6"></a><a name="rnHsRecFields1"></a><span class='hs-definition'>rnHsRecFields1</span> 
<a name="line-7"></a>    <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>arg</span><span class='hs-varop'>.</span> 
<a name="line-8"></a>       <span class='hs-conid'>HsRecFieldContext</span>
<a name="line-9"></a>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>RdrName</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>arg</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- When punning, use this to build a new field</span>
<a name="line-10"></a>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HsRecFields</span> <span class='hs-conid'>RdrName</span> <span class='hs-layout'>(</span><span class='hs-conid'>Located</span> <span class='hs-varid'>arg</span><span class='hs-layout'>)</span>
<a name="line-11"></a>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>RnM</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>[</span><span class='hs-conid'>HsRecField</span> <span class='hs-conid'>Name</span> <span class='hs-layout'>(</span><span class='hs-conid'>Located</span> <span class='hs-varid'>arg</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span> <span class='hs-conid'>FreeVars</span><span class='hs-layout'>)</span>
<a name="line-12"></a>
<a name="line-13"></a><span class='hs-comment'>-- This supprisingly complicated pass</span>
<a name="line-14"></a><span class='hs-comment'>--   a) looks up the field name (possibly using disambiguation)</span>
<a name="line-15"></a><span class='hs-comment'>--   b) fills in puns and dot-dot stuff</span>
<a name="line-16"></a><span class='hs-comment'>-- When we we've finished, we've renamed the LHS, but not the RHS,</span>
<a name="line-17"></a><span class='hs-comment'>-- of each x=e binding</span>
<a name="line-18"></a>
<a name="line-19"></a><span class='hs-definition'>rnHsRecFields1</span> <span class='hs-varid'>ctxt</span> <span class='hs-varid'>mk_arg</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsRecFields</span> <span class='hs-layout'>{</span> <span class='hs-varid'>rec_flds</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>flds</span><span class='hs-layout'>,</span> <span class='hs-varid'>rec_dotdot</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>dotdot</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-20"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span> <span class='hs-layout'>{</span> <span class='hs-varid'>pun_ok</span>      <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>xoptM</span> <span class='hs-conid'>Opt_RecordPuns</span>
<a name="line-21"></a>       <span class='hs-layout'>;</span> <span class='hs-varid'>disambig_ok</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>xoptM</span> <span class='hs-conid'>Opt_DisambiguateRecordFields</span>
<a name="line-22"></a>       <span class='hs-layout'>;</span> <span class='hs-varid'>parent</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>check_disambiguation</span> <span class='hs-varid'>disambig_ok</span> <span class='hs-varid'>mb_con</span>
<a name="line-23"></a>       <span class='hs-layout'>;</span> <span class='hs-varid'>flds1</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>mapM</span> <span class='hs-layout'>(</span><span class='hs-varid'>rn_fld</span> <span class='hs-varid'>pun_ok</span> <span class='hs-varid'>parent</span><span class='hs-layout'>)</span> <span class='hs-varid'>flds</span>
<a name="line-24"></a>       <span class='hs-layout'>;</span> <span class='hs-varid'>mapM_</span> <span class='hs-layout'>(</span><span class='hs-varid'>addErr</span> <span class='hs-varop'>.</span> <span class='hs-varid'>dupFieldErr</span> <span class='hs-varid'>ctxt</span><span class='hs-layout'>)</span> <span class='hs-varid'>dup_flds</span>
<a name="line-25"></a>       <span class='hs-layout'>;</span> <span class='hs-varid'>dotdot_flds</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>rn_dotdot</span> <span class='hs-varid'>dotdot</span> <span class='hs-varid'>mb_con</span> <span class='hs-varid'>flds1</span>
<a name="line-26"></a>       <span class='hs-layout'>;</span> <span class='hs-keyword'>let</span> <span class='hs-varid'>all_flds</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>null</span> <span class='hs-varid'>dotdot_flds</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>flds1</span>
<a name="line-27"></a>                      <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>        <span class='hs-keyglyph'>=</span> <span class='hs-varid'>flds1</span> <span class='hs-varop'>++</span> <span class='hs-varid'>dotdot_flds</span>
<a name="line-28"></a>       <span class='hs-layout'>;</span> <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>all_flds</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkFVs</span> <span class='hs-layout'>(</span><span class='hs-varid'>getFieldIds</span> <span class='hs-varid'>all_flds</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-layout'>}</span>
<a name="line-29"></a>  <span class='hs-keyword'>where</span>
<a name="line-30"></a>    <span class='hs-varid'>mb_con</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>ctxt</span> <span class='hs-keyword'>of</span>
<a name="line-31"></a>                <span class='hs-conid'>HsRecFieldCon</span> <span class='hs-varid'>con</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>not</span> <span class='hs-layout'>(</span><span class='hs-varid'>isUnboundName</span> <span class='hs-varid'>con</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>con</span>
<a name="line-32"></a>                <span class='hs-conid'>HsRecFieldPat</span> <span class='hs-varid'>con</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>not</span> <span class='hs-layout'>(</span><span class='hs-varid'>isUnboundName</span> <span class='hs-varid'>con</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>con</span>
<a name="line-33"></a>                <span class='hs-sel'>_other</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Nothing</span>
<a name="line-34"></a>           <span class='hs-comment'>-- The unbound name test is because if the constructor </span>
<a name="line-35"></a>           <span class='hs-comment'>-- isn't in scope the constructor lookup will add an error</span>
<a name="line-36"></a>           <span class='hs-comment'>-- add an error, but still return an unbound name. </span>
<a name="line-37"></a>           <span class='hs-comment'>-- We don't want that to screw up the dot-dot fill-in stuff.</span>
<a name="line-38"></a>
<a name="line-39"></a>    <span class='hs-varid'>doc</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>mb_con</span> <span class='hs-keyword'>of</span>
<a name="line-40"></a>            <span class='hs-conid'>Nothing</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"constructor field name"</span><span class='hs-layout'>)</span>
<a name="line-41"></a>            <span class='hs-conid'>Just</span> <span class='hs-varid'>con</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"field of constructor"</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>quotes</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>con</span><span class='hs-layout'>)</span>
<a name="line-42"></a>
<a name="line-43"></a>    <span class='hs-varid'>rn_fld</span> <span class='hs-varid'>pun_ok</span> <span class='hs-varid'>parent</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsRecField</span> <span class='hs-layout'>{</span> <span class='hs-varid'>hsRecFieldId</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fld</span>
<a name="line-44"></a>                                     <span class='hs-layout'>,</span> <span class='hs-varid'>hsRecFieldArg</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>arg</span>
<a name="line-45"></a>                                     <span class='hs-layout'>,</span> <span class='hs-varid'>hsRecPun</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pun</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-46"></a>      <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span> <span class='hs-layout'>{</span> <span class='hs-varid'>fld'</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-varid'>loc</span> <span class='hs-varid'>fld_nm</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>wrapLocM</span> <span class='hs-layout'>(</span><span class='hs-varid'>lookupSubBndrOcc</span> <span class='hs-conid'>True</span> <span class='hs-varid'>parent</span> <span class='hs-varid'>doc</span><span class='hs-layout'>)</span> <span class='hs-varid'>fld</span>
<a name="line-47"></a>           <span class='hs-layout'>;</span> <span class='hs-varid'>arg'</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-keyword'>if</span> <span class='hs-varid'>pun</span> 
<a name="line-48"></a>                     <span class='hs-keyword'>then</span> <span class='hs-keyword'>do</span> <span class='hs-layout'>{</span> <span class='hs-varid'>checkErr</span> <span class='hs-varid'>pun_ok</span> <span class='hs-layout'>(</span><span class='hs-varid'>badPun</span> <span class='hs-varid'>fld</span><span class='hs-layout'>)</span>
<a name="line-49"></a>                             <span class='hs-layout'>;</span> <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-varid'>loc</span> <span class='hs-layout'>(</span><span class='hs-varid'>mk_arg</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkRdrUnqual</span> <span class='hs-layout'>(</span><span class='hs-varid'>nameOccName</span> <span class='hs-varid'>fld_nm</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-layout'>}</span>
<a name="line-50"></a>                     <span class='hs-keyword'>else</span> <span class='hs-varid'>return</span> <span class='hs-varid'>arg</span>
<a name="line-51"></a>           <span class='hs-layout'>;</span> <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsRecField</span> <span class='hs-layout'>{</span> <span class='hs-varid'>hsRecFieldId</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fld'</span>
<a name="line-52"></a>                                <span class='hs-layout'>,</span> <span class='hs-varid'>hsRecFieldArg</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>arg'</span>
<a name="line-53"></a>                                <span class='hs-layout'>,</span> <span class='hs-varid'>hsRecPun</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pun</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-layout'>}</span>
<a name="line-54"></a>
<a name="line-55"></a>    <span class='hs-varid'>rn_dotdot</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>Int</span>      <span class='hs-comment'>-- See Note [DotDot fields] in HsPat</span>
<a name="line-56"></a>              <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>Name</span>     <span class='hs-comment'>-- The constructor (Nothing for an update</span>
<a name="line-57"></a>                                <span class='hs-comment'>--    or out of scope constructor)</span>
<a name="line-58"></a>              <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>HsRecField</span> <span class='hs-conid'>Name</span> <span class='hs-layout'>(</span><span class='hs-conid'>Located</span> <span class='hs-varid'>arg</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>   <span class='hs-comment'>-- Explicit fields</span>
<a name="line-59"></a>              <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>RnM</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>HsRecField</span> <span class='hs-conid'>Name</span> <span class='hs-layout'>(</span><span class='hs-conid'>Located</span> <span class='hs-varid'>arg</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>   <span class='hs-comment'>-- Filled in .. fields</span>
<a name="line-60"></a>    <span class='hs-varid'>rn_dotdot</span> <span class='hs-conid'>Nothing</span> <span class='hs-sel'>_mb_con</span> <span class='hs-sel'>_flds</span>     <span class='hs-comment'>-- No ".." at all</span>
<a name="line-61"></a>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>return</span> <span class='hs-conid'>[]</span>
<a name="line-62"></a>    <span class='hs-varid'>rn_dotdot</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-conid'>Nothing</span> <span class='hs-sel'>_flds</span>   <span class='hs-comment'>-- ".." on record update</span>
<a name="line-63"></a>      <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span> <span class='hs-layout'>{</span> <span class='hs-varid'>addErr</span> <span class='hs-layout'>(</span><span class='hs-varid'>badDotDot</span> <span class='hs-varid'>ctxt</span><span class='hs-layout'>)</span><span class='hs-layout'>;</span> <span class='hs-varid'>return</span> <span class='hs-conid'>[]</span> <span class='hs-layout'>}</span>
<a name="line-64"></a>    <span class='hs-varid'>rn_dotdot</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-varid'>con</span><span class='hs-layout'>)</span> <span class='hs-varid'>flds</span> <span class='hs-comment'>-- ".." on record construction / pat match</span>
<a name="line-65"></a>      <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ASSERT</span><span class='hs-layout'>(</span> <span class='hs-varid'>n</span> <span class='hs-varop'>==</span> <span class='hs-varid'>length</span> <span class='hs-varid'>flds</span> <span class='hs-layout'>)</span>
<a name="line-66"></a>        <span class='hs-keyword'>do</span> <span class='hs-layout'>{</span> <span class='hs-varid'>loc</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getSrcSpanM</span> <span class='hs-comment'>-- Rather approximate</span>
<a name="line-67"></a>           <span class='hs-layout'>;</span> <span class='hs-varid'>dd_flag</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>xoptM</span> <span class='hs-conid'>Opt_RecordWildCards</span>
<a name="line-68"></a>           <span class='hs-layout'>;</span> <span class='hs-varid'>checkErr</span> <span class='hs-varid'>dd_flag</span> <span class='hs-layout'>(</span><span class='hs-varid'>needFlagDotDot</span> <span class='hs-varid'>ctxt</span><span class='hs-layout'>)</span>
<a name="line-69"></a>           <span class='hs-layout'>;</span> <span class='hs-layout'>(</span><span class='hs-varid'>rdr_env</span><span class='hs-layout'>,</span> <span class='hs-varid'>lcl_env</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getRdrEnvs</span>
<a name="line-70"></a>           <span class='hs-layout'>;</span> <span class='hs-varid'>con_fields</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>lookupConstructorFields</span> <span class='hs-varid'>con</span>
<a name="line-71"></a>           <span class='hs-layout'>;</span> <span class='hs-keyword'>let</span> <span class='hs-varid'>present_flds</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getFieldIds</span> <span class='hs-varid'>flds</span>
<a name="line-72"></a>                 <span class='hs-varid'>parent_tc</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>find_tycon</span> <span class='hs-varid'>rdr_env</span> <span class='hs-varid'>con</span>
<a name="line-73"></a>
<a name="line-74"></a>                   <span class='hs-comment'>-- For constructor uses (but not patterns)</span>
<a name="line-75"></a>                   <span class='hs-comment'>-- the arg should be in scope (unqualified)</span>
<a name="line-76"></a>                   <span class='hs-comment'>-- ignoring the record field itself</span>
<a name="line-77"></a>                   <span class='hs-comment'>-- Eg.  data R = R { x,y :: Int }</span>
<a name="line-78"></a>                   <span class='hs-comment'>--      f x = R { .. }   -- Should expand to R {x=x}, not R{x=x,y=y}</span>
<a name="line-79"></a>                 <span class='hs-varid'>arg_in_scope</span> <span class='hs-varid'>fld</span> 
<a name="line-80"></a>                   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>rdr</span> <span class='hs-varop'>`elemLocalRdrEnv`</span> <span class='hs-varid'>lcl_env</span>
<a name="line-81"></a>                   <span class='hs-varop'>||</span> <span class='hs-varid'>notNull</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>gre</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>gre</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>lookupGRE_RdrName</span> <span class='hs-varid'>rdr</span> <span class='hs-varid'>rdr_env</span>
<a name="line-82"></a>                                    <span class='hs-layout'>,</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>gre_par</span> <span class='hs-varid'>gre</span> <span class='hs-keyword'>of</span>
<a name="line-83"></a>                                        <span class='hs-conid'>ParentIs</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>p</span> <span class='hs-varop'>/=</span> <span class='hs-varid'>parent_tc</span>
<a name="line-84"></a>                                        <span class='hs-keyword'>_</span>          <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>True</span> <span class='hs-keyglyph'>]</span>
<a name="line-85"></a>                   <span class='hs-keyword'>where</span>
<a name="line-86"></a>                     <span class='hs-varid'>rdr</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkRdrUnqual</span> <span class='hs-layout'>(</span><span class='hs-varid'>nameOccName</span> <span class='hs-varid'>fld</span><span class='hs-layout'>)</span>
<a name="line-87"></a>
<a name="line-88"></a>                 <span class='hs-varid'>dot_dot_gres</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>head</span> <span class='hs-varid'>gres</span>
<a name="line-89"></a>                                <span class='hs-keyglyph'>|</span> <span class='hs-varid'>fld</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>con_fields</span>
<a name="line-90"></a>                                <span class='hs-layout'>,</span> <span class='hs-varid'>not</span> <span class='hs-layout'>(</span><span class='hs-varid'>fld</span> <span class='hs-varop'>`elem`</span> <span class='hs-varid'>present_flds</span><span class='hs-layout'>)</span>
<a name="line-91"></a>                                <span class='hs-layout'>,</span> <span class='hs-keyword'>let</span> <span class='hs-varid'>gres</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>lookupGRE_Name</span> <span class='hs-varid'>rdr_env</span> <span class='hs-varid'>fld</span>
<a name="line-92"></a>                                <span class='hs-layout'>,</span> <span class='hs-varid'>not</span> <span class='hs-layout'>(</span><span class='hs-varid'>null</span> <span class='hs-varid'>gres</span><span class='hs-layout'>)</span>  <span class='hs-comment'>-- Check field is in scope</span>
<a name="line-93"></a>                                <span class='hs-layout'>,</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>ctxt</span> <span class='hs-keyword'>of</span>
<a name="line-94"></a>                                    <span class='hs-conid'>HsRecFieldCon</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>arg_in_scope</span> <span class='hs-varid'>fld</span>
<a name="line-95"></a>                                    <span class='hs-sel'>_other</span>           <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>True</span> <span class='hs-keyglyph'>]</span> 
<a name="line-96"></a>
<a name="line-97"></a>           <span class='hs-layout'>;</span> <span class='hs-varid'>addUsedRdrNames</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-varid'>greRdrName</span> <span class='hs-varid'>dot_dot_gres</span><span class='hs-layout'>)</span>
<a name="line-98"></a>           <span class='hs-layout'>;</span> <span class='hs-varid'>return</span> <span class='hs-keyglyph'>[</span> <span class='hs-conid'>HsRecField</span>
<a name="line-99"></a>                        <span class='hs-layout'>{</span> <span class='hs-varid'>hsRecFieldId</span>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>L</span> <span class='hs-varid'>loc</span> <span class='hs-varid'>fld</span>
<a name="line-100"></a>                        <span class='hs-layout'>,</span> <span class='hs-varid'>hsRecFieldArg</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>L</span> <span class='hs-varid'>loc</span> <span class='hs-layout'>(</span><span class='hs-varid'>mk_arg</span> <span class='hs-varid'>arg_rdr</span><span class='hs-layout'>)</span>
<a name="line-101"></a>                        <span class='hs-layout'>,</span> <span class='hs-varid'>hsRecPun</span>      <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span> <span class='hs-layout'>}</span>
<a name="line-102"></a>                    <span class='hs-keyglyph'>|</span> <span class='hs-varid'>gre</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>dot_dot_gres</span>
<a name="line-103"></a>                    <span class='hs-layout'>,</span> <span class='hs-keyword'>let</span> <span class='hs-varid'>fld</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>gre_name</span> <span class='hs-varid'>gre</span>
<a name="line-104"></a>                          <span class='hs-varid'>arg_rdr</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkRdrUnqual</span> <span class='hs-layout'>(</span><span class='hs-varid'>nameOccName</span> <span class='hs-varid'>fld</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>]</span> <span class='hs-layout'>}</span>
<a name="line-105"></a>
<a name="line-106"></a>    <span class='hs-varid'>check_disambiguation</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Bool</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>RnM</span> <span class='hs-conid'>Parent</span>
<a name="line-107"></a>    <span class='hs-comment'>-- When disambiguation is on, </span>
<a name="line-108"></a>    <span class='hs-varid'>check_disambiguation</span> <span class='hs-varid'>disambig_ok</span> <span class='hs-varid'>mb_con</span>
<a name="line-109"></a>      <span class='hs-keyglyph'>|</span> <span class='hs-varid'>disambig_ok</span><span class='hs-layout'>,</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>con</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>mb_con</span>
<a name="line-110"></a>      <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span> <span class='hs-layout'>{</span> <span class='hs-varid'>env</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getGlobalRdrEnv</span><span class='hs-layout'>;</span> <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-conid'>ParentIs</span> <span class='hs-layout'>(</span><span class='hs-varid'>find_tycon</span> <span class='hs-varid'>env</span> <span class='hs-varid'>con</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-layout'>}</span>
<a name="line-111"></a>      <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>return</span> <span class='hs-conid'>NoParent</span>
<a name="line-112"></a> 
<a name="line-113"></a>    <span class='hs-varid'>find_tycon</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>GlobalRdrEnv</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Name</span> <span class='hs-comment'>{- DataCon -}</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Name</span> <span class='hs-comment'>{- TyCon -}</span>
<a name="line-114"></a>    <span class='hs-comment'>-- Return the parent *type constructor* of the data constructor</span>
<a name="line-115"></a>    <span class='hs-comment'>-- That is, the parent of the data constructor.  </span>
<a name="line-116"></a>    <span class='hs-comment'>-- That's the parent to use for looking up record fields.</span>
<a name="line-117"></a>    <span class='hs-varid'>find_tycon</span> <span class='hs-varid'>env</span> <span class='hs-varid'>con</span> 
<a name="line-118"></a>      <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-conid'>AConLike</span> <span class='hs-layout'>(</span><span class='hs-conid'>RealDataCon</span> <span class='hs-varid'>dc</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>wiredInNameTyThing_maybe</span> <span class='hs-varid'>con</span>
<a name="line-119"></a>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tyConName</span> <span class='hs-layout'>(</span><span class='hs-varid'>dataConTyCon</span> <span class='hs-varid'>dc</span><span class='hs-layout'>)</span>   <span class='hs-comment'>-- Special case for [], which is built-in syntax</span>
<a name="line-120"></a>                                      <span class='hs-comment'>-- and not in the GlobalRdrEnv (Trac #8448)</span>
<a name="line-121"></a>      <span class='hs-keyglyph'>|</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>GRE</span> <span class='hs-layout'>{</span> <span class='hs-varid'>gre_par</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ParentIs</span> <span class='hs-varid'>p</span> <span class='hs-layout'>}</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>lookupGRE_Name</span> <span class='hs-varid'>env</span> <span class='hs-varid'>con</span>
<a name="line-122"></a>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>p</span>
<a name="line-123"></a>
<a name="line-124"></a>      <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>
<a name="line-125"></a>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprPanic</span> <span class='hs-str'>"find_tycon"</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>con</span> <span class='hs-varop'>$$</span> <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-varid'>lookupGRE_Name</span> <span class='hs-varid'>env</span> <span class='hs-varid'>con</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-126"></a>
<a name="line-127"></a>    <span class='hs-varid'>dup_flds</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>[</span><span class='hs-conid'>RdrName</span><span class='hs-keyglyph'>]</span><span class='hs-keyglyph'>]</span>
<a name="line-128"></a>        <span class='hs-comment'>-- Each list represents a RdrName that occurred more than once</span>
<a name="line-129"></a>        <span class='hs-comment'>-- (the list contains all occurrences)</span>
<a name="line-130"></a>        <span class='hs-comment'>-- Each list in dup_fields is non-empty</span>
<a name="line-131"></a>    <span class='hs-layout'>(</span><span class='hs-keyword'>_</span><span class='hs-layout'>,</span> <span class='hs-varid'>dup_flds</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>removeDups</span> <span class='hs-varid'>compare</span> <span class='hs-layout'>(</span><span class='hs-varid'>getFieldIds</span> <span class='hs-varid'>flds</span><span class='hs-layout'>)</span>
<a name="line-132"></a>
<a name="line-133"></a><a name="getFieldIds"></a><span class='hs-definition'>getFieldIds</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>HsRecField</span> <span class='hs-varid'>id</span> <span class='hs-varid'>arg</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>id</span><span class='hs-keyglyph'>]</span>
<a name="line-134"></a><span class='hs-definition'>getFieldIds</span> <span class='hs-varid'>flds</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-varid'>unLoc</span> <span class='hs-varop'>.</span> <span class='hs-varid'>hsRecFieldId</span><span class='hs-layout'>)</span> <span class='hs-varid'>flds</span>
<a name="line-135"></a>
<a name="line-136"></a><a name="needFlagDotDot"></a><span class='hs-definition'>needFlagDotDot</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsRecFieldContext</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-137"></a><span class='hs-definition'>needFlagDotDot</span> <span class='hs-varid'>ctxt</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>vcat</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"Illegal `..' in record"</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>pprRFC</span> <span class='hs-varid'>ctxt</span><span class='hs-layout'>,</span>
<a name="line-138"></a>                            <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"Use RecordWildCards to permit this"</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-139"></a>
<a name="line-140"></a><a name="badDotDot"></a><span class='hs-definition'>badDotDot</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsRecFieldContext</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-141"></a><span class='hs-definition'>badDotDot</span> <span class='hs-varid'>ctxt</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"You cannot use `..' in a record"</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>pprRFC</span> <span class='hs-varid'>ctxt</span>
<a name="line-142"></a>
<a name="line-143"></a><a name="badPun"></a><span class='hs-definition'>badPun</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Located</span> <span class='hs-conid'>RdrName</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-144"></a><span class='hs-definition'>badPun</span> <span class='hs-varid'>fld</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>vcat</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"Illegal use of punning for field"</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>quotes</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>fld</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-145"></a>                   <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"Use NamedFieldPuns to permit this"</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-146"></a>
<a name="line-147"></a><a name="dupFieldErr"></a><span class='hs-definition'>dupFieldErr</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsRecFieldContext</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>RdrName</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-148"></a><span class='hs-definition'>dupFieldErr</span> <span class='hs-varid'>ctxt</span> <span class='hs-varid'>dups</span>
<a name="line-149"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hsep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"duplicate field name"</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> 
<a name="line-150"></a>          <span class='hs-varid'>quotes</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-varid'>head</span> <span class='hs-varid'>dups</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-151"></a>          <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"in record"</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprRFC</span> <span class='hs-varid'>ctxt</span><span class='hs-keyglyph'>]</span>
<a name="line-152"></a>
<a name="line-153"></a><a name="pprRFC"></a><span class='hs-definition'>pprRFC</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsRecFieldContext</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-154"></a><span class='hs-definition'>pprRFC</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsRecFieldCon</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"construction"</span><span class='hs-layout'>)</span>
<a name="line-155"></a><span class='hs-definition'>pprRFC</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsRecFieldPat</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"pattern"</span><span class='hs-layout'>)</span>
<a name="line-156"></a><span class='hs-definition'>pprRFC</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsRecFieldUpd</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"update"</span><span class='hs-layout'>)</span>
</pre>\end{code}


%************************************************************************
%*                                                                      *
\subsubsection{Literals}
%*                                                                      *
%************************************************************************

When literals occur we have to make sure
that the types and classes they involve
are made available.

\begin{code}
<pre><a name="line-1"></a><a name="rnLit"></a><span class='hs-definition'>rnLit</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsLit</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>RnM</span> <span class='hs-conid'>()</span>
<a name="line-2"></a><span class='hs-definition'>rnLit</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsChar</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>checkErr</span> <span class='hs-layout'>(</span><span class='hs-varid'>inCharRange</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>bogusCharError</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span>
<a name="line-3"></a><span class='hs-definition'>rnLit</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>return</span> <span class='hs-conid'>()</span>
<a name="line-4"></a>
<a name="line-5"></a><a name="generalizeOverLitVal"></a><span class='hs-comment'>-- Turn a Fractional-looking literal which happens to be an integer into an</span>
<a name="line-6"></a><span class='hs-comment'>-- Integer-looking literal.</span>
<a name="line-7"></a><span class='hs-definition'>generalizeOverLitVal</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>OverLitVal</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>OverLitVal</span>
<a name="line-8"></a><span class='hs-definition'>generalizeOverLitVal</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsFractional</span> <span class='hs-layout'>(</span><span class='hs-conid'>FL</span> <span class='hs-layout'>{</span><span class='hs-varid'>fl_value</span><span class='hs-keyglyph'>=</span><span class='hs-varid'>val</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-9"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-varid'>denominator</span> <span class='hs-varid'>val</span> <span class='hs-varop'>==</span> <span class='hs-num'>1</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HsIntegral</span> <span class='hs-layout'>(</span><span class='hs-varid'>numerator</span> <span class='hs-varid'>val</span><span class='hs-layout'>)</span>
<a name="line-10"></a><span class='hs-definition'>generalizeOverLitVal</span> <span class='hs-varid'>lit</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>lit</span>
<a name="line-11"></a>
<a name="line-12"></a><a name="rnOverLit"></a><span class='hs-definition'>rnOverLit</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsOverLit</span> <span class='hs-varid'>t</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>RnM</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsOverLit</span> <span class='hs-conid'>Name</span><span class='hs-layout'>,</span> <span class='hs-conid'>FreeVars</span><span class='hs-layout'>)</span>
<a name="line-13"></a><span class='hs-definition'>rnOverLit</span> <span class='hs-varid'>origLit</span>
<a name="line-14"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>  <span class='hs-layout'>{</span> <span class='hs-varid'>opt_NumDecimals</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>xoptM</span> <span class='hs-conid'>Opt_NumDecimals</span>
<a name="line-15"></a>        <span class='hs-layout'>;</span> <span class='hs-keyword'>let</span> <span class='hs-layout'>{</span> <span class='hs-varid'>lit</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-conid'>OverLit</span> <span class='hs-layout'>{</span><span class='hs-varid'>ol_val</span><span class='hs-keyglyph'>=</span><span class='hs-varid'>val</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-16"></a>            <span class='hs-keyglyph'>|</span> <span class='hs-varid'>opt_NumDecimals</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>origLit</span> <span class='hs-layout'>{</span><span class='hs-varid'>ol_val</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>generalizeOverLitVal</span> <span class='hs-layout'>(</span><span class='hs-varid'>ol_val</span> <span class='hs-varid'>origLit</span><span class='hs-layout'>)</span><span class='hs-layout'>}</span>
<a name="line-17"></a>            <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>       <span class='hs-keyglyph'>=</span> <span class='hs-varid'>origLit</span>
<a name="line-18"></a>          <span class='hs-layout'>}</span>
<a name="line-19"></a>        <span class='hs-layout'>;</span> <span class='hs-keyword'>let</span> <span class='hs-varid'>std_name</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hsOverLitName</span> <span class='hs-varid'>val</span>
<a name="line-20"></a>        <span class='hs-layout'>;</span> <span class='hs-layout'>(</span><span class='hs-varid'>from_thing_name</span><span class='hs-layout'>,</span> <span class='hs-varid'>fvs</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>lookupSyntaxName</span> <span class='hs-varid'>std_name</span>
<a name="line-21"></a>        <span class='hs-layout'>;</span> <span class='hs-keyword'>let</span> <span class='hs-varid'>rebindable</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>from_thing_name</span> <span class='hs-keyword'>of</span>
<a name="line-22"></a>                                <span class='hs-conid'>HsVar</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>v</span> <span class='hs-varop'>/=</span> <span class='hs-varid'>std_name</span>
<a name="line-23"></a>                                <span class='hs-keyword'>_</span>       <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>panic</span> <span class='hs-str'>"rnOverLit"</span>
<a name="line-24"></a>        <span class='hs-layout'>;</span> <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>lit</span> <span class='hs-layout'>{</span> <span class='hs-varid'>ol_witness</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>from_thing_name</span>
<a name="line-25"></a>                      <span class='hs-layout'>,</span> <span class='hs-varid'>ol_rebindable</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>rebindable</span> <span class='hs-layout'>}</span><span class='hs-layout'>,</span> <span class='hs-varid'>fvs</span><span class='hs-layout'>)</span> <span class='hs-layout'>}</span>
</pre>\end{code}

%************************************************************************
%*                                                                      *
\subsubsection{Errors}
%*                                                                      *
%************************************************************************

\begin{code}
<pre><a name="line-1"></a><a name="patSigErr"></a><span class='hs-definition'>patSigErr</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Outputable</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-2"></a><span class='hs-definition'>patSigErr</span> <span class='hs-varid'>ty</span>
<a name="line-3"></a>  <span class='hs-keyglyph'>=</span>  <span class='hs-layout'>(</span><span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"Illegal signature in pattern:"</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>ty</span><span class='hs-layout'>)</span>
<a name="line-4"></a>        <span class='hs-varop'>$$</span> <span class='hs-varid'>nest</span> <span class='hs-num'>4</span> <span class='hs-layout'>(</span><span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"Use ScopedTypeVariables to permit it"</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-5"></a>
<a name="line-6"></a><a name="bogusCharError"></a><span class='hs-definition'>bogusCharError</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Char</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-7"></a><span class='hs-definition'>bogusCharError</span> <span class='hs-varid'>c</span>
<a name="line-8"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"character literal out of range: '\\"</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>char</span> <span class='hs-varid'>c</span>  <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'\''</span>
<a name="line-9"></a>
<a name="line-10"></a><a name="badViewPat"></a><span class='hs-definition'>badViewPat</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Pat</span> <span class='hs-conid'>RdrName</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-11"></a><span class='hs-definition'>badViewPat</span> <span class='hs-varid'>pat</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>vcat</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"Illegal view pattern: "</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>pat</span><span class='hs-layout'>,</span>
<a name="line-12"></a>                       <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"Use ViewPatterns to enable view patterns"</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
</pre>\end{code}
</body>
</html>
