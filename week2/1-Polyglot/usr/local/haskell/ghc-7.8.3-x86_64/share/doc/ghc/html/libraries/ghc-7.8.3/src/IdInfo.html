<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>basicTypes/IdInfo.lhs</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
%
% (c) The University of Glasgow 2006
% (c) The GRASP/AQUA Project, Glasgow University, 1993-1998
%
\section[IdInfo]{@IdInfos@: Non-essential information about @Ids@}

(And a pretty good illustration of quite a few things wrong with
Haskell. [WDP 94/11])

\begin{code}
<pre><a name="line-1"></a><span class='hs-comment'>{-# OPTIONS -fno-warn-tabs #-}</span>
<a name="line-2"></a><span class='hs-comment'>-- The above warning supression flag is a temporary kludge.</span>
<a name="line-3"></a><span class='hs-comment'>-- While working on this module you are encouraged to remove it and</span>
<a name="line-4"></a><span class='hs-comment'>-- detab the module (please do the detabbing in a separate patch). See</span>
<a name="line-5"></a><span class='hs-comment'>--     <a href="http://ghc.haskell.org/trac/ghc/wiki/Commentary/CodingStyle#TabsvsSpaces">http://ghc.haskell.org/trac/ghc/wiki/Commentary/CodingStyle#TabsvsSpaces</a></span>
<a name="line-6"></a><span class='hs-comment'>-- for details</span>
<a name="line-7"></a>
<a name="line-8"></a><span class='hs-keyword'>module</span> <span class='hs-conid'>IdInfo</span> <span class='hs-layout'>(</span>
<a name="line-9"></a>        <span class='hs-comment'>-- * The IdDetails type</span>
<a name="line-10"></a>	<span class='hs-conid'>IdDetails</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprIdDetails</span><span class='hs-layout'>,</span> <span class='hs-varid'>coVarDetails</span><span class='hs-layout'>,</span>
<a name="line-11"></a>
<a name="line-12"></a>        <span class='hs-comment'>-- * The IdInfo type</span>
<a name="line-13"></a>	<span class='hs-conid'>IdInfo</span><span class='hs-layout'>,</span>		<span class='hs-comment'>-- Abstract</span>
<a name="line-14"></a>	<span class='hs-varid'>vanillaIdInfo</span><span class='hs-layout'>,</span> <span class='hs-varid'>noCafIdInfo</span><span class='hs-layout'>,</span>
<a name="line-15"></a>	<span class='hs-varid'>seqIdInfo</span><span class='hs-layout'>,</span> <span class='hs-varid'>megaSeqIdInfo</span><span class='hs-layout'>,</span>
<a name="line-16"></a>
<a name="line-17"></a>        <span class='hs-comment'>-- ** The OneShotInfo type</span>
<a name="line-18"></a>        <span class='hs-conid'>OneShotInfo</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-19"></a>        <span class='hs-varid'>oneShotInfo</span><span class='hs-layout'>,</span> <span class='hs-varid'>noOneShotInfo</span><span class='hs-layout'>,</span> <span class='hs-varid'>hasNoOneShotInfo</span><span class='hs-layout'>,</span>
<a name="line-20"></a>        <span class='hs-varid'>setOneShotInfo</span><span class='hs-layout'>,</span> 
<a name="line-21"></a>
<a name="line-22"></a>	<span class='hs-comment'>-- ** Zapping various forms of Info</span>
<a name="line-23"></a>	<span class='hs-varid'>zapLamInfo</span><span class='hs-layout'>,</span> <span class='hs-varid'>zapFragileInfo</span><span class='hs-layout'>,</span>
<a name="line-24"></a>        <span class='hs-varid'>zapDemandInfo</span><span class='hs-layout'>,</span>
<a name="line-25"></a>
<a name="line-26"></a>	<span class='hs-comment'>-- ** The ArityInfo type</span>
<a name="line-27"></a>	<span class='hs-conid'>ArityInfo</span><span class='hs-layout'>,</span>
<a name="line-28"></a>	<span class='hs-varid'>unknownArity</span><span class='hs-layout'>,</span> 
<a name="line-29"></a>	<span class='hs-varid'>arityInfo</span><span class='hs-layout'>,</span> <span class='hs-varid'>setArityInfo</span><span class='hs-layout'>,</span> <span class='hs-varid'>ppArityInfo</span><span class='hs-layout'>,</span> 
<a name="line-30"></a>
<a name="line-31"></a>	<span class='hs-comment'>-- ** Demand and strictness Info</span>
<a name="line-32"></a> 	<span class='hs-varid'>strictnessInfo</span><span class='hs-layout'>,</span> <span class='hs-varid'>setStrictnessInfo</span><span class='hs-layout'>,</span> 
<a name="line-33"></a>  	<span class='hs-varid'>demandInfo</span><span class='hs-layout'>,</span> <span class='hs-varid'>setDemandInfo</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprStrictness</span><span class='hs-layout'>,</span>
<a name="line-34"></a>
<a name="line-35"></a>	<span class='hs-comment'>-- ** Unfolding Info</span>
<a name="line-36"></a>	<span class='hs-varid'>unfoldingInfo</span><span class='hs-layout'>,</span> <span class='hs-varid'>setUnfoldingInfo</span><span class='hs-layout'>,</span> <span class='hs-varid'>setUnfoldingInfoLazily</span><span class='hs-layout'>,</span>
<a name="line-37"></a>
<a name="line-38"></a>	<span class='hs-comment'>-- ** The InlinePragInfo type</span>
<a name="line-39"></a>	<span class='hs-conid'>InlinePragInfo</span><span class='hs-layout'>,</span>
<a name="line-40"></a>	<span class='hs-varid'>inlinePragInfo</span><span class='hs-layout'>,</span> <span class='hs-varid'>setInlinePragInfo</span><span class='hs-layout'>,</span>
<a name="line-41"></a>
<a name="line-42"></a>	<span class='hs-comment'>-- ** The OccInfo type</span>
<a name="line-43"></a>	<span class='hs-conid'>OccInfo</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-44"></a>	<span class='hs-varid'>isDeadOcc</span><span class='hs-layout'>,</span> <span class='hs-varid'>isStrongLoopBreaker</span><span class='hs-layout'>,</span> <span class='hs-varid'>isWeakLoopBreaker</span><span class='hs-layout'>,</span>
<a name="line-45"></a>	<span class='hs-varid'>occInfo</span><span class='hs-layout'>,</span> <span class='hs-varid'>setOccInfo</span><span class='hs-layout'>,</span>
<a name="line-46"></a>
<a name="line-47"></a>	<span class='hs-conid'>InsideLam</span><span class='hs-layout'>,</span> <span class='hs-conid'>OneBranch</span><span class='hs-layout'>,</span>
<a name="line-48"></a>	<span class='hs-varid'>insideLam</span><span class='hs-layout'>,</span> <span class='hs-varid'>notInsideLam</span><span class='hs-layout'>,</span> <span class='hs-varid'>oneBranch</span><span class='hs-layout'>,</span> <span class='hs-varid'>notOneBranch</span><span class='hs-layout'>,</span>
<a name="line-49"></a>
<a name="line-50"></a>	<span class='hs-comment'>-- ** The SpecInfo type</span>
<a name="line-51"></a>	<span class='hs-conid'>SpecInfo</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-52"></a>	<span class='hs-varid'>emptySpecInfo</span><span class='hs-layout'>,</span>
<a name="line-53"></a>	<span class='hs-varid'>isEmptySpecInfo</span><span class='hs-layout'>,</span> <span class='hs-varid'>specInfoFreeVars</span><span class='hs-layout'>,</span>
<a name="line-54"></a>	<span class='hs-varid'>specInfoRules</span><span class='hs-layout'>,</span> <span class='hs-varid'>seqSpecInfo</span><span class='hs-layout'>,</span> <span class='hs-varid'>setSpecInfoHead</span><span class='hs-layout'>,</span>
<a name="line-55"></a>        <span class='hs-varid'>specInfo</span><span class='hs-layout'>,</span> <span class='hs-varid'>setSpecInfo</span><span class='hs-layout'>,</span>
<a name="line-56"></a>
<a name="line-57"></a>	<span class='hs-comment'>-- ** The CAFInfo type</span>
<a name="line-58"></a>	<span class='hs-conid'>CafInfo</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-59"></a>	<span class='hs-varid'>ppCafInfo</span><span class='hs-layout'>,</span> <span class='hs-varid'>mayHaveCafRefs</span><span class='hs-layout'>,</span>
<a name="line-60"></a>	<span class='hs-varid'>cafInfo</span><span class='hs-layout'>,</span> <span class='hs-varid'>setCafInfo</span><span class='hs-layout'>,</span>
<a name="line-61"></a>
<a name="line-62"></a>        <span class='hs-comment'>-- ** Tick-box Info</span>
<a name="line-63"></a>        <span class='hs-conid'>TickBoxOp</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>TickBoxId</span><span class='hs-layout'>,</span>
<a name="line-64"></a>    <span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-65"></a>
<a name="line-66"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>CoreSyn</span>
<a name="line-67"></a>
<a name="line-68"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Class</span>
<a name="line-69"></a><span class='hs-keyword'>import</span> <span class='hs-comment'>{-# SOURCE #-}</span> <span class='hs-conid'>PrimOp</span> <span class='hs-layout'>(</span><span class='hs-conid'>PrimOp</span><span class='hs-layout'>)</span>
<a name="line-70"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Name</span>
<a name="line-71"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>VarSet</span>
<a name="line-72"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>BasicTypes</span>
<a name="line-73"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>DataCon</span>
<a name="line-74"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>TyCon</span>
<a name="line-75"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>ForeignCall</span>
<a name="line-76"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Outputable</span>	
<a name="line-77"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Module</span>
<a name="line-78"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>FastString</span>
<a name="line-79"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Demand</span>
<a name="line-80"></a>
<a name="line-81"></a><span class='hs-comment'>-- infixl so you can say (id `set` a `set` b)</span>
<a name="line-82"></a><span class='hs-keyword'>infixl</span> 	<span class='hs-num'>1</span> <span class='hs-varop'>`setSpecInfo`</span><span class='hs-layout'>,</span>
<a name="line-83"></a>	  <span class='hs-varop'>`setArityInfo`</span><span class='hs-layout'>,</span>
<a name="line-84"></a>	  <span class='hs-varop'>`setInlinePragInfo`</span><span class='hs-layout'>,</span>
<a name="line-85"></a>	  <span class='hs-varop'>`setUnfoldingInfo`</span><span class='hs-layout'>,</span>
<a name="line-86"></a>	  <span class='hs-varop'>`setOneShotInfo`</span><span class='hs-layout'>,</span>
<a name="line-87"></a>	  <span class='hs-varop'>`setOccInfo`</span><span class='hs-layout'>,</span>
<a name="line-88"></a>	  <span class='hs-varop'>`setCafInfo`</span><span class='hs-layout'>,</span>
<a name="line-89"></a>	  <span class='hs-varop'>`setStrictnessInfo`</span><span class='hs-layout'>,</span>
<a name="line-90"></a>	  <span class='hs-varop'>`setDemandInfo`</span>
</pre>\end{code}

%************************************************************************
%*									*
                     IdDetails
%*									*
%************************************************************************

\begin{code}
<pre><a name="line-1"></a><a name="IdDetails"></a><span class='hs-comment'>-- | The 'IdDetails' of an 'Id' give stable, and necessary, </span>
<a name="line-2"></a><a name="IdDetails"></a><span class='hs-comment'>-- information about the Id. </span>
<a name="line-3"></a><a name="IdDetails"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>IdDetails</span>
<a name="line-4"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>VanillaId</span>	
<a name="line-5"></a>
<a name="line-6"></a>  <span class='hs-comment'>-- | The 'Id' for a record selector</span>
<a name="line-7"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>RecSelId</span>                 
<a name="line-8"></a>    <span class='hs-layout'>{</span> <span class='hs-varid'>sel_tycon</span>   <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span>	<span class='hs-comment'>-- ^ For a data type family, this is the /instance/ 'TyCon'</span>
<a name="line-9"></a>				<span class='hs-comment'>--   not the family 'TyCon'</span>
<a name="line-10"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>sel_naughty</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Bool</span>       <span class='hs-comment'>-- True &lt;=&gt; a "naughty" selector which can't actually exist, for example @x@ in:</span>
<a name="line-11"></a>                                <span class='hs-comment'>--    data T = forall a. MkT { x :: a }</span>
<a name="line-12"></a>    <span class='hs-layout'>}</span>				<span class='hs-comment'>-- See Note [Naughty record selectors] in TcTyClsDecls</span>
<a name="line-13"></a>
<a name="line-14"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>DataConWorkId</span> <span class='hs-conid'>DataCon</span>	<span class='hs-comment'>-- ^ The 'Id' is for a data constructor /worker/</span>
<a name="line-15"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>DataConWrapId</span> <span class='hs-conid'>DataCon</span>	<span class='hs-comment'>-- ^ The 'Id' is for a data constructor /wrapper/</span>
<a name="line-16"></a>				
<a name="line-17"></a>				<span class='hs-comment'>-- [the only reasons we need to know is so that</span>
<a name="line-18"></a>				<span class='hs-comment'>--  a) to support isImplicitId</span>
<a name="line-19"></a>				<span class='hs-comment'>--  b) when desugaring a RecordCon we can get </span>
<a name="line-20"></a>				<span class='hs-comment'>--     from the Id back to the data con]</span>
<a name="line-21"></a>
<a name="line-22"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ClassOpId</span> <span class='hs-conid'>Class</span> 		<span class='hs-comment'>-- ^ The 'Id' is a superclass selector or class operation of a class</span>
<a name="line-23"></a>
<a name="line-24"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>PrimOpId</span> <span class='hs-conid'>PrimOp</span>		<span class='hs-comment'>-- ^ The 'Id' is for a primitive operator</span>
<a name="line-25"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>FCallId</span> <span class='hs-conid'>ForeignCall</span>		<span class='hs-comment'>-- ^ The 'Id' is for a foreign call</span>
<a name="line-26"></a>
<a name="line-27"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>TickBoxOpId</span> <span class='hs-conid'>TickBoxOp</span>	<span class='hs-comment'>-- ^ The 'Id' is for a HPC tick box (both traditional and binary)</span>
<a name="line-28"></a>
<a name="line-29"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>DFunId</span> <span class='hs-conid'>Int</span> <span class='hs-conid'>Bool</span>             <span class='hs-comment'>-- ^ A dictionary function.</span>
<a name="line-30"></a>       <span class='hs-comment'>-- Int = the number of "silent" arguments to the dfun</span>
<a name="line-31"></a>       <span class='hs-comment'>--       e.g.  class D a =&gt; C a where ...</span>
<a name="line-32"></a>       <span class='hs-comment'>--             instance C a =&gt; C [a]</span>
<a name="line-33"></a>       <span class='hs-comment'>--       has is_silent = 1, because the dfun</span>
<a name="line-34"></a>       <span class='hs-comment'>--       has type  dfun :: (D a, C a) =&gt; C [a]</span>
<a name="line-35"></a>       <span class='hs-comment'>--       See Note [Silent superclass arguments] in TcInstDcls</span>
<a name="line-36"></a>       <span class='hs-comment'>--</span>
<a name="line-37"></a>       <span class='hs-comment'>-- Bool = True &lt;=&gt; the class has only one method, so may be</span>
<a name="line-38"></a>       <span class='hs-comment'>--                  implemented with a newtype, so it might be bad</span>
<a name="line-39"></a>       <span class='hs-comment'>--                  to be strict on this dictionary</span>
<a name="line-40"></a>
<a name="line-41"></a><a name="coVarDetails"></a><span class='hs-definition'>coVarDetails</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>IdDetails</span>
<a name="line-42"></a><span class='hs-definition'>coVarDetails</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>VanillaId</span>
<a name="line-43"></a>
<a name="line-44"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Outputable</span> <span class='hs-conid'>IdDetails</span> <span class='hs-keyword'>where</span>
<a name="line-45"></a>    <span class='hs-varid'>ppr</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprIdDetails</span>
<a name="line-46"></a>
<a name="line-47"></a><a name="pprIdDetails"></a><span class='hs-definition'>pprIdDetails</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>IdDetails</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-48"></a><span class='hs-definition'>pprIdDetails</span> <span class='hs-conid'>VanillaId</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>empty</span>
<a name="line-49"></a><span class='hs-definition'>pprIdDetails</span> <span class='hs-varid'>other</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>brackets</span> <span class='hs-layout'>(</span><span class='hs-varid'>pp</span> <span class='hs-varid'>other</span><span class='hs-layout'>)</span>
<a name="line-50"></a> <span class='hs-keyword'>where</span>
<a name="line-51"></a>   <span class='hs-varid'>pp</span> <span class='hs-conid'>VanillaId</span>         <span class='hs-keyglyph'>=</span> <span class='hs-varid'>panic</span> <span class='hs-str'>"pprIdDetails"</span>
<a name="line-52"></a>   <span class='hs-varid'>pp</span> <span class='hs-layout'>(</span><span class='hs-conid'>DataConWorkId</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"DataCon"</span><span class='hs-layout'>)</span>
<a name="line-53"></a>   <span class='hs-varid'>pp</span> <span class='hs-layout'>(</span><span class='hs-conid'>DataConWrapId</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"DataConWrapper"</span><span class='hs-layout'>)</span>
<a name="line-54"></a>   <span class='hs-varid'>pp</span> <span class='hs-layout'>(</span><span class='hs-conid'>ClassOpId</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"ClassOp"</span><span class='hs-layout'>)</span>
<a name="line-55"></a>   <span class='hs-varid'>pp</span> <span class='hs-layout'>(</span><span class='hs-conid'>PrimOpId</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"PrimOp"</span><span class='hs-layout'>)</span>
<a name="line-56"></a>   <span class='hs-varid'>pp</span> <span class='hs-layout'>(</span><span class='hs-conid'>FCallId</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>       <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"ForeignCall"</span><span class='hs-layout'>)</span>
<a name="line-57"></a>   <span class='hs-varid'>pp</span> <span class='hs-layout'>(</span><span class='hs-conid'>TickBoxOpId</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"TickBoxOp"</span><span class='hs-layout'>)</span>
<a name="line-58"></a>   <span class='hs-varid'>pp</span> <span class='hs-layout'>(</span><span class='hs-conid'>DFunId</span> <span class='hs-varid'>ns</span> <span class='hs-varid'>nt</span><span class='hs-layout'>)</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"DFunId"</span><span class='hs-layout'>)</span>
<a name="line-59"></a>                             <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>ppWhen</span> <span class='hs-layout'>(</span><span class='hs-varid'>ns</span> <span class='hs-varop'>/=</span> <span class='hs-num'>0</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>brackets</span> <span class='hs-layout'>(</span><span class='hs-varid'>int</span> <span class='hs-varid'>ns</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-60"></a>                             <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>ppWhen</span> <span class='hs-varid'>nt</span> <span class='hs-layout'>(</span><span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"(nt)"</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-61"></a>   <span class='hs-varid'>pp</span> <span class='hs-layout'>(</span><span class='hs-conid'>RecSelId</span> <span class='hs-layout'>{</span> <span class='hs-varid'>sel_naughty</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>is_naughty</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-62"></a>      			 <span class='hs-keyglyph'>=</span> <span class='hs-varid'>brackets</span> <span class='hs-varop'>$</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"RecSel"</span><span class='hs-layout'>)</span> 
<a name="line-63"></a>      			    <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>ppWhen</span> <span class='hs-varid'>is_naughty</span> <span class='hs-layout'>(</span><span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"(naughty)"</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
</pre>\end{code}


%************************************************************************
%*									*
\subsection{The main IdInfo type}
%*									*
%************************************************************************

\begin{code}
<pre><a name="line-1"></a><a name="IdInfo"></a><span class='hs-comment'>-- | An 'IdInfo' gives /optional/ information about an 'Id'.  If</span>
<a name="line-2"></a><a name="IdInfo"></a><span class='hs-comment'>-- present it never lies, but it may not be present, in which case there</span>
<a name="line-3"></a><a name="IdInfo"></a><span class='hs-comment'>-- is always a conservative assumption which can be made.</span>
<a name="line-4"></a><a name="IdInfo"></a><span class='hs-comment'>-- </span>
<a name="line-5"></a><a name="IdInfo"></a><span class='hs-comment'>-- Two 'Id's may have different info even though they have the same</span>
<a name="line-6"></a><a name="IdInfo"></a><span class='hs-comment'>-- 'Unique' (and are hence the same 'Id'); for example, one might lack</span>
<a name="line-7"></a><a name="IdInfo"></a><span class='hs-comment'>-- the properties attached to the other.</span>
<a name="line-8"></a><a name="IdInfo"></a><span class='hs-comment'>-- </span>
<a name="line-9"></a><a name="IdInfo"></a><span class='hs-comment'>-- The 'IdInfo' gives information about the value, or definition, of the</span>
<a name="line-10"></a><a name="IdInfo"></a><span class='hs-comment'>-- 'Id'.  It does not contain information about the 'Id''s usage,</span>
<a name="line-11"></a><a name="IdInfo"></a><span class='hs-comment'>-- except for 'demandInfo' and 'oneShotInfo'.</span>
<a name="line-12"></a><a name="IdInfo"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>IdInfo</span>
<a name="line-13"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>IdInfo</span> <span class='hs-layout'>{</span>
<a name="line-14"></a>	<span class='hs-varid'>arityInfo</span> 	<span class='hs-keyglyph'>::</span> <span class='hs-varop'>!</span><span class='hs-conid'>ArityInfo</span><span class='hs-layout'>,</span>		<span class='hs-comment'>-- ^ 'Id' arity</span>
<a name="line-15"></a>	<span class='hs-varid'>specInfo</span> 	<span class='hs-keyglyph'>::</span> <span class='hs-conid'>SpecInfo</span><span class='hs-layout'>,</span>		<span class='hs-comment'>-- ^ Specialisations of the 'Id's function which exist</span>
<a name="line-16"></a>			   			<span class='hs-comment'>-- See Note [Specialisations and RULES in IdInfo]</span>
<a name="line-17"></a>	<span class='hs-varid'>unfoldingInfo</span>	<span class='hs-keyglyph'>::</span> <span class='hs-conid'>Unfolding</span><span class='hs-layout'>,</span>		<span class='hs-comment'>-- ^ The 'Id's unfolding</span>
<a name="line-18"></a>	<span class='hs-varid'>cafInfo</span>		<span class='hs-keyglyph'>::</span> <span class='hs-conid'>CafInfo</span><span class='hs-layout'>,</span>		<span class='hs-comment'>-- ^ 'Id' CAF info</span>
<a name="line-19"></a>        <span class='hs-varid'>oneShotInfo</span>	<span class='hs-keyglyph'>::</span> <span class='hs-conid'>OneShotInfo</span><span class='hs-layout'>,</span>		<span class='hs-comment'>-- ^ Info about a lambda-bound variable, if the 'Id' is one</span>
<a name="line-20"></a>	<span class='hs-varid'>inlinePragInfo</span>	<span class='hs-keyglyph'>::</span> <span class='hs-conid'>InlinePragma</span><span class='hs-layout'>,</span>	<span class='hs-comment'>-- ^ Any inline pragma atached to the 'Id'</span>
<a name="line-21"></a>	<span class='hs-varid'>occInfo</span>		<span class='hs-keyglyph'>::</span> <span class='hs-conid'>OccInfo</span><span class='hs-layout'>,</span>		<span class='hs-comment'>-- ^ How the 'Id' occurs in the program</span>
<a name="line-22"></a>
<a name="line-23"></a>        <span class='hs-varid'>strictnessInfo</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>StrictSig</span><span class='hs-layout'>,</span>      <span class='hs-comment'>--  ^ A strictness signature</span>
<a name="line-24"></a>
<a name="line-25"></a>        <span class='hs-varid'>demandInfo</span>      <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Demand</span>        <span class='hs-comment'>-- ^ ID demand information</span>
<a name="line-26"></a>
<a name="line-27"></a>    <span class='hs-layout'>}</span>
<a name="line-28"></a>
<a name="line-29"></a><a name="seqIdInfo"></a><span class='hs-comment'>-- | Just evaluate the 'IdInfo' to WHNF</span>
<a name="line-30"></a><span class='hs-definition'>seqIdInfo</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>IdInfo</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>()</span>
<a name="line-31"></a><span class='hs-definition'>seqIdInfo</span> <span class='hs-layout'>(</span><span class='hs-conid'>IdInfo</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>()</span>
<a name="line-32"></a>
<a name="line-33"></a><a name="megaSeqIdInfo"></a><span class='hs-comment'>-- | Evaluate all the fields of the 'IdInfo' that are generally demanded by the</span>
<a name="line-34"></a><span class='hs-comment'>-- compiler</span>
<a name="line-35"></a><span class='hs-definition'>megaSeqIdInfo</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>IdInfo</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>()</span>
<a name="line-36"></a><span class='hs-definition'>megaSeqIdInfo</span> <span class='hs-varid'>info</span>
<a name="line-37"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>seqSpecInfo</span> <span class='hs-layout'>(</span><span class='hs-varid'>specInfo</span> <span class='hs-varid'>info</span><span class='hs-layout'>)</span>			<span class='hs-varop'>`seq`</span>
<a name="line-38"></a>
<a name="line-39"></a><span class='hs-comment'>-- Omitting this improves runtimes a little, presumably because</span>
<a name="line-40"></a><span class='hs-comment'>-- some unfoldings are not calculated at all</span>
<a name="line-41"></a><span class='hs-comment'>--    seqUnfolding (unfoldingInfo info)		`seq`</span>
<a name="line-42"></a>
<a name="line-43"></a>    <span class='hs-varid'>seqDemandInfo</span> <span class='hs-layout'>(</span><span class='hs-varid'>demandInfo</span> <span class='hs-varid'>info</span><span class='hs-layout'>)</span>             <span class='hs-varop'>`seq`</span>
<a name="line-44"></a>    <span class='hs-varid'>seqStrictnessInfo</span> <span class='hs-layout'>(</span><span class='hs-varid'>strictnessInfo</span> <span class='hs-varid'>info</span><span class='hs-layout'>)</span>     <span class='hs-varop'>`seq`</span>
<a name="line-45"></a>    <span class='hs-varid'>seqCaf</span> <span class='hs-layout'>(</span><span class='hs-varid'>cafInfo</span> <span class='hs-varid'>info</span><span class='hs-layout'>)</span>			<span class='hs-varop'>`seq`</span>
<a name="line-46"></a>    <span class='hs-varid'>seqOneShot</span> <span class='hs-layout'>(</span><span class='hs-varid'>oneShotInfo</span> <span class='hs-varid'>info</span><span class='hs-layout'>)</span>		<span class='hs-varop'>`seq`</span>
<a name="line-47"></a>    <span class='hs-varid'>seqOccInfo</span> <span class='hs-layout'>(</span><span class='hs-varid'>occInfo</span> <span class='hs-varid'>info</span><span class='hs-layout'>)</span>
<a name="line-48"></a>
<a name="line-49"></a><a name="seqOneShot"></a><span class='hs-definition'>seqOneShot</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>OneShotInfo</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>()</span>
<a name="line-50"></a><span class='hs-definition'>seqOneShot</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>l</span> <span class='hs-varop'>`seq`</span> <span class='hs-conid'>()</span>
<a name="line-51"></a>
<a name="line-52"></a><a name="seqStrictnessInfo"></a><span class='hs-definition'>seqStrictnessInfo</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>StrictSig</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>()</span>
<a name="line-53"></a><span class='hs-definition'>seqStrictnessInfo</span> <span class='hs-varid'>ty</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>seqStrictSig</span> <span class='hs-varid'>ty</span>
<a name="line-54"></a>
<a name="line-55"></a><a name="seqDemandInfo"></a><span class='hs-definition'>seqDemandInfo</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Demand</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>()</span>
<a name="line-56"></a><span class='hs-definition'>seqDemandInfo</span> <span class='hs-varid'>dmd</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>seqDemand</span> <span class='hs-varid'>dmd</span>
</pre>\end{code}

Setters

\begin{code}
<pre><a name="line-1"></a><a name="setSpecInfo"></a><span class='hs-definition'>setSpecInfo</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>IdInfo</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SpecInfo</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IdInfo</span>
<a name="line-2"></a><span class='hs-definition'>setSpecInfo</span> 	  <span class='hs-varid'>info</span> <span class='hs-varid'>sp</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sp</span> <span class='hs-varop'>`seq`</span> <span class='hs-varid'>info</span> <span class='hs-layout'>{</span> <span class='hs-varid'>specInfo</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sp</span> <span class='hs-layout'>}</span>
<a name="line-3"></a><a name="setInlinePragInfo"></a><span class='hs-definition'>setInlinePragInfo</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>IdInfo</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>InlinePragma</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IdInfo</span>
<a name="line-4"></a><span class='hs-definition'>setInlinePragInfo</span> <span class='hs-varid'>info</span> <span class='hs-varid'>pr</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pr</span> <span class='hs-varop'>`seq`</span> <span class='hs-varid'>info</span> <span class='hs-layout'>{</span> <span class='hs-varid'>inlinePragInfo</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pr</span> <span class='hs-layout'>}</span>
<a name="line-5"></a><a name="setOccInfo"></a><span class='hs-definition'>setOccInfo</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>IdInfo</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>OccInfo</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IdInfo</span>
<a name="line-6"></a><span class='hs-definition'>setOccInfo</span>	  <span class='hs-varid'>info</span> <span class='hs-varid'>oc</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>oc</span> <span class='hs-varop'>`seq`</span> <span class='hs-varid'>info</span> <span class='hs-layout'>{</span> <span class='hs-varid'>occInfo</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>oc</span> <span class='hs-layout'>}</span>
<a name="line-7"></a>	<span class='hs-comment'>-- Try to avoid spack leaks by seq'ing</span>
<a name="line-8"></a>
<a name="line-9"></a><a name="setUnfoldingInfoLazily"></a><span class='hs-definition'>setUnfoldingInfoLazily</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>IdInfo</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Unfolding</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IdInfo</span>
<a name="line-10"></a><span class='hs-definition'>setUnfoldingInfoLazily</span> <span class='hs-varid'>info</span> <span class='hs-varid'>uf</span> 	<span class='hs-comment'>-- Lazy variant to avoid looking at the</span>
<a name="line-11"></a>  <span class='hs-keyglyph'>=</span>				<span class='hs-comment'>-- unfolding of an imported Id unless necessary</span>
<a name="line-12"></a>    <span class='hs-varid'>info</span> <span class='hs-layout'>{</span> <span class='hs-varid'>unfoldingInfo</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>uf</span> <span class='hs-layout'>}</span>	<span class='hs-comment'>-- (In this case the demand-zapping is redundant.)</span>
<a name="line-13"></a>
<a name="line-14"></a><a name="setUnfoldingInfo"></a><span class='hs-definition'>setUnfoldingInfo</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>IdInfo</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Unfolding</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IdInfo</span>
<a name="line-15"></a><span class='hs-definition'>setUnfoldingInfo</span> <span class='hs-varid'>info</span> <span class='hs-varid'>uf</span> 
<a name="line-16"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-comment'>-- We don't seq the unfolding, as we generate intermediate</span>
<a name="line-17"></a>    <span class='hs-comment'>-- unfoldings which are just thrown away, so evaluating them is a</span>
<a name="line-18"></a>    <span class='hs-comment'>-- waste of time.</span>
<a name="line-19"></a>    <span class='hs-comment'>-- seqUnfolding uf `seq`</span>
<a name="line-20"></a>    <span class='hs-varid'>info</span> <span class='hs-layout'>{</span> <span class='hs-varid'>unfoldingInfo</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>uf</span> <span class='hs-layout'>}</span>
<a name="line-21"></a>
<a name="line-22"></a><a name="setArityInfo"></a><span class='hs-definition'>setArityInfo</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>IdInfo</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ArityInfo</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IdInfo</span>
<a name="line-23"></a><span class='hs-definition'>setArityInfo</span>	  <span class='hs-varid'>info</span> <span class='hs-varid'>ar</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>info</span> <span class='hs-layout'>{</span> <span class='hs-varid'>arityInfo</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ar</span>  <span class='hs-layout'>}</span>
<a name="line-24"></a><a name="setCafInfo"></a><span class='hs-definition'>setCafInfo</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>IdInfo</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>CafInfo</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IdInfo</span>
<a name="line-25"></a><span class='hs-definition'>setCafInfo</span>        <span class='hs-varid'>info</span> <span class='hs-varid'>caf</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>info</span> <span class='hs-layout'>{</span> <span class='hs-varid'>cafInfo</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>caf</span> <span class='hs-layout'>}</span>
<a name="line-26"></a>
<a name="line-27"></a><a name="setOneShotInfo"></a><span class='hs-definition'>setOneShotInfo</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>IdInfo</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>OneShotInfo</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IdInfo</span>
<a name="line-28"></a><span class='hs-definition'>setOneShotInfo</span>      <span class='hs-varid'>info</span> <span class='hs-varid'>lb</span> <span class='hs-keyglyph'>=</span> <span class='hs-comment'>{-lb `seq`-}</span> <span class='hs-varid'>info</span> <span class='hs-layout'>{</span> <span class='hs-varid'>oneShotInfo</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>lb</span> <span class='hs-layout'>}</span>
<a name="line-29"></a>
<a name="line-30"></a><a name="setDemandInfo"></a><span class='hs-definition'>setDemandInfo</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>IdInfo</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Demand</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IdInfo</span>
<a name="line-31"></a><span class='hs-definition'>setDemandInfo</span> <span class='hs-varid'>info</span> <span class='hs-varid'>dd</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>dd</span> <span class='hs-varop'>`seq`</span> <span class='hs-varid'>info</span> <span class='hs-layout'>{</span> <span class='hs-varid'>demandInfo</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>dd</span> <span class='hs-layout'>}</span>
<a name="line-32"></a>
<a name="line-33"></a><a name="setStrictnessInfo"></a><span class='hs-definition'>setStrictnessInfo</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>IdInfo</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>StrictSig</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IdInfo</span>
<a name="line-34"></a><span class='hs-definition'>setStrictnessInfo</span> <span class='hs-varid'>info</span> <span class='hs-varid'>dd</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>dd</span> <span class='hs-varop'>`seq`</span> <span class='hs-varid'>info</span> <span class='hs-layout'>{</span> <span class='hs-varid'>strictnessInfo</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>dd</span> <span class='hs-layout'>}</span>
</pre>\end{code}


\begin{code}
<pre><a name="line-1"></a><a name="vanillaIdInfo"></a><span class='hs-comment'>-- | Basic 'IdInfo' that carries no useful information whatsoever</span>
<a name="line-2"></a><span class='hs-definition'>vanillaIdInfo</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>IdInfo</span>
<a name="line-3"></a><span class='hs-definition'>vanillaIdInfo</span> 
<a name="line-4"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>IdInfo</span> <span class='hs-layout'>{</span>
<a name="line-5"></a>	    <span class='hs-varid'>cafInfo</span>		<span class='hs-keyglyph'>=</span> <span class='hs-varid'>vanillaCafInfo</span><span class='hs-layout'>,</span>
<a name="line-6"></a>	    <span class='hs-varid'>arityInfo</span>		<span class='hs-keyglyph'>=</span> <span class='hs-varid'>unknownArity</span><span class='hs-layout'>,</span>
<a name="line-7"></a>	    <span class='hs-varid'>specInfo</span>		<span class='hs-keyglyph'>=</span> <span class='hs-varid'>emptySpecInfo</span><span class='hs-layout'>,</span>
<a name="line-8"></a>	    <span class='hs-varid'>unfoldingInfo</span>	<span class='hs-keyglyph'>=</span> <span class='hs-varid'>noUnfolding</span><span class='hs-layout'>,</span>
<a name="line-9"></a>	    <span class='hs-varid'>oneShotInfo</span>		<span class='hs-keyglyph'>=</span> <span class='hs-conid'>NoOneShotInfo</span><span class='hs-layout'>,</span>
<a name="line-10"></a>	    <span class='hs-varid'>inlinePragInfo</span> 	<span class='hs-keyglyph'>=</span> <span class='hs-varid'>defaultInlinePragma</span><span class='hs-layout'>,</span>
<a name="line-11"></a>	    <span class='hs-varid'>occInfo</span>		<span class='hs-keyglyph'>=</span> <span class='hs-conid'>NoOccInfo</span><span class='hs-layout'>,</span>
<a name="line-12"></a>            <span class='hs-varid'>demandInfo</span>	        <span class='hs-keyglyph'>=</span> <span class='hs-varid'>topDmd</span><span class='hs-layout'>,</span>
<a name="line-13"></a>	    <span class='hs-varid'>strictnessInfo</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>nopSig</span>
<a name="line-14"></a>	   <span class='hs-layout'>}</span>
<a name="line-15"></a>
<a name="line-16"></a><a name="noCafIdInfo"></a><span class='hs-comment'>-- | More informative 'IdInfo' we can use when we know the 'Id' has no CAF references</span>
<a name="line-17"></a><span class='hs-definition'>noCafIdInfo</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>IdInfo</span>
<a name="line-18"></a><span class='hs-definition'>noCafIdInfo</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>vanillaIdInfo</span> <span class='hs-varop'>`setCafInfo`</span>    <span class='hs-conid'>NoCafRefs</span>
<a name="line-19"></a>	<span class='hs-comment'>-- Used for built-in type Ids in MkId.</span>
</pre>\end{code}


%************************************************************************
%*									*
\subsection[arity-IdInfo]{Arity info about an @Id@}
%*									*
%************************************************************************

For locally-defined Ids, the code generator maintains its own notion
of their arities; so it should not be asking...	 (but other things
besides the code-generator need arity info!)

\begin{code}
<pre><a name="line-1"></a><a name="ArityInfo"></a><span class='hs-comment'>-- | An 'ArityInfo' of @n@ tells us that partial application of this </span>
<a name="line-2"></a><a name="ArityInfo"></a><span class='hs-comment'>-- 'Id' to up to @n-1@ value arguments does essentially no work.</span>
<a name="line-3"></a><a name="ArityInfo"></a><span class='hs-comment'>--</span>
<a name="line-4"></a><a name="ArityInfo"></a><span class='hs-comment'>-- That is not necessarily the same as saying that it has @n@ leading </span>
<a name="line-5"></a><a name="ArityInfo"></a><span class='hs-comment'>-- lambdas, because coerces may get in the way.</span>
<a name="line-6"></a><a name="ArityInfo"></a><span class='hs-comment'>--</span>
<a name="line-7"></a><a name="ArityInfo"></a><span class='hs-comment'>-- The arity might increase later in the compilation process, if</span>
<a name="line-8"></a><a name="ArityInfo"></a><span class='hs-comment'>-- an extra lambda floats up to the binding site.</span>
<a name="line-9"></a><a name="ArityInfo"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>ArityInfo</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Arity</span>
<a name="line-10"></a>
<a name="line-11"></a><a name="unknownArity"></a><span class='hs-comment'>-- | It is always safe to assume that an 'Id' has an arity of 0</span>
<a name="line-12"></a><span class='hs-definition'>unknownArity</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Arity</span>
<a name="line-13"></a><span class='hs-definition'>unknownArity</span> <span class='hs-keyglyph'>=</span> <span class='hs-num'>0</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Arity</span>
<a name="line-14"></a>
<a name="line-15"></a><a name="ppArityInfo"></a><span class='hs-definition'>ppArityInfo</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-16"></a><span class='hs-definition'>ppArityInfo</span> <span class='hs-num'>0</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>empty</span>
<a name="line-17"></a><span class='hs-definition'>ppArityInfo</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hsep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"Arity"</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>int</span> <span class='hs-varid'>n</span><span class='hs-keyglyph'>]</span>
</pre>\end{code}

%************************************************************************
%*									*
\subsection{Inline-pragma information}
%*									*
%************************************************************************

\begin{code}
<pre><a name="line-1"></a><a name="InlinePragInfo"></a><span class='hs-comment'>-- | Tells when the inlining is active.</span>
<a name="line-2"></a><a name="InlinePragInfo"></a><span class='hs-comment'>-- When it is active the thing may be inlined, depending on how</span>
<a name="line-3"></a><a name="InlinePragInfo"></a><span class='hs-comment'>-- big it is.</span>
<a name="line-4"></a><a name="InlinePragInfo"></a><span class='hs-comment'>--</span>
<a name="line-5"></a><a name="InlinePragInfo"></a><span class='hs-comment'>-- If there was an @INLINE@ pragma, then as a separate matter, the</span>
<a name="line-6"></a><a name="InlinePragInfo"></a><span class='hs-comment'>-- RHS will have been made to look small with a Core inline 'Note'</span>
<a name="line-7"></a><a name="InlinePragInfo"></a><span class='hs-comment'>--</span>
<a name="line-8"></a><a name="InlinePragInfo"></a><span class='hs-comment'>-- The default 'InlinePragInfo' is 'AlwaysActive', so the info serves</span>
<a name="line-9"></a><a name="InlinePragInfo"></a><span class='hs-comment'>-- entirely as a way to inhibit inlining until we want it</span>
<a name="line-10"></a><a name="InlinePragInfo"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>InlinePragInfo</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>InlinePragma</span>
</pre>\end{code}


%************************************************************************
%*									*
               Strictness
%*									*
%************************************************************************

\begin{code}
<pre><a name="line-1"></a><a name="pprStrictness"></a><span class='hs-definition'>pprStrictness</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>StrictSig</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-2"></a><span class='hs-definition'>pprStrictness</span> <span class='hs-varid'>sig</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>sig</span>
</pre>\end{code}


%************************************************************************
%*									*
	SpecInfo
%*									*
%************************************************************************

Note [Specialisations and RULES in IdInfo]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Generally speaking, a GlobalIdshas an *empty* SpecInfo.  All their
RULES are contained in the globally-built rule-base.  In principle,
one could attach the to M.f the RULES for M.f that are defined in M.
But we don't do that for instance declarations and so we just treat
them all uniformly.

The EXCEPTION is PrimOpIds, which do have rules in their IdInfo. That is
jsut for convenience really.

However, LocalIds may have non-empty SpecInfo.  We treat them 
differently because:
  a) they might be nested, in which case a global table won't work
  b) the RULE might mention free variables, which we use to keep things alive

In TidyPgm, when the LocalId becomes a GlobalId, its RULES are stripped off
and put in the global list.

\begin{code}
<pre><a name="line-1"></a><a name="SpecInfo"></a><span class='hs-comment'>-- | Records the specializations of this 'Id' that we know about</span>
<a name="line-2"></a><a name="SpecInfo"></a><span class='hs-comment'>-- in the form of rewrite 'CoreRule's that target them</span>
<a name="line-3"></a><a name="SpecInfo"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>SpecInfo</span> 
<a name="line-4"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>SpecInfo</span> 
<a name="line-5"></a>	<span class='hs-keyglyph'>[</span><span class='hs-conid'>CoreRule</span><span class='hs-keyglyph'>]</span> 
<a name="line-6"></a>	<span class='hs-conid'>VarSet</span>		<span class='hs-comment'>-- Locally-defined free vars of *both* LHS and RHS </span>
<a name="line-7"></a>			<span class='hs-comment'>-- of rules.  I don't think it needs to include the</span>
<a name="line-8"></a>			<span class='hs-comment'>-- ru_fn though.</span>
<a name="line-9"></a>			<span class='hs-comment'>-- Note [Rule dependency info] in OccurAnal</span>
<a name="line-10"></a>
<a name="line-11"></a><a name="emptySpecInfo"></a><span class='hs-comment'>-- | Assume that no specilizations exist: always safe</span>
<a name="line-12"></a><span class='hs-definition'>emptySpecInfo</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SpecInfo</span>
<a name="line-13"></a><span class='hs-definition'>emptySpecInfo</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>SpecInfo</span> <span class='hs-conid'>[]</span> <span class='hs-varid'>emptyVarSet</span>
<a name="line-14"></a>
<a name="line-15"></a><a name="isEmptySpecInfo"></a><span class='hs-definition'>isEmptySpecInfo</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SpecInfo</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-16"></a><span class='hs-definition'>isEmptySpecInfo</span> <span class='hs-layout'>(</span><span class='hs-conid'>SpecInfo</span> <span class='hs-varid'>rs</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>null</span> <span class='hs-varid'>rs</span>
<a name="line-17"></a>
<a name="line-18"></a><a name="specInfoFreeVars"></a><span class='hs-comment'>-- | Retrieve the locally-defined free variables of both the left and</span>
<a name="line-19"></a><span class='hs-comment'>-- right hand sides of the specialization rules</span>
<a name="line-20"></a><span class='hs-definition'>specInfoFreeVars</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SpecInfo</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>VarSet</span>
<a name="line-21"></a><span class='hs-definition'>specInfoFreeVars</span> <span class='hs-layout'>(</span><span class='hs-conid'>SpecInfo</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>fvs</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fvs</span>
<a name="line-22"></a>
<a name="line-23"></a><a name="specInfoRules"></a><span class='hs-definition'>specInfoRules</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SpecInfo</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>CoreRule</span><span class='hs-keyglyph'>]</span>
<a name="line-24"></a><span class='hs-definition'>specInfoRules</span> <span class='hs-layout'>(</span><span class='hs-conid'>SpecInfo</span> <span class='hs-varid'>rules</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>rules</span>
<a name="line-25"></a>
<a name="line-26"></a><a name="setSpecInfoHead"></a><span class='hs-comment'>-- | Change the name of the function the rule is keyed on on all of the 'CoreRule's</span>
<a name="line-27"></a><span class='hs-definition'>setSpecInfoHead</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SpecInfo</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SpecInfo</span>
<a name="line-28"></a><span class='hs-definition'>setSpecInfoHead</span> <span class='hs-varid'>fn</span> <span class='hs-layout'>(</span><span class='hs-conid'>SpecInfo</span> <span class='hs-varid'>rules</span> <span class='hs-varid'>fvs</span><span class='hs-layout'>)</span>
<a name="line-29"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>SpecInfo</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-varid'>setRuleIdName</span> <span class='hs-varid'>fn</span><span class='hs-layout'>)</span> <span class='hs-varid'>rules</span><span class='hs-layout'>)</span> <span class='hs-varid'>fvs</span>
<a name="line-30"></a>
<a name="line-31"></a><a name="seqSpecInfo"></a><span class='hs-definition'>seqSpecInfo</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SpecInfo</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>()</span>
<a name="line-32"></a><span class='hs-definition'>seqSpecInfo</span> <span class='hs-layout'>(</span><span class='hs-conid'>SpecInfo</span> <span class='hs-varid'>rules</span> <span class='hs-varid'>fvs</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>seqRules</span> <span class='hs-varid'>rules</span> <span class='hs-varop'>`seq`</span> <span class='hs-varid'>seqVarSet</span> <span class='hs-varid'>fvs</span>
</pre>\end{code}

%************************************************************************
%*									*
\subsection[CG-IdInfo]{Code generator-related information}
%*									*
%************************************************************************

\begin{code}
<pre><a name="line-1"></a><span class='hs-comment'>-- CafInfo is used to build Static Reference Tables (see simplStg/SRT.lhs).</span>
<a name="line-2"></a>
<a name="line-3"></a><a name="CafInfo"></a><span class='hs-comment'>-- | Records whether an 'Id' makes Constant Applicative Form references</span>
<a name="line-4"></a><a name="CafInfo"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>CafInfo</span> 
<a name="line-5"></a>	<span class='hs-keyglyph'>=</span> <span class='hs-conid'>MayHaveCafRefs</span>		<span class='hs-comment'>-- ^ Indicates that the 'Id' is for either:</span>
<a name="line-6"></a>					<span class='hs-comment'>--</span>
<a name="line-7"></a>					<span class='hs-comment'>-- 1. A function or static constructor</span>
<a name="line-8"></a>					<span class='hs-comment'>--    that refers to one or more CAFs, or</span>
<a name="line-9"></a>					<span class='hs-comment'>--</span>
<a name="line-10"></a>					<span class='hs-comment'>-- 2. A real live CAF</span>
<a name="line-11"></a>
<a name="line-12"></a>	<span class='hs-keyglyph'>|</span> <span class='hs-conid'>NoCafRefs</span>			<span class='hs-comment'>-- ^ A function or static constructor</span>
<a name="line-13"></a>				        <span class='hs-comment'>-- that refers to no CAFs.</span>
<a name="line-14"></a>        <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Eq</span><span class='hs-layout'>,</span> <span class='hs-conid'>Ord</span><span class='hs-layout'>)</span>
<a name="line-15"></a>
<a name="line-16"></a><a name="vanillaCafInfo"></a><span class='hs-comment'>-- | Assumes that the 'Id' has CAF references: definitely safe</span>
<a name="line-17"></a><span class='hs-definition'>vanillaCafInfo</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>CafInfo</span>
<a name="line-18"></a><span class='hs-definition'>vanillaCafInfo</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>MayHaveCafRefs</span>
<a name="line-19"></a>
<a name="line-20"></a><a name="mayHaveCafRefs"></a><span class='hs-definition'>mayHaveCafRefs</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>CafInfo</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-21"></a><span class='hs-definition'>mayHaveCafRefs</span>  <span class='hs-conid'>MayHaveCafRefs</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-22"></a><span class='hs-definition'>mayHaveCafRefs</span> <span class='hs-keyword'>_</span>	       <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-23"></a>
<a name="line-24"></a><a name="seqCaf"></a><span class='hs-definition'>seqCaf</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>CafInfo</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>()</span>
<a name="line-25"></a><span class='hs-definition'>seqCaf</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>c</span> <span class='hs-varop'>`seq`</span> <span class='hs-conid'>()</span>
<a name="line-26"></a>
<a name="line-27"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Outputable</span> <span class='hs-conid'>CafInfo</span> <span class='hs-keyword'>where</span>
<a name="line-28"></a>   <span class='hs-varid'>ppr</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppCafInfo</span>
<a name="line-29"></a>
<a name="line-30"></a><a name="ppCafInfo"></a><span class='hs-definition'>ppCafInfo</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>CafInfo</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-31"></a><span class='hs-definition'>ppCafInfo</span> <span class='hs-conid'>NoCafRefs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"NoCafRefs"</span><span class='hs-layout'>)</span>
<a name="line-32"></a><span class='hs-definition'>ppCafInfo</span> <span class='hs-conid'>MayHaveCafRefs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>empty</span>
</pre>\end{code}

%************************************************************************
%*									*
\subsection{Bulk operations on IdInfo}
%*									*
%************************************************************************

\begin{code}
<pre><a name="line-1"></a><a name="zapLamInfo"></a><span class='hs-comment'>-- | This is used to remove information on lambda binders that we have</span>
<a name="line-2"></a><span class='hs-comment'>-- setup as part of a lambda group, assuming they will be applied all at once,</span>
<a name="line-3"></a><span class='hs-comment'>-- but turn out to be part of an unsaturated lambda as in e.g:</span>
<a name="line-4"></a><span class='hs-comment'>--</span>
<a name="line-5"></a><span class='hs-comment'>-- &gt; (\x1. \x2. e) arg1</span>
<a name="line-6"></a><span class='hs-definition'>zapLamInfo</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>IdInfo</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>IdInfo</span>
<a name="line-7"></a><span class='hs-definition'>zapLamInfo</span> <span class='hs-varid'>info</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-conid'>IdInfo</span> <span class='hs-layout'>{</span><span class='hs-varid'>occInfo</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>occ</span><span class='hs-layout'>,</span> <span class='hs-varid'>demandInfo</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>demand</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-8"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>is_safe_occ</span> <span class='hs-varid'>occ</span> <span class='hs-varop'>&amp;&amp;</span> <span class='hs-varid'>is_safe_dmd</span> <span class='hs-varid'>demand</span>
<a name="line-9"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-10"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>
<a name="line-11"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-varid'>info</span> <span class='hs-layout'>{</span><span class='hs-varid'>occInfo</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>safe_occ</span><span class='hs-layout'>,</span> <span class='hs-varid'>demandInfo</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>topDmd</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-12"></a>  <span class='hs-keyword'>where</span>
<a name="line-13"></a>	<span class='hs-comment'>-- The "unsafe" occ info is the ones that say I'm not in a lambda</span>
<a name="line-14"></a>	<span class='hs-comment'>-- because that might not be true for an unsaturated lambda</span>
<a name="line-15"></a>    <span class='hs-varid'>is_safe_occ</span> <span class='hs-layout'>(</span><span class='hs-conid'>OneOcc</span> <span class='hs-varid'>in_lam</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>in_lam</span>
<a name="line-16"></a>    <span class='hs-varid'>is_safe_occ</span> <span class='hs-sel'>_other</span>		    <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-17"></a>
<a name="line-18"></a>    <span class='hs-varid'>safe_occ</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>occ</span> <span class='hs-keyword'>of</span>
<a name="line-19"></a>		 <span class='hs-conid'>OneOcc</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>once</span> <span class='hs-varid'>int_cxt</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>OneOcc</span> <span class='hs-varid'>insideLam</span> <span class='hs-varid'>once</span> <span class='hs-varid'>int_cxt</span>
<a name="line-20"></a>		 <span class='hs-sel'>_other</span>	       	       <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>occ</span>
<a name="line-21"></a>
<a name="line-22"></a>    <span class='hs-varid'>is_safe_dmd</span> <span class='hs-varid'>dmd</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>not</span> <span class='hs-layout'>(</span><span class='hs-varid'>isStrictDmd</span> <span class='hs-varid'>dmd</span><span class='hs-layout'>)</span>
</pre>\end{code}

\begin{code}
<pre><a name="line-1"></a><a name="zapDemandInfo"></a><span class='hs-comment'>-- | Remove demand info on the 'IdInfo' if it is present, otherwise return @Nothing@</span>
<a name="line-2"></a><span class='hs-definition'>zapDemandInfo</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>IdInfo</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>IdInfo</span>
<a name="line-3"></a><span class='hs-definition'>zapDemandInfo</span> <span class='hs-varid'>info</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-varid'>info</span> <span class='hs-layout'>{</span><span class='hs-varid'>demandInfo</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>topDmd</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>
</pre>\end{code}

\begin{code}
<pre><a name="line-1"></a><a name="zapFragileInfo"></a><span class='hs-definition'>zapFragileInfo</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>IdInfo</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>IdInfo</span>
<a name="line-2"></a><span class='hs-comment'>-- ^ Zap info that depends on free variables</span>
<a name="line-3"></a><span class='hs-definition'>zapFragileInfo</span> <span class='hs-varid'>info</span> 
<a name="line-4"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-varid'>info</span> <span class='hs-varop'>`setSpecInfo`</span> <span class='hs-varid'>emptySpecInfo</span>
<a name="line-5"></a>               <span class='hs-varop'>`setUnfoldingInfo`</span> <span class='hs-varid'>noUnfolding</span>
<a name="line-6"></a>	       <span class='hs-varop'>`setOccInfo`</span> <span class='hs-varid'>zapFragileOcc</span> <span class='hs-varid'>occ</span><span class='hs-layout'>)</span>
<a name="line-7"></a>  <span class='hs-keyword'>where</span>
<a name="line-8"></a>    <span class='hs-varid'>occ</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>occInfo</span> <span class='hs-varid'>info</span>
</pre>\end{code}

%************************************************************************
%*									*
\subsection{TickBoxOp}
%*									*
%************************************************************************

\begin{code}
<pre><a name="line-1"></a><a name="TickBoxId"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>TickBoxId</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Int</span>
<a name="line-2"></a>
<a name="line-3"></a><a name="TickBoxOp"></a><span class='hs-comment'>-- | Tick box for Hpc-style coverage</span>
<a name="line-4"></a><a name="TickBoxOp"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>TickBoxOp</span> 
<a name="line-5"></a>   <span class='hs-keyglyph'>=</span> <span class='hs-conid'>TickBox</span> <span class='hs-conid'>Module</span> <span class='hs-comment'>{-# UNPACK #-}</span> <span class='hs-varop'>!</span><span class='hs-conid'>TickBoxId</span>
<a name="line-6"></a>
<a name="line-7"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Outputable</span> <span class='hs-conid'>TickBoxOp</span> <span class='hs-keyword'>where</span>
<a name="line-8"></a>    <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>TickBox</span> <span class='hs-varid'>mod</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span>         <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"tick"</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-varid'>mod</span><span class='hs-layout'>,</span><span class='hs-varid'>n</span><span class='hs-layout'>)</span>
</pre>\end{code}
</body>
</html>
