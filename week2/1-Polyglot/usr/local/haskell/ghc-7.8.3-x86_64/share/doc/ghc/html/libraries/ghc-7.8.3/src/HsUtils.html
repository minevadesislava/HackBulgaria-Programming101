<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>hsSyn/HsUtils.lhs</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
%
% (c) The University of Glasgow, 1992-2006
%

Here we collect a variety of helper functions that construct or
analyse HsSyn.  All these functions deal with generic HsSyn; functions
which deal with the intantiated versions are located elsewhere:

   Parameterised by	Module
   ----------------     -------------
   RdrName		parser/RdrHsSyn
   Name			rename/RnHsSyn
   Id			typecheck/TcHsSyn	

\begin{code}
<pre><a name="line-1"></a><span class='hs-comment'>{-# OPTIONS -fno-warn-tabs #-}</span>
<a name="line-2"></a><span class='hs-comment'>-- The above warning supression flag is a temporary kludge.</span>
<a name="line-3"></a><span class='hs-comment'>-- While working on this module you are encouraged to remove it and</span>
<a name="line-4"></a><span class='hs-comment'>-- detab the module (please do the detabbing in a separate patch). See</span>
<a name="line-5"></a><span class='hs-comment'>--     <a href="http://ghc.haskell.org/trac/ghc/wiki/Commentary/CodingStyle#TabsvsSpaces">http://ghc.haskell.org/trac/ghc/wiki/Commentary/CodingStyle#TabsvsSpaces</a></span>
<a name="line-6"></a><span class='hs-comment'>-- for details</span>
<a name="line-7"></a>
<a name="line-8"></a><span class='hs-keyword'>module</span> <span class='hs-conid'>HsUtils</span><span class='hs-layout'>(</span>
<a name="line-9"></a>  <span class='hs-comment'>-- Terms</span>
<a name="line-10"></a>  <span class='hs-varid'>mkHsPar</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkHsApp</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkHsConApp</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkSimpleHsAlt</span><span class='hs-layout'>,</span>
<a name="line-11"></a>  <span class='hs-varid'>mkSimpleMatch</span><span class='hs-layout'>,</span> <span class='hs-varid'>unguardedGRHSs</span><span class='hs-layout'>,</span> <span class='hs-varid'>unguardedRHS</span><span class='hs-layout'>,</span> 
<a name="line-12"></a>  <span class='hs-varid'>mkMatchGroup</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkMatch</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkHsLam</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkHsIf</span><span class='hs-layout'>,</span>
<a name="line-13"></a>  <span class='hs-varid'>mkHsWrap</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkLHsWrap</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkHsWrapCo</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkLHsWrapCo</span><span class='hs-layout'>,</span>
<a name="line-14"></a>  <span class='hs-varid'>coToHsWrapper</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkHsDictLet</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkHsLams</span><span class='hs-layout'>,</span>
<a name="line-15"></a>  <span class='hs-varid'>mkHsOpApp</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkHsDo</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkHsComp</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkHsWrapPat</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkHsWrapPatCo</span><span class='hs-layout'>,</span>
<a name="line-16"></a>  <span class='hs-varid'>mkLHsPar</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkHsCmdCast</span><span class='hs-layout'>,</span>
<a name="line-17"></a>
<a name="line-18"></a>  <span class='hs-varid'>nlHsTyApp</span><span class='hs-layout'>,</span> <span class='hs-varid'>nlHsVar</span><span class='hs-layout'>,</span> <span class='hs-varid'>nlHsLit</span><span class='hs-layout'>,</span> <span class='hs-varid'>nlHsApp</span><span class='hs-layout'>,</span> <span class='hs-varid'>nlHsApps</span><span class='hs-layout'>,</span> <span class='hs-varid'>nlHsIntLit</span><span class='hs-layout'>,</span> <span class='hs-varid'>nlHsVarApps</span><span class='hs-layout'>,</span> 
<a name="line-19"></a>  <span class='hs-varid'>nlHsDo</span><span class='hs-layout'>,</span> <span class='hs-varid'>nlHsOpApp</span><span class='hs-layout'>,</span> <span class='hs-varid'>nlHsLam</span><span class='hs-layout'>,</span> <span class='hs-varid'>nlHsPar</span><span class='hs-layout'>,</span> <span class='hs-varid'>nlHsIf</span><span class='hs-layout'>,</span> <span class='hs-varid'>nlHsCase</span><span class='hs-layout'>,</span> <span class='hs-varid'>nlList</span><span class='hs-layout'>,</span>
<a name="line-20"></a>  <span class='hs-varid'>mkLHsTupleExpr</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkLHsVarTuple</span><span class='hs-layout'>,</span> <span class='hs-varid'>missingTupArg</span><span class='hs-layout'>,</span>
<a name="line-21"></a>  <span class='hs-varid'>toHsType</span><span class='hs-layout'>,</span> <span class='hs-varid'>toHsKind</span><span class='hs-layout'>,</span>
<a name="line-22"></a>
<a name="line-23"></a>  <span class='hs-comment'>-- Bindings</span>
<a name="line-24"></a>  <span class='hs-varid'>mkFunBind</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkVarBind</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkHsVarBind</span><span class='hs-layout'>,</span> <span class='hs-varid'>mk_easy_FunBind</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkTopFunBind</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkPatSynBind</span><span class='hs-layout'>,</span>
<a name="line-25"></a>
<a name="line-26"></a>  <span class='hs-comment'>-- Literals</span>
<a name="line-27"></a>  <span class='hs-varid'>mkHsIntegral</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkHsFractional</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkHsIsString</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkHsString</span><span class='hs-layout'>,</span> 
<a name="line-28"></a>
<a name="line-29"></a>  <span class='hs-comment'>-- Patterns</span>
<a name="line-30"></a>  <span class='hs-varid'>mkNPat</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkNPlusKPat</span><span class='hs-layout'>,</span> <span class='hs-varid'>nlVarPat</span><span class='hs-layout'>,</span> <span class='hs-varid'>nlLitPat</span><span class='hs-layout'>,</span> <span class='hs-varid'>nlConVarPat</span><span class='hs-layout'>,</span> <span class='hs-varid'>nlConPat</span><span class='hs-layout'>,</span> <span class='hs-varid'>nlInfixConPat</span><span class='hs-layout'>,</span>
<a name="line-31"></a>  <span class='hs-varid'>nlNullaryConPat</span><span class='hs-layout'>,</span> <span class='hs-varid'>nlWildConPat</span><span class='hs-layout'>,</span> <span class='hs-varid'>nlWildPat</span><span class='hs-layout'>,</span> <span class='hs-varid'>nlTuplePat</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkParPat</span><span class='hs-layout'>,</span>
<a name="line-32"></a>
<a name="line-33"></a>  <span class='hs-comment'>-- Types</span>
<a name="line-34"></a>  <span class='hs-varid'>mkHsAppTy</span><span class='hs-layout'>,</span> <span class='hs-varid'>userHsTyVarBndrs</span><span class='hs-layout'>,</span>
<a name="line-35"></a>  <span class='hs-varid'>nlHsAppTy</span><span class='hs-layout'>,</span> <span class='hs-varid'>nlHsTyVar</span><span class='hs-layout'>,</span> <span class='hs-varid'>nlHsFunTy</span><span class='hs-layout'>,</span> <span class='hs-varid'>nlHsTyConApp</span><span class='hs-layout'>,</span> 
<a name="line-36"></a>
<a name="line-37"></a>  <span class='hs-comment'>-- Stmts</span>
<a name="line-38"></a>  <span class='hs-varid'>mkTransformStmt</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkTransformByStmt</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkBodyStmt</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkBindStmt</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkLastStmt</span><span class='hs-layout'>,</span>
<a name="line-39"></a>  <span class='hs-varid'>emptyTransStmt</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkGroupUsingStmt</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkGroupByUsingStmt</span><span class='hs-layout'>,</span> 
<a name="line-40"></a>  <span class='hs-varid'>emptyRecStmt</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkRecStmt</span><span class='hs-layout'>,</span> 
<a name="line-41"></a>
<a name="line-42"></a>  <span class='hs-comment'>-- Template Haskell</span>
<a name="line-43"></a>  <span class='hs-varid'>mkHsSpliceTy</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkHsSpliceE</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkHsSpliceTE</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkHsSplice</span><span class='hs-layout'>,</span>
<a name="line-44"></a>  <span class='hs-varid'>mkHsQuasiQuote</span><span class='hs-layout'>,</span> <span class='hs-varid'>unqualQuasiQuote</span><span class='hs-layout'>,</span>
<a name="line-45"></a>
<a name="line-46"></a>  <span class='hs-comment'>-- Flags</span>
<a name="line-47"></a>  <span class='hs-varid'>noRebindableInfo</span><span class='hs-layout'>,</span> 
<a name="line-48"></a>
<a name="line-49"></a>  <span class='hs-comment'>-- Collecting binders</span>
<a name="line-50"></a>  <span class='hs-varid'>collectLocalBinders</span><span class='hs-layout'>,</span> <span class='hs-varid'>collectHsValBinders</span><span class='hs-layout'>,</span> <span class='hs-varid'>collectHsBindListBinders</span><span class='hs-layout'>,</span>
<a name="line-51"></a>  <span class='hs-varid'>collectHsBindsBinders</span><span class='hs-layout'>,</span> <span class='hs-varid'>collectHsBindBinders</span><span class='hs-layout'>,</span> <span class='hs-varid'>collectMethodBinders</span><span class='hs-layout'>,</span>
<a name="line-52"></a>  <span class='hs-varid'>collectPatBinders</span><span class='hs-layout'>,</span> <span class='hs-varid'>collectPatsBinders</span><span class='hs-layout'>,</span>
<a name="line-53"></a>  <span class='hs-varid'>collectLStmtsBinders</span><span class='hs-layout'>,</span> <span class='hs-varid'>collectStmtsBinders</span><span class='hs-layout'>,</span>
<a name="line-54"></a>  <span class='hs-varid'>collectLStmtBinders</span><span class='hs-layout'>,</span> <span class='hs-varid'>collectStmtBinders</span><span class='hs-layout'>,</span>
<a name="line-55"></a>
<a name="line-56"></a>  <span class='hs-varid'>hsLTyClDeclBinders</span><span class='hs-layout'>,</span> <span class='hs-varid'>hsTyClDeclsBinders</span><span class='hs-layout'>,</span> 
<a name="line-57"></a>  <span class='hs-varid'>hsForeignDeclsBinders</span><span class='hs-layout'>,</span> <span class='hs-varid'>hsGroupBinders</span><span class='hs-layout'>,</span> <span class='hs-varid'>hsDataFamInstBinders</span><span class='hs-layout'>,</span>
<a name="line-58"></a>  
<a name="line-59"></a>  <span class='hs-comment'>-- Collecting implicit binders</span>
<a name="line-60"></a>  <span class='hs-varid'>lStmtsImplicits</span><span class='hs-layout'>,</span> <span class='hs-varid'>hsValBindsImplicits</span><span class='hs-layout'>,</span> <span class='hs-varid'>lPatImplicits</span>
<a name="line-61"></a>  <span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-62"></a>
<a name="line-63"></a><span class='hs-cpp'>#include "HsVersions.h"</span>
<a name="line-64"></a>
<a name="line-65"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>HsDecls</span>
<a name="line-66"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>HsBinds</span>
<a name="line-67"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>HsExpr</span>
<a name="line-68"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>HsPat</span>
<a name="line-69"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>HsTypes</span>	
<a name="line-70"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>HsLit</span>
<a name="line-71"></a>
<a name="line-72"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>TcEvidence</span>
<a name="line-73"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>RdrName</span>
<a name="line-74"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Var</span>
<a name="line-75"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>TypeRep</span>
<a name="line-76"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>TcType</span>
<a name="line-77"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Kind</span>
<a name="line-78"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>DataCon</span>
<a name="line-79"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Name</span>
<a name="line-80"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>NameSet</span>
<a name="line-81"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>BasicTypes</span>
<a name="line-82"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>SrcLoc</span>
<a name="line-83"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>FastString</span>
<a name="line-84"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Util</span>
<a name="line-85"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Bag</span>
<a name="line-86"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Outputable</span>
<a name="line-87"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Either</span>
</pre>\end{code}


%************************************************************************
%*									*
	Some useful helpers for constructing syntax
%*									*
%************************************************************************

These functions attempt to construct a not-completely-useless SrcSpan
from their components, compared with the nl* functions below which
just attach noSrcSpan to everything.

\begin{code}
<pre><a name="line-1"></a><a name="mkHsPar"></a><span class='hs-definition'>mkHsPar</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span>
<a name="line-2"></a><span class='hs-definition'>mkHsPar</span> <span class='hs-varid'>e</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>L</span> <span class='hs-layout'>(</span><span class='hs-varid'>getLoc</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsPar</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>
<a name="line-3"></a>
<a name="line-4"></a><a name="mkSimpleMatch"></a><span class='hs-definition'>mkSimpleMatch</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LPat</span> <span class='hs-varid'>id</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-varid'>body</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LMatch</span> <span class='hs-varid'>id</span> <span class='hs-layout'>(</span><span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-varid'>body</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-5"></a><span class='hs-definition'>mkSimpleMatch</span> <span class='hs-varid'>pats</span> <span class='hs-varid'>rhs</span> 
<a name="line-6"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>L</span> <span class='hs-varid'>loc</span> <span class='hs-varop'>$</span>
<a name="line-7"></a>    <span class='hs-conid'>Match</span> <span class='hs-varid'>pats</span> <span class='hs-conid'>Nothing</span> <span class='hs-layout'>(</span><span class='hs-varid'>unguardedGRHSs</span> <span class='hs-varid'>rhs</span><span class='hs-layout'>)</span>
<a name="line-8"></a>  <span class='hs-keyword'>where</span>
<a name="line-9"></a>    <span class='hs-varid'>loc</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>pats</span> <span class='hs-keyword'>of</span>
<a name="line-10"></a>		<span class='hs-conid'>[]</span>      <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>getLoc</span> <span class='hs-varid'>rhs</span>
<a name="line-11"></a>		<span class='hs-layout'>(</span><span class='hs-varid'>pat</span><span class='hs-conop'>:</span><span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>combineSrcSpans</span> <span class='hs-layout'>(</span><span class='hs-varid'>getLoc</span> <span class='hs-varid'>pat</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>getLoc</span> <span class='hs-varid'>rhs</span><span class='hs-layout'>)</span>
<a name="line-12"></a>
<a name="line-13"></a><a name="unguardedGRHSs"></a><span class='hs-definition'>unguardedGRHSs</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-varid'>body</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>GRHSs</span> <span class='hs-varid'>id</span> <span class='hs-layout'>(</span><span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-varid'>body</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-14"></a><span class='hs-definition'>unguardedGRHSs</span> <span class='hs-varid'>rhs</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>GRHSs</span> <span class='hs-layout'>(</span><span class='hs-varid'>unguardedRHS</span> <span class='hs-varid'>rhs</span><span class='hs-layout'>)</span> <span class='hs-varid'>emptyLocalBinds</span>
<a name="line-15"></a>
<a name="line-16"></a><a name="unguardedRHS"></a><span class='hs-definition'>unguardedRHS</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-varid'>body</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LGRHS</span> <span class='hs-varid'>id</span> <span class='hs-layout'>(</span><span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-varid'>body</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-17"></a><span class='hs-definition'>unguardedRHS</span> <span class='hs-varid'>rhs</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-varid'>loc</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>L</span> <span class='hs-varid'>loc</span> <span class='hs-layout'>(</span><span class='hs-conid'>GRHS</span> <span class='hs-conid'>[]</span> <span class='hs-varid'>rhs</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-18"></a>
<a name="line-19"></a><a name="mkMatchGroup"></a><span class='hs-definition'>mkMatchGroup</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Origin</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LMatch</span> <span class='hs-varid'>id</span> <span class='hs-layout'>(</span><span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-varid'>body</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>MatchGroup</span> <span class='hs-varid'>id</span> <span class='hs-layout'>(</span><span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-varid'>body</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-20"></a><span class='hs-definition'>mkMatchGroup</span> <span class='hs-varid'>origin</span> <span class='hs-varid'>matches</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>MG</span> <span class='hs-layout'>{</span> <span class='hs-varid'>mg_alts</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>matches</span><span class='hs-layout'>,</span> <span class='hs-varid'>mg_arg_tys</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>[]</span><span class='hs-layout'>,</span> <span class='hs-varid'>mg_res_ty</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>placeHolderType</span><span class='hs-layout'>,</span> <span class='hs-varid'>mg_origin</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>origin</span> <span class='hs-layout'>}</span>
<a name="line-21"></a>
<a name="line-22"></a><a name="mkHsAppTy"></a><span class='hs-definition'>mkHsAppTy</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LHsType</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsType</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsType</span> <span class='hs-varid'>name</span>
<a name="line-23"></a><span class='hs-definition'>mkHsAppTy</span> <span class='hs-varid'>t1</span> <span class='hs-varid'>t2</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>addCLoc</span> <span class='hs-varid'>t1</span> <span class='hs-varid'>t2</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsAppTy</span> <span class='hs-varid'>t1</span> <span class='hs-varid'>t2</span><span class='hs-layout'>)</span>
<a name="line-24"></a>
<a name="line-25"></a><a name="mkHsApp"></a><span class='hs-definition'>mkHsApp</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>name</span>
<a name="line-26"></a><span class='hs-definition'>mkHsApp</span> <span class='hs-varid'>e1</span> <span class='hs-varid'>e2</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>addCLoc</span> <span class='hs-varid'>e1</span> <span class='hs-varid'>e2</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsApp</span> <span class='hs-varid'>e1</span> <span class='hs-varid'>e2</span><span class='hs-layout'>)</span>
<a name="line-27"></a>
<a name="line-28"></a><a name="mkHsLam"></a><span class='hs-definition'>mkHsLam</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LPat</span> <span class='hs-varid'>id</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span>
<a name="line-29"></a><span class='hs-definition'>mkHsLam</span> <span class='hs-varid'>pats</span> <span class='hs-varid'>body</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkHsPar</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-layout'>(</span><span class='hs-varid'>getLoc</span> <span class='hs-varid'>body</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsLam</span> <span class='hs-varid'>matches</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-30"></a>	<span class='hs-keyword'>where</span>
<a name="line-31"></a>          <span class='hs-varid'>matches</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkMatchGroup</span> <span class='hs-conid'>Generated</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>mkSimpleMatch</span> <span class='hs-varid'>pats</span> <span class='hs-varid'>body</span><span class='hs-keyglyph'>]</span>
<a name="line-32"></a>
<a name="line-33"></a><a name="mkHsLams"></a><span class='hs-definition'>mkHsLams</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>TyVar</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>EvVar</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-conid'>Id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-conid'>Id</span>
<a name="line-34"></a><span class='hs-definition'>mkHsLams</span> <span class='hs-varid'>tyvars</span> <span class='hs-varid'>dicts</span> <span class='hs-varid'>expr</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkLHsWrap</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkWpTyLams</span> <span class='hs-varid'>tyvars</span> <span class='hs-varop'>&lt;.&gt;</span> <span class='hs-varid'>mkWpLams</span> <span class='hs-varid'>dicts</span><span class='hs-layout'>)</span> <span class='hs-varid'>expr</span>
<a name="line-35"></a>
<a name="line-36"></a><a name="mkHsConApp"></a><span class='hs-definition'>mkHsConApp</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>DataCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Type</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>HsExpr</span> <span class='hs-conid'>Id</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-conid'>Id</span>
<a name="line-37"></a><span class='hs-comment'>-- Used for constructing dictionary terms etc, so no locations </span>
<a name="line-38"></a><span class='hs-definition'>mkHsConApp</span> <span class='hs-varid'>data_con</span> <span class='hs-varid'>tys</span> <span class='hs-varid'>args</span> 
<a name="line-39"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>foldl</span> <span class='hs-varid'>mk_app</span> <span class='hs-layout'>(</span><span class='hs-varid'>nlHsTyApp</span> <span class='hs-layout'>(</span><span class='hs-varid'>dataConWrapId</span> <span class='hs-varid'>data_con</span><span class='hs-layout'>)</span> <span class='hs-varid'>tys</span><span class='hs-layout'>)</span> <span class='hs-varid'>args</span>
<a name="line-40"></a>  <span class='hs-keyword'>where</span>
<a name="line-41"></a>    <span class='hs-varid'>mk_app</span> <span class='hs-varid'>f</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>noLoc</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsApp</span> <span class='hs-varid'>f</span> <span class='hs-layout'>(</span><span class='hs-varid'>noLoc</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-42"></a>
<a name="line-43"></a><a name="mkSimpleHsAlt"></a><span class='hs-definition'>mkSimpleHsAlt</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LPat</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-varid'>body</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LMatch</span> <span class='hs-varid'>id</span> <span class='hs-layout'>(</span><span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-varid'>body</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-44"></a><span class='hs-comment'>-- A simple lambda with a single pattern, no binds, no guards; pre-typechecking</span>
<a name="line-45"></a><span class='hs-definition'>mkSimpleHsAlt</span> <span class='hs-varid'>pat</span> <span class='hs-varid'>expr</span> 
<a name="line-46"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkSimpleMatch</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>pat</span><span class='hs-keyglyph'>]</span> <span class='hs-varid'>expr</span>
<a name="line-47"></a>
<a name="line-48"></a><a name="nlHsTyApp"></a><span class='hs-definition'>nlHsTyApp</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Type</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>name</span>
<a name="line-49"></a><span class='hs-definition'>nlHsTyApp</span> <span class='hs-varid'>fun_id</span> <span class='hs-varid'>tys</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>noLoc</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsWrap</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkWpTyApps</span> <span class='hs-varid'>tys</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsVar</span> <span class='hs-varid'>fun_id</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-50"></a>
<a name="line-51"></a><a name="mkLHsPar"></a><span class='hs-comment'>--------- Adding parens ---------</span>
<a name="line-52"></a><span class='hs-definition'>mkLHsPar</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>name</span>
<a name="line-53"></a><span class='hs-comment'>-- Wrap in parens if hsExprNeedsParens says it needs them</span>
<a name="line-54"></a><span class='hs-comment'>-- So   'f x'  becomes '(f x)', but '3' stays as '3'</span>
<a name="line-55"></a><span class='hs-definition'>mkLHsPar</span> <span class='hs-varid'>le</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-varid'>loc</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>hsExprNeedsParens</span> <span class='hs-varid'>e</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>L</span> <span class='hs-varid'>loc</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsPar</span> <span class='hs-varid'>le</span><span class='hs-layout'>)</span>
<a name="line-56"></a>                      <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>           <span class='hs-keyglyph'>=</span> <span class='hs-varid'>le</span>
<a name="line-57"></a>
<a name="line-58"></a><a name="mkParPat"></a><span class='hs-definition'>mkParPat</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LPat</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LPat</span> <span class='hs-varid'>name</span>
<a name="line-59"></a><span class='hs-definition'>mkParPat</span> <span class='hs-varid'>lp</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-varid'>loc</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>hsPatNeedsParens</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>L</span> <span class='hs-varid'>loc</span> <span class='hs-layout'>(</span><span class='hs-conid'>ParPat</span> <span class='hs-varid'>lp</span><span class='hs-layout'>)</span>
<a name="line-60"></a>                      <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>          <span class='hs-keyglyph'>=</span> <span class='hs-varid'>lp</span>
<a name="line-61"></a>
<a name="line-62"></a>
<a name="line-63"></a><span class='hs-comment'>-------------------------------</span>
<a name="line-64"></a><span class='hs-comment'>-- These are the bits of syntax that contain rebindable names</span>
<a name="line-65"></a><span class='hs-comment'>-- See RnEnv.lookupSyntaxName</span>
<a name="line-66"></a>
<a name="line-67"></a><a name="mkHsIntegral"></a><span class='hs-definition'>mkHsIntegral</span>   <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Integer</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>PostTcType</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HsOverLit</span> <span class='hs-varid'>id</span>
<a name="line-68"></a><a name="mkHsFractional"></a><span class='hs-definition'>mkHsFractional</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>FractionalLit</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>PostTcType</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HsOverLit</span> <span class='hs-varid'>id</span>
<a name="line-69"></a><a name="mkHsIsString"></a><span class='hs-definition'>mkHsIsString</span>   <span class='hs-keyglyph'>::</span> <span class='hs-conid'>FastString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>PostTcType</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HsOverLit</span> <span class='hs-varid'>id</span>
<a name="line-70"></a><a name="mkHsDo"></a><span class='hs-definition'>mkHsDo</span>         <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsStmtContext</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>ExprLStmt</span> <span class='hs-varid'>id</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HsExpr</span> <span class='hs-varid'>id</span>
<a name="line-71"></a><a name="mkHsComp"></a><span class='hs-definition'>mkHsComp</span>       <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsStmtContext</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>ExprLStmt</span> <span class='hs-varid'>id</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HsExpr</span> <span class='hs-varid'>id</span>
<a name="line-72"></a>
<a name="line-73"></a><a name="mkNPat"></a><span class='hs-definition'>mkNPat</span>      <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsOverLit</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>SyntaxExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Pat</span> <span class='hs-varid'>id</span>
<a name="line-74"></a><a name="mkNPlusKPat"></a><span class='hs-definition'>mkNPlusKPat</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Located</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HsOverLit</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Pat</span> <span class='hs-varid'>id</span>
<a name="line-75"></a>
<a name="line-76"></a><a name="mkLastStmt"></a><span class='hs-definition'>mkLastStmt</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-varid'>bodyR</span> <span class='hs-varid'>idR</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>StmtLR</span> <span class='hs-varid'>idL</span> <span class='hs-varid'>idR</span> <span class='hs-layout'>(</span><span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-varid'>bodyR</span> <span class='hs-varid'>idR</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-77"></a><a name="mkBodyStmt"></a><span class='hs-definition'>mkBodyStmt</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-varid'>bodyR</span> <span class='hs-varid'>idR</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>StmtLR</span> <span class='hs-varid'>idL</span> <span class='hs-varid'>idR</span> <span class='hs-layout'>(</span><span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-varid'>bodyR</span> <span class='hs-varid'>idR</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-78"></a><a name="mkBindStmt"></a><span class='hs-definition'>mkBindStmt</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LPat</span> <span class='hs-varid'>idL</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-varid'>bodyR</span> <span class='hs-varid'>idR</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>StmtLR</span> <span class='hs-varid'>idL</span> <span class='hs-varid'>idR</span> <span class='hs-layout'>(</span><span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-varid'>bodyR</span> <span class='hs-varid'>idR</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-79"></a>
<a name="line-80"></a><a name="emptyRecStmt"></a><span class='hs-definition'>emptyRecStmt</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>StmtLR</span> <span class='hs-varid'>idL</span> <span class='hs-varid'>idR</span> <span class='hs-varid'>bodyR</span>
<a name="line-81"></a><a name="mkRecStmt"></a><span class='hs-definition'>mkRecStmt</span>    <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LStmtLR</span> <span class='hs-varid'>idL</span> <span class='hs-varid'>idR</span> <span class='hs-varid'>bodyR</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>StmtLR</span> <span class='hs-varid'>idL</span> <span class='hs-varid'>idR</span> <span class='hs-varid'>bodyR</span>
<a name="line-82"></a>
<a name="line-83"></a>
<a name="line-84"></a><span class='hs-definition'>mkHsIntegral</span>   <span class='hs-varid'>i</span>       <span class='hs-keyglyph'>=</span> <span class='hs-conid'>OverLit</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsIntegral</span>   <span class='hs-varid'>i</span><span class='hs-layout'>)</span>  <span class='hs-varid'>noRebindableInfo</span> <span class='hs-varid'>noSyntaxExpr</span>
<a name="line-85"></a><span class='hs-definition'>mkHsFractional</span> <span class='hs-varid'>f</span>       <span class='hs-keyglyph'>=</span> <span class='hs-conid'>OverLit</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsFractional</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span>  <span class='hs-varid'>noRebindableInfo</span> <span class='hs-varid'>noSyntaxExpr</span>
<a name="line-86"></a><span class='hs-definition'>mkHsIsString</span>   <span class='hs-varid'>s</span>       <span class='hs-keyglyph'>=</span> <span class='hs-conid'>OverLit</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsIsString</span>   <span class='hs-varid'>s</span><span class='hs-layout'>)</span>  <span class='hs-varid'>noRebindableInfo</span> <span class='hs-varid'>noSyntaxExpr</span>
<a name="line-87"></a>
<a name="line-88"></a><a name="noRebindableInfo"></a><span class='hs-definition'>noRebindableInfo</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Bool</span>
<a name="line-89"></a><span class='hs-definition'>noRebindableInfo</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>error</span> <span class='hs-str'>"noRebindableInfo"</span> 	<span class='hs-comment'>-- Just another placeholder; </span>
<a name="line-90"></a>
<a name="line-91"></a><span class='hs-definition'>mkHsDo</span> <span class='hs-varid'>ctxt</span> <span class='hs-varid'>stmts</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HsDo</span> <span class='hs-varid'>ctxt</span> <span class='hs-varid'>stmts</span> <span class='hs-varid'>placeHolderType</span>
<a name="line-92"></a><span class='hs-definition'>mkHsComp</span> <span class='hs-varid'>ctxt</span> <span class='hs-varid'>stmts</span> <span class='hs-varid'>expr</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkHsDo</span> <span class='hs-varid'>ctxt</span> <span class='hs-layout'>(</span><span class='hs-varid'>stmts</span> <span class='hs-varop'>++</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>last_stmt</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-93"></a>  <span class='hs-keyword'>where</span>
<a name="line-94"></a>    <span class='hs-varid'>last_stmt</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>L</span> <span class='hs-layout'>(</span><span class='hs-varid'>getLoc</span> <span class='hs-varid'>expr</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-varid'>mkLastStmt</span> <span class='hs-varid'>expr</span>
<a name="line-95"></a>
<a name="line-96"></a><a name="mkHsIf"></a><span class='hs-definition'>mkHsIf</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HsExpr</span> <span class='hs-varid'>id</span>
<a name="line-97"></a><span class='hs-definition'>mkHsIf</span> <span class='hs-varid'>c</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HsIf</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-varid'>noSyntaxExpr</span><span class='hs-layout'>)</span> <span class='hs-varid'>c</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span>
<a name="line-98"></a>
<a name="line-99"></a><span class='hs-definition'>mkNPat</span> <span class='hs-varid'>lit</span> <span class='hs-varid'>neg</span>     <span class='hs-keyglyph'>=</span> <span class='hs-conid'>NPat</span> <span class='hs-varid'>lit</span> <span class='hs-varid'>neg</span> <span class='hs-varid'>noSyntaxExpr</span>
<a name="line-100"></a><span class='hs-definition'>mkNPlusKPat</span> <span class='hs-varid'>id</span> <span class='hs-varid'>lit</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>NPlusKPat</span> <span class='hs-varid'>id</span> <span class='hs-varid'>lit</span> <span class='hs-varid'>noSyntaxExpr</span> <span class='hs-varid'>noSyntaxExpr</span>
<a name="line-101"></a>
<a name="line-102"></a><a name="mkTransformStmt"></a><span class='hs-definition'>mkTransformStmt</span>    <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>ExprLStmt</span> <span class='hs-varid'>idL</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>idR</span>
<a name="line-103"></a>                   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>StmtLR</span> <span class='hs-varid'>idL</span> <span class='hs-varid'>idR</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>idL</span><span class='hs-layout'>)</span>
<a name="line-104"></a><a name="mkTransformByStmt"></a><span class='hs-definition'>mkTransformByStmt</span>  <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>ExprLStmt</span> <span class='hs-varid'>idL</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>idR</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>idR</span>
<a name="line-105"></a>                   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>StmtLR</span> <span class='hs-varid'>idL</span> <span class='hs-varid'>idR</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>idL</span><span class='hs-layout'>)</span>
<a name="line-106"></a><a name="mkGroupUsingStmt"></a><span class='hs-definition'>mkGroupUsingStmt</span>   <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>ExprLStmt</span> <span class='hs-varid'>idL</span><span class='hs-keyglyph'>]</span>                <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>idR</span>
<a name="line-107"></a>                   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>StmtLR</span> <span class='hs-varid'>idL</span> <span class='hs-varid'>idR</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>idL</span><span class='hs-layout'>)</span>
<a name="line-108"></a><a name="mkGroupByUsingStmt"></a><span class='hs-definition'>mkGroupByUsingStmt</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>ExprLStmt</span> <span class='hs-varid'>idL</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>idR</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>idR</span>
<a name="line-109"></a>                   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>StmtLR</span> <span class='hs-varid'>idL</span> <span class='hs-varid'>idR</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>idL</span><span class='hs-layout'>)</span>
<a name="line-110"></a>
<a name="line-111"></a><a name="emptyTransStmt"></a><span class='hs-definition'>emptyTransStmt</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>StmtLR</span> <span class='hs-varid'>idL</span> <span class='hs-varid'>idR</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>idR</span><span class='hs-layout'>)</span>
<a name="line-112"></a><span class='hs-definition'>emptyTransStmt</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>TransStmt</span> <span class='hs-layout'>{</span> <span class='hs-varid'>trS_form</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>panic</span> <span class='hs-str'>"emptyTransStmt: form"</span>
<a name="line-113"></a>                           <span class='hs-layout'>,</span> <span class='hs-varid'>trS_stmts</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>[]</span><span class='hs-layout'>,</span> <span class='hs-varid'>trS_bndrs</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>[]</span> 
<a name="line-114"></a>                           <span class='hs-layout'>,</span> <span class='hs-varid'>trS_by</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span><span class='hs-layout'>,</span> <span class='hs-varid'>trS_using</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>noLoc</span> <span class='hs-varid'>noSyntaxExpr</span>
<a name="line-115"></a>                           <span class='hs-layout'>,</span> <span class='hs-varid'>trS_ret</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>noSyntaxExpr</span><span class='hs-layout'>,</span> <span class='hs-varid'>trS_bind</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>noSyntaxExpr</span>
<a name="line-116"></a>                           <span class='hs-layout'>,</span> <span class='hs-varid'>trS_fmap</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>noSyntaxExpr</span> <span class='hs-layout'>}</span>
<a name="line-117"></a><span class='hs-definition'>mkTransformStmt</span>    <span class='hs-varid'>ss</span> <span class='hs-varid'>u</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>emptyTransStmt</span> <span class='hs-layout'>{</span> <span class='hs-varid'>trS_form</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ThenForm</span><span class='hs-layout'>,</span>  <span class='hs-varid'>trS_stmts</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ss</span><span class='hs-layout'>,</span> <span class='hs-varid'>trS_using</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>u</span> <span class='hs-layout'>}</span>
<a name="line-118"></a><span class='hs-definition'>mkTransformByStmt</span>  <span class='hs-varid'>ss</span> <span class='hs-varid'>u</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>emptyTransStmt</span> <span class='hs-layout'>{</span> <span class='hs-varid'>trS_form</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ThenForm</span><span class='hs-layout'>,</span>  <span class='hs-varid'>trS_stmts</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ss</span><span class='hs-layout'>,</span> <span class='hs-varid'>trS_using</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>u</span><span class='hs-layout'>,</span> <span class='hs-varid'>trS_by</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>b</span> <span class='hs-layout'>}</span>
<a name="line-119"></a><span class='hs-definition'>mkGroupUsingStmt</span>   <span class='hs-varid'>ss</span> <span class='hs-varid'>u</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>emptyTransStmt</span> <span class='hs-layout'>{</span> <span class='hs-varid'>trS_form</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>GroupForm</span><span class='hs-layout'>,</span> <span class='hs-varid'>trS_stmts</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ss</span><span class='hs-layout'>,</span> <span class='hs-varid'>trS_using</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>u</span> <span class='hs-layout'>}</span>
<a name="line-120"></a><span class='hs-definition'>mkGroupByUsingStmt</span> <span class='hs-varid'>ss</span> <span class='hs-varid'>b</span> <span class='hs-varid'>u</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>emptyTransStmt</span> <span class='hs-layout'>{</span> <span class='hs-varid'>trS_form</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>GroupForm</span><span class='hs-layout'>,</span> <span class='hs-varid'>trS_stmts</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ss</span><span class='hs-layout'>,</span> <span class='hs-varid'>trS_using</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>u</span><span class='hs-layout'>,</span> <span class='hs-varid'>trS_by</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>b</span> <span class='hs-layout'>}</span>
<a name="line-121"></a>
<a name="line-122"></a><span class='hs-definition'>mkLastStmt</span> <span class='hs-varid'>body</span>     <span class='hs-keyglyph'>=</span> <span class='hs-conid'>LastStmt</span> <span class='hs-varid'>body</span> <span class='hs-varid'>noSyntaxExpr</span>
<a name="line-123"></a><span class='hs-definition'>mkBodyStmt</span> <span class='hs-varid'>body</span>     <span class='hs-keyglyph'>=</span> <span class='hs-conid'>BodyStmt</span> <span class='hs-varid'>body</span> <span class='hs-varid'>noSyntaxExpr</span> <span class='hs-varid'>noSyntaxExpr</span> <span class='hs-varid'>placeHolderType</span>
<a name="line-124"></a><span class='hs-definition'>mkBindStmt</span> <span class='hs-varid'>pat</span> <span class='hs-varid'>body</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>BindStmt</span> <span class='hs-varid'>pat</span> <span class='hs-varid'>body</span> <span class='hs-varid'>noSyntaxExpr</span> <span class='hs-varid'>noSyntaxExpr</span>
<a name="line-125"></a>
<a name="line-126"></a><span class='hs-definition'>emptyRecStmt</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>RecStmt</span> <span class='hs-layout'>{</span> <span class='hs-varid'>recS_stmts</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>[]</span><span class='hs-layout'>,</span> <span class='hs-varid'>recS_later_ids</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>[]</span><span class='hs-layout'>,</span> <span class='hs-varid'>recS_rec_ids</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>[]</span>
<a name="line-127"></a>                       <span class='hs-layout'>,</span> <span class='hs-varid'>recS_ret_fn</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>noSyntaxExpr</span><span class='hs-layout'>,</span> <span class='hs-varid'>recS_mfix_fn</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>noSyntaxExpr</span>
<a name="line-128"></a>                       <span class='hs-layout'>,</span> <span class='hs-varid'>recS_bind_fn</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>noSyntaxExpr</span><span class='hs-layout'>,</span> <span class='hs-varid'>recS_later_rets</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>[]</span>
<a name="line-129"></a>                       <span class='hs-layout'>,</span> <span class='hs-varid'>recS_rec_rets</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>[]</span><span class='hs-layout'>,</span> <span class='hs-varid'>recS_ret_ty</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>placeHolderType</span> <span class='hs-layout'>}</span>
<a name="line-130"></a>
<a name="line-131"></a><span class='hs-definition'>mkRecStmt</span> <span class='hs-varid'>stmts</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>emptyRecStmt</span> <span class='hs-layout'>{</span> <span class='hs-varid'>recS_stmts</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>stmts</span> <span class='hs-layout'>}</span>
<a name="line-132"></a>
<a name="line-133"></a><a name="mkHsOpApp"></a><span class='hs-comment'>-------------------------------</span>
<a name="line-134"></a><span class='hs-comment'>--- A useful function for building @OpApps@.  The operator is always a</span>
<a name="line-135"></a><span class='hs-comment'>-- variable, and we don't know the fixity yet.</span>
<a name="line-136"></a><span class='hs-definition'>mkHsOpApp</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HsExpr</span> <span class='hs-varid'>id</span>
<a name="line-137"></a><span class='hs-definition'>mkHsOpApp</span> <span class='hs-varid'>e1</span> <span class='hs-varid'>op</span> <span class='hs-varid'>e2</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>OpApp</span> <span class='hs-varid'>e1</span> <span class='hs-layout'>(</span><span class='hs-varid'>noLoc</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsVar</span> <span class='hs-varid'>op</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>error</span> <span class='hs-str'>"mkOpApp:fixity"</span><span class='hs-layout'>)</span> <span class='hs-varid'>e2</span>
<a name="line-138"></a>
<a name="line-139"></a><a name="mkHsSplice"></a><span class='hs-definition'>mkHsSplice</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-conid'>RdrName</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HsSplice</span> <span class='hs-conid'>RdrName</span>
<a name="line-140"></a><span class='hs-definition'>mkHsSplice</span> <span class='hs-varid'>e</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HsSplice</span> <span class='hs-varid'>unqualSplice</span> <span class='hs-varid'>e</span>
<a name="line-141"></a>
<a name="line-142"></a><a name="mkHsSpliceE"></a><span class='hs-definition'>mkHsSpliceE</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-conid'>RdrName</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HsExpr</span> <span class='hs-conid'>RdrName</span>
<a name="line-143"></a><span class='hs-definition'>mkHsSpliceE</span> <span class='hs-varid'>e</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HsSpliceE</span> <span class='hs-conid'>False</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkHsSplice</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>
<a name="line-144"></a>
<a name="line-145"></a><a name="mkHsSpliceTE"></a><span class='hs-definition'>mkHsSpliceTE</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-conid'>RdrName</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HsExpr</span> <span class='hs-conid'>RdrName</span>
<a name="line-146"></a><span class='hs-definition'>mkHsSpliceTE</span> <span class='hs-varid'>e</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HsSpliceE</span> <span class='hs-conid'>True</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkHsSplice</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>
<a name="line-147"></a>
<a name="line-148"></a><a name="mkHsSpliceTy"></a><span class='hs-definition'>mkHsSpliceTy</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-conid'>RdrName</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HsType</span> <span class='hs-conid'>RdrName</span>
<a name="line-149"></a><span class='hs-definition'>mkHsSpliceTy</span> <span class='hs-varid'>e</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HsSpliceTy</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkHsSplice</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-varid'>placeHolderKind</span>
<a name="line-150"></a>
<a name="line-151"></a><a name="unqualSplice"></a><span class='hs-definition'>unqualSplice</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>RdrName</span>
<a name="line-152"></a><span class='hs-definition'>unqualSplice</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkRdrUnqual</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkVarOccFS</span> <span class='hs-layout'>(</span><span class='hs-varid'>fsLit</span> <span class='hs-str'>"splice"</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-153"></a>		<span class='hs-comment'>-- A name (uniquified later) to</span>
<a name="line-154"></a>		<span class='hs-comment'>-- identify the splice</span>
<a name="line-155"></a>
<a name="line-156"></a><a name="mkHsQuasiQuote"></a><span class='hs-definition'>mkHsQuasiQuote</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>RdrName</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SrcSpan</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>FastString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HsQuasiQuote</span> <span class='hs-conid'>RdrName</span>
<a name="line-157"></a><span class='hs-definition'>mkHsQuasiQuote</span> <span class='hs-varid'>quoter</span> <span class='hs-varid'>span</span> <span class='hs-varid'>quote</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HsQuasiQuote</span> <span class='hs-varid'>quoter</span> <span class='hs-varid'>span</span> <span class='hs-varid'>quote</span>
<a name="line-158"></a>
<a name="line-159"></a><a name="unqualQuasiQuote"></a><span class='hs-definition'>unqualQuasiQuote</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>RdrName</span>
<a name="line-160"></a><span class='hs-definition'>unqualQuasiQuote</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkRdrUnqual</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkVarOccFS</span> <span class='hs-layout'>(</span><span class='hs-varid'>fsLit</span> <span class='hs-str'>"quasiquote"</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-161"></a>		<span class='hs-comment'>-- A name (uniquified later) to</span>
<a name="line-162"></a>		<span class='hs-comment'>-- identify the quasi-quote</span>
<a name="line-163"></a>
<a name="line-164"></a><a name="mkHsString"></a><span class='hs-definition'>mkHsString</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HsLit</span>
<a name="line-165"></a><span class='hs-definition'>mkHsString</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HsString</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkFastString</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span>
<a name="line-166"></a>
<a name="line-167"></a><a name="userHsTyVarBndrs"></a><span class='hs-comment'>-------------</span>
<a name="line-168"></a><span class='hs-definition'>userHsTyVarBndrs</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SrcSpan</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>name</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsTyVarBndr</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-169"></a><span class='hs-comment'>-- Caller sets location</span>
<a name="line-170"></a><span class='hs-definition'>userHsTyVarBndrs</span> <span class='hs-varid'>loc</span> <span class='hs-varid'>bndrs</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>[</span> <span class='hs-conid'>L</span> <span class='hs-varid'>loc</span> <span class='hs-layout'>(</span><span class='hs-conid'>UserTyVar</span> <span class='hs-varid'>v</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>bndrs</span> <span class='hs-keyglyph'>]</span>
</pre>\end{code}


%************************************************************************
%*									*
	Constructing syntax with no location info
%*									*
%************************************************************************

\begin{code}
<pre><a name="line-1"></a><a name="nlHsVar"></a><span class='hs-definition'>nlHsVar</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span>
<a name="line-2"></a><span class='hs-definition'>nlHsVar</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>noLoc</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsVar</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span>
<a name="line-3"></a>
<a name="line-4"></a><a name="nlHsLit"></a><span class='hs-definition'>nlHsLit</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsLit</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span>
<a name="line-5"></a><span class='hs-definition'>nlHsLit</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>noLoc</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsLit</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span>
<a name="line-6"></a>
<a name="line-7"></a><a name="nlVarPat"></a><span class='hs-definition'>nlVarPat</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LPat</span> <span class='hs-varid'>id</span>
<a name="line-8"></a><span class='hs-definition'>nlVarPat</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>noLoc</span> <span class='hs-layout'>(</span><span class='hs-conid'>VarPat</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span>
<a name="line-9"></a>
<a name="line-10"></a><a name="nlLitPat"></a><span class='hs-definition'>nlLitPat</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsLit</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LPat</span> <span class='hs-varid'>id</span>
<a name="line-11"></a><span class='hs-definition'>nlLitPat</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>noLoc</span> <span class='hs-layout'>(</span><span class='hs-conid'>LitPat</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span>
<a name="line-12"></a>
<a name="line-13"></a><a name="nlHsApp"></a><span class='hs-definition'>nlHsApp</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span>
<a name="line-14"></a><span class='hs-definition'>nlHsApp</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>noLoc</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsApp</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span>
<a name="line-15"></a>
<a name="line-16"></a><a name="nlHsIntLit"></a><span class='hs-definition'>nlHsIntLit</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Integer</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span>
<a name="line-17"></a><span class='hs-definition'>nlHsIntLit</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>noLoc</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsLit</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsInt</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-18"></a>
<a name="line-19"></a><a name="nlHsApps"></a><span class='hs-definition'>nlHsApps</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span>
<a name="line-20"></a><span class='hs-definition'>nlHsApps</span> <span class='hs-varid'>f</span> <span class='hs-varid'>xs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>foldl</span> <span class='hs-varid'>nlHsApp</span> <span class='hs-layout'>(</span><span class='hs-varid'>nlHsVar</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span> <span class='hs-varid'>xs</span>
<a name="line-21"></a>	     
<a name="line-22"></a><a name="nlHsVarApps"></a><span class='hs-definition'>nlHsVarApps</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>id</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span>
<a name="line-23"></a><span class='hs-definition'>nlHsVarApps</span> <span class='hs-varid'>f</span> <span class='hs-varid'>xs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>noLoc</span> <span class='hs-layout'>(</span><span class='hs-varid'>foldl</span> <span class='hs-varid'>mk</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsVar</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-conid'>HsVar</span> <span class='hs-varid'>xs</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-24"></a>		 <span class='hs-keyword'>where</span>
<a name="line-25"></a>		   <span class='hs-varid'>mk</span> <span class='hs-varid'>f</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HsApp</span> <span class='hs-layout'>(</span><span class='hs-varid'>noLoc</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>noLoc</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-26"></a>
<a name="line-27"></a><a name="nlConVarPat"></a><span class='hs-definition'>nlConVarPat</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>id</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LPat</span> <span class='hs-varid'>id</span>
<a name="line-28"></a><span class='hs-definition'>nlConVarPat</span> <span class='hs-varid'>con</span> <span class='hs-varid'>vars</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>nlConPat</span> <span class='hs-varid'>con</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-varid'>nlVarPat</span> <span class='hs-varid'>vars</span><span class='hs-layout'>)</span>
<a name="line-29"></a>
<a name="line-30"></a><a name="nlInfixConPat"></a><span class='hs-definition'>nlInfixConPat</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LPat</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LPat</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LPat</span> <span class='hs-varid'>id</span>
<a name="line-31"></a><span class='hs-definition'>nlInfixConPat</span> <span class='hs-varid'>con</span> <span class='hs-varid'>l</span> <span class='hs-varid'>r</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>noLoc</span> <span class='hs-layout'>(</span><span class='hs-conid'>ConPatIn</span> <span class='hs-layout'>(</span><span class='hs-varid'>noLoc</span> <span class='hs-varid'>con</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>InfixCon</span> <span class='hs-varid'>l</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-32"></a>
<a name="line-33"></a><a name="nlConPat"></a><span class='hs-definition'>nlConPat</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LPat</span> <span class='hs-varid'>id</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LPat</span> <span class='hs-varid'>id</span>
<a name="line-34"></a><span class='hs-definition'>nlConPat</span> <span class='hs-varid'>con</span> <span class='hs-varid'>pats</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>noLoc</span> <span class='hs-layout'>(</span><span class='hs-conid'>ConPatIn</span> <span class='hs-layout'>(</span><span class='hs-varid'>noLoc</span> <span class='hs-varid'>con</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>PrefixCon</span> <span class='hs-varid'>pats</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-35"></a>
<a name="line-36"></a><a name="nlNullaryConPat"></a><span class='hs-definition'>nlNullaryConPat</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LPat</span> <span class='hs-varid'>id</span>
<a name="line-37"></a><span class='hs-definition'>nlNullaryConPat</span> <span class='hs-varid'>con</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>noLoc</span> <span class='hs-layout'>(</span><span class='hs-conid'>ConPatIn</span> <span class='hs-layout'>(</span><span class='hs-varid'>noLoc</span> <span class='hs-varid'>con</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>PrefixCon</span> <span class='hs-conid'>[]</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-38"></a>
<a name="line-39"></a><a name="nlWildConPat"></a><span class='hs-definition'>nlWildConPat</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>DataCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LPat</span> <span class='hs-conid'>RdrName</span>
<a name="line-40"></a><span class='hs-definition'>nlWildConPat</span> <span class='hs-varid'>con</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>noLoc</span> <span class='hs-layout'>(</span><span class='hs-conid'>ConPatIn</span> <span class='hs-layout'>(</span><span class='hs-varid'>noLoc</span> <span class='hs-layout'>(</span><span class='hs-varid'>getRdrName</span> <span class='hs-varid'>con</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-41"></a>				   <span class='hs-layout'>(</span><span class='hs-conid'>PrefixCon</span> <span class='hs-layout'>(</span><span class='hs-varid'>nOfThem</span> <span class='hs-layout'>(</span><span class='hs-varid'>dataConSourceArity</span> <span class='hs-varid'>con</span><span class='hs-layout'>)</span> <span class='hs-varid'>nlWildPat</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-42"></a>
<a name="line-43"></a><a name="nlWildPat"></a><span class='hs-definition'>nlWildPat</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LPat</span> <span class='hs-varid'>id</span>
<a name="line-44"></a><span class='hs-definition'>nlWildPat</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>noLoc</span> <span class='hs-layout'>(</span><span class='hs-conid'>WildPat</span> <span class='hs-varid'>placeHolderType</span><span class='hs-layout'>)</span>	<span class='hs-comment'>-- Pre-typechecking</span>
<a name="line-45"></a>
<a name="line-46"></a><a name="nlHsDo"></a><span class='hs-definition'>nlHsDo</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsStmtContext</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LStmt</span> <span class='hs-varid'>id</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span>
<a name="line-47"></a><span class='hs-definition'>nlHsDo</span> <span class='hs-varid'>ctxt</span> <span class='hs-varid'>stmts</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>noLoc</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkHsDo</span> <span class='hs-varid'>ctxt</span> <span class='hs-varid'>stmts</span><span class='hs-layout'>)</span>
<a name="line-48"></a>
<a name="line-49"></a><a name="nlHsOpApp"></a><span class='hs-definition'>nlHsOpApp</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span>
<a name="line-50"></a><span class='hs-definition'>nlHsOpApp</span> <span class='hs-varid'>e1</span> <span class='hs-varid'>op</span> <span class='hs-varid'>e2</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>noLoc</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkHsOpApp</span> <span class='hs-varid'>e1</span> <span class='hs-varid'>op</span> <span class='hs-varid'>e2</span><span class='hs-layout'>)</span>
<a name="line-51"></a>
<a name="line-52"></a><a name="nlHsLam"></a><span class='hs-definition'>nlHsLam</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LMatch</span> <span class='hs-varid'>id</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span>
<a name="line-53"></a><a name="nlHsPar"></a><span class='hs-definition'>nlHsPar</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span>
<a name="line-54"></a><a name="nlHsIf"></a><span class='hs-definition'>nlHsIf</span>   <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span>
<a name="line-55"></a><a name="nlHsCase"></a><span class='hs-definition'>nlHsCase</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LMatch</span> <span class='hs-varid'>id</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span>
<a name="line-56"></a><a name="nlList"></a><span class='hs-definition'>nlList</span>   <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span>
<a name="line-57"></a>
<a name="line-58"></a><span class='hs-definition'>nlHsLam</span>	<span class='hs-varid'>match</span>          <span class='hs-keyglyph'>=</span> <span class='hs-varid'>noLoc</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsLam</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkMatchGroup</span> <span class='hs-conid'>Generated</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>match</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-59"></a><span class='hs-definition'>nlHsPar</span> <span class='hs-varid'>e</span>              <span class='hs-keyglyph'>=</span> <span class='hs-varid'>noLoc</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsPar</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>
<a name="line-60"></a><span class='hs-definition'>nlHsIf</span> <span class='hs-varid'>cond</span> <span class='hs-varid'>true</span> <span class='hs-varid'>false</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>noLoc</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkHsIf</span> <span class='hs-varid'>cond</span> <span class='hs-varid'>true</span> <span class='hs-varid'>false</span><span class='hs-layout'>)</span>
<a name="line-61"></a><span class='hs-definition'>nlHsCase</span> <span class='hs-varid'>expr</span> <span class='hs-varid'>matches</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>noLoc</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsCase</span> <span class='hs-varid'>expr</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkMatchGroup</span> <span class='hs-conid'>Generated</span> <span class='hs-varid'>matches</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-62"></a><span class='hs-definition'>nlList</span> <span class='hs-varid'>exprs</span>           <span class='hs-keyglyph'>=</span> <span class='hs-varid'>noLoc</span> <span class='hs-layout'>(</span><span class='hs-conid'>ExplicitList</span> <span class='hs-varid'>placeHolderType</span> <span class='hs-conid'>Nothing</span> <span class='hs-varid'>exprs</span><span class='hs-layout'>)</span>
<a name="line-63"></a>
<a name="line-64"></a><a name="nlHsAppTy"></a><span class='hs-definition'>nlHsAppTy</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LHsType</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsType</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsType</span> <span class='hs-varid'>name</span>
<a name="line-65"></a><a name="nlHsTyVar"></a><span class='hs-definition'>nlHsTyVar</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>name</span>                         <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsType</span> <span class='hs-varid'>name</span>
<a name="line-66"></a><a name="nlHsFunTy"></a><span class='hs-definition'>nlHsFunTy</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LHsType</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsType</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsType</span> <span class='hs-varid'>name</span>
<a name="line-67"></a>
<a name="line-68"></a><span class='hs-definition'>nlHsAppTy</span> <span class='hs-varid'>f</span> <span class='hs-varid'>t</span>		<span class='hs-keyglyph'>=</span> <span class='hs-varid'>noLoc</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsAppTy</span> <span class='hs-varid'>f</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span>
<a name="line-69"></a><span class='hs-definition'>nlHsTyVar</span> <span class='hs-varid'>x</span>		<span class='hs-keyglyph'>=</span> <span class='hs-varid'>noLoc</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsTyVar</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span>
<a name="line-70"></a><span class='hs-definition'>nlHsFunTy</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span>		<span class='hs-keyglyph'>=</span> <span class='hs-varid'>noLoc</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsFunTy</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span>
<a name="line-71"></a>
<a name="line-72"></a><a name="nlHsTyConApp"></a><span class='hs-definition'>nlHsTyConApp</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LHsType</span> <span class='hs-varid'>name</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsType</span> <span class='hs-varid'>name</span>
<a name="line-73"></a><span class='hs-definition'>nlHsTyConApp</span> <span class='hs-varid'>tycon</span> <span class='hs-varid'>tys</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>foldl</span> <span class='hs-varid'>nlHsAppTy</span> <span class='hs-layout'>(</span><span class='hs-varid'>nlHsTyVar</span> <span class='hs-varid'>tycon</span><span class='hs-layout'>)</span> <span class='hs-varid'>tys</span>
</pre>\end{code}

Tuples.  All these functions are *pre-typechecker* because they lack
types on the tuple.

\begin{code}
<pre><a name="line-1"></a><a name="mkLHsTupleExpr"></a><span class='hs-definition'>mkLHsTupleExpr</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>a</span>
<a name="line-2"></a><span class='hs-comment'>-- Makes a pre-typechecker boxed tuple, deals with 1 case</span>
<a name="line-3"></a><span class='hs-definition'>mkLHsTupleExpr</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>e</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>e</span>
<a name="line-4"></a><span class='hs-definition'>mkLHsTupleExpr</span> <span class='hs-varid'>es</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>noLoc</span> <span class='hs-varop'>$</span> <span class='hs-conid'>ExplicitTuple</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-conid'>Present</span> <span class='hs-varid'>es</span><span class='hs-layout'>)</span> <span class='hs-conid'>Boxed</span>
<a name="line-5"></a>
<a name="line-6"></a><a name="mkLHsVarTuple"></a><span class='hs-definition'>mkLHsVarTuple</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>a</span>
<a name="line-7"></a><span class='hs-definition'>mkLHsVarTuple</span> <span class='hs-varid'>ids</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkLHsTupleExpr</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-varid'>nlHsVar</span> <span class='hs-varid'>ids</span><span class='hs-layout'>)</span>
<a name="line-8"></a>
<a name="line-9"></a><a name="nlTuplePat"></a><span class='hs-definition'>nlTuplePat</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LPat</span> <span class='hs-varid'>id</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Boxity</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LPat</span> <span class='hs-varid'>id</span>
<a name="line-10"></a><span class='hs-definition'>nlTuplePat</span> <span class='hs-varid'>pats</span> <span class='hs-varid'>box</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>noLoc</span> <span class='hs-layout'>(</span><span class='hs-conid'>TuplePat</span> <span class='hs-varid'>pats</span> <span class='hs-varid'>box</span> <span class='hs-conid'>[]</span><span class='hs-layout'>)</span>
<a name="line-11"></a>
<a name="line-12"></a><a name="missingTupArg"></a><span class='hs-definition'>missingTupArg</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsTupArg</span> <span class='hs-varid'>a</span>
<a name="line-13"></a><span class='hs-definition'>missingTupArg</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Missing</span> <span class='hs-varid'>placeHolderType</span>
</pre>\end{code}


%************************************************************************
%*									*
        Converting a Type to an HsType RdrName
%*									*
%************************************************************************

This is needed to implement GeneralizedNewtypeDeriving.

\begin{code}
<pre><a name="line-1"></a><a name="toHsType"></a><span class='hs-definition'>toHsType</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Type</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsType</span> <span class='hs-conid'>RdrName</span>
<a name="line-2"></a><span class='hs-definition'>toHsType</span> <span class='hs-varid'>ty</span>
<a name="line-3"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>[]</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>tvs_only</span>
<a name="line-4"></a>  <span class='hs-layout'>,</span> <span class='hs-conid'>[]</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>theta</span>
<a name="line-5"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>to_hs_type</span> <span class='hs-varid'>tau</span>
<a name="line-6"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>
<a name="line-7"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>noLoc</span> <span class='hs-varop'>$</span>
<a name="line-8"></a>    <span class='hs-varid'>mkExplicitHsForAllTy</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-varid'>mk_hs_tvb</span> <span class='hs-varid'>tvs_only</span><span class='hs-layout'>)</span>
<a name="line-9"></a>                         <span class='hs-layout'>(</span><span class='hs-varid'>noLoc</span> <span class='hs-varop'>$</span> <span class='hs-varid'>map</span> <span class='hs-varid'>toHsType</span> <span class='hs-varid'>theta</span><span class='hs-layout'>)</span>
<a name="line-10"></a>                         <span class='hs-layout'>(</span><span class='hs-varid'>to_hs_type</span> <span class='hs-varid'>tau</span><span class='hs-layout'>)</span>
<a name="line-11"></a>
<a name="line-12"></a>  <span class='hs-keyword'>where</span>
<a name="line-13"></a>    <span class='hs-layout'>(</span><span class='hs-varid'>tvs</span><span class='hs-layout'>,</span> <span class='hs-varid'>theta</span><span class='hs-layout'>,</span> <span class='hs-varid'>tau</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tcSplitSigmaTy</span> <span class='hs-varid'>ty</span>
<a name="line-14"></a>    <span class='hs-varid'>tvs_only</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>filter</span> <span class='hs-varid'>isTypeVar</span> <span class='hs-varid'>tvs</span>
<a name="line-15"></a>
<a name="line-16"></a>    <span class='hs-varid'>to_hs_type</span> <span class='hs-layout'>(</span><span class='hs-conid'>TyVarTy</span> <span class='hs-varid'>tv</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>nlHsTyVar</span> <span class='hs-layout'>(</span><span class='hs-varid'>getRdrName</span> <span class='hs-varid'>tv</span><span class='hs-layout'>)</span>
<a name="line-17"></a>    <span class='hs-varid'>to_hs_type</span> <span class='hs-layout'>(</span><span class='hs-conid'>AppTy</span> <span class='hs-varid'>t1</span> <span class='hs-varid'>t2</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>nlHsAppTy</span> <span class='hs-layout'>(</span><span class='hs-varid'>toHsType</span> <span class='hs-varid'>t1</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>toHsType</span> <span class='hs-varid'>t2</span><span class='hs-layout'>)</span>
<a name="line-18"></a>    <span class='hs-varid'>to_hs_type</span> <span class='hs-layout'>(</span><span class='hs-conid'>TyConApp</span> <span class='hs-varid'>tc</span> <span class='hs-varid'>args</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>nlHsTyConApp</span> <span class='hs-layout'>(</span><span class='hs-varid'>getRdrName</span> <span class='hs-varid'>tc</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-varid'>toHsType</span> <span class='hs-varid'>args'</span><span class='hs-layout'>)</span>
<a name="line-19"></a>       <span class='hs-keyword'>where</span> 
<a name="line-20"></a>         <span class='hs-varid'>args'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>filterOut</span> <span class='hs-varid'>isKind</span> <span class='hs-varid'>args</span>
<a name="line-21"></a>         <span class='hs-comment'>-- Source-language types have _implicit_ kind arguments,</span>
<a name="line-22"></a>         <span class='hs-comment'>-- so we must remove them here (Trac #8563)</span>
<a name="line-23"></a>    <span class='hs-varid'>to_hs_type</span> <span class='hs-layout'>(</span><span class='hs-conid'>FunTy</span> <span class='hs-varid'>arg</span> <span class='hs-varid'>res</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ASSERT</span><span class='hs-layout'>(</span> <span class='hs-varid'>not</span> <span class='hs-layout'>(</span><span class='hs-varid'>isConstraintKind</span> <span class='hs-layout'>(</span><span class='hs-varid'>typeKind</span> <span class='hs-varid'>arg</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-layout'>)</span>
<a name="line-24"></a>                                 <span class='hs-varid'>nlHsFunTy</span> <span class='hs-layout'>(</span><span class='hs-varid'>toHsType</span> <span class='hs-varid'>arg</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>toHsType</span> <span class='hs-varid'>res</span><span class='hs-layout'>)</span>
<a name="line-25"></a>    <span class='hs-varid'>to_hs_type</span> <span class='hs-varid'>t</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-conid'>ForAllTy</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprPanic</span> <span class='hs-str'>"toHsType"</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span>
<a name="line-26"></a>    <span class='hs-varid'>to_hs_type</span> <span class='hs-layout'>(</span><span class='hs-conid'>LitTy</span> <span class='hs-layout'>(</span><span class='hs-conid'>NumTyLit</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>noLoc</span> <span class='hs-varop'>$</span> <span class='hs-conid'>HsTyLit</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsNumTy</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span>
<a name="line-27"></a>    <span class='hs-varid'>to_hs_type</span> <span class='hs-layout'>(</span><span class='hs-conid'>LitTy</span> <span class='hs-layout'>(</span><span class='hs-conid'>StrTyLit</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>noLoc</span> <span class='hs-varop'>$</span> <span class='hs-conid'>HsTyLit</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsStrTy</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span>
<a name="line-28"></a>
<a name="line-29"></a>    <span class='hs-varid'>mk_hs_tvb</span> <span class='hs-varid'>tv</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>noLoc</span> <span class='hs-varop'>$</span> <span class='hs-conid'>KindedTyVar</span> <span class='hs-layout'>(</span><span class='hs-varid'>getRdrName</span> <span class='hs-varid'>tv</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>toHsKind</span> <span class='hs-layout'>(</span><span class='hs-varid'>tyVarKind</span> <span class='hs-varid'>tv</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-30"></a>
<a name="line-31"></a><a name="toHsKind"></a><span class='hs-definition'>toHsKind</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Kind</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsKind</span> <span class='hs-conid'>RdrName</span>
<a name="line-32"></a><span class='hs-definition'>toHsKind</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>toHsType</span>
<a name="line-33"></a>
</pre>\end{code}

\begin{code}
<pre><a name="line-1"></a><a name="mkLHsWrap"></a><span class='hs-comment'>--------- HsWrappers: type args, dict args, casts ---------</span>
<a name="line-2"></a><span class='hs-definition'>mkLHsWrap</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsWrapper</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span>
<a name="line-3"></a><span class='hs-definition'>mkLHsWrap</span> <span class='hs-varid'>co_fn</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-varid'>loc</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>L</span> <span class='hs-varid'>loc</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkHsWrap</span> <span class='hs-varid'>co_fn</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>
<a name="line-4"></a>
<a name="line-5"></a><a name="mkHsWrap"></a><span class='hs-definition'>mkHsWrap</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsWrapper</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HsExpr</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HsExpr</span> <span class='hs-varid'>id</span>
<a name="line-6"></a><span class='hs-definition'>mkHsWrap</span> <span class='hs-varid'>co_fn</span> <span class='hs-varid'>e</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>isIdHsWrapper</span> <span class='hs-varid'>co_fn</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>e</span>
<a name="line-7"></a>		 <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>	       <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HsWrap</span> <span class='hs-varid'>co_fn</span> <span class='hs-varid'>e</span>
<a name="line-8"></a>
<a name="line-9"></a><a name="mkHsWrapCo"></a><span class='hs-definition'>mkHsWrapCo</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TcCoercion</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HsExpr</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HsExpr</span> <span class='hs-varid'>id</span>
<a name="line-10"></a><span class='hs-definition'>mkHsWrapCo</span> <span class='hs-varid'>co</span> <span class='hs-varid'>e</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkHsWrap</span> <span class='hs-layout'>(</span><span class='hs-varid'>coToHsWrapper</span> <span class='hs-varid'>co</span><span class='hs-layout'>)</span> <span class='hs-varid'>e</span>
<a name="line-11"></a>
<a name="line-12"></a><a name="mkLHsWrapCo"></a><span class='hs-definition'>mkLHsWrapCo</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TcCoercion</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span>
<a name="line-13"></a><span class='hs-definition'>mkLHsWrapCo</span> <span class='hs-varid'>co</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-varid'>loc</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>L</span> <span class='hs-varid'>loc</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkHsWrapCo</span> <span class='hs-varid'>co</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>
<a name="line-14"></a>
<a name="line-15"></a><a name="mkHsCmdCast"></a><span class='hs-definition'>mkHsCmdCast</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TcCoercion</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HsCmd</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HsCmd</span> <span class='hs-varid'>id</span>
<a name="line-16"></a><span class='hs-definition'>mkHsCmdCast</span> <span class='hs-varid'>co</span> <span class='hs-varid'>cmd</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>isTcReflCo</span> <span class='hs-varid'>co</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>cmd</span>
<a name="line-17"></a>                   <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>     <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HsCmdCast</span> <span class='hs-varid'>co</span> <span class='hs-varid'>cmd</span>
<a name="line-18"></a>
<a name="line-19"></a><a name="coToHsWrapper"></a><span class='hs-definition'>coToHsWrapper</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TcCoercion</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HsWrapper</span>
<a name="line-20"></a><span class='hs-definition'>coToHsWrapper</span> <span class='hs-varid'>co</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>isTcReflCo</span> <span class='hs-varid'>co</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>idHsWrapper</span>
<a name="line-21"></a>                 <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkWpCast</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkTcSubCo</span> <span class='hs-varid'>co</span><span class='hs-layout'>)</span>
<a name="line-22"></a>
<a name="line-23"></a><a name="mkHsWrapPat"></a><span class='hs-definition'>mkHsWrapPat</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsWrapper</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Pat</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Type</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Pat</span> <span class='hs-varid'>id</span>
<a name="line-24"></a><span class='hs-definition'>mkHsWrapPat</span> <span class='hs-varid'>co_fn</span> <span class='hs-varid'>p</span> <span class='hs-varid'>ty</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>isIdHsWrapper</span> <span class='hs-varid'>co_fn</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>p</span>
<a name="line-25"></a>		       <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>	     <span class='hs-keyglyph'>=</span> <span class='hs-conid'>CoPat</span> <span class='hs-varid'>co_fn</span> <span class='hs-varid'>p</span> <span class='hs-varid'>ty</span>
<a name="line-26"></a>
<a name="line-27"></a><a name="mkHsWrapPatCo"></a><span class='hs-definition'>mkHsWrapPatCo</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TcCoercion</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Pat</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Type</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Pat</span> <span class='hs-varid'>id</span>
<a name="line-28"></a><span class='hs-definition'>mkHsWrapPatCo</span> <span class='hs-varid'>co</span> <span class='hs-varid'>pat</span> <span class='hs-varid'>ty</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>isTcReflCo</span> <span class='hs-varid'>co</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pat</span>
<a name="line-29"></a>                        <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>     <span class='hs-keyglyph'>=</span> <span class='hs-conid'>CoPat</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkWpCast</span> <span class='hs-varid'>co</span><span class='hs-layout'>)</span> <span class='hs-varid'>pat</span> <span class='hs-varid'>ty</span>
<a name="line-30"></a>
<a name="line-31"></a><a name="mkHsDictLet"></a><span class='hs-definition'>mkHsDictLet</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TcEvBinds</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-conid'>Id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-conid'>Id</span>
<a name="line-32"></a><span class='hs-definition'>mkHsDictLet</span> <span class='hs-varid'>ev_binds</span> <span class='hs-varid'>expr</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkLHsWrap</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkWpLet</span> <span class='hs-varid'>ev_binds</span><span class='hs-layout'>)</span> <span class='hs-varid'>expr</span>
</pre>\end{code}
l
%************************************************************************
%*									*
		Bindings; with a location at the top
%*									*
%************************************************************************

\begin{code}
<pre><a name="line-1"></a><a name="mkFunBind"></a><span class='hs-definition'>mkFunBind</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Located</span> <span class='hs-conid'>RdrName</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LMatch</span> <span class='hs-conid'>RdrName</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-conid'>RdrName</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HsBind</span> <span class='hs-conid'>RdrName</span>
<a name="line-2"></a><span class='hs-comment'>-- Not infix, with place holders for coercion and free vars</span>
<a name="line-3"></a><span class='hs-definition'>mkFunBind</span> <span class='hs-varid'>fn</span> <span class='hs-varid'>ms</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>FunBind</span> <span class='hs-layout'>{</span> <span class='hs-varid'>fun_id</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fn</span><span class='hs-layout'>,</span> <span class='hs-varid'>fun_infix</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-4"></a>                          <span class='hs-layout'>,</span> <span class='hs-varid'>fun_matches</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkMatchGroup</span> <span class='hs-conid'>Generated</span> <span class='hs-varid'>ms</span>
<a name="line-5"></a>                          <span class='hs-layout'>,</span> <span class='hs-varid'>fun_co_fn</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>idHsWrapper</span>
<a name="line-6"></a>                          <span class='hs-layout'>,</span> <span class='hs-varid'>bind_fvs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>placeHolderNames</span>
<a name="line-7"></a>                          <span class='hs-layout'>,</span> <span class='hs-varid'>fun_tick</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span> <span class='hs-layout'>}</span>
<a name="line-8"></a>
<a name="line-9"></a><a name="mkTopFunBind"></a><span class='hs-definition'>mkTopFunBind</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Origin</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Located</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LMatch</span> <span class='hs-conid'>Name</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-conid'>Name</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HsBind</span> <span class='hs-conid'>Name</span>
<a name="line-10"></a><span class='hs-comment'>-- In Name-land, with empty bind_fvs</span>
<a name="line-11"></a><span class='hs-definition'>mkTopFunBind</span> <span class='hs-varid'>origin</span> <span class='hs-varid'>fn</span> <span class='hs-varid'>ms</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>FunBind</span> <span class='hs-layout'>{</span> <span class='hs-varid'>fun_id</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fn</span><span class='hs-layout'>,</span> <span class='hs-varid'>fun_infix</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-12"></a>                                    <span class='hs-layout'>,</span> <span class='hs-varid'>fun_matches</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkMatchGroup</span> <span class='hs-varid'>origin</span> <span class='hs-varid'>ms</span>
<a name="line-13"></a>                                    <span class='hs-layout'>,</span> <span class='hs-varid'>fun_co_fn</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>idHsWrapper</span>
<a name="line-14"></a>                                    <span class='hs-layout'>,</span> <span class='hs-varid'>bind_fvs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>emptyNameSet</span>	<span class='hs-comment'>-- NB: closed binding</span>
<a name="line-15"></a>                                    <span class='hs-layout'>,</span> <span class='hs-varid'>fun_tick</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span> <span class='hs-layout'>}</span>
<a name="line-16"></a>
<a name="line-17"></a><a name="mkHsVarBind"></a><span class='hs-definition'>mkHsVarBind</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SrcSpan</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>RdrName</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-conid'>RdrName</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsBind</span> <span class='hs-conid'>RdrName</span>
<a name="line-18"></a><span class='hs-definition'>mkHsVarBind</span> <span class='hs-varid'>loc</span> <span class='hs-varid'>var</span> <span class='hs-varid'>rhs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mk_easy_FunBind</span> <span class='hs-varid'>loc</span> <span class='hs-varid'>var</span> <span class='hs-conid'>[]</span> <span class='hs-varid'>rhs</span>
<a name="line-19"></a>
<a name="line-20"></a><a name="mkVarBind"></a><span class='hs-definition'>mkVarBind</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsBind</span> <span class='hs-varid'>id</span>
<a name="line-21"></a><span class='hs-definition'>mkVarBind</span> <span class='hs-varid'>var</span> <span class='hs-varid'>rhs</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>L</span> <span class='hs-layout'>(</span><span class='hs-varid'>getLoc</span> <span class='hs-varid'>rhs</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span>
<a name="line-22"></a>		    <span class='hs-conid'>VarBind</span> <span class='hs-layout'>{</span> <span class='hs-varid'>var_id</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>var</span><span class='hs-layout'>,</span> <span class='hs-varid'>var_rhs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>rhs</span><span class='hs-layout'>,</span> <span class='hs-varid'>var_inline</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span> <span class='hs-layout'>}</span>
<a name="line-23"></a>
<a name="line-24"></a><a name="mkPatSynBind"></a><span class='hs-definition'>mkPatSynBind</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Located</span> <span class='hs-conid'>RdrName</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HsPatSynDetails</span> <span class='hs-layout'>(</span><span class='hs-conid'>Located</span> <span class='hs-conid'>RdrName</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LPat</span> <span class='hs-conid'>RdrName</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HsPatSynDir</span> <span class='hs-conid'>RdrName</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HsBind</span> <span class='hs-conid'>RdrName</span>
<a name="line-25"></a><span class='hs-definition'>mkPatSynBind</span> <span class='hs-varid'>name</span> <span class='hs-varid'>details</span> <span class='hs-varid'>lpat</span> <span class='hs-varid'>dir</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>PatSynBind</span><span class='hs-layout'>{</span> <span class='hs-varid'>patsyn_id</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>name</span>
<a name="line-26"></a>                                               <span class='hs-layout'>,</span> <span class='hs-varid'>patsyn_args</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>details</span>
<a name="line-27"></a>                                               <span class='hs-layout'>,</span> <span class='hs-varid'>patsyn_def</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>lpat</span>
<a name="line-28"></a>                                               <span class='hs-layout'>,</span> <span class='hs-varid'>patsyn_dir</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>dir</span>
<a name="line-29"></a>                                               <span class='hs-layout'>,</span> <span class='hs-varid'>bind_fvs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>placeHolderNames</span> <span class='hs-layout'>}</span>
<a name="line-30"></a>
<a name="line-31"></a><a name="mk_easy_FunBind"></a><span class='hs-comment'>------------</span>
<a name="line-32"></a><span class='hs-definition'>mk_easy_FunBind</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SrcSpan</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>RdrName</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LPat</span> <span class='hs-conid'>RdrName</span><span class='hs-keyglyph'>]</span>
<a name="line-33"></a>		<span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-conid'>RdrName</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsBind</span> <span class='hs-conid'>RdrName</span>
<a name="line-34"></a><span class='hs-definition'>mk_easy_FunBind</span> <span class='hs-varid'>loc</span> <span class='hs-varid'>fun</span> <span class='hs-varid'>pats</span> <span class='hs-varid'>expr</span>
<a name="line-35"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>L</span> <span class='hs-varid'>loc</span> <span class='hs-varop'>$</span> <span class='hs-varid'>mkFunBind</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-varid'>loc</span> <span class='hs-varid'>fun</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>mkMatch</span> <span class='hs-varid'>pats</span> <span class='hs-varid'>expr</span> <span class='hs-varid'>emptyLocalBinds</span><span class='hs-keyglyph'>]</span>
<a name="line-36"></a>
<a name="line-37"></a><a name="mkMatch"></a><span class='hs-comment'>------------</span>
<a name="line-38"></a><span class='hs-definition'>mkMatch</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LPat</span> <span class='hs-varid'>id</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HsLocalBinds</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LMatch</span> <span class='hs-varid'>id</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-39"></a><span class='hs-definition'>mkMatch</span> <span class='hs-varid'>pats</span> <span class='hs-varid'>expr</span> <span class='hs-varid'>binds</span>
<a name="line-40"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>noLoc</span> <span class='hs-layout'>(</span><span class='hs-conid'>Match</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-varid'>paren</span> <span class='hs-varid'>pats</span><span class='hs-layout'>)</span> <span class='hs-conid'>Nothing</span> 
<a name="line-41"></a>		 <span class='hs-layout'>(</span><span class='hs-conid'>GRHSs</span> <span class='hs-layout'>(</span><span class='hs-varid'>unguardedRHS</span> <span class='hs-varid'>expr</span><span class='hs-layout'>)</span> <span class='hs-varid'>binds</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-42"></a>  <span class='hs-keyword'>where</span>
<a name="line-43"></a>    <span class='hs-varid'>paren</span> <span class='hs-varid'>lp</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-varid'>l</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>hsPatNeedsParens</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>L</span> <span class='hs-varid'>l</span> <span class='hs-layout'>(</span><span class='hs-conid'>ParPat</span> <span class='hs-varid'>lp</span><span class='hs-layout'>)</span> 
<a name="line-44"></a>		     <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>          <span class='hs-keyglyph'>=</span> <span class='hs-varid'>lp</span>
</pre>\end{code}


%************************************************************************
%*									*
	Collecting binders
%*									*
%************************************************************************

Get all the binders in some HsBindGroups, IN THE ORDER OF APPEARANCE. eg.

...
where
  (x, y) = ...
  f i j  = ...
  [a, b] = ...

it should return [x, y, f, a, b] (remember, order important).

Note [Collect binders only after renaming]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
These functions should only be used on HsSyn *after* the renamer,
to return a [Name] or [Id].  Before renaming the record punning
and wild-card mechanism makes it hard to know what is bound.
So these functions should not be applied to (HsSyn RdrName)

\begin{code}
<pre><a name="line-1"></a><a name="collectLocalBinders"></a><span class='hs-comment'>----------------- Bindings --------------------------</span>
<a name="line-2"></a><span class='hs-definition'>collectLocalBinders</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsLocalBindsLR</span> <span class='hs-varid'>idL</span> <span class='hs-varid'>idR</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>idL</span><span class='hs-keyglyph'>]</span>
<a name="line-3"></a><span class='hs-definition'>collectLocalBinders</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsValBinds</span> <span class='hs-varid'>val_binds</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>collectHsValBinders</span> <span class='hs-varid'>val_binds</span>
<a name="line-4"></a><span class='hs-definition'>collectLocalBinders</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsIPBinds</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-conid'>[]</span>
<a name="line-5"></a><span class='hs-definition'>collectLocalBinders</span> <span class='hs-conid'>EmptyLocalBinds</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>[]</span>
<a name="line-6"></a>
<a name="line-7"></a><a name="collectHsValBinders"></a><span class='hs-definition'>collectHsValBinders</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsValBindsLR</span> <span class='hs-varid'>idL</span> <span class='hs-varid'>idR</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>idL</span><span class='hs-keyglyph'>]</span>
<a name="line-8"></a><span class='hs-definition'>collectHsValBinders</span> <span class='hs-layout'>(</span><span class='hs-conid'>ValBindsIn</span>  <span class='hs-varid'>binds</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>collectHsBindsBinders</span> <span class='hs-varid'>binds</span>
<a name="line-9"></a><span class='hs-definition'>collectHsValBinders</span> <span class='hs-layout'>(</span><span class='hs-conid'>ValBindsOut</span> <span class='hs-varid'>binds</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>foldr</span> <span class='hs-varid'>collect_one</span> <span class='hs-conid'>[]</span> <span class='hs-varid'>binds</span>
<a name="line-10"></a>  <span class='hs-keyword'>where</span>
<a name="line-11"></a>   <span class='hs-varid'>collect_one</span> <span class='hs-layout'>(</span><span class='hs-keyword'>_</span><span class='hs-layout'>,</span><span class='hs-varid'>binds</span><span class='hs-layout'>)</span> <span class='hs-varid'>acc</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>collect_binds</span> <span class='hs-varid'>binds</span> <span class='hs-varid'>acc</span>
<a name="line-12"></a>
<a name="line-13"></a><a name="collectHsBindBinders"></a><span class='hs-definition'>collectHsBindBinders</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsBindLR</span> <span class='hs-varid'>idL</span> <span class='hs-varid'>idR</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>idL</span><span class='hs-keyglyph'>]</span>
<a name="line-14"></a><span class='hs-definition'>collectHsBindBinders</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>collect_bind</span> <span class='hs-varid'>b</span> <span class='hs-conid'>[]</span>
<a name="line-15"></a>
<a name="line-16"></a><a name="collect_bind"></a><span class='hs-definition'>collect_bind</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsBindLR</span> <span class='hs-varid'>idL</span> <span class='hs-varid'>idR</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>idL</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>idL</span><span class='hs-keyglyph'>]</span>
<a name="line-17"></a><span class='hs-definition'>collect_bind</span> <span class='hs-layout'>(</span><span class='hs-conid'>PatBind</span> <span class='hs-layout'>{</span> <span class='hs-varid'>pat_lhs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>p</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span>    <span class='hs-varid'>acc</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>collect_lpat</span> <span class='hs-varid'>p</span> <span class='hs-varid'>acc</span>
<a name="line-18"></a><span class='hs-definition'>collect_bind</span> <span class='hs-layout'>(</span><span class='hs-conid'>FunBind</span> <span class='hs-layout'>{</span> <span class='hs-varid'>fun_id</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>f</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-varid'>acc</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>f</span> <span class='hs-conop'>:</span> <span class='hs-varid'>acc</span>
<a name="line-19"></a><span class='hs-definition'>collect_bind</span> <span class='hs-layout'>(</span><span class='hs-conid'>VarBind</span> <span class='hs-layout'>{</span> <span class='hs-varid'>var_id</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>f</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span>     <span class='hs-varid'>acc</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>f</span> <span class='hs-conop'>:</span> <span class='hs-varid'>acc</span>
<a name="line-20"></a><span class='hs-definition'>collect_bind</span> <span class='hs-layout'>(</span><span class='hs-conid'>AbsBinds</span> <span class='hs-layout'>{</span> <span class='hs-varid'>abs_exports</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>dbinds</span><span class='hs-layout'>,</span> <span class='hs-varid'>abs_binds</span> <span class='hs-keyglyph'>=</span> <span class='hs-sel'>_binds</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-varid'>acc</span>
<a name="line-21"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>map</span> <span class='hs-varid'>abe_poly</span> <span class='hs-varid'>dbinds</span> <span class='hs-varop'>++</span> <span class='hs-varid'>acc</span> 
<a name="line-22"></a>	<span class='hs-comment'>-- ++ foldr collect_bind acc binds</span>
<a name="line-23"></a>	<span class='hs-comment'>-- I don't think we want the binders from the nested binds</span>
<a name="line-24"></a>	<span class='hs-comment'>-- The only time we collect binders from a typechecked </span>
<a name="line-25"></a>	<span class='hs-comment'>-- binding (hence see AbsBinds) is in zonking in TcHsSyn</span>
<a name="line-26"></a><span class='hs-definition'>collect_bind</span> <span class='hs-layout'>(</span><span class='hs-conid'>PatSynBind</span> <span class='hs-layout'>{</span> <span class='hs-varid'>patsyn_id</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>ps</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-varid'>acc</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ps</span> <span class='hs-conop'>:</span> <span class='hs-varid'>acc</span>
<a name="line-27"></a>
<a name="line-28"></a><a name="collectHsBindsBinders"></a><span class='hs-definition'>collectHsBindsBinders</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LHsBindsLR</span> <span class='hs-varid'>idL</span> <span class='hs-varid'>idR</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>idL</span><span class='hs-keyglyph'>]</span>
<a name="line-29"></a><span class='hs-definition'>collectHsBindsBinders</span> <span class='hs-varid'>binds</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>collect_binds</span> <span class='hs-varid'>binds</span> <span class='hs-conid'>[]</span>
<a name="line-30"></a>
<a name="line-31"></a><a name="collectHsBindListBinders"></a><span class='hs-definition'>collectHsBindListBinders</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LHsBindLR</span> <span class='hs-varid'>idL</span> <span class='hs-varid'>idR</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>idL</span><span class='hs-keyglyph'>]</span>
<a name="line-32"></a><span class='hs-definition'>collectHsBindListBinders</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>foldr</span> <span class='hs-layout'>(</span><span class='hs-varid'>collect_bind</span> <span class='hs-varop'>.</span> <span class='hs-varid'>unLoc</span><span class='hs-layout'>)</span> <span class='hs-conid'>[]</span>
<a name="line-33"></a>
<a name="line-34"></a><a name="collect_binds"></a><span class='hs-definition'>collect_binds</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LHsBindsLR</span> <span class='hs-varid'>idL</span> <span class='hs-varid'>idR</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>idL</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>idL</span><span class='hs-keyglyph'>]</span>
<a name="line-35"></a><span class='hs-definition'>collect_binds</span> <span class='hs-varid'>binds</span> <span class='hs-varid'>acc</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>foldrBag</span> <span class='hs-layout'>(</span><span class='hs-varid'>collect_bind</span> <span class='hs-varop'>.</span> <span class='hs-varid'>unLoc</span><span class='hs-layout'>)</span> <span class='hs-varid'>acc</span> <span class='hs-varid'>binds</span>
<a name="line-36"></a>
<a name="line-37"></a><a name="collectMethodBinders"></a><span class='hs-definition'>collectMethodBinders</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LHsBindsLR</span> <span class='hs-conid'>RdrName</span> <span class='hs-varid'>idR</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Located</span> <span class='hs-conid'>RdrName</span><span class='hs-keyglyph'>]</span>
<a name="line-38"></a><span class='hs-comment'>-- Used exclusively for the bindings of an instance decl which are all FunBinds</span>
<a name="line-39"></a><span class='hs-definition'>collectMethodBinders</span> <span class='hs-varid'>binds</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>foldrBag</span> <span class='hs-layout'>(</span><span class='hs-varid'>get</span> <span class='hs-varop'>.</span> <span class='hs-varid'>unLoc</span><span class='hs-layout'>)</span> <span class='hs-conid'>[]</span> <span class='hs-varid'>binds</span>
<a name="line-40"></a>  <span class='hs-keyword'>where</span>
<a name="line-41"></a>    <span class='hs-varid'>get</span> <span class='hs-layout'>(</span><span class='hs-conid'>FunBind</span> <span class='hs-layout'>{</span> <span class='hs-varid'>fun_id</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>f</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-varid'>fs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>f</span> <span class='hs-conop'>:</span> <span class='hs-varid'>fs</span>
<a name="line-42"></a>    <span class='hs-varid'>get</span> <span class='hs-keyword'>_</span>                        <span class='hs-varid'>fs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fs</span>	
<a name="line-43"></a>       <span class='hs-comment'>-- Someone else complains about non-FunBinds</span>
<a name="line-44"></a>
<a name="line-45"></a><a name="collectLStmtsBinders"></a><span class='hs-comment'>----------------- Statements --------------------------</span>
<a name="line-46"></a><span class='hs-definition'>collectLStmtsBinders</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LStmtLR</span> <span class='hs-varid'>idL</span> <span class='hs-varid'>idR</span> <span class='hs-varid'>body</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>idL</span><span class='hs-keyglyph'>]</span>
<a name="line-47"></a><span class='hs-definition'>collectLStmtsBinders</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>concatMap</span> <span class='hs-varid'>collectLStmtBinders</span>
<a name="line-48"></a>
<a name="line-49"></a><a name="collectStmtsBinders"></a><span class='hs-definition'>collectStmtsBinders</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>StmtLR</span> <span class='hs-varid'>idL</span> <span class='hs-varid'>idR</span> <span class='hs-varid'>body</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>idL</span><span class='hs-keyglyph'>]</span>
<a name="line-50"></a><span class='hs-definition'>collectStmtsBinders</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>concatMap</span> <span class='hs-varid'>collectStmtBinders</span>
<a name="line-51"></a>
<a name="line-52"></a><a name="collectLStmtBinders"></a><span class='hs-definition'>collectLStmtBinders</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LStmtLR</span> <span class='hs-varid'>idL</span> <span class='hs-varid'>idR</span> <span class='hs-varid'>body</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>idL</span><span class='hs-keyglyph'>]</span>
<a name="line-53"></a><span class='hs-definition'>collectLStmtBinders</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>collectStmtBinders</span> <span class='hs-varop'>.</span> <span class='hs-varid'>unLoc</span>
<a name="line-54"></a>
<a name="line-55"></a><a name="collectStmtBinders"></a><span class='hs-definition'>collectStmtBinders</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>StmtLR</span> <span class='hs-varid'>idL</span> <span class='hs-varid'>idR</span> <span class='hs-varid'>body</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>idL</span><span class='hs-keyglyph'>]</span>
<a name="line-56"></a>  <span class='hs-comment'>-- Id Binders for a Stmt... [but what about pattern-sig type vars]?</span>
<a name="line-57"></a><span class='hs-definition'>collectStmtBinders</span> <span class='hs-layout'>(</span><span class='hs-conid'>BindStmt</span> <span class='hs-varid'>pat</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>collectPatBinders</span> <span class='hs-varid'>pat</span>
<a name="line-58"></a><span class='hs-definition'>collectStmtBinders</span> <span class='hs-layout'>(</span><span class='hs-conid'>LetStmt</span> <span class='hs-varid'>binds</span><span class='hs-layout'>)</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>collectLocalBinders</span> <span class='hs-varid'>binds</span>
<a name="line-59"></a><span class='hs-definition'>collectStmtBinders</span> <span class='hs-layout'>(</span><span class='hs-conid'>BodyStmt</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>        <span class='hs-keyglyph'>=</span> <span class='hs-conid'>[]</span>
<a name="line-60"></a><span class='hs-definition'>collectStmtBinders</span> <span class='hs-layout'>(</span><span class='hs-conid'>LastStmt</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>        <span class='hs-keyglyph'>=</span> <span class='hs-conid'>[]</span>
<a name="line-61"></a><span class='hs-definition'>collectStmtBinders</span> <span class='hs-layout'>(</span><span class='hs-conid'>ParStmt</span> <span class='hs-varid'>xs</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>collectLStmtsBinders</span>
<a name="line-62"></a>                                        <span class='hs-varop'>$</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>s</span> <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ParStmtBlock</span> <span class='hs-varid'>ss</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>xs</span><span class='hs-layout'>,</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>ss</span><span class='hs-keyglyph'>]</span>
<a name="line-63"></a><span class='hs-definition'>collectStmtBinders</span> <span class='hs-layout'>(</span><span class='hs-conid'>TransStmt</span> <span class='hs-layout'>{</span> <span class='hs-varid'>trS_stmts</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>stmts</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>collectLStmtsBinders</span> <span class='hs-varid'>stmts</span>
<a name="line-64"></a><span class='hs-definition'>collectStmtBinders</span> <span class='hs-layout'>(</span><span class='hs-conid'>RecStmt</span> <span class='hs-layout'>{</span> <span class='hs-varid'>recS_stmts</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ss</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>collectLStmtsBinders</span> <span class='hs-varid'>ss</span>
<a name="line-65"></a>
<a name="line-66"></a>
<a name="line-67"></a><a name="collectPatBinders"></a><span class='hs-comment'>----------------- Patterns --------------------------</span>
<a name="line-68"></a><span class='hs-definition'>collectPatBinders</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LPat</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span>
<a name="line-69"></a><span class='hs-definition'>collectPatBinders</span> <span class='hs-varid'>pat</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>collect_lpat</span> <span class='hs-varid'>pat</span> <span class='hs-conid'>[]</span>
<a name="line-70"></a>
<a name="line-71"></a><a name="collectPatsBinders"></a><span class='hs-definition'>collectPatsBinders</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LPat</span> <span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span>
<a name="line-72"></a><span class='hs-definition'>collectPatsBinders</span> <span class='hs-varid'>pats</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>foldr</span> <span class='hs-varid'>collect_lpat</span> <span class='hs-conid'>[]</span> <span class='hs-varid'>pats</span>
<a name="line-73"></a>
<a name="line-74"></a><a name="collect_lpat"></a><span class='hs-comment'>-------------</span>
<a name="line-75"></a><span class='hs-definition'>collect_lpat</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LPat</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>name</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>name</span><span class='hs-keyglyph'>]</span>
<a name="line-76"></a><span class='hs-definition'>collect_lpat</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>pat</span><span class='hs-layout'>)</span> <span class='hs-varid'>bndrs</span>
<a name="line-77"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>go</span> <span class='hs-varid'>pat</span>
<a name="line-78"></a>  <span class='hs-keyword'>where</span>
<a name="line-79"></a>    <span class='hs-varid'>go</span> <span class='hs-layout'>(</span><span class='hs-conid'>VarPat</span> <span class='hs-varid'>var</span><span class='hs-layout'>)</span> 	   	  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>var</span> <span class='hs-conop'>:</span> <span class='hs-varid'>bndrs</span>
<a name="line-80"></a>    <span class='hs-varid'>go</span> <span class='hs-layout'>(</span><span class='hs-conid'>WildPat</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>	      	  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>bndrs</span>
<a name="line-81"></a>    <span class='hs-varid'>go</span> <span class='hs-layout'>(</span><span class='hs-conid'>LazyPat</span> <span class='hs-varid'>pat</span><span class='hs-layout'>)</span>     	  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>collect_lpat</span> <span class='hs-varid'>pat</span> <span class='hs-varid'>bndrs</span>
<a name="line-82"></a>    <span class='hs-varid'>go</span> <span class='hs-layout'>(</span><span class='hs-conid'>BangPat</span> <span class='hs-varid'>pat</span><span class='hs-layout'>)</span>     	  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>collect_lpat</span> <span class='hs-varid'>pat</span> <span class='hs-varid'>bndrs</span>
<a name="line-83"></a>    <span class='hs-varid'>go</span> <span class='hs-layout'>(</span><span class='hs-conid'>AsPat</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-varid'>pat</span><span class='hs-layout'>)</span>     	  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>a</span> <span class='hs-conop'>:</span> <span class='hs-varid'>collect_lpat</span> <span class='hs-varid'>pat</span> <span class='hs-varid'>bndrs</span>
<a name="line-84"></a>    <span class='hs-varid'>go</span> <span class='hs-layout'>(</span><span class='hs-conid'>ViewPat</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>pat</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>          <span class='hs-keyglyph'>=</span> <span class='hs-varid'>collect_lpat</span> <span class='hs-varid'>pat</span> <span class='hs-varid'>bndrs</span>
<a name="line-85"></a>    <span class='hs-varid'>go</span> <span class='hs-layout'>(</span><span class='hs-conid'>ParPat</span>  <span class='hs-varid'>pat</span><span class='hs-layout'>)</span>     	  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>collect_lpat</span> <span class='hs-varid'>pat</span> <span class='hs-varid'>bndrs</span>
<a name="line-86"></a>				  
<a name="line-87"></a>    <span class='hs-varid'>go</span> <span class='hs-layout'>(</span><span class='hs-conid'>ListPat</span> <span class='hs-varid'>pats</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>         <span class='hs-keyglyph'>=</span> <span class='hs-varid'>foldr</span> <span class='hs-varid'>collect_lpat</span> <span class='hs-varid'>bndrs</span> <span class='hs-varid'>pats</span>
<a name="line-88"></a>    <span class='hs-varid'>go</span> <span class='hs-layout'>(</span><span class='hs-conid'>PArrPat</span> <span class='hs-varid'>pats</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>    	  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>foldr</span> <span class='hs-varid'>collect_lpat</span> <span class='hs-varid'>bndrs</span> <span class='hs-varid'>pats</span>
<a name="line-89"></a>    <span class='hs-varid'>go</span> <span class='hs-layout'>(</span><span class='hs-conid'>TuplePat</span> <span class='hs-varid'>pats</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>  	  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>foldr</span> <span class='hs-varid'>collect_lpat</span> <span class='hs-varid'>bndrs</span> <span class='hs-varid'>pats</span>
<a name="line-90"></a>				  
<a name="line-91"></a>    <span class='hs-varid'>go</span> <span class='hs-layout'>(</span><span class='hs-conid'>ConPatIn</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>ps</span><span class='hs-layout'>)</span>            <span class='hs-keyglyph'>=</span> <span class='hs-varid'>foldr</span> <span class='hs-varid'>collect_lpat</span> <span class='hs-varid'>bndrs</span> <span class='hs-layout'>(</span><span class='hs-varid'>hsConPatArgs</span> <span class='hs-varid'>ps</span><span class='hs-layout'>)</span>
<a name="line-92"></a>    <span class='hs-varid'>go</span> <span class='hs-layout'>(</span><span class='hs-conid'>ConPatOut</span> <span class='hs-layout'>{</span><span class='hs-varid'>pat_args</span><span class='hs-keyglyph'>=</span><span class='hs-varid'>ps</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>foldr</span> <span class='hs-varid'>collect_lpat</span> <span class='hs-varid'>bndrs</span> <span class='hs-layout'>(</span><span class='hs-varid'>hsConPatArgs</span> <span class='hs-varid'>ps</span><span class='hs-layout'>)</span>
<a name="line-93"></a>	<span class='hs-comment'>-- See Note [Dictionary binders in ConPatOut]</span>
<a name="line-94"></a>    <span class='hs-varid'>go</span> <span class='hs-layout'>(</span><span class='hs-conid'>LitPat</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>	      	  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>bndrs</span>
<a name="line-95"></a>    <span class='hs-varid'>go</span> <span class='hs-layout'>(</span><span class='hs-conid'>NPat</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>		  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>bndrs</span>
<a name="line-96"></a>    <span class='hs-varid'>go</span> <span class='hs-layout'>(</span><span class='hs-conid'>NPlusKPat</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>n</span> <span class='hs-conop'>:</span> <span class='hs-varid'>bndrs</span>
<a name="line-97"></a> 				  
<a name="line-98"></a>    <span class='hs-varid'>go</span> <span class='hs-layout'>(</span><span class='hs-conid'>SigPatIn</span> <span class='hs-varid'>pat</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>	 	  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>collect_lpat</span> <span class='hs-varid'>pat</span> <span class='hs-varid'>bndrs</span>
<a name="line-99"></a>    <span class='hs-varid'>go</span> <span class='hs-layout'>(</span><span class='hs-conid'>SigPatOut</span> <span class='hs-varid'>pat</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>	  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>collect_lpat</span> <span class='hs-varid'>pat</span> <span class='hs-varid'>bndrs</span>
<a name="line-100"></a>    <span class='hs-varid'>go</span> <span class='hs-layout'>(</span><span class='hs-conid'>SplicePat</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>              <span class='hs-keyglyph'>=</span> <span class='hs-varid'>bndrs</span>
<a name="line-101"></a>    <span class='hs-varid'>go</span> <span class='hs-layout'>(</span><span class='hs-conid'>QuasiQuotePat</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>          <span class='hs-keyglyph'>=</span> <span class='hs-varid'>bndrs</span>
<a name="line-102"></a>    <span class='hs-varid'>go</span> <span class='hs-layout'>(</span><span class='hs-conid'>CoPat</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>pat</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>            <span class='hs-keyglyph'>=</span> <span class='hs-varid'>go</span> <span class='hs-varid'>pat</span>
</pre>\end{code}

Note [Dictionary binders in ConPatOut] See also same Note in DsArrows
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Do *not* gather (a) dictionary and (b) dictionary bindings as binders
of a ConPatOut pattern.  For most calls it doesn't matter, because
it's pre-typechecker and there are no ConPatOuts.  But it does matter
more in the desugarer; for example, DsUtils.mkSelectorBinds uses
collectPatBinders.  In a lazy pattern, for example f ~(C x y) = ...,
we want to generate bindings for x,y but not for dictionaries bound by
C.  (The type checker ensures they would not be used.)

Desugaring of arrow case expressions needs these bindings (see DsArrows
and arrowcase1), but SPJ (Jan 2007) says it's safer for it to use its
own pat-binder-collector:

Here's the problem.  Consider

data T a where
   C :: Num a => a -> Int -> T a

f ~(C (n+1) m) = (n,m)

Here, the pattern (C (n+1)) binds a hidden dictionary (d::Num a),
and *also* uses that dictionary to match the (n+1) pattern.  Yet, the
variables bound by the lazy pattern are n,m, *not* the dictionary d.
So in mkSelectorBinds in DsUtils, we want just m,n as the variables bound.

\begin{code}
<pre><a name="line-1"></a><a name="hsGroupBinders"></a><span class='hs-definition'>hsGroupBinders</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsGroup</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Name</span><span class='hs-keyglyph'>]</span>
<a name="line-2"></a><span class='hs-definition'>hsGroupBinders</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsGroup</span> <span class='hs-layout'>{</span> <span class='hs-varid'>hs_valds</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>val_decls</span><span class='hs-layout'>,</span> <span class='hs-varid'>hs_tyclds</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tycl_decls</span><span class='hs-layout'>,</span>
<a name="line-3"></a>                          <span class='hs-varid'>hs_instds</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>inst_decls</span><span class='hs-layout'>,</span> <span class='hs-varid'>hs_fords</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>foreign_decls</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-4"></a><span class='hs-comment'>-- Collect the binders of a Group</span>
<a name="line-5"></a>  <span class='hs-keyglyph'>=</span>  <span class='hs-varid'>collectHsValBinders</span> <span class='hs-varid'>val_decls</span>
<a name="line-6"></a>  <span class='hs-varop'>++</span> <span class='hs-varid'>hsTyClDeclsBinders</span> <span class='hs-varid'>tycl_decls</span> <span class='hs-varid'>inst_decls</span>
<a name="line-7"></a>  <span class='hs-varop'>++</span> <span class='hs-varid'>hsForeignDeclsBinders</span> <span class='hs-varid'>foreign_decls</span>
<a name="line-8"></a>
<a name="line-9"></a><a name="hsForeignDeclsBinders"></a><span class='hs-definition'>hsForeignDeclsBinders</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LForeignDecl</span> <span class='hs-conid'>Name</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Name</span><span class='hs-keyglyph'>]</span>
<a name="line-10"></a><span class='hs-definition'>hsForeignDeclsBinders</span> <span class='hs-varid'>foreign_decls</span>
<a name="line-11"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>n</span> <span class='hs-keyglyph'>|</span> <span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>ForeignImport</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>foreign_decls</span><span class='hs-keyglyph'>]</span>
<a name="line-12"></a>
<a name="line-13"></a><a name="hsTyClDeclsBinders"></a><span class='hs-definition'>hsTyClDeclsBinders</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>TyClGroup</span> <span class='hs-conid'>Name</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-conid'>InstDecl</span> <span class='hs-conid'>Name</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Name</span><span class='hs-keyglyph'>]</span>
<a name="line-14"></a><span class='hs-comment'>-- We need to look at instance declarations too, </span>
<a name="line-15"></a><span class='hs-comment'>-- because their associated types may bind data constructors</span>
<a name="line-16"></a><span class='hs-definition'>hsTyClDeclsBinders</span> <span class='hs-varid'>tycl_decls</span> <span class='hs-varid'>inst_decls</span>
<a name="line-17"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>map</span> <span class='hs-varid'>unLoc</span> <span class='hs-layout'>(</span><span class='hs-varid'>concatMap</span> <span class='hs-layout'>(</span><span class='hs-varid'>concatMap</span> <span class='hs-varid'>hsLTyClDeclBinders</span> <span class='hs-varop'>.</span> <span class='hs-varid'>group_tyclds</span><span class='hs-layout'>)</span> <span class='hs-varid'>tycl_decls</span> <span class='hs-varop'>++</span>
<a name="line-18"></a>               <span class='hs-varid'>concatMap</span> <span class='hs-layout'>(</span><span class='hs-varid'>hsInstDeclBinders</span> <span class='hs-varop'>.</span> <span class='hs-varid'>unLoc</span><span class='hs-layout'>)</span> <span class='hs-varid'>inst_decls</span><span class='hs-layout'>)</span>
<a name="line-19"></a>
<a name="line-20"></a><a name="hsLTyClDeclBinders"></a><span class='hs-comment'>-------------------</span>
<a name="line-21"></a><span class='hs-definition'>hsLTyClDeclBinders</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Eq</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-conid'>TyClDecl</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Located</span> <span class='hs-varid'>name</span><span class='hs-keyglyph'>]</span>
<a name="line-22"></a><span class='hs-comment'>-- ^ Returns all the /binding/ names of the decl.</span>
<a name="line-23"></a><span class='hs-comment'>-- The first one is guaranteed to be the name of the decl. For record fields</span>
<a name="line-24"></a><span class='hs-comment'>-- mentioned in multiple constructors, the SrcLoc will be from the first</span>
<a name="line-25"></a><span class='hs-comment'>-- occurrence.  We use the equality to filter out duplicate field names.</span>
<a name="line-26"></a><span class='hs-comment'>--</span>
<a name="line-27"></a><span class='hs-comment'>-- Each returned (Located name) is wrapped in a @SrcSpan@ of the whole</span>
<a name="line-28"></a><span class='hs-comment'>-- /declaration/, not just the name itself (which is how it appears in</span>
<a name="line-29"></a><span class='hs-comment'>-- the syntax tree).  This SrcSpan (for the entire declaration) is used</span>
<a name="line-30"></a><span class='hs-comment'>-- as the SrcSpan for the Name that is finally produced, and hence for</span>
<a name="line-31"></a><span class='hs-comment'>-- error messages.  (See Trac #8607.)</span>
<a name="line-32"></a>
<a name="line-33"></a><span class='hs-definition'>hsLTyClDeclBinders</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-varid'>loc</span> <span class='hs-layout'>(</span><span class='hs-conid'>FamDecl</span> <span class='hs-layout'>{</span> <span class='hs-varid'>tcdFam</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>FamilyDecl</span> <span class='hs-layout'>{</span> <span class='hs-varid'>fdLName</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>name</span> <span class='hs-layout'>}</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-34"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>L</span> <span class='hs-varid'>loc</span> <span class='hs-varid'>name</span><span class='hs-keyglyph'>]</span>
<a name="line-35"></a><span class='hs-definition'>hsLTyClDeclBinders</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-varid'>loc</span> <span class='hs-layout'>(</span><span class='hs-conid'>ForeignType</span> <span class='hs-layout'>{</span> <span class='hs-varid'>tcdLName</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>name</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>L</span> <span class='hs-varid'>loc</span> <span class='hs-varid'>name</span><span class='hs-keyglyph'>]</span>
<a name="line-36"></a><span class='hs-definition'>hsLTyClDeclBinders</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-varid'>loc</span> <span class='hs-layout'>(</span><span class='hs-conid'>SynDecl</span>     <span class='hs-layout'>{</span> <span class='hs-varid'>tcdLName</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>name</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>L</span> <span class='hs-varid'>loc</span> <span class='hs-varid'>name</span><span class='hs-keyglyph'>]</span>
<a name="line-37"></a><span class='hs-definition'>hsLTyClDeclBinders</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-varid'>loc</span> <span class='hs-layout'>(</span><span class='hs-conid'>ClassDecl</span>   <span class='hs-layout'>{</span> <span class='hs-varid'>tcdLName</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>cls_name</span>
<a name="line-38"></a>                                       <span class='hs-layout'>,</span> <span class='hs-varid'>tcdSigs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sigs</span><span class='hs-layout'>,</span> <span class='hs-varid'>tcdATs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ats</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-39"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>L</span> <span class='hs-varid'>loc</span> <span class='hs-varid'>cls_name</span> <span class='hs-conop'>:</span>
<a name="line-40"></a>    <span class='hs-keyglyph'>[</span> <span class='hs-conid'>L</span> <span class='hs-varid'>fam_loc</span> <span class='hs-varid'>fam_name</span> <span class='hs-keyglyph'>|</span> <span class='hs-conid'>L</span> <span class='hs-varid'>fam_loc</span> <span class='hs-layout'>(</span><span class='hs-conid'>FamilyDecl</span> <span class='hs-layout'>{</span> <span class='hs-varid'>fdLName</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>fam_name</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>ats</span> <span class='hs-keyglyph'>]</span> <span class='hs-varop'>++</span>
<a name="line-41"></a>    <span class='hs-keyglyph'>[</span> <span class='hs-conid'>L</span> <span class='hs-varid'>mem_loc</span> <span class='hs-varid'>mem_name</span> <span class='hs-keyglyph'>|</span> <span class='hs-conid'>L</span> <span class='hs-varid'>mem_loc</span> <span class='hs-layout'>(</span><span class='hs-conid'>TypeSig</span> <span class='hs-varid'>ns</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>sigs</span><span class='hs-layout'>,</span> <span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>mem_name</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>ns</span> <span class='hs-keyglyph'>]</span>
<a name="line-42"></a><span class='hs-definition'>hsLTyClDeclBinders</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-varid'>loc</span> <span class='hs-layout'>(</span><span class='hs-conid'>DataDecl</span>    <span class='hs-layout'>{</span> <span class='hs-varid'>tcdLName</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>name</span><span class='hs-layout'>,</span> <span class='hs-varid'>tcdDataDefn</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>defn</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-43"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>L</span> <span class='hs-varid'>loc</span> <span class='hs-varid'>name</span> <span class='hs-conop'>:</span> <span class='hs-varid'>hsDataDefnBinders</span> <span class='hs-varid'>defn</span>
<a name="line-44"></a>
<a name="line-45"></a><a name="hsInstDeclBinders"></a><span class='hs-comment'>-------------------</span>
<a name="line-46"></a><span class='hs-definition'>hsInstDeclBinders</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Eq</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>InstDecl</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Located</span> <span class='hs-varid'>name</span><span class='hs-keyglyph'>]</span>
<a name="line-47"></a><span class='hs-definition'>hsInstDeclBinders</span> <span class='hs-layout'>(</span><span class='hs-conid'>ClsInstD</span> <span class='hs-layout'>{</span> <span class='hs-varid'>cid_inst</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ClsInstDecl</span> <span class='hs-layout'>{</span> <span class='hs-varid'>cid_datafam_insts</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>dfis</span> <span class='hs-layout'>}</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-48"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>concatMap</span> <span class='hs-layout'>(</span><span class='hs-varid'>hsDataFamInstBinders</span> <span class='hs-varop'>.</span> <span class='hs-varid'>unLoc</span><span class='hs-layout'>)</span> <span class='hs-varid'>dfis</span>
<a name="line-49"></a><span class='hs-definition'>hsInstDeclBinders</span> <span class='hs-layout'>(</span><span class='hs-conid'>DataFamInstD</span> <span class='hs-layout'>{</span> <span class='hs-varid'>dfid_inst</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fi</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hsDataFamInstBinders</span> <span class='hs-varid'>fi</span>
<a name="line-50"></a><span class='hs-definition'>hsInstDeclBinders</span> <span class='hs-layout'>(</span><span class='hs-conid'>TyFamInstD</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>[]</span>
<a name="line-51"></a>
<a name="line-52"></a><a name="hsDataFamInstBinders"></a><span class='hs-comment'>-------------------</span>
<a name="line-53"></a><span class='hs-comment'>-- the SrcLoc returned are for the whole declarations, not just the names</span>
<a name="line-54"></a><span class='hs-definition'>hsDataFamInstBinders</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Eq</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>DataFamInstDecl</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Located</span> <span class='hs-varid'>name</span><span class='hs-keyglyph'>]</span>
<a name="line-55"></a><span class='hs-definition'>hsDataFamInstBinders</span> <span class='hs-layout'>(</span><span class='hs-conid'>DataFamInstDecl</span> <span class='hs-layout'>{</span> <span class='hs-varid'>dfid_defn</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>defn</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-56"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hsDataDefnBinders</span> <span class='hs-varid'>defn</span>
<a name="line-57"></a>  <span class='hs-comment'>-- There can't be repeated symbols because only data instances have binders</span>
<a name="line-58"></a>
<a name="line-59"></a><a name="hsDataDefnBinders"></a><span class='hs-comment'>-------------------</span>
<a name="line-60"></a><span class='hs-comment'>-- the SrcLoc returned are for the whole declarations, not just the names</span>
<a name="line-61"></a><span class='hs-definition'>hsDataDefnBinders</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Eq</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HsDataDefn</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Located</span> <span class='hs-varid'>name</span><span class='hs-keyglyph'>]</span>
<a name="line-62"></a><span class='hs-definition'>hsDataDefnBinders</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsDataDefn</span> <span class='hs-layout'>{</span> <span class='hs-varid'>dd_cons</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>cons</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hsConDeclsBinders</span> <span class='hs-varid'>cons</span>
<a name="line-63"></a>  <span class='hs-comment'>-- See Note [Binders in family instances]</span>
<a name="line-64"></a>
<a name="line-65"></a><a name="hsConDeclsBinders"></a><span class='hs-comment'>-------------------</span>
<a name="line-66"></a><span class='hs-definition'>hsConDeclsBinders</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Eq</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LConDecl</span> <span class='hs-varid'>name</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Located</span> <span class='hs-varid'>name</span><span class='hs-keyglyph'>]</span>
<a name="line-67"></a>  <span class='hs-comment'>-- See hsLTyClDeclBinders for what this does</span>
<a name="line-68"></a>  <span class='hs-comment'>-- The function is boringly complicated because of the records</span>
<a name="line-69"></a>  <span class='hs-comment'>-- And since we only have equality, we have to be a little careful</span>
<a name="line-70"></a><span class='hs-definition'>hsConDeclsBinders</span> <span class='hs-varid'>cons</span>
<a name="line-71"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>snd</span> <span class='hs-layout'>(</span><span class='hs-varid'>foldl</span> <span class='hs-varid'>do_one</span> <span class='hs-layout'>(</span><span class='hs-conid'>[]</span><span class='hs-layout'>,</span> <span class='hs-conid'>[]</span><span class='hs-layout'>)</span> <span class='hs-varid'>cons</span><span class='hs-layout'>)</span>
<a name="line-72"></a>  <span class='hs-keyword'>where</span>
<a name="line-73"></a>    <span class='hs-varid'>do_one</span> <span class='hs-layout'>(</span><span class='hs-varid'>flds_seen</span><span class='hs-layout'>,</span> <span class='hs-varid'>acc</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-varid'>loc</span> <span class='hs-layout'>(</span><span class='hs-conid'>ConDecl</span> <span class='hs-layout'>{</span> <span class='hs-varid'>con_name</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>name</span>
<a name="line-74"></a>                                            <span class='hs-layout'>,</span> <span class='hs-varid'>con_details</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>RecCon</span> <span class='hs-varid'>flds</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-75"></a>	<span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-varid'>unLoc</span> <span class='hs-varid'>new_flds</span> <span class='hs-varop'>++</span> <span class='hs-varid'>flds_seen</span><span class='hs-layout'>,</span> <span class='hs-conid'>L</span> <span class='hs-varid'>loc</span> <span class='hs-varid'>name</span> <span class='hs-conop'>:</span> <span class='hs-varid'>new_flds</span> <span class='hs-varop'>++</span> <span class='hs-varid'>acc</span><span class='hs-layout'>)</span>
<a name="line-76"></a>	<span class='hs-keyword'>where</span>
<a name="line-77"></a>          <span class='hs-comment'>-- don't re-mangle the location of field names, because we don't</span>
<a name="line-78"></a>          <span class='hs-comment'>-- have a record of the full location of the field declaration anyway</span>
<a name="line-79"></a>	  <span class='hs-varid'>new_flds</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>filterOut</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>f</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>unLoc</span> <span class='hs-varid'>f</span> <span class='hs-varop'>`elem`</span> <span class='hs-varid'>flds_seen</span><span class='hs-layout'>)</span> 
<a name="line-80"></a>			       <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-varid'>cd_fld_name</span> <span class='hs-varid'>flds</span><span class='hs-layout'>)</span>
<a name="line-81"></a>
<a name="line-82"></a>    <span class='hs-varid'>do_one</span> <span class='hs-layout'>(</span><span class='hs-varid'>flds_seen</span><span class='hs-layout'>,</span> <span class='hs-varid'>acc</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-varid'>loc</span> <span class='hs-layout'>(</span><span class='hs-conid'>ConDecl</span> <span class='hs-layout'>{</span> <span class='hs-varid'>con_name</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>name</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-83"></a>	<span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>flds_seen</span><span class='hs-layout'>,</span> <span class='hs-conid'>L</span> <span class='hs-varid'>loc</span> <span class='hs-varid'>name</span> <span class='hs-conop'>:</span> <span class='hs-varid'>acc</span><span class='hs-layout'>)</span>
</pre>\end{code}

Note [Binders in family instances]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
In a type or data family instance declaration, the type 
constructor is an *occurrence* not a binding site
    type instance T Int = Int -> Int   -- No binders
    data instance S Bool = S1 | S2     -- Binders are S1,S2


%************************************************************************
%*									*
	Collecting binders the user did not write
%*									*
%************************************************************************

The job of this family of functions is to run through binding sites and find the set of all Names
that were defined "implicitly", without being explicitly written by the user.

The main purpose is to find names introduced by record wildcards so that we can avoid
warning the user when they don't use those names (#4404)

\begin{code}
<pre><a name="line-1"></a><a name="lStmtsImplicits"></a><span class='hs-definition'>lStmtsImplicits</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LStmtLR</span> <span class='hs-conid'>Name</span> <span class='hs-varid'>idR</span> <span class='hs-layout'>(</span><span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-varid'>body</span> <span class='hs-varid'>idR</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>NameSet</span>
<a name="line-2"></a><span class='hs-definition'>lStmtsImplicits</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hs_lstmts</span>
<a name="line-3"></a>  <span class='hs-keyword'>where</span>
<a name="line-4"></a>    <span class='hs-varid'>hs_lstmts</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LStmtLR</span> <span class='hs-conid'>Name</span> <span class='hs-varid'>idR</span> <span class='hs-layout'>(</span><span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-varid'>body</span> <span class='hs-varid'>idR</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>NameSet</span>
<a name="line-5"></a>    <span class='hs-varid'>hs_lstmts</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>foldr</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>stmt</span> <span class='hs-varid'>rest</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>unionNameSets</span> <span class='hs-layout'>(</span><span class='hs-varid'>hs_stmt</span> <span class='hs-layout'>(</span><span class='hs-varid'>unLoc</span> <span class='hs-varid'>stmt</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varid'>rest</span><span class='hs-layout'>)</span> <span class='hs-varid'>emptyNameSet</span>
<a name="line-6"></a>    
<a name="line-7"></a>    <span class='hs-varid'>hs_stmt</span> <span class='hs-layout'>(</span><span class='hs-conid'>BindStmt</span> <span class='hs-varid'>pat</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>lPatImplicits</span> <span class='hs-varid'>pat</span>
<a name="line-8"></a>    <span class='hs-varid'>hs_stmt</span> <span class='hs-layout'>(</span><span class='hs-conid'>LetStmt</span> <span class='hs-varid'>binds</span><span class='hs-layout'>)</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hs_local_binds</span> <span class='hs-varid'>binds</span>
<a name="line-9"></a>    <span class='hs-varid'>hs_stmt</span> <span class='hs-layout'>(</span><span class='hs-conid'>BodyStmt</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>        <span class='hs-keyglyph'>=</span> <span class='hs-varid'>emptyNameSet</span>
<a name="line-10"></a>    <span class='hs-varid'>hs_stmt</span> <span class='hs-layout'>(</span><span class='hs-conid'>LastStmt</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>        <span class='hs-keyglyph'>=</span> <span class='hs-varid'>emptyNameSet</span>
<a name="line-11"></a>    <span class='hs-varid'>hs_stmt</span> <span class='hs-layout'>(</span><span class='hs-conid'>ParStmt</span> <span class='hs-varid'>xs</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hs_lstmts</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>s</span> <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ParStmtBlock</span> <span class='hs-varid'>ss</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>xs</span><span class='hs-layout'>,</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>ss</span><span class='hs-keyglyph'>]</span>
<a name="line-12"></a>    <span class='hs-varid'>hs_stmt</span> <span class='hs-layout'>(</span><span class='hs-conid'>TransStmt</span> <span class='hs-layout'>{</span> <span class='hs-varid'>trS_stmts</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>stmts</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hs_lstmts</span> <span class='hs-varid'>stmts</span>
<a name="line-13"></a>    <span class='hs-varid'>hs_stmt</span> <span class='hs-layout'>(</span><span class='hs-conid'>RecStmt</span> <span class='hs-layout'>{</span> <span class='hs-varid'>recS_stmts</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ss</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hs_lstmts</span> <span class='hs-varid'>ss</span>
<a name="line-14"></a>    
<a name="line-15"></a>    <span class='hs-varid'>hs_local_binds</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsValBinds</span> <span class='hs-varid'>val_binds</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hsValBindsImplicits</span> <span class='hs-varid'>val_binds</span>
<a name="line-16"></a>    <span class='hs-varid'>hs_local_binds</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsIPBinds</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>         <span class='hs-keyglyph'>=</span> <span class='hs-varid'>emptyNameSet</span>
<a name="line-17"></a>    <span class='hs-varid'>hs_local_binds</span> <span class='hs-conid'>EmptyLocalBinds</span>       <span class='hs-keyglyph'>=</span> <span class='hs-varid'>emptyNameSet</span>
<a name="line-18"></a>
<a name="line-19"></a><a name="hsValBindsImplicits"></a><span class='hs-definition'>hsValBindsImplicits</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsValBindsLR</span> <span class='hs-conid'>Name</span> <span class='hs-varid'>idR</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>NameSet</span>
<a name="line-20"></a><span class='hs-definition'>hsValBindsImplicits</span> <span class='hs-layout'>(</span><span class='hs-conid'>ValBindsOut</span> <span class='hs-varid'>binds</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>
<a name="line-21"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>foldr</span> <span class='hs-layout'>(</span><span class='hs-varid'>unionNameSets</span> <span class='hs-varop'>.</span> <span class='hs-varid'>lhsBindsImplicits</span> <span class='hs-varop'>.</span> <span class='hs-varid'>snd</span><span class='hs-layout'>)</span> <span class='hs-varid'>emptyNameSet</span> <span class='hs-varid'>binds</span>
<a name="line-22"></a><span class='hs-definition'>hsValBindsImplicits</span> <span class='hs-layout'>(</span><span class='hs-conid'>ValBindsIn</span> <span class='hs-varid'>binds</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> 
<a name="line-23"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>lhsBindsImplicits</span> <span class='hs-varid'>binds</span>
<a name="line-24"></a>
<a name="line-25"></a><a name="lhsBindsImplicits"></a><span class='hs-definition'>lhsBindsImplicits</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LHsBindsLR</span> <span class='hs-conid'>Name</span> <span class='hs-varid'>idR</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>NameSet</span>
<a name="line-26"></a><span class='hs-definition'>lhsBindsImplicits</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>foldBag</span> <span class='hs-varid'>unionNameSets</span> <span class='hs-layout'>(</span><span class='hs-varid'>lhs_bind</span> <span class='hs-varop'>.</span> <span class='hs-varid'>unLoc</span><span class='hs-layout'>)</span> <span class='hs-varid'>emptyNameSet</span>
<a name="line-27"></a>  <span class='hs-keyword'>where</span>
<a name="line-28"></a>    <span class='hs-varid'>lhs_bind</span> <span class='hs-layout'>(</span><span class='hs-conid'>PatBind</span> <span class='hs-layout'>{</span> <span class='hs-varid'>pat_lhs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>lpat</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>lPatImplicits</span> <span class='hs-varid'>lpat</span>
<a name="line-29"></a>    <span class='hs-varid'>lhs_bind</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>emptyNameSet</span>
<a name="line-30"></a>
<a name="line-31"></a><a name="lPatImplicits"></a><span class='hs-definition'>lPatImplicits</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LPat</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>NameSet</span>
<a name="line-32"></a><span class='hs-definition'>lPatImplicits</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hs_lpat</span>
<a name="line-33"></a>  <span class='hs-keyword'>where</span>
<a name="line-34"></a>    <span class='hs-varid'>hs_lpat</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>pat</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hs_pat</span> <span class='hs-varid'>pat</span>
<a name="line-35"></a>    
<a name="line-36"></a>    <span class='hs-varid'>hs_lpats</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>foldr</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>pat</span> <span class='hs-varid'>rest</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>hs_lpat</span> <span class='hs-varid'>pat</span> <span class='hs-varop'>`unionNameSets`</span> <span class='hs-varid'>rest</span><span class='hs-layout'>)</span> <span class='hs-varid'>emptyNameSet</span>
<a name="line-37"></a>    
<a name="line-38"></a>    <span class='hs-varid'>hs_pat</span> <span class='hs-layout'>(</span><span class='hs-conid'>LazyPat</span> <span class='hs-varid'>pat</span><span class='hs-layout'>)</span>       <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hs_lpat</span> <span class='hs-varid'>pat</span>
<a name="line-39"></a>    <span class='hs-varid'>hs_pat</span> <span class='hs-layout'>(</span><span class='hs-conid'>BangPat</span> <span class='hs-varid'>pat</span><span class='hs-layout'>)</span>       <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hs_lpat</span> <span class='hs-varid'>pat</span>
<a name="line-40"></a>    <span class='hs-varid'>hs_pat</span> <span class='hs-layout'>(</span><span class='hs-conid'>AsPat</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>pat</span><span class='hs-layout'>)</span>       <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hs_lpat</span> <span class='hs-varid'>pat</span>
<a name="line-41"></a>    <span class='hs-varid'>hs_pat</span> <span class='hs-layout'>(</span><span class='hs-conid'>ViewPat</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>pat</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hs_lpat</span> <span class='hs-varid'>pat</span>
<a name="line-42"></a>    <span class='hs-varid'>hs_pat</span> <span class='hs-layout'>(</span><span class='hs-conid'>ParPat</span>  <span class='hs-varid'>pat</span><span class='hs-layout'>)</span>       <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hs_lpat</span> <span class='hs-varid'>pat</span>
<a name="line-43"></a>    <span class='hs-varid'>hs_pat</span> <span class='hs-layout'>(</span><span class='hs-conid'>ListPat</span> <span class='hs-varid'>pats</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hs_lpats</span> <span class='hs-varid'>pats</span>
<a name="line-44"></a>    <span class='hs-varid'>hs_pat</span> <span class='hs-layout'>(</span><span class='hs-conid'>PArrPat</span> <span class='hs-varid'>pats</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hs_lpats</span> <span class='hs-varid'>pats</span>
<a name="line-45"></a>    <span class='hs-varid'>hs_pat</span> <span class='hs-layout'>(</span><span class='hs-conid'>TuplePat</span> <span class='hs-varid'>pats</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hs_lpats</span> <span class='hs-varid'>pats</span>
<a name="line-46"></a>
<a name="line-47"></a>    <span class='hs-varid'>hs_pat</span> <span class='hs-layout'>(</span><span class='hs-conid'>SigPatIn</span> <span class='hs-varid'>pat</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hs_lpat</span> <span class='hs-varid'>pat</span>
<a name="line-48"></a>    <span class='hs-varid'>hs_pat</span> <span class='hs-layout'>(</span><span class='hs-conid'>SigPatOut</span> <span class='hs-varid'>pat</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hs_lpat</span> <span class='hs-varid'>pat</span>
<a name="line-49"></a>    <span class='hs-varid'>hs_pat</span> <span class='hs-layout'>(</span><span class='hs-conid'>CoPat</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>pat</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hs_pat</span> <span class='hs-varid'>pat</span>
<a name="line-50"></a>    
<a name="line-51"></a>    <span class='hs-varid'>hs_pat</span> <span class='hs-layout'>(</span><span class='hs-conid'>ConPatIn</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>ps</span><span class='hs-layout'>)</span>           <span class='hs-keyglyph'>=</span> <span class='hs-varid'>details</span> <span class='hs-varid'>ps</span>
<a name="line-52"></a>    <span class='hs-varid'>hs_pat</span> <span class='hs-layout'>(</span><span class='hs-conid'>ConPatOut</span> <span class='hs-layout'>{</span><span class='hs-varid'>pat_args</span><span class='hs-keyglyph'>=</span><span class='hs-varid'>ps</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>details</span> <span class='hs-varid'>ps</span>
<a name="line-53"></a>    
<a name="line-54"></a>    <span class='hs-varid'>hs_pat</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>emptyNameSet</span>
<a name="line-55"></a>    
<a name="line-56"></a>    <span class='hs-varid'>details</span> <span class='hs-layout'>(</span><span class='hs-conid'>PrefixCon</span> <span class='hs-varid'>ps</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hs_lpats</span> <span class='hs-varid'>ps</span>
<a name="line-57"></a>    <span class='hs-varid'>details</span> <span class='hs-layout'>(</span><span class='hs-conid'>RecCon</span> <span class='hs-varid'>fs</span><span class='hs-layout'>)</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hs_lpats</span> <span class='hs-varid'>explicit</span> <span class='hs-varop'>`unionNameSets`</span> <span class='hs-varid'>mkNameSet</span> <span class='hs-layout'>(</span><span class='hs-varid'>collectPatsBinders</span> <span class='hs-varid'>implicit</span><span class='hs-layout'>)</span>
<a name="line-58"></a>      <span class='hs-keyword'>where</span> <span class='hs-layout'>(</span><span class='hs-varid'>explicit</span><span class='hs-layout'>,</span> <span class='hs-varid'>implicit</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>partitionEithers</span> <span class='hs-keyglyph'>[</span><span class='hs-keyword'>if</span> <span class='hs-varid'>pat_explicit</span> <span class='hs-keyword'>then</span> <span class='hs-conid'>Left</span> <span class='hs-varid'>pat</span> <span class='hs-keyword'>else</span> <span class='hs-conid'>Right</span> <span class='hs-varid'>pat</span>
<a name="line-59"></a>                                                    <span class='hs-keyglyph'>|</span> <span class='hs-layout'>(</span><span class='hs-varid'>i</span><span class='hs-layout'>,</span> <span class='hs-varid'>fld</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-keyglyph'>[</span><span class='hs-num'>0</span><span class='hs-keyglyph'>..</span><span class='hs-keyglyph'>]</span> <span class='hs-varop'>`zip`</span> <span class='hs-varid'>rec_flds</span> <span class='hs-varid'>fs</span>
<a name="line-60"></a>                                                    <span class='hs-layout'>,</span> <span class='hs-keyword'>let</span> <span class='hs-varid'>pat</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hsRecFieldArg</span> <span class='hs-varid'>fld</span>
<a name="line-61"></a>                                                          <span class='hs-varid'>pat_explicit</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>maybe</span> <span class='hs-conid'>True</span> <span class='hs-layout'>(</span><span class='hs-varid'>i</span><span class='hs-varop'>&lt;</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>rec_dotdot</span> <span class='hs-varid'>fs</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-62"></a>    <span class='hs-varid'>details</span> <span class='hs-layout'>(</span><span class='hs-conid'>InfixCon</span> <span class='hs-varid'>p1</span> <span class='hs-varid'>p2</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hs_lpat</span> <span class='hs-varid'>p1</span> <span class='hs-varop'>`unionNameSets`</span> <span class='hs-varid'>hs_lpat</span> <span class='hs-varid'>p2</span>
</pre>\end{code}
</body>
</html>
