<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>basicTypes/Module.lhs</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
%
% (c) The University of Glasgow, 2004-2006
%

Module
~~~~~~~~~~
Simply the name of a module, represented as a FastString.
These are Uniquable, hence we can build Maps with Modules as
the keys.

\begin{code}
<pre><a name="line-1"></a>
<a name="line-2"></a><span class='hs-keyword'>module</span> <span class='hs-conid'>Module</span>
<a name="line-3"></a>    <span class='hs-layout'>(</span>
<a name="line-4"></a>        <span class='hs-comment'>-- * The ModuleName type</span>
<a name="line-5"></a>        <span class='hs-conid'>ModuleName</span><span class='hs-layout'>,</span>
<a name="line-6"></a>        <span class='hs-varid'>pprModuleName</span><span class='hs-layout'>,</span>
<a name="line-7"></a>        <span class='hs-varid'>moduleNameFS</span><span class='hs-layout'>,</span>
<a name="line-8"></a>        <span class='hs-varid'>moduleNameString</span><span class='hs-layout'>,</span>
<a name="line-9"></a>        <span class='hs-varid'>moduleNameSlashes</span><span class='hs-layout'>,</span> <span class='hs-varid'>moduleNameColons</span><span class='hs-layout'>,</span>
<a name="line-10"></a>        <span class='hs-varid'>mkModuleName</span><span class='hs-layout'>,</span>
<a name="line-11"></a>        <span class='hs-varid'>mkModuleNameFS</span><span class='hs-layout'>,</span>
<a name="line-12"></a>        <span class='hs-varid'>stableModuleNameCmp</span><span class='hs-layout'>,</span>
<a name="line-13"></a>
<a name="line-14"></a>        <span class='hs-comment'>-- * The PackageId type</span>
<a name="line-15"></a>        <span class='hs-conid'>PackageId</span><span class='hs-layout'>,</span>
<a name="line-16"></a>        <span class='hs-varid'>fsToPackageId</span><span class='hs-layout'>,</span>
<a name="line-17"></a>        <span class='hs-varid'>packageIdFS</span><span class='hs-layout'>,</span>
<a name="line-18"></a>        <span class='hs-varid'>stringToPackageId</span><span class='hs-layout'>,</span>
<a name="line-19"></a>        <span class='hs-varid'>packageIdString</span><span class='hs-layout'>,</span>
<a name="line-20"></a>        <span class='hs-varid'>stablePackageIdCmp</span><span class='hs-layout'>,</span>
<a name="line-21"></a>
<a name="line-22"></a>        <span class='hs-comment'>-- * Wired-in PackageIds</span>
<a name="line-23"></a>        <span class='hs-comment'>-- $wired_in_packages</span>
<a name="line-24"></a>        <span class='hs-varid'>primPackageId</span><span class='hs-layout'>,</span>
<a name="line-25"></a>        <span class='hs-varid'>integerPackageId</span><span class='hs-layout'>,</span>
<a name="line-26"></a>        <span class='hs-varid'>basePackageId</span><span class='hs-layout'>,</span>
<a name="line-27"></a>        <span class='hs-varid'>rtsPackageId</span><span class='hs-layout'>,</span>
<a name="line-28"></a>        <span class='hs-varid'>thPackageId</span><span class='hs-layout'>,</span>
<a name="line-29"></a>        <span class='hs-varid'>dphSeqPackageId</span><span class='hs-layout'>,</span>
<a name="line-30"></a>        <span class='hs-varid'>dphParPackageId</span><span class='hs-layout'>,</span>
<a name="line-31"></a>        <span class='hs-varid'>mainPackageId</span><span class='hs-layout'>,</span>
<a name="line-32"></a>        <span class='hs-varid'>thisGhcPackageId</span><span class='hs-layout'>,</span>
<a name="line-33"></a>        <span class='hs-varid'>interactivePackageId</span><span class='hs-layout'>,</span> <span class='hs-varid'>isInteractiveModule</span><span class='hs-layout'>,</span>
<a name="line-34"></a>
<a name="line-35"></a>        <span class='hs-comment'>-- * The Module type</span>
<a name="line-36"></a>        <span class='hs-conid'>Module</span><span class='hs-layout'>,</span>
<a name="line-37"></a>        <span class='hs-varid'>modulePackageId</span><span class='hs-layout'>,</span> <span class='hs-varid'>moduleName</span><span class='hs-layout'>,</span>
<a name="line-38"></a>        <span class='hs-varid'>pprModule</span><span class='hs-layout'>,</span>
<a name="line-39"></a>        <span class='hs-varid'>mkModule</span><span class='hs-layout'>,</span>
<a name="line-40"></a>        <span class='hs-varid'>stableModuleCmp</span><span class='hs-layout'>,</span>
<a name="line-41"></a>        <span class='hs-conid'>HasModule</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-42"></a>        <span class='hs-conid'>ContainsModule</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-43"></a>
<a name="line-44"></a>        <span class='hs-comment'>-- * The ModuleLocation type</span>
<a name="line-45"></a>        <span class='hs-conid'>ModLocation</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-46"></a>        <span class='hs-varid'>addBootSuffix</span><span class='hs-layout'>,</span> <span class='hs-varid'>addBootSuffix_maybe</span><span class='hs-layout'>,</span> <span class='hs-varid'>addBootSuffixLocn</span><span class='hs-layout'>,</span>
<a name="line-47"></a>
<a name="line-48"></a>        <span class='hs-comment'>-- * Module mappings</span>
<a name="line-49"></a>        <span class='hs-conid'>ModuleEnv</span><span class='hs-layout'>,</span>
<a name="line-50"></a>        <span class='hs-varid'>elemModuleEnv</span><span class='hs-layout'>,</span> <span class='hs-varid'>extendModuleEnv</span><span class='hs-layout'>,</span> <span class='hs-varid'>extendModuleEnvList</span><span class='hs-layout'>,</span>
<a name="line-51"></a>        <span class='hs-varid'>extendModuleEnvList_C</span><span class='hs-layout'>,</span> <span class='hs-varid'>plusModuleEnv_C</span><span class='hs-layout'>,</span>
<a name="line-52"></a>        <span class='hs-varid'>delModuleEnvList</span><span class='hs-layout'>,</span> <span class='hs-varid'>delModuleEnv</span><span class='hs-layout'>,</span> <span class='hs-varid'>plusModuleEnv</span><span class='hs-layout'>,</span> <span class='hs-varid'>lookupModuleEnv</span><span class='hs-layout'>,</span>
<a name="line-53"></a>        <span class='hs-varid'>lookupWithDefaultModuleEnv</span><span class='hs-layout'>,</span> <span class='hs-varid'>mapModuleEnv</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkModuleEnv</span><span class='hs-layout'>,</span> <span class='hs-varid'>emptyModuleEnv</span><span class='hs-layout'>,</span>
<a name="line-54"></a>        <span class='hs-varid'>moduleEnvKeys</span><span class='hs-layout'>,</span> <span class='hs-varid'>moduleEnvElts</span><span class='hs-layout'>,</span> <span class='hs-varid'>moduleEnvToList</span><span class='hs-layout'>,</span>
<a name="line-55"></a>        <span class='hs-varid'>unitModuleEnv</span><span class='hs-layout'>,</span> <span class='hs-varid'>isEmptyModuleEnv</span><span class='hs-layout'>,</span>
<a name="line-56"></a>        <span class='hs-varid'>foldModuleEnv</span><span class='hs-layout'>,</span> <span class='hs-varid'>extendModuleEnvWith</span><span class='hs-layout'>,</span> <span class='hs-varid'>filterModuleEnv</span><span class='hs-layout'>,</span>
<a name="line-57"></a>
<a name="line-58"></a>        <span class='hs-comment'>-- * ModuleName mappings</span>
<a name="line-59"></a>        <span class='hs-conid'>ModuleNameEnv</span><span class='hs-layout'>,</span>
<a name="line-60"></a>
<a name="line-61"></a>        <span class='hs-comment'>-- * Sets of Modules</span>
<a name="line-62"></a>        <span class='hs-conid'>ModuleSet</span><span class='hs-layout'>,</span>
<a name="line-63"></a>        <span class='hs-varid'>emptyModuleSet</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkModuleSet</span><span class='hs-layout'>,</span> <span class='hs-varid'>moduleSetElts</span><span class='hs-layout'>,</span> <span class='hs-varid'>extendModuleSet</span><span class='hs-layout'>,</span> <span class='hs-varid'>elemModuleSet</span>
<a name="line-64"></a>    <span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-65"></a>
<a name="line-66"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Config</span>
<a name="line-67"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Outputable</span>
<a name="line-68"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Unique</span>
<a name="line-69"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>UniqFM</span>
<a name="line-70"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>FastString</span>
<a name="line-71"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Binary</span>
<a name="line-72"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Util</span>
<a name="line-73"></a>
<a name="line-74"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Data</span>
<a name="line-75"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Map</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span><span class='hs-layout'>)</span>
<a name="line-76"></a><span class='hs-keyword'>import</span> <span class='hs-keyword'>qualified</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Map</span> <span class='hs-keyword'>as</span> <span class='hs-conid'>Map</span>
<a name="line-77"></a><span class='hs-keyword'>import</span> <span class='hs-keyword'>qualified</span> <span class='hs-conid'>FiniteMap</span> <span class='hs-keyword'>as</span> <span class='hs-conid'>Map</span>
<a name="line-78"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>System</span><span class='hs-varop'>.</span><span class='hs-conid'>FilePath</span>
</pre>\end{code}

%************************************************************************
%*                                                                      *
\subsection{Module locations}
%*                                                                      *
%************************************************************************

\begin{code}
<pre><a name="line-1"></a><a name="ModLocation"></a><span class='hs-comment'>-- | Where a module lives on the file system: the actual locations</span>
<a name="line-2"></a><a name="ModLocation"></a><span class='hs-comment'>-- of the .hs, .hi and .o files, if we have them</span>
<a name="line-3"></a><a name="ModLocation"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>ModLocation</span>
<a name="line-4"></a>   <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ModLocation</span> <span class='hs-layout'>{</span>
<a name="line-5"></a>        <span class='hs-varid'>ml_hs_file</span>   <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>FilePath</span><span class='hs-layout'>,</span>
<a name="line-6"></a>                <span class='hs-comment'>-- The source file, if we have one.  Package modules</span>
<a name="line-7"></a>                <span class='hs-comment'>-- probably don't have source files.</span>
<a name="line-8"></a>
<a name="line-9"></a>        <span class='hs-varid'>ml_hi_file</span>   <span class='hs-keyglyph'>::</span> <span class='hs-conid'>FilePath</span><span class='hs-layout'>,</span>
<a name="line-10"></a>                <span class='hs-comment'>-- Where the .hi file is, whether or not it exists</span>
<a name="line-11"></a>                <span class='hs-comment'>-- yet.  Always of form foo.hi, even if there is an</span>
<a name="line-12"></a>                <span class='hs-comment'>-- hi-boot file (we add the -boot suffix later)</span>
<a name="line-13"></a>
<a name="line-14"></a>        <span class='hs-varid'>ml_obj_file</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>FilePath</span>
<a name="line-15"></a>                <span class='hs-comment'>-- Where the .o file is, whether or not it exists yet.</span>
<a name="line-16"></a>                <span class='hs-comment'>-- (might not exist either because the module hasn't</span>
<a name="line-17"></a>                <span class='hs-comment'>-- been compiled yet, or because it is part of a</span>
<a name="line-18"></a>                <span class='hs-comment'>-- package with a .a file)</span>
<a name="line-19"></a>  <span class='hs-layout'>}</span> <span class='hs-keyword'>deriving</span> <span class='hs-conid'>Show</span>
<a name="line-20"></a>
<a name="line-21"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Outputable</span> <span class='hs-conid'>ModLocation</span> <span class='hs-keyword'>where</span>
<a name="line-22"></a>   <span class='hs-varid'>ppr</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-varop'>.</span> <span class='hs-varid'>show</span>
</pre>\end{code}

For a module in another package, the hs_file and obj_file
components of ModLocation are undefined.

The locations specified by a ModLocation may or may not
correspond to actual files yet: for example, even if the object
file doesn't exist, the ModLocation still contains the path to
where the object file will reside if/when it is created.

\begin{code}
<pre><a name="line-1"></a><a name="addBootSuffix"></a><span class='hs-definition'>addBootSuffix</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>FilePath</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>FilePath</span>
<a name="line-2"></a><span class='hs-comment'>-- ^ Add the @-boot@ suffix to .hs, .hi and .o files</span>
<a name="line-3"></a><span class='hs-definition'>addBootSuffix</span> <span class='hs-varid'>path</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>path</span> <span class='hs-varop'>++</span> <span class='hs-str'>"-boot"</span>
<a name="line-4"></a>
<a name="line-5"></a><a name="addBootSuffix_maybe"></a><span class='hs-definition'>addBootSuffix_maybe</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Bool</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>FilePath</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>FilePath</span>
<a name="line-6"></a><span class='hs-comment'>-- ^ Add the @-boot@ suffix if the @Bool@ argument is @True@</span>
<a name="line-7"></a><span class='hs-definition'>addBootSuffix_maybe</span> <span class='hs-varid'>is_boot</span> <span class='hs-varid'>path</span>
<a name="line-8"></a> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>is_boot</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>addBootSuffix</span> <span class='hs-varid'>path</span>
<a name="line-9"></a> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>path</span>
<a name="line-10"></a>
<a name="line-11"></a><a name="addBootSuffixLocn"></a><span class='hs-definition'>addBootSuffixLocn</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ModLocation</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ModLocation</span>
<a name="line-12"></a><span class='hs-comment'>-- ^ Add the @-boot@ suffix to all file paths associated with the module</span>
<a name="line-13"></a><span class='hs-definition'>addBootSuffixLocn</span> <span class='hs-varid'>locn</span>
<a name="line-14"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>locn</span> <span class='hs-layout'>{</span> <span class='hs-varid'>ml_hs_file</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fmap</span> <span class='hs-varid'>addBootSuffix</span> <span class='hs-layout'>(</span><span class='hs-varid'>ml_hs_file</span> <span class='hs-varid'>locn</span><span class='hs-layout'>)</span>
<a name="line-15"></a>         <span class='hs-layout'>,</span> <span class='hs-varid'>ml_hi_file</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>addBootSuffix</span> <span class='hs-layout'>(</span><span class='hs-varid'>ml_hi_file</span> <span class='hs-varid'>locn</span><span class='hs-layout'>)</span>
<a name="line-16"></a>         <span class='hs-layout'>,</span> <span class='hs-varid'>ml_obj_file</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>addBootSuffix</span> <span class='hs-layout'>(</span><span class='hs-varid'>ml_obj_file</span> <span class='hs-varid'>locn</span><span class='hs-layout'>)</span> <span class='hs-layout'>}</span>
</pre>\end{code}


%************************************************************************
%*                                                                      *
\subsection{The name of a module}
%*                                                                      *
%************************************************************************

\begin{code}
<pre><a name="line-1"></a><a name="ModuleName"></a><span class='hs-comment'>-- | A ModuleName is essentially a simple string, e.g. @Data.List@.</span>
<a name="line-2"></a><a name="ModuleName"></a><span class='hs-keyword'>newtype</span> <span class='hs-conid'>ModuleName</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ModuleName</span> <span class='hs-conid'>FastString</span>
<a name="line-3"></a>    <span class='hs-keyword'>deriving</span> <span class='hs-conid'>Typeable</span>
<a name="line-4"></a>
<a name="line-5"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Uniquable</span> <span class='hs-conid'>ModuleName</span> <span class='hs-keyword'>where</span>
<a name="line-6"></a>  <span class='hs-varid'>getUnique</span> <span class='hs-layout'>(</span><span class='hs-conid'>ModuleName</span> <span class='hs-varid'>nm</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getUnique</span> <span class='hs-varid'>nm</span>
<a name="line-7"></a>
<a name="line-8"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Eq</span> <span class='hs-conid'>ModuleName</span> <span class='hs-keyword'>where</span>
<a name="line-9"></a>  <span class='hs-varid'>nm1</span> <span class='hs-varop'>==</span> <span class='hs-varid'>nm2</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getUnique</span> <span class='hs-varid'>nm1</span> <span class='hs-varop'>==</span> <span class='hs-varid'>getUnique</span> <span class='hs-varid'>nm2</span>
<a name="line-10"></a>
<a name="line-11"></a><span class='hs-comment'>-- Warning: gives an ordering relation based on the uniques of the</span>
<a name="line-12"></a><span class='hs-comment'>-- FastStrings which are the (encoded) module names.  This is _not_</span>
<a name="line-13"></a><span class='hs-comment'>-- a lexicographical ordering.</span>
<a name="line-14"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Ord</span> <span class='hs-conid'>ModuleName</span> <span class='hs-keyword'>where</span>
<a name="line-15"></a>  <span class='hs-varid'>nm1</span> <span class='hs-varop'>`compare`</span> <span class='hs-varid'>nm2</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getUnique</span> <span class='hs-varid'>nm1</span> <span class='hs-varop'>`compare`</span> <span class='hs-varid'>getUnique</span> <span class='hs-varid'>nm2</span>
<a name="line-16"></a>
<a name="line-17"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Outputable</span> <span class='hs-conid'>ModuleName</span> <span class='hs-keyword'>where</span>
<a name="line-18"></a>  <span class='hs-varid'>ppr</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprModuleName</span>
<a name="line-19"></a>
<a name="line-20"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Binary</span> <span class='hs-conid'>ModuleName</span> <span class='hs-keyword'>where</span>
<a name="line-21"></a>  <span class='hs-varid'>put_</span> <span class='hs-varid'>bh</span> <span class='hs-layout'>(</span><span class='hs-conid'>ModuleName</span> <span class='hs-varid'>fs</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>put_</span> <span class='hs-varid'>bh</span> <span class='hs-varid'>fs</span>
<a name="line-22"></a>  <span class='hs-varid'>get</span> <span class='hs-varid'>bh</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span> <span class='hs-varid'>fs</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>get</span> <span class='hs-varid'>bh</span><span class='hs-layout'>;</span> <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-conid'>ModuleName</span> <span class='hs-varid'>fs</span><span class='hs-layout'>)</span>
<a name="line-23"></a>
<a name="line-24"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Data</span> <span class='hs-conid'>ModuleName</span> <span class='hs-keyword'>where</span>
<a name="line-25"></a>  <span class='hs-comment'>-- don't traverse?</span>
<a name="line-26"></a>  <span class='hs-varid'>toConstr</span> <span class='hs-keyword'>_</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>abstractConstr</span> <span class='hs-str'>"ModuleName"</span>
<a name="line-27"></a>  <span class='hs-varid'>gunfold</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>error</span> <span class='hs-str'>"gunfold"</span>
<a name="line-28"></a>  <span class='hs-varid'>dataTypeOf</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkNoRepType</span> <span class='hs-str'>"ModuleName"</span>
<a name="line-29"></a>
<a name="line-30"></a><a name="stableModuleNameCmp"></a><span class='hs-definition'>stableModuleNameCmp</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ModuleName</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ModuleName</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Ordering</span>
<a name="line-31"></a><span class='hs-comment'>-- ^ Compares module names lexically, rather than by their 'Unique's</span>
<a name="line-32"></a><span class='hs-definition'>stableModuleNameCmp</span> <span class='hs-varid'>n1</span> <span class='hs-varid'>n2</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>moduleNameFS</span> <span class='hs-varid'>n1</span> <span class='hs-varop'>`compare`</span> <span class='hs-varid'>moduleNameFS</span> <span class='hs-varid'>n2</span>
<a name="line-33"></a>
<a name="line-34"></a><a name="pprModuleName"></a><span class='hs-definition'>pprModuleName</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ModuleName</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-35"></a><span class='hs-definition'>pprModuleName</span> <span class='hs-layout'>(</span><span class='hs-conid'>ModuleName</span> <span class='hs-varid'>nm</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-36"></a>    <span class='hs-varid'>getPprStyle</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span> <span class='hs-varid'>sty</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-37"></a>    <span class='hs-keyword'>if</span> <span class='hs-varid'>codeStyle</span> <span class='hs-varid'>sty</span>
<a name="line-38"></a>        <span class='hs-keyword'>then</span> <span class='hs-varid'>ztext</span> <span class='hs-layout'>(</span><span class='hs-varid'>zEncodeFS</span> <span class='hs-varid'>nm</span><span class='hs-layout'>)</span>
<a name="line-39"></a>        <span class='hs-keyword'>else</span> <span class='hs-varid'>ftext</span> <span class='hs-varid'>nm</span>
<a name="line-40"></a>
<a name="line-41"></a><a name="moduleNameFS"></a><span class='hs-definition'>moduleNameFS</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ModuleName</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>FastString</span>
<a name="line-42"></a><span class='hs-definition'>moduleNameFS</span> <span class='hs-layout'>(</span><span class='hs-conid'>ModuleName</span> <span class='hs-varid'>mod</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mod</span>
<a name="line-43"></a>
<a name="line-44"></a><a name="moduleNameString"></a><span class='hs-definition'>moduleNameString</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ModuleName</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>String</span>
<a name="line-45"></a><span class='hs-definition'>moduleNameString</span> <span class='hs-layout'>(</span><span class='hs-conid'>ModuleName</span> <span class='hs-varid'>mod</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>unpackFS</span> <span class='hs-varid'>mod</span>
<a name="line-46"></a>
<a name="line-47"></a><a name="mkModuleName"></a><span class='hs-definition'>mkModuleName</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ModuleName</span>
<a name="line-48"></a><span class='hs-definition'>mkModuleName</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ModuleName</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkFastString</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span>
<a name="line-49"></a>
<a name="line-50"></a><a name="mkModuleNameFS"></a><span class='hs-definition'>mkModuleNameFS</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>FastString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ModuleName</span>
<a name="line-51"></a><span class='hs-definition'>mkModuleNameFS</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ModuleName</span> <span class='hs-varid'>s</span>
<a name="line-52"></a>
<a name="line-53"></a><a name="moduleNameSlashes"></a><span class='hs-comment'>-- |Returns the string version of the module name, with dots replaced by slashes.</span>
<a name="line-54"></a><span class='hs-comment'>--</span>
<a name="line-55"></a><span class='hs-definition'>moduleNameSlashes</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ModuleName</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>String</span>
<a name="line-56"></a><span class='hs-definition'>moduleNameSlashes</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>dots_to_slashes</span> <span class='hs-varop'>.</span> <span class='hs-varid'>moduleNameString</span>
<a name="line-57"></a>  <span class='hs-keyword'>where</span> <span class='hs-varid'>dots_to_slashes</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>c</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>if</span> <span class='hs-varid'>c</span> <span class='hs-varop'>==</span> <span class='hs-chr'>'.'</span> <span class='hs-keyword'>then</span> <span class='hs-varid'>pathSeparator</span> <span class='hs-keyword'>else</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span>
<a name="line-58"></a>
<a name="line-59"></a><a name="moduleNameColons"></a><span class='hs-comment'>-- |Returns the string version of the module name, with dots replaced by underscores.</span>
<a name="line-60"></a><span class='hs-comment'>--</span>
<a name="line-61"></a><span class='hs-definition'>moduleNameColons</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ModuleName</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>String</span>
<a name="line-62"></a><span class='hs-definition'>moduleNameColons</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>dots_to_colons</span> <span class='hs-varop'>.</span> <span class='hs-varid'>moduleNameString</span>
<a name="line-63"></a>  <span class='hs-keyword'>where</span> <span class='hs-varid'>dots_to_colons</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>c</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>if</span> <span class='hs-varid'>c</span> <span class='hs-varop'>==</span> <span class='hs-chr'>'.'</span> <span class='hs-keyword'>then</span> <span class='hs-chr'>':'</span> <span class='hs-keyword'>else</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span>
</pre>\end{code}

%************************************************************************
%*                                                                      *
\subsection{A fully qualified module}
%*                                                                      *
%************************************************************************

\begin{code}
<pre><a name="line-1"></a><a name="Module"></a><span class='hs-comment'>-- | A Module is a pair of a 'PackageId' and a 'ModuleName'.</span>
<a name="line-2"></a><a name="Module"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>Module</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Module</span> <span class='hs-layout'>{</span>
<a name="line-3"></a>   <span class='hs-varid'>modulePackageId</span> <span class='hs-keyglyph'>::</span> <span class='hs-varop'>!</span><span class='hs-conid'>PackageId</span><span class='hs-layout'>,</span>  <span class='hs-comment'>-- pkg-1.0</span>
<a name="line-4"></a>   <span class='hs-varid'>moduleName</span>      <span class='hs-keyglyph'>::</span> <span class='hs-varop'>!</span><span class='hs-conid'>ModuleName</span>  <span class='hs-comment'>-- A.B.C</span>
<a name="line-5"></a>  <span class='hs-layout'>}</span>
<a name="line-6"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Eq</span><span class='hs-layout'>,</span> <span class='hs-conid'>Ord</span><span class='hs-layout'>,</span> <span class='hs-conid'>Typeable</span><span class='hs-layout'>)</span>
<a name="line-7"></a>
<a name="line-8"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Uniquable</span> <span class='hs-conid'>Module</span> <span class='hs-keyword'>where</span>
<a name="line-9"></a>  <span class='hs-varid'>getUnique</span> <span class='hs-layout'>(</span><span class='hs-conid'>Module</span> <span class='hs-varid'>p</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getUnique</span> <span class='hs-layout'>(</span><span class='hs-varid'>packageIdFS</span> <span class='hs-varid'>p</span> <span class='hs-varop'>`appendFS`</span> <span class='hs-varid'>moduleNameFS</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span>
<a name="line-10"></a>
<a name="line-11"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Outputable</span> <span class='hs-conid'>Module</span> <span class='hs-keyword'>where</span>
<a name="line-12"></a>  <span class='hs-varid'>ppr</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprModule</span>
<a name="line-13"></a>
<a name="line-14"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Binary</span> <span class='hs-conid'>Module</span> <span class='hs-keyword'>where</span>
<a name="line-15"></a>  <span class='hs-varid'>put_</span> <span class='hs-varid'>bh</span> <span class='hs-layout'>(</span><span class='hs-conid'>Module</span> <span class='hs-varid'>p</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>put_</span> <span class='hs-varid'>bh</span> <span class='hs-varid'>p</span> <span class='hs-varop'>&gt;&gt;</span> <span class='hs-varid'>put_</span> <span class='hs-varid'>bh</span> <span class='hs-varid'>n</span>
<a name="line-16"></a>  <span class='hs-varid'>get</span> <span class='hs-varid'>bh</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>get</span> <span class='hs-varid'>bh</span><span class='hs-layout'>;</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>get</span> <span class='hs-varid'>bh</span><span class='hs-layout'>;</span> <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-conid'>Module</span> <span class='hs-varid'>p</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span>
<a name="line-17"></a>
<a name="line-18"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Data</span> <span class='hs-conid'>Module</span> <span class='hs-keyword'>where</span>
<a name="line-19"></a>  <span class='hs-comment'>-- don't traverse?</span>
<a name="line-20"></a>  <span class='hs-varid'>toConstr</span> <span class='hs-keyword'>_</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>abstractConstr</span> <span class='hs-str'>"Module"</span>
<a name="line-21"></a>  <span class='hs-varid'>gunfold</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>error</span> <span class='hs-str'>"gunfold"</span>
<a name="line-22"></a>  <span class='hs-varid'>dataTypeOf</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkNoRepType</span> <span class='hs-str'>"Module"</span>
<a name="line-23"></a>
<a name="line-24"></a><a name="stableModuleCmp"></a><span class='hs-comment'>-- | This gives a stable ordering, as opposed to the Ord instance which</span>
<a name="line-25"></a><span class='hs-comment'>-- gives an ordering based on the 'Unique's of the components, which may</span>
<a name="line-26"></a><span class='hs-comment'>-- not be stable from run to run of the compiler.</span>
<a name="line-27"></a><span class='hs-definition'>stableModuleCmp</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Module</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Module</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Ordering</span>
<a name="line-28"></a><span class='hs-definition'>stableModuleCmp</span> <span class='hs-layout'>(</span><span class='hs-conid'>Module</span> <span class='hs-varid'>p1</span> <span class='hs-varid'>n1</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>Module</span> <span class='hs-varid'>p2</span> <span class='hs-varid'>n2</span><span class='hs-layout'>)</span>
<a name="line-29"></a>   <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>p1</span> <span class='hs-varop'>`stablePackageIdCmp`</span>  <span class='hs-varid'>p2</span><span class='hs-layout'>)</span> <span class='hs-varop'>`thenCmp`</span>
<a name="line-30"></a>     <span class='hs-layout'>(</span><span class='hs-varid'>n1</span> <span class='hs-varop'>`stableModuleNameCmp`</span> <span class='hs-varid'>n2</span><span class='hs-layout'>)</span>
<a name="line-31"></a>
<a name="line-32"></a><a name="mkModule"></a><span class='hs-definition'>mkModule</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>PackageId</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ModuleName</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Module</span>
<a name="line-33"></a><span class='hs-definition'>mkModule</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Module</span>
<a name="line-34"></a>
<a name="line-35"></a><a name="pprModule"></a><span class='hs-definition'>pprModule</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Module</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-36"></a><span class='hs-definition'>pprModule</span> <span class='hs-varid'>mod</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-conid'>Module</span> <span class='hs-varid'>p</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>=</span>
<a name="line-37"></a>  <span class='hs-varid'>pprPackagePrefix</span> <span class='hs-varid'>p</span> <span class='hs-varid'>mod</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>pprModuleName</span> <span class='hs-varid'>n</span>
<a name="line-38"></a>
<a name="line-39"></a><a name="pprPackagePrefix"></a><span class='hs-definition'>pprPackagePrefix</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>PackageId</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Module</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-40"></a><span class='hs-definition'>pprPackagePrefix</span> <span class='hs-varid'>p</span> <span class='hs-varid'>mod</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getPprStyle</span> <span class='hs-varid'>doc</span>
<a name="line-41"></a> <span class='hs-keyword'>where</span>
<a name="line-42"></a>   <span class='hs-varid'>doc</span> <span class='hs-varid'>sty</span>
<a name="line-43"></a>       <span class='hs-keyglyph'>|</span> <span class='hs-varid'>codeStyle</span> <span class='hs-varid'>sty</span> <span class='hs-keyglyph'>=</span>
<a name="line-44"></a>          <span class='hs-keyword'>if</span> <span class='hs-varid'>p</span> <span class='hs-varop'>==</span> <span class='hs-varid'>mainPackageId</span>
<a name="line-45"></a>                <span class='hs-keyword'>then</span> <span class='hs-varid'>empty</span> <span class='hs-comment'>-- never qualify the main package in code</span>
<a name="line-46"></a>                <span class='hs-keyword'>else</span> <span class='hs-varid'>ztext</span> <span class='hs-layout'>(</span><span class='hs-varid'>zEncodeFS</span> <span class='hs-layout'>(</span><span class='hs-varid'>packageIdFS</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'_'</span>
<a name="line-47"></a>       <span class='hs-keyglyph'>|</span> <span class='hs-varid'>qualModule</span> <span class='hs-varid'>sty</span> <span class='hs-varid'>mod</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ftext</span> <span class='hs-layout'>(</span><span class='hs-varid'>packageIdFS</span> <span class='hs-layout'>(</span><span class='hs-varid'>modulePackageId</span> <span class='hs-varid'>mod</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>char</span> <span class='hs-chr'>':'</span>
<a name="line-48"></a>                <span class='hs-comment'>-- the PrintUnqualified tells us which modules have to</span>
<a name="line-49"></a>                <span class='hs-comment'>-- be qualified with package names</span>
<a name="line-50"></a>       <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>empty</span>
<a name="line-51"></a>
<a name="line-52"></a><span class='hs-keyword'>class</span> <span class='hs-conid'>ContainsModule</span> <span class='hs-varid'>t</span> <span class='hs-keyword'>where</span>
<a name="line-53"></a>    <span class='hs-varid'>extractModule</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>t</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Module</span>
<a name="line-54"></a>
<a name="line-55"></a><span class='hs-keyword'>class</span> <span class='hs-conid'>HasModule</span> <span class='hs-varid'>m</span> <span class='hs-keyword'>where</span>
<a name="line-56"></a>    <span class='hs-varid'>getModule</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>m</span> <span class='hs-conid'>Module</span>
</pre>\end{code}

%************************************************************************
%*                                                                      *
\subsection{PackageId}
%*                                                                      *
%************************************************************************

\begin{code}
<pre><a name="line-1"></a><a name="PackageId"></a><span class='hs-comment'>-- | Essentially just a string identifying a package, including the version: e.g. parsec-1.0</span>
<a name="line-2"></a><a name="PackageId"></a><span class='hs-keyword'>newtype</span> <span class='hs-conid'>PackageId</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>PId</span> <span class='hs-conid'>FastString</span> <span class='hs-keyword'>deriving</span><span class='hs-layout'>(</span> <span class='hs-conid'>Eq</span><span class='hs-layout'>,</span> <span class='hs-conid'>Typeable</span> <span class='hs-layout'>)</span>
<a name="line-3"></a>    <span class='hs-comment'>-- here to avoid module loops with PackageConfig</span>
<a name="line-4"></a>
<a name="line-5"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Uniquable</span> <span class='hs-conid'>PackageId</span> <span class='hs-keyword'>where</span>
<a name="line-6"></a> <span class='hs-varid'>getUnique</span> <span class='hs-varid'>pid</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getUnique</span> <span class='hs-layout'>(</span><span class='hs-varid'>packageIdFS</span> <span class='hs-varid'>pid</span><span class='hs-layout'>)</span>
<a name="line-7"></a>
<a name="line-8"></a><span class='hs-comment'>-- Note: *not* a stable lexicographic ordering, a faster unique-based</span>
<a name="line-9"></a><span class='hs-comment'>-- ordering.</span>
<a name="line-10"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Ord</span> <span class='hs-conid'>PackageId</span> <span class='hs-keyword'>where</span>
<a name="line-11"></a>  <span class='hs-varid'>nm1</span> <span class='hs-varop'>`compare`</span> <span class='hs-varid'>nm2</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getUnique</span> <span class='hs-varid'>nm1</span> <span class='hs-varop'>`compare`</span> <span class='hs-varid'>getUnique</span> <span class='hs-varid'>nm2</span>
<a name="line-12"></a>
<a name="line-13"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Data</span> <span class='hs-conid'>PackageId</span> <span class='hs-keyword'>where</span>
<a name="line-14"></a>  <span class='hs-comment'>-- don't traverse?</span>
<a name="line-15"></a>  <span class='hs-varid'>toConstr</span> <span class='hs-keyword'>_</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>abstractConstr</span> <span class='hs-str'>"PackageId"</span>
<a name="line-16"></a>  <span class='hs-varid'>gunfold</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>error</span> <span class='hs-str'>"gunfold"</span>
<a name="line-17"></a>  <span class='hs-varid'>dataTypeOf</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkNoRepType</span> <span class='hs-str'>"PackageId"</span>
<a name="line-18"></a>
<a name="line-19"></a><a name="stablePackageIdCmp"></a><span class='hs-definition'>stablePackageIdCmp</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>PackageId</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>PackageId</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Ordering</span>
<a name="line-20"></a><span class='hs-comment'>-- ^ Compares package ids lexically, rather than by their 'Unique's</span>
<a name="line-21"></a><span class='hs-definition'>stablePackageIdCmp</span> <span class='hs-varid'>p1</span> <span class='hs-varid'>p2</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>packageIdFS</span> <span class='hs-varid'>p1</span> <span class='hs-varop'>`compare`</span> <span class='hs-varid'>packageIdFS</span> <span class='hs-varid'>p2</span>
<a name="line-22"></a>
<a name="line-23"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Outputable</span> <span class='hs-conid'>PackageId</span> <span class='hs-keyword'>where</span>
<a name="line-24"></a>   <span class='hs-varid'>ppr</span> <span class='hs-varid'>pid</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-layout'>(</span><span class='hs-varid'>packageIdString</span> <span class='hs-varid'>pid</span><span class='hs-layout'>)</span>
<a name="line-25"></a>
<a name="line-26"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Binary</span> <span class='hs-conid'>PackageId</span> <span class='hs-keyword'>where</span>
<a name="line-27"></a>  <span class='hs-varid'>put_</span> <span class='hs-varid'>bh</span> <span class='hs-varid'>pid</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>put_</span> <span class='hs-varid'>bh</span> <span class='hs-layout'>(</span><span class='hs-varid'>packageIdFS</span> <span class='hs-varid'>pid</span><span class='hs-layout'>)</span>
<a name="line-28"></a>  <span class='hs-varid'>get</span> <span class='hs-varid'>bh</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span> <span class='hs-layout'>{</span> <span class='hs-varid'>fs</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>get</span> <span class='hs-varid'>bh</span><span class='hs-layout'>;</span> <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>fsToPackageId</span> <span class='hs-varid'>fs</span><span class='hs-layout'>)</span> <span class='hs-layout'>}</span>
<a name="line-29"></a>
<a name="line-30"></a><a name="fsToPackageId"></a><span class='hs-definition'>fsToPackageId</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>FastString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>PackageId</span>
<a name="line-31"></a><span class='hs-definition'>fsToPackageId</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>PId</span>
<a name="line-32"></a>
<a name="line-33"></a><a name="packageIdFS"></a><span class='hs-definition'>packageIdFS</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>PackageId</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>FastString</span>
<a name="line-34"></a><span class='hs-definition'>packageIdFS</span> <span class='hs-layout'>(</span><span class='hs-conid'>PId</span> <span class='hs-varid'>fs</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fs</span>
<a name="line-35"></a>
<a name="line-36"></a><a name="stringToPackageId"></a><span class='hs-definition'>stringToPackageId</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>PackageId</span>
<a name="line-37"></a><span class='hs-definition'>stringToPackageId</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fsToPackageId</span> <span class='hs-varop'>.</span> <span class='hs-varid'>mkFastString</span>
<a name="line-38"></a>
<a name="line-39"></a><a name="packageIdString"></a><span class='hs-definition'>packageIdString</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>PackageId</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>String</span>
<a name="line-40"></a><span class='hs-definition'>packageIdString</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>unpackFS</span> <span class='hs-varop'>.</span> <span class='hs-varid'>packageIdFS</span>
<a name="line-41"></a>
<a name="line-42"></a>
<a name="line-43"></a><span class='hs-comment'>-- -----------------------------------------------------------------------------</span>
<a name="line-44"></a><span class='hs-comment'>-- $wired_in_packages</span>
<a name="line-45"></a><span class='hs-comment'>-- Certain packages are known to the compiler, in that we know about certain</span>
<a name="line-46"></a><span class='hs-comment'>-- entities that reside in these packages, and the compiler needs to</span>
<a name="line-47"></a><span class='hs-comment'>-- declare static Modules and Names that refer to these packages.  Hence</span>
<a name="line-48"></a><span class='hs-comment'>-- the wired-in packages can't include version numbers, since we don't want</span>
<a name="line-49"></a><span class='hs-comment'>-- to bake the version numbers of these packages into GHC.</span>
<a name="line-50"></a><span class='hs-comment'>--</span>
<a name="line-51"></a><span class='hs-comment'>-- So here's the plan.  Wired-in packages are still versioned as</span>
<a name="line-52"></a><span class='hs-comment'>-- normal in the packages database, and you can still have multiple</span>
<a name="line-53"></a><span class='hs-comment'>-- versions of them installed.  However, for each invocation of GHC,</span>
<a name="line-54"></a><span class='hs-comment'>-- only a single instance of each wired-in package will be recognised</span>
<a name="line-55"></a><span class='hs-comment'>-- (the desired one is selected via @-package@\/@-hide-package@), and GHC</span>
<a name="line-56"></a><span class='hs-comment'>-- will use the unversioned 'PackageId' below when referring to it,</span>
<a name="line-57"></a><span class='hs-comment'>-- including in .hi files and object file symbols.  Unselected</span>
<a name="line-58"></a><span class='hs-comment'>-- versions of wired-in packages will be ignored, as will any other</span>
<a name="line-59"></a><span class='hs-comment'>-- package that depends directly or indirectly on it (much as if you</span>
<a name="line-60"></a><span class='hs-comment'>-- had used @-ignore-package@).</span>
<a name="line-61"></a>
<a name="line-62"></a><span class='hs-comment'>-- Make sure you change 'Packages.findWiredInPackages' if you add an entry here</span>
<a name="line-63"></a>
<a name="line-64"></a><a name="integerPackageId"></a><span class='hs-definition'>integerPackageId</span><span class='hs-layout'>,</span> <span class='hs-varid'>primPackageId</span><span class='hs-layout'>,</span>
<a name="line-65"></a>  <span class='hs-varid'>basePackageId</span><span class='hs-layout'>,</span> <span class='hs-varid'>rtsPackageId</span><span class='hs-layout'>,</span>
<a name="line-66"></a>  <span class='hs-varid'>thPackageId</span><span class='hs-layout'>,</span> <span class='hs-varid'>dphSeqPackageId</span><span class='hs-layout'>,</span> <span class='hs-varid'>dphParPackageId</span><span class='hs-layout'>,</span>
<a name="line-67"></a>  <span class='hs-varid'>mainPackageId</span><span class='hs-layout'>,</span> <span class='hs-varid'>thisGhcPackageId</span><span class='hs-layout'>,</span> <span class='hs-varid'>interactivePackageId</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>PackageId</span>
<a name="line-68"></a><a name="primPackageId"></a><span class='hs-definition'>primPackageId</span>        <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fsToPackageId</span> <span class='hs-layout'>(</span><span class='hs-varid'>fsLit</span> <span class='hs-str'>"ghc-prim"</span><span class='hs-layout'>)</span>
<a name="line-69"></a><span class='hs-definition'>integerPackageId</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fsToPackageId</span> <span class='hs-layout'>(</span><span class='hs-varid'>fsLit</span> <span class='hs-varid'>cIntegerLibrary</span><span class='hs-layout'>)</span>
<a name="line-70"></a><a name="basePackageId"></a><span class='hs-definition'>basePackageId</span>        <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fsToPackageId</span> <span class='hs-layout'>(</span><span class='hs-varid'>fsLit</span> <span class='hs-str'>"base"</span><span class='hs-layout'>)</span>
<a name="line-71"></a><a name="rtsPackageId"></a><span class='hs-definition'>rtsPackageId</span>         <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fsToPackageId</span> <span class='hs-layout'>(</span><span class='hs-varid'>fsLit</span> <span class='hs-str'>"rts"</span><span class='hs-layout'>)</span>
<a name="line-72"></a><a name="thPackageId"></a><span class='hs-definition'>thPackageId</span>          <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fsToPackageId</span> <span class='hs-layout'>(</span><span class='hs-varid'>fsLit</span> <span class='hs-str'>"template-haskell"</span><span class='hs-layout'>)</span>
<a name="line-73"></a><a name="dphSeqPackageId"></a><span class='hs-definition'>dphSeqPackageId</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fsToPackageId</span> <span class='hs-layout'>(</span><span class='hs-varid'>fsLit</span> <span class='hs-str'>"dph-seq"</span><span class='hs-layout'>)</span>
<a name="line-74"></a><a name="dphParPackageId"></a><span class='hs-definition'>dphParPackageId</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fsToPackageId</span> <span class='hs-layout'>(</span><span class='hs-varid'>fsLit</span> <span class='hs-str'>"dph-par"</span><span class='hs-layout'>)</span>
<a name="line-75"></a><a name="thisGhcPackageId"></a><span class='hs-definition'>thisGhcPackageId</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fsToPackageId</span> <span class='hs-layout'>(</span><span class='hs-varid'>fsLit</span> <span class='hs-layout'>(</span><span class='hs-str'>"ghc-"</span> <span class='hs-varop'>++</span> <span class='hs-varid'>cProjectVersion</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-76"></a><a name="interactivePackageId"></a><span class='hs-definition'>interactivePackageId</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fsToPackageId</span> <span class='hs-layout'>(</span><span class='hs-varid'>fsLit</span> <span class='hs-str'>"interactive"</span><span class='hs-layout'>)</span>
<a name="line-77"></a>
<a name="line-78"></a><a name="mainPackageId"></a><span class='hs-comment'>-- | This is the package Id for the current program.  It is the default</span>
<a name="line-79"></a><span class='hs-comment'>-- package Id if you don't specify a package name.  We don't add this prefix</span>
<a name="line-80"></a><span class='hs-comment'>-- to symbol names, since there can be only one main package per program.</span>
<a name="line-81"></a><span class='hs-definition'>mainPackageId</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fsToPackageId</span> <span class='hs-layout'>(</span><span class='hs-varid'>fsLit</span> <span class='hs-str'>"main"</span><span class='hs-layout'>)</span>
<a name="line-82"></a>
<a name="line-83"></a><a name="isInteractiveModule"></a><span class='hs-definition'>isInteractiveModule</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Module</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-84"></a><span class='hs-definition'>isInteractiveModule</span> <span class='hs-varid'>mod</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>modulePackageId</span> <span class='hs-varid'>mod</span> <span class='hs-varop'>==</span> <span class='hs-varid'>interactivePackageId</span>
</pre>\end{code}

%************************************************************************
%*                                                                      *
\subsection{@ModuleEnv@s}
%*                                                                      *
%************************************************************************

\begin{code}
<pre><a name="line-1"></a><a name="ModuleEnv"></a><span class='hs-comment'>-- | A map keyed off of 'Module's</span>
<a name="line-2"></a><a name="ModuleEnv"></a><span class='hs-keyword'>newtype</span> <span class='hs-conid'>ModuleEnv</span> <span class='hs-varid'>elt</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ModuleEnv</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span> <span class='hs-conid'>Module</span> <span class='hs-varid'>elt</span><span class='hs-layout'>)</span>
<a name="line-3"></a>
<a name="line-4"></a><a name="filterModuleEnv"></a><span class='hs-definition'>filterModuleEnv</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Module</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ModuleEnv</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ModuleEnv</span> <span class='hs-varid'>a</span>
<a name="line-5"></a><span class='hs-definition'>filterModuleEnv</span> <span class='hs-varid'>f</span> <span class='hs-layout'>(</span><span class='hs-conid'>ModuleEnv</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ModuleEnv</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>filterWithKey</span> <span class='hs-varid'>f</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>
<a name="line-6"></a>
<a name="line-7"></a><a name="elemModuleEnv"></a><span class='hs-definition'>elemModuleEnv</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Module</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ModuleEnv</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-8"></a><span class='hs-definition'>elemModuleEnv</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-conid'>ModuleEnv</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>member</span> <span class='hs-varid'>m</span> <span class='hs-varid'>e</span>
<a name="line-9"></a>
<a name="line-10"></a><a name="extendModuleEnv"></a><span class='hs-definition'>extendModuleEnv</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ModuleEnv</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Module</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ModuleEnv</span> <span class='hs-varid'>a</span>
<a name="line-11"></a><span class='hs-definition'>extendModuleEnv</span> <span class='hs-layout'>(</span><span class='hs-conid'>ModuleEnv</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-varid'>m</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ModuleEnv</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>insert</span> <span class='hs-varid'>m</span> <span class='hs-varid'>x</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>
<a name="line-12"></a>
<a name="line-13"></a><a name="extendModuleEnvWith"></a><span class='hs-definition'>extendModuleEnvWith</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ModuleEnv</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Module</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ModuleEnv</span> <span class='hs-varid'>a</span>
<a name="line-14"></a><span class='hs-definition'>extendModuleEnvWith</span> <span class='hs-varid'>f</span> <span class='hs-layout'>(</span><span class='hs-conid'>ModuleEnv</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-varid'>m</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ModuleEnv</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>insertWith</span> <span class='hs-varid'>f</span> <span class='hs-varid'>m</span> <span class='hs-varid'>x</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>
<a name="line-15"></a>
<a name="line-16"></a><a name="extendModuleEnvList"></a><span class='hs-definition'>extendModuleEnvList</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ModuleEnv</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-layout'>(</span><span class='hs-conid'>Module</span><span class='hs-layout'>,</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ModuleEnv</span> <span class='hs-varid'>a</span>
<a name="line-17"></a><span class='hs-definition'>extendModuleEnvList</span> <span class='hs-layout'>(</span><span class='hs-conid'>ModuleEnv</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-varid'>xs</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ModuleEnv</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>insertList</span> <span class='hs-varid'>xs</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>
<a name="line-18"></a>
<a name="line-19"></a><a name="extendModuleEnvList_C"></a><span class='hs-definition'>extendModuleEnvList_C</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ModuleEnv</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-layout'>(</span><span class='hs-conid'>Module</span><span class='hs-layout'>,</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-20"></a>                      <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ModuleEnv</span> <span class='hs-varid'>a</span>
<a name="line-21"></a><span class='hs-definition'>extendModuleEnvList_C</span> <span class='hs-varid'>f</span> <span class='hs-layout'>(</span><span class='hs-conid'>ModuleEnv</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-varid'>xs</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ModuleEnv</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>insertListWith</span> <span class='hs-varid'>f</span> <span class='hs-varid'>xs</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>
<a name="line-22"></a>
<a name="line-23"></a><a name="plusModuleEnv_C"></a><span class='hs-definition'>plusModuleEnv_C</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ModuleEnv</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ModuleEnv</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ModuleEnv</span> <span class='hs-varid'>a</span>
<a name="line-24"></a><span class='hs-definition'>plusModuleEnv_C</span> <span class='hs-varid'>f</span> <span class='hs-layout'>(</span><span class='hs-conid'>ModuleEnv</span> <span class='hs-varid'>e1</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>ModuleEnv</span> <span class='hs-varid'>e2</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ModuleEnv</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>unionWith</span> <span class='hs-varid'>f</span> <span class='hs-varid'>e1</span> <span class='hs-varid'>e2</span><span class='hs-layout'>)</span>
<a name="line-25"></a>
<a name="line-26"></a><a name="delModuleEnvList"></a><span class='hs-definition'>delModuleEnvList</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ModuleEnv</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Module</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ModuleEnv</span> <span class='hs-varid'>a</span>
<a name="line-27"></a><span class='hs-definition'>delModuleEnvList</span> <span class='hs-layout'>(</span><span class='hs-conid'>ModuleEnv</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-varid'>ms</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ModuleEnv</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>deleteList</span> <span class='hs-varid'>ms</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>
<a name="line-28"></a>
<a name="line-29"></a><a name="delModuleEnv"></a><span class='hs-definition'>delModuleEnv</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ModuleEnv</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Module</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ModuleEnv</span> <span class='hs-varid'>a</span>
<a name="line-30"></a><span class='hs-definition'>delModuleEnv</span> <span class='hs-layout'>(</span><span class='hs-conid'>ModuleEnv</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ModuleEnv</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>delete</span> <span class='hs-varid'>m</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>
<a name="line-31"></a>
<a name="line-32"></a><a name="plusModuleEnv"></a><span class='hs-definition'>plusModuleEnv</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ModuleEnv</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ModuleEnv</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ModuleEnv</span> <span class='hs-varid'>a</span>
<a name="line-33"></a><span class='hs-definition'>plusModuleEnv</span> <span class='hs-layout'>(</span><span class='hs-conid'>ModuleEnv</span> <span class='hs-varid'>e1</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>ModuleEnv</span> <span class='hs-varid'>e2</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ModuleEnv</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>union</span> <span class='hs-varid'>e1</span> <span class='hs-varid'>e2</span><span class='hs-layout'>)</span>
<a name="line-34"></a>
<a name="line-35"></a><a name="lookupModuleEnv"></a><span class='hs-definition'>lookupModuleEnv</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ModuleEnv</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Module</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-varid'>a</span>
<a name="line-36"></a><span class='hs-definition'>lookupModuleEnv</span> <span class='hs-layout'>(</span><span class='hs-conid'>ModuleEnv</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>lookup</span> <span class='hs-varid'>m</span> <span class='hs-varid'>e</span>
<a name="line-37"></a>
<a name="line-38"></a><a name="lookupWithDefaultModuleEnv"></a><span class='hs-definition'>lookupWithDefaultModuleEnv</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ModuleEnv</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Module</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span>
<a name="line-39"></a><span class='hs-definition'>lookupWithDefaultModuleEnv</span> <span class='hs-layout'>(</span><span class='hs-conid'>ModuleEnv</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-varid'>x</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>findWithDefault</span> <span class='hs-varid'>x</span> <span class='hs-varid'>m</span> <span class='hs-varid'>e</span>
<a name="line-40"></a>
<a name="line-41"></a><a name="mapModuleEnv"></a><span class='hs-definition'>mapModuleEnv</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ModuleEnv</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ModuleEnv</span> <span class='hs-varid'>b</span>
<a name="line-42"></a><span class='hs-definition'>mapModuleEnv</span> <span class='hs-varid'>f</span> <span class='hs-layout'>(</span><span class='hs-conid'>ModuleEnv</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ModuleEnv</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>mapWithKey</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-keyword'>_</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>f</span> <span class='hs-varid'>v</span><span class='hs-layout'>)</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>
<a name="line-43"></a>
<a name="line-44"></a><a name="mkModuleEnv"></a><span class='hs-definition'>mkModuleEnv</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-layout'>(</span><span class='hs-conid'>Module</span><span class='hs-layout'>,</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ModuleEnv</span> <span class='hs-varid'>a</span>
<a name="line-45"></a><span class='hs-definition'>mkModuleEnv</span> <span class='hs-varid'>xs</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ModuleEnv</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>fromList</span> <span class='hs-varid'>xs</span><span class='hs-layout'>)</span>
<a name="line-46"></a>
<a name="line-47"></a><a name="emptyModuleEnv"></a><span class='hs-definition'>emptyModuleEnv</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ModuleEnv</span> <span class='hs-varid'>a</span>
<a name="line-48"></a><span class='hs-definition'>emptyModuleEnv</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ModuleEnv</span> <span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>empty</span>
<a name="line-49"></a>
<a name="line-50"></a><a name="moduleEnvKeys"></a><span class='hs-definition'>moduleEnvKeys</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ModuleEnv</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Module</span><span class='hs-keyglyph'>]</span>
<a name="line-51"></a><span class='hs-definition'>moduleEnvKeys</span> <span class='hs-layout'>(</span><span class='hs-conid'>ModuleEnv</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>keys</span> <span class='hs-varid'>e</span>
<a name="line-52"></a>
<a name="line-53"></a><a name="moduleEnvElts"></a><span class='hs-definition'>moduleEnvElts</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ModuleEnv</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span>
<a name="line-54"></a><span class='hs-definition'>moduleEnvElts</span> <span class='hs-layout'>(</span><span class='hs-conid'>ModuleEnv</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>elems</span> <span class='hs-varid'>e</span>
<a name="line-55"></a>
<a name="line-56"></a><a name="moduleEnvToList"></a><span class='hs-definition'>moduleEnvToList</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ModuleEnv</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-layout'>(</span><span class='hs-conid'>Module</span><span class='hs-layout'>,</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-57"></a><span class='hs-definition'>moduleEnvToList</span> <span class='hs-layout'>(</span><span class='hs-conid'>ModuleEnv</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>toList</span> <span class='hs-varid'>e</span>
<a name="line-58"></a>
<a name="line-59"></a><a name="unitModuleEnv"></a><span class='hs-definition'>unitModuleEnv</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Module</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ModuleEnv</span> <span class='hs-varid'>a</span>
<a name="line-60"></a><span class='hs-definition'>unitModuleEnv</span> <span class='hs-varid'>m</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ModuleEnv</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>singleton</span> <span class='hs-varid'>m</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span>
<a name="line-61"></a>
<a name="line-62"></a><a name="isEmptyModuleEnv"></a><span class='hs-definition'>isEmptyModuleEnv</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ModuleEnv</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-63"></a><span class='hs-definition'>isEmptyModuleEnv</span> <span class='hs-layout'>(</span><span class='hs-conid'>ModuleEnv</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>null</span> <span class='hs-varid'>e</span>
<a name="line-64"></a>
<a name="line-65"></a><a name="foldModuleEnv"></a><span class='hs-definition'>foldModuleEnv</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ModuleEnv</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span>
<a name="line-66"></a><span class='hs-definition'>foldModuleEnv</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x</span> <span class='hs-layout'>(</span><span class='hs-conid'>ModuleEnv</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>foldRightWithKey</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-keyword'>_</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>f</span> <span class='hs-varid'>v</span><span class='hs-layout'>)</span> <span class='hs-varid'>x</span> <span class='hs-varid'>e</span>
</pre>\end{code}

\begin{code}
<pre><a name="line-1"></a><a name="ModuleSet"></a><span class='hs-comment'>-- | A set of 'Module's</span>
<a name="line-2"></a><a name="ModuleSet"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>ModuleSet</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Map</span> <span class='hs-conid'>Module</span> <span class='hs-conid'>()</span>
<a name="line-3"></a>
<a name="line-4"></a><a name="mkModuleSet"></a><span class='hs-definition'>mkModuleSet</span>     <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Module</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ModuleSet</span>
<a name="line-5"></a><a name="extendModuleSet"></a><span class='hs-definition'>extendModuleSet</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ModuleSet</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Module</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ModuleSet</span>
<a name="line-6"></a><a name="emptyModuleSet"></a><span class='hs-definition'>emptyModuleSet</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ModuleSet</span>
<a name="line-7"></a><a name="moduleSetElts"></a><span class='hs-definition'>moduleSetElts</span>   <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ModuleSet</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Module</span><span class='hs-keyglyph'>]</span>
<a name="line-8"></a><a name="elemModuleSet"></a><span class='hs-definition'>elemModuleSet</span>   <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Module</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ModuleSet</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-9"></a>
<a name="line-10"></a><span class='hs-definition'>emptyModuleSet</span>    <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>empty</span>
<a name="line-11"></a><span class='hs-definition'>mkModuleSet</span> <span class='hs-varid'>ms</span>    <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>fromList</span> <span class='hs-keyglyph'>[</span><span class='hs-layout'>(</span><span class='hs-varid'>m</span><span class='hs-layout'>,</span><span class='hs-conid'>()</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>ms</span> <span class='hs-keyglyph'>]</span>
<a name="line-12"></a><span class='hs-definition'>extendModuleSet</span> <span class='hs-varid'>s</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>insert</span> <span class='hs-varid'>m</span> <span class='hs-conid'>()</span> <span class='hs-varid'>s</span>
<a name="line-13"></a><span class='hs-definition'>moduleSetElts</span>     <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>keys</span>
<a name="line-14"></a><span class='hs-definition'>elemModuleSet</span>     <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>member</span>
</pre>\end{code}

A ModuleName has a Unique, so we can build mappings of these using
UniqFM.

\begin{code}
<pre><a name="line-1"></a><a name="ModuleNameEnv"></a><span class='hs-comment'>-- | A map keyed off of 'ModuleName's (actually, their 'Unique's)</span>
<a name="line-2"></a><a name="ModuleNameEnv"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>ModuleNameEnv</span> <span class='hs-varid'>elt</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>UniqFM</span> <span class='hs-varid'>elt</span>
</pre>\end{code}

</body>
</html>
