<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>hsSyn/HsDecls.lhs</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
%
% (c) The University of Glasgow 2006
% (c) The GRASP/AQUA Project, Glasgow University, 1992-1998
%

\begin{code}
<pre><a name="line-1"></a><span class='hs-comment'>{-# LANGUAGE DeriveDataTypeable, DeriveFunctor, DeriveFoldable,
<a name="line-2"></a>             DeriveTraversable #-}</span>
<a name="line-3"></a>
<a name="line-4"></a><span class='hs-comment'>-- | Abstract syntax of global declarations.</span>
<a name="line-5"></a><span class='hs-comment'>--</span>
<a name="line-6"></a><span class='hs-comment'>-- Definitions for: @SynDecl@ and @ConDecl@, @ClassDecl@,</span>
<a name="line-7"></a><span class='hs-comment'>-- @InstDecl@, @DefaultDecl@ and @ForeignDecl@.</span>
<a name="line-8"></a><span class='hs-keyword'>module</span> <span class='hs-conid'>HsDecls</span> <span class='hs-layout'>(</span>
<a name="line-9"></a>  <span class='hs-comment'>-- * Toplevel declarations</span>
<a name="line-10"></a>  <span class='hs-conid'>HsDecl</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>LHsDecl</span><span class='hs-layout'>,</span> <span class='hs-conid'>HsDataDefn</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-11"></a>  <span class='hs-comment'>-- ** Class or type declarations</span>
<a name="line-12"></a>  <span class='hs-conid'>TyClDecl</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>LTyClDecl</span><span class='hs-layout'>,</span>
<a name="line-13"></a>  <span class='hs-conid'>TyClGroup</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>tyClGroupConcat</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkTyClGroup</span><span class='hs-layout'>,</span>
<a name="line-14"></a>  <span class='hs-varid'>isClassDecl</span><span class='hs-layout'>,</span> <span class='hs-varid'>isDataDecl</span><span class='hs-layout'>,</span> <span class='hs-varid'>isSynDecl</span><span class='hs-layout'>,</span> <span class='hs-varid'>tcdName</span><span class='hs-layout'>,</span>
<a name="line-15"></a>  <span class='hs-varid'>isFamilyDecl</span><span class='hs-layout'>,</span> <span class='hs-varid'>isTypeFamilyDecl</span><span class='hs-layout'>,</span> <span class='hs-varid'>isDataFamilyDecl</span><span class='hs-layout'>,</span>
<a name="line-16"></a>  <span class='hs-varid'>isOpenTypeFamilyInfo</span><span class='hs-layout'>,</span> <span class='hs-varid'>isClosedTypeFamilyInfo</span><span class='hs-layout'>,</span>
<a name="line-17"></a>  <span class='hs-varid'>tyFamInstDeclName</span><span class='hs-layout'>,</span> <span class='hs-varid'>tyFamInstDeclLName</span><span class='hs-layout'>,</span>
<a name="line-18"></a>  <span class='hs-varid'>countTyClDecls</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprTyClDeclFlavour</span><span class='hs-layout'>,</span>
<a name="line-19"></a>  <span class='hs-varid'>tyClDeclLName</span><span class='hs-layout'>,</span> <span class='hs-varid'>tyClDeclTyVars</span><span class='hs-layout'>,</span>
<a name="line-20"></a>  <span class='hs-conid'>FamilyDecl</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>LFamilyDecl</span><span class='hs-layout'>,</span>
<a name="line-21"></a>
<a name="line-22"></a>  <span class='hs-comment'>-- ** Instance declarations</span>
<a name="line-23"></a>  <span class='hs-conid'>InstDecl</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>LInstDecl</span><span class='hs-layout'>,</span> <span class='hs-conid'>NewOrData</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>FamilyInfo</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-24"></a>  <span class='hs-conid'>TyFamInstDecl</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>LTyFamInstDecl</span><span class='hs-layout'>,</span> <span class='hs-varid'>instDeclDataFamInsts</span><span class='hs-layout'>,</span>
<a name="line-25"></a>  <span class='hs-conid'>DataFamInstDecl</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>LDataFamInstDecl</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprDataFamInstFlavour</span><span class='hs-layout'>,</span>
<a name="line-26"></a>  <span class='hs-conid'>TyFamInstEqn</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>LTyFamInstEqn</span><span class='hs-layout'>,</span>
<a name="line-27"></a>  <span class='hs-conid'>LClsInstDecl</span><span class='hs-layout'>,</span> <span class='hs-conid'>ClsInstDecl</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-28"></a>
<a name="line-29"></a>  <span class='hs-comment'>-- ** Standalone deriving declarations</span>
<a name="line-30"></a>  <span class='hs-conid'>DerivDecl</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>LDerivDecl</span><span class='hs-layout'>,</span>
<a name="line-31"></a>  <span class='hs-comment'>-- ** @RULE@ declarations</span>
<a name="line-32"></a>  <span class='hs-conid'>RuleDecl</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>LRuleDecl</span><span class='hs-layout'>,</span> <span class='hs-conid'>RuleBndr</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-33"></a>  <span class='hs-varid'>collectRuleBndrSigTys</span><span class='hs-layout'>,</span>
<a name="line-34"></a>  <span class='hs-comment'>-- ** @VECTORISE@ declarations</span>
<a name="line-35"></a>  <span class='hs-conid'>VectDecl</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>LVectDecl</span><span class='hs-layout'>,</span>
<a name="line-36"></a>  <span class='hs-varid'>lvectDeclName</span><span class='hs-layout'>,</span> <span class='hs-varid'>lvectInstDecl</span><span class='hs-layout'>,</span>
<a name="line-37"></a>  <span class='hs-comment'>-- ** @default@ declarations</span>
<a name="line-38"></a>  <span class='hs-conid'>DefaultDecl</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>LDefaultDecl</span><span class='hs-layout'>,</span>
<a name="line-39"></a>  <span class='hs-comment'>-- ** Template haskell declaration splice</span>
<a name="line-40"></a>  <span class='hs-conid'>SpliceDecl</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>LSpliceDecl</span><span class='hs-layout'>,</span>
<a name="line-41"></a>  <span class='hs-comment'>-- ** Foreign function interface declarations</span>
<a name="line-42"></a>  <span class='hs-conid'>ForeignDecl</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>LForeignDecl</span><span class='hs-layout'>,</span> <span class='hs-conid'>ForeignImport</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>ForeignExport</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-43"></a>  <span class='hs-varid'>noForeignImportCoercionYet</span><span class='hs-layout'>,</span> <span class='hs-varid'>noForeignExportCoercionYet</span><span class='hs-layout'>,</span>
<a name="line-44"></a>  <span class='hs-conid'>CImportSpec</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-45"></a>  <span class='hs-comment'>-- ** Data-constructor declarations</span>
<a name="line-46"></a>  <span class='hs-conid'>ConDecl</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>LConDecl</span><span class='hs-layout'>,</span> <span class='hs-conid'>ResType</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> 
<a name="line-47"></a>  <span class='hs-conid'>HsConDeclDetails</span><span class='hs-layout'>,</span> <span class='hs-varid'>hsConDeclArgTys</span><span class='hs-layout'>,</span> 
<a name="line-48"></a>  <span class='hs-comment'>-- ** Document comments</span>
<a name="line-49"></a>  <span class='hs-conid'>DocDecl</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>LDocDecl</span><span class='hs-layout'>,</span> <span class='hs-varid'>docDeclDoc</span><span class='hs-layout'>,</span>
<a name="line-50"></a>  <span class='hs-comment'>-- ** Deprecations</span>
<a name="line-51"></a>  <span class='hs-conid'>WarnDecl</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>  <span class='hs-conid'>LWarnDecl</span><span class='hs-layout'>,</span>
<a name="line-52"></a>  <span class='hs-comment'>-- ** Annotations</span>
<a name="line-53"></a>  <span class='hs-conid'>AnnDecl</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>LAnnDecl</span><span class='hs-layout'>,</span> 
<a name="line-54"></a>  <span class='hs-conid'>AnnProvenance</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>annProvenanceName_maybe</span><span class='hs-layout'>,</span>
<a name="line-55"></a>  <span class='hs-comment'>-- ** Role annotations</span>
<a name="line-56"></a>  <span class='hs-conid'>RoleAnnotDecl</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>LRoleAnnotDecl</span><span class='hs-layout'>,</span> <span class='hs-varid'>roleAnnotDeclName</span><span class='hs-layout'>,</span>
<a name="line-57"></a>
<a name="line-58"></a>  <span class='hs-comment'>-- * Grouping</span>
<a name="line-59"></a>  <span class='hs-conid'>HsGroup</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>  <span class='hs-varid'>emptyRdrGroup</span><span class='hs-layout'>,</span> <span class='hs-varid'>emptyRnGroup</span><span class='hs-layout'>,</span> <span class='hs-varid'>appendGroups</span>
<a name="line-60"></a>
<a name="line-61"></a>    <span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-62"></a>
<a name="line-63"></a><span class='hs-comment'>-- friends:</span>
<a name="line-64"></a><span class='hs-keyword'>import</span> <span class='hs-comment'>{-# SOURCE #-}</span>   <span class='hs-conid'>HsExpr</span><span class='hs-layout'>(</span> <span class='hs-conid'>LHsExpr</span><span class='hs-layout'>,</span> <span class='hs-conid'>HsExpr</span><span class='hs-layout'>,</span> <span class='hs-conid'>HsSplice</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprExpr</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprUntypedSplice</span> <span class='hs-layout'>)</span>
<a name="line-65"></a>        <span class='hs-comment'>-- Because Expr imports Decls via HsBracket</span>
<a name="line-66"></a>
<a name="line-67"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>HsBinds</span>
<a name="line-68"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>HsPat</span>
<a name="line-69"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>HsTypes</span>
<a name="line-70"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>HsDoc</span>
<a name="line-71"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>TyCon</span>
<a name="line-72"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>NameSet</span>
<a name="line-73"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Name</span>
<a name="line-74"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>BasicTypes</span>
<a name="line-75"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Coercion</span>
<a name="line-76"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>ForeignCall</span>
<a name="line-77"></a>
<a name="line-78"></a><span class='hs-comment'>-- others:</span>
<a name="line-79"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>InstEnv</span>
<a name="line-80"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Class</span>
<a name="line-81"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Outputable</span>       
<a name="line-82"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Util</span>
<a name="line-83"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>SrcLoc</span>
<a name="line-84"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>FastString</span>
<a name="line-85"></a>
<a name="line-86"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Bag</span>
<a name="line-87"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Data</span>        <span class='hs-varid'>hiding</span> <span class='hs-layout'>(</span><span class='hs-conid'>TyCon</span><span class='hs-layout'>)</span>
<a name="line-88"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Foldable</span> <span class='hs-layout'>(</span><span class='hs-conid'>Foldable</span><span class='hs-layout'>)</span>
<a name="line-89"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Traversable</span>
</pre>\end{code}

%************************************************************************
%*                                                                      *
\subsection[HsDecl]{Declarations}
%*                                                                      *
%************************************************************************

\begin{code}
<pre><a name="line-1"></a><a name="LHsDecl"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LHsDecl</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsDecl</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-2"></a>
<a name="line-3"></a><a name="HsDecl"></a><span class='hs-comment'>-- | A Haskell Declaration</span>
<a name="line-4"></a><a name="HsDecl"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>HsDecl</span> <span class='hs-varid'>id</span>
<a name="line-5"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>TyClD</span>       <span class='hs-layout'>(</span><span class='hs-conid'>TyClDecl</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>     <span class='hs-comment'>-- ^ A type or class declaration.</span>
<a name="line-6"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>InstD</span>       <span class='hs-layout'>(</span><span class='hs-conid'>InstDecl</span>  <span class='hs-varid'>id</span><span class='hs-layout'>)</span>    <span class='hs-comment'>-- ^ An instance declaration.</span>
<a name="line-7"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>DerivD</span>      <span class='hs-layout'>(</span><span class='hs-conid'>DerivDecl</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-8"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ValD</span>        <span class='hs-layout'>(</span><span class='hs-conid'>HsBind</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-9"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>SigD</span>        <span class='hs-layout'>(</span><span class='hs-conid'>Sig</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-10"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>DefD</span>        <span class='hs-layout'>(</span><span class='hs-conid'>DefaultDecl</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-11"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ForD</span>        <span class='hs-layout'>(</span><span class='hs-conid'>ForeignDecl</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-12"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>WarningD</span>    <span class='hs-layout'>(</span><span class='hs-conid'>WarnDecl</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-13"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnD</span>        <span class='hs-layout'>(</span><span class='hs-conid'>AnnDecl</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-14"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>RuleD</span>       <span class='hs-layout'>(</span><span class='hs-conid'>RuleDecl</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-15"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>VectD</span>       <span class='hs-layout'>(</span><span class='hs-conid'>VectDecl</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-16"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>SpliceD</span>     <span class='hs-layout'>(</span><span class='hs-conid'>SpliceDecl</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-17"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>DocD</span>        <span class='hs-layout'>(</span><span class='hs-conid'>DocDecl</span><span class='hs-layout'>)</span>
<a name="line-18"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>QuasiQuoteD</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsQuasiQuote</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-19"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>RoleAnnotD</span>  <span class='hs-layout'>(</span><span class='hs-conid'>RoleAnnotDecl</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-20"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Data</span><span class='hs-layout'>,</span> <span class='hs-conid'>Typeable</span><span class='hs-layout'>)</span>
<a name="line-21"></a>
<a name="line-22"></a>
<a name="line-23"></a><span class='hs-comment'>-- NB: all top-level fixity decls are contained EITHER</span>
<a name="line-24"></a><span class='hs-comment'>-- EITHER SigDs</span>
<a name="line-25"></a><span class='hs-comment'>-- OR     in the ClassDecls in TyClDs</span>
<a name="line-26"></a><span class='hs-comment'>--</span>
<a name="line-27"></a><span class='hs-comment'>-- The former covers</span>
<a name="line-28"></a><span class='hs-comment'>--      a) data constructors</span>
<a name="line-29"></a><span class='hs-comment'>--      b) class methods (but they can be also done in the</span>
<a name="line-30"></a><span class='hs-comment'>--              signatures of class decls)</span>
<a name="line-31"></a><span class='hs-comment'>--      c) imported functions (that have an IfacSig)</span>
<a name="line-32"></a><span class='hs-comment'>--      d) top level decls</span>
<a name="line-33"></a><span class='hs-comment'>--</span>
<a name="line-34"></a><span class='hs-comment'>-- The latter is for class methods only</span>
<a name="line-35"></a>
<a name="line-36"></a><a name="HsGroup"></a><span class='hs-comment'>-- | A 'HsDecl' is categorised into a 'HsGroup' before being</span>
<a name="line-37"></a><a name="HsGroup"></a><span class='hs-comment'>-- fed to the renamer.</span>
<a name="line-38"></a><a name="HsGroup"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>HsGroup</span> <span class='hs-varid'>id</span>
<a name="line-39"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HsGroup</span> <span class='hs-layout'>{</span>
<a name="line-40"></a>        <span class='hs-varid'>hs_valds</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsValBinds</span> <span class='hs-varid'>id</span><span class='hs-layout'>,</span>
<a name="line-41"></a>        <span class='hs-varid'>hs_splcds</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LSpliceDecl</span> <span class='hs-varid'>id</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span>
<a name="line-42"></a>
<a name="line-43"></a>        <span class='hs-varid'>hs_tyclds</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>TyClGroup</span> <span class='hs-varid'>id</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span>
<a name="line-44"></a>                <span class='hs-comment'>-- A list of mutually-recursive groups</span>
<a name="line-45"></a>                <span class='hs-comment'>-- No family-instances here; they are in hs_instds</span>
<a name="line-46"></a>                <span class='hs-comment'>-- Parser generates a singleton list;</span>
<a name="line-47"></a>                <span class='hs-comment'>-- renamer does dependency analysis</span>
<a name="line-48"></a>
<a name="line-49"></a>        <span class='hs-varid'>hs_instds</span>  <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LInstDecl</span> <span class='hs-varid'>id</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span>
<a name="line-50"></a>                <span class='hs-comment'>-- Both class and family instance declarations in here</span>
<a name="line-51"></a>
<a name="line-52"></a>        <span class='hs-varid'>hs_derivds</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LDerivDecl</span> <span class='hs-varid'>id</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span>
<a name="line-53"></a>
<a name="line-54"></a>        <span class='hs-varid'>hs_fixds</span>  <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LFixitySig</span> <span class='hs-varid'>id</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span>
<a name="line-55"></a>                <span class='hs-comment'>-- Snaffled out of both top-level fixity signatures,</span>
<a name="line-56"></a>                <span class='hs-comment'>-- and those in class declarations</span>
<a name="line-57"></a>
<a name="line-58"></a>        <span class='hs-varid'>hs_defds</span>  <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LDefaultDecl</span> <span class='hs-varid'>id</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span>
<a name="line-59"></a>        <span class='hs-varid'>hs_fords</span>  <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LForeignDecl</span> <span class='hs-varid'>id</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span>
<a name="line-60"></a>        <span class='hs-varid'>hs_warnds</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LWarnDecl</span> <span class='hs-varid'>id</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span>
<a name="line-61"></a>        <span class='hs-varid'>hs_annds</span>  <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LAnnDecl</span> <span class='hs-varid'>id</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span>
<a name="line-62"></a>        <span class='hs-varid'>hs_ruleds</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LRuleDecl</span> <span class='hs-varid'>id</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span>
<a name="line-63"></a>        <span class='hs-varid'>hs_vects</span>  <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LVectDecl</span> <span class='hs-varid'>id</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span>
<a name="line-64"></a>
<a name="line-65"></a>        <span class='hs-varid'>hs_docs</span>   <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LDocDecl</span><span class='hs-keyglyph'>]</span>
<a name="line-66"></a>  <span class='hs-layout'>}</span> <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Data</span><span class='hs-layout'>,</span> <span class='hs-conid'>Typeable</span><span class='hs-layout'>)</span>
<a name="line-67"></a>
<a name="line-68"></a><a name="emptyGroup"></a><span class='hs-definition'>emptyGroup</span><span class='hs-layout'>,</span> <span class='hs-varid'>emptyRdrGroup</span><span class='hs-layout'>,</span> <span class='hs-varid'>emptyRnGroup</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsGroup</span> <span class='hs-varid'>a</span>
<a name="line-69"></a><a name="emptyRdrGroup"></a><span class='hs-definition'>emptyRdrGroup</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>emptyGroup</span> <span class='hs-layout'>{</span> <span class='hs-varid'>hs_valds</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>emptyValBindsIn</span> <span class='hs-layout'>}</span>
<a name="line-70"></a><a name="emptyRnGroup"></a><span class='hs-definition'>emptyRnGroup</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>emptyGroup</span> <span class='hs-layout'>{</span> <span class='hs-varid'>hs_valds</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>emptyValBindsOut</span> <span class='hs-layout'>}</span>
<a name="line-71"></a>
<a name="line-72"></a><span class='hs-definition'>emptyGroup</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HsGroup</span> <span class='hs-layout'>{</span> <span class='hs-varid'>hs_tyclds</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>[]</span><span class='hs-layout'>,</span> <span class='hs-varid'>hs_instds</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>[]</span><span class='hs-layout'>,</span> 
<a name="line-73"></a>                       <span class='hs-varid'>hs_derivds</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>[]</span><span class='hs-layout'>,</span>
<a name="line-74"></a>                       <span class='hs-varid'>hs_fixds</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>[]</span><span class='hs-layout'>,</span> <span class='hs-varid'>hs_defds</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>[]</span><span class='hs-layout'>,</span> <span class='hs-varid'>hs_annds</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>[]</span><span class='hs-layout'>,</span>
<a name="line-75"></a>                       <span class='hs-varid'>hs_fords</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>[]</span><span class='hs-layout'>,</span> <span class='hs-varid'>hs_warnds</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>[]</span><span class='hs-layout'>,</span> <span class='hs-varid'>hs_ruleds</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>[]</span><span class='hs-layout'>,</span> <span class='hs-varid'>hs_vects</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>[]</span><span class='hs-layout'>,</span>
<a name="line-76"></a>                       <span class='hs-varid'>hs_valds</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>error</span> <span class='hs-str'>"emptyGroup hs_valds: Can't happen"</span><span class='hs-layout'>,</span>
<a name="line-77"></a>                       <span class='hs-varid'>hs_splcds</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>[]</span><span class='hs-layout'>,</span>
<a name="line-78"></a>                       <span class='hs-varid'>hs_docs</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>[]</span> <span class='hs-layout'>}</span>
<a name="line-79"></a>
<a name="line-80"></a><a name="appendGroups"></a><span class='hs-definition'>appendGroups</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsGroup</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HsGroup</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HsGroup</span> <span class='hs-varid'>a</span>
<a name="line-81"></a><span class='hs-definition'>appendGroups</span> 
<a name="line-82"></a>    <span class='hs-conid'>HsGroup</span> <span class='hs-layout'>{</span> 
<a name="line-83"></a>        <span class='hs-varid'>hs_valds</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>val_groups1</span><span class='hs-layout'>,</span>
<a name="line-84"></a>        <span class='hs-varid'>hs_splcds</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>spliceds1</span><span class='hs-layout'>,</span>
<a name="line-85"></a>        <span class='hs-varid'>hs_tyclds</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tyclds1</span><span class='hs-layout'>,</span> 
<a name="line-86"></a>        <span class='hs-varid'>hs_instds</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>instds1</span><span class='hs-layout'>,</span>
<a name="line-87"></a>        <span class='hs-varid'>hs_derivds</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>derivds1</span><span class='hs-layout'>,</span>
<a name="line-88"></a>        <span class='hs-varid'>hs_fixds</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fixds1</span><span class='hs-layout'>,</span> 
<a name="line-89"></a>        <span class='hs-varid'>hs_defds</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>defds1</span><span class='hs-layout'>,</span>
<a name="line-90"></a>        <span class='hs-varid'>hs_annds</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>annds1</span><span class='hs-layout'>,</span>
<a name="line-91"></a>        <span class='hs-varid'>hs_fords</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fords1</span><span class='hs-layout'>,</span> 
<a name="line-92"></a>        <span class='hs-varid'>hs_warnds</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>warnds1</span><span class='hs-layout'>,</span>
<a name="line-93"></a>        <span class='hs-varid'>hs_ruleds</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>rulds1</span><span class='hs-layout'>,</span>
<a name="line-94"></a>        <span class='hs-varid'>hs_vects</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>vects1</span><span class='hs-layout'>,</span>
<a name="line-95"></a>  <span class='hs-varid'>hs_docs</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>docs1</span> <span class='hs-layout'>}</span>
<a name="line-96"></a>    <span class='hs-conid'>HsGroup</span> <span class='hs-layout'>{</span> 
<a name="line-97"></a>        <span class='hs-varid'>hs_valds</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>val_groups2</span><span class='hs-layout'>,</span>
<a name="line-98"></a>        <span class='hs-varid'>hs_splcds</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>spliceds2</span><span class='hs-layout'>,</span>
<a name="line-99"></a>        <span class='hs-varid'>hs_tyclds</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tyclds2</span><span class='hs-layout'>,</span> 
<a name="line-100"></a>        <span class='hs-varid'>hs_instds</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>instds2</span><span class='hs-layout'>,</span>
<a name="line-101"></a>        <span class='hs-varid'>hs_derivds</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>derivds2</span><span class='hs-layout'>,</span>
<a name="line-102"></a>        <span class='hs-varid'>hs_fixds</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fixds2</span><span class='hs-layout'>,</span> 
<a name="line-103"></a>        <span class='hs-varid'>hs_defds</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>defds2</span><span class='hs-layout'>,</span>
<a name="line-104"></a>        <span class='hs-varid'>hs_annds</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>annds2</span><span class='hs-layout'>,</span>
<a name="line-105"></a>        <span class='hs-varid'>hs_fords</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fords2</span><span class='hs-layout'>,</span> 
<a name="line-106"></a>        <span class='hs-varid'>hs_warnds</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>warnds2</span><span class='hs-layout'>,</span>
<a name="line-107"></a>        <span class='hs-varid'>hs_ruleds</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>rulds2</span><span class='hs-layout'>,</span>
<a name="line-108"></a>        <span class='hs-varid'>hs_vects</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>vects2</span><span class='hs-layout'>,</span>
<a name="line-109"></a>        <span class='hs-varid'>hs_docs</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>docs2</span> <span class='hs-layout'>}</span>
<a name="line-110"></a>  <span class='hs-keyglyph'>=</span> 
<a name="line-111"></a>    <span class='hs-conid'>HsGroup</span> <span class='hs-layout'>{</span> 
<a name="line-112"></a>        <span class='hs-varid'>hs_valds</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>val_groups1</span> <span class='hs-varop'>`plusHsValBinds`</span> <span class='hs-varid'>val_groups2</span><span class='hs-layout'>,</span>
<a name="line-113"></a>        <span class='hs-varid'>hs_splcds</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>spliceds1</span> <span class='hs-varop'>++</span> <span class='hs-varid'>spliceds2</span><span class='hs-layout'>,</span> 
<a name="line-114"></a>        <span class='hs-varid'>hs_tyclds</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tyclds1</span> <span class='hs-varop'>++</span> <span class='hs-varid'>tyclds2</span><span class='hs-layout'>,</span> 
<a name="line-115"></a>        <span class='hs-varid'>hs_instds</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>instds1</span> <span class='hs-varop'>++</span> <span class='hs-varid'>instds2</span><span class='hs-layout'>,</span>
<a name="line-116"></a>        <span class='hs-varid'>hs_derivds</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>derivds1</span> <span class='hs-varop'>++</span> <span class='hs-varid'>derivds2</span><span class='hs-layout'>,</span>
<a name="line-117"></a>        <span class='hs-varid'>hs_fixds</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fixds1</span> <span class='hs-varop'>++</span> <span class='hs-varid'>fixds2</span><span class='hs-layout'>,</span>
<a name="line-118"></a>        <span class='hs-varid'>hs_annds</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>annds1</span> <span class='hs-varop'>++</span> <span class='hs-varid'>annds2</span><span class='hs-layout'>,</span>
<a name="line-119"></a>        <span class='hs-varid'>hs_defds</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>defds1</span> <span class='hs-varop'>++</span> <span class='hs-varid'>defds2</span><span class='hs-layout'>,</span>
<a name="line-120"></a>        <span class='hs-varid'>hs_fords</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fords1</span> <span class='hs-varop'>++</span> <span class='hs-varid'>fords2</span><span class='hs-layout'>,</span> 
<a name="line-121"></a>        <span class='hs-varid'>hs_warnds</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>warnds1</span> <span class='hs-varop'>++</span> <span class='hs-varid'>warnds2</span><span class='hs-layout'>,</span>
<a name="line-122"></a>        <span class='hs-varid'>hs_ruleds</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>rulds1</span> <span class='hs-varop'>++</span> <span class='hs-varid'>rulds2</span><span class='hs-layout'>,</span>
<a name="line-123"></a>        <span class='hs-varid'>hs_vects</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>vects1</span> <span class='hs-varop'>++</span> <span class='hs-varid'>vects2</span><span class='hs-layout'>,</span>
<a name="line-124"></a>        <span class='hs-varid'>hs_docs</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>docs1</span>  <span class='hs-varop'>++</span> <span class='hs-varid'>docs2</span> <span class='hs-layout'>}</span>
</pre>\end{code}

\begin{code}
<pre><a name="line-1"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Outputable</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsDecl</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-2"></a>    <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>TyClD</span> <span class='hs-varid'>dcl</span><span class='hs-layout'>)</span>             <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>dcl</span>
<a name="line-3"></a>    <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>ValD</span> <span class='hs-varid'>binds</span><span class='hs-layout'>)</span>            <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>binds</span>
<a name="line-4"></a>    <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>DefD</span> <span class='hs-varid'>def</span><span class='hs-layout'>)</span>              <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>def</span>
<a name="line-5"></a>    <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>InstD</span> <span class='hs-varid'>inst</span><span class='hs-layout'>)</span>            <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>inst</span>
<a name="line-6"></a>    <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>DerivD</span> <span class='hs-varid'>deriv</span><span class='hs-layout'>)</span>          <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>deriv</span>
<a name="line-7"></a>    <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>ForD</span> <span class='hs-varid'>fd</span><span class='hs-layout'>)</span>               <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>fd</span>
<a name="line-8"></a>    <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>SigD</span> <span class='hs-varid'>sd</span><span class='hs-layout'>)</span>               <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>sd</span>
<a name="line-9"></a>    <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>RuleD</span> <span class='hs-varid'>rd</span><span class='hs-layout'>)</span>              <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>rd</span>
<a name="line-10"></a>    <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>VectD</span> <span class='hs-varid'>vect</span><span class='hs-layout'>)</span>            <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>vect</span>
<a name="line-11"></a>    <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>WarningD</span> <span class='hs-varid'>wd</span><span class='hs-layout'>)</span>           <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>wd</span>
<a name="line-12"></a>    <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>AnnD</span> <span class='hs-varid'>ad</span><span class='hs-layout'>)</span>               <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>ad</span>
<a name="line-13"></a>    <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>SpliceD</span> <span class='hs-varid'>dd</span><span class='hs-layout'>)</span>            <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>dd</span>
<a name="line-14"></a>    <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>DocD</span> <span class='hs-varid'>doc</span><span class='hs-layout'>)</span>              <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>doc</span>
<a name="line-15"></a>    <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>QuasiQuoteD</span> <span class='hs-varid'>qq</span><span class='hs-layout'>)</span>        <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>qq</span>
<a name="line-16"></a>    <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>RoleAnnotD</span> <span class='hs-varid'>ra</span><span class='hs-layout'>)</span>         <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>ra</span>
<a name="line-17"></a>
<a name="line-18"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Outputable</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsGroup</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-19"></a>    <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsGroup</span> <span class='hs-layout'>{</span> <span class='hs-varid'>hs_valds</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>val_decls</span><span class='hs-layout'>,</span>
<a name="line-20"></a>                   <span class='hs-varid'>hs_tyclds</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tycl_decls</span><span class='hs-layout'>,</span>
<a name="line-21"></a>                   <span class='hs-varid'>hs_instds</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>inst_decls</span><span class='hs-layout'>,</span>
<a name="line-22"></a>                   <span class='hs-varid'>hs_derivds</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>deriv_decls</span><span class='hs-layout'>,</span>
<a name="line-23"></a>                   <span class='hs-varid'>hs_fixds</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fix_decls</span><span class='hs-layout'>,</span>
<a name="line-24"></a>                   <span class='hs-varid'>hs_warnds</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>deprec_decls</span><span class='hs-layout'>,</span>
<a name="line-25"></a>                   <span class='hs-varid'>hs_annds</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ann_decls</span><span class='hs-layout'>,</span>
<a name="line-26"></a>                   <span class='hs-varid'>hs_fords</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>foreign_decls</span><span class='hs-layout'>,</span>
<a name="line-27"></a>                   <span class='hs-varid'>hs_defds</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>default_decls</span><span class='hs-layout'>,</span>
<a name="line-28"></a>                   <span class='hs-varid'>hs_ruleds</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>rule_decls</span><span class='hs-layout'>,</span>
<a name="line-29"></a>                   <span class='hs-varid'>hs_vects</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>vect_decls</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-30"></a>        <span class='hs-keyglyph'>=</span> <span class='hs-varid'>vcat_mb</span> <span class='hs-varid'>empty</span> 
<a name="line-31"></a>            <span class='hs-keyglyph'>[</span><span class='hs-varid'>ppr_ds</span> <span class='hs-varid'>fix_decls</span><span class='hs-layout'>,</span> <span class='hs-varid'>ppr_ds</span> <span class='hs-varid'>default_decls</span><span class='hs-layout'>,</span> 
<a name="line-32"></a>             <span class='hs-varid'>ppr_ds</span> <span class='hs-varid'>deprec_decls</span><span class='hs-layout'>,</span> <span class='hs-varid'>ppr_ds</span> <span class='hs-varid'>ann_decls</span><span class='hs-layout'>,</span>
<a name="line-33"></a>             <span class='hs-varid'>ppr_ds</span> <span class='hs-varid'>rule_decls</span><span class='hs-layout'>,</span>
<a name="line-34"></a>             <span class='hs-varid'>ppr_ds</span> <span class='hs-varid'>vect_decls</span><span class='hs-layout'>,</span>
<a name="line-35"></a>             <span class='hs-keyword'>if</span> <span class='hs-varid'>isEmptyValBinds</span> <span class='hs-varid'>val_decls</span> 
<a name="line-36"></a>                <span class='hs-keyword'>then</span> <span class='hs-conid'>Nothing</span> 
<a name="line-37"></a>                <span class='hs-keyword'>else</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>val_decls</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-38"></a>             <span class='hs-varid'>ppr_ds</span> <span class='hs-layout'>(</span><span class='hs-varid'>tyClGroupConcat</span> <span class='hs-varid'>tycl_decls</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> 
<a name="line-39"></a>             <span class='hs-varid'>ppr_ds</span> <span class='hs-varid'>inst_decls</span><span class='hs-layout'>,</span>
<a name="line-40"></a>             <span class='hs-varid'>ppr_ds</span> <span class='hs-varid'>deriv_decls</span><span class='hs-layout'>,</span>
<a name="line-41"></a>             <span class='hs-varid'>ppr_ds</span> <span class='hs-varid'>foreign_decls</span><span class='hs-keyglyph'>]</span>
<a name="line-42"></a>        <span class='hs-keyword'>where</span>
<a name="line-43"></a>          <span class='hs-varid'>ppr_ds</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Outputable</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>SDoc</span>
<a name="line-44"></a>          <span class='hs-varid'>ppr_ds</span> <span class='hs-conid'>[]</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-45"></a>          <span class='hs-varid'>ppr_ds</span> <span class='hs-varid'>ds</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-varid'>vcat</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>ds</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-46"></a>
<a name="line-47"></a>          <span class='hs-varid'>vcat_mb</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SDoc</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Maybe</span> <span class='hs-conid'>SDoc</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-48"></a>          <span class='hs-comment'>-- Concatenate vertically with white-space between non-blanks</span>
<a name="line-49"></a>          <span class='hs-varid'>vcat_mb</span> <span class='hs-keyword'>_</span>    <span class='hs-conid'>[]</span>             <span class='hs-keyglyph'>=</span> <span class='hs-varid'>empty</span>
<a name="line-50"></a>          <span class='hs-varid'>vcat_mb</span> <span class='hs-varid'>gap</span> <span class='hs-layout'>(</span><span class='hs-conid'>Nothing</span> <span class='hs-conop'>:</span> <span class='hs-varid'>ds</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>vcat_mb</span> <span class='hs-varid'>gap</span> <span class='hs-varid'>ds</span>
<a name="line-51"></a>          <span class='hs-varid'>vcat_mb</span> <span class='hs-varid'>gap</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-varid'>d</span>  <span class='hs-conop'>:</span> <span class='hs-varid'>ds</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>gap</span> <span class='hs-varop'>$$</span> <span class='hs-varid'>d</span> <span class='hs-varop'>$$</span> <span class='hs-varid'>vcat_mb</span> <span class='hs-varid'>blankLine</span> <span class='hs-varid'>ds</span>
<a name="line-52"></a>
<a name="line-53"></a><a name="LSpliceDecl"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LSpliceDecl</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-conid'>SpliceDecl</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>
<a name="line-54"></a><a name="SpliceDecl"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>SpliceDecl</span> <span class='hs-varid'>id</span> 
<a name="line-55"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>SpliceDecl</span>                  <span class='hs-comment'>-- Top level splice</span>
<a name="line-56"></a>        <span class='hs-layout'>(</span><span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsSplice</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-57"></a>        <span class='hs-conid'>HsExplicitFlag</span>          <span class='hs-comment'>-- Explicit &lt;=&gt; $(f x y)</span>
<a name="line-58"></a>                                <span class='hs-comment'>-- Implicit &lt;=&gt; f x y,  i.e. a naked top level expression</span>
<a name="line-59"></a>    <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Data</span><span class='hs-layout'>,</span> <span class='hs-conid'>Typeable</span><span class='hs-layout'>)</span>
<a name="line-60"></a>
<a name="line-61"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Outputable</span> <span class='hs-layout'>(</span><span class='hs-conid'>SpliceDecl</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-62"></a>   <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>SpliceDecl</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprUntypedSplice</span> <span class='hs-varid'>e</span>
</pre>\end{code}


%************************************************************************
%*                                                                      *
\subsection[SynDecl]{@data@, @newtype@ or @type@ (synonym) type declaration}
%*                                                                      *
%************************************************************************

                --------------------------------
                        THE NAMING STORY
                --------------------------------

Here is the story about the implicit names that go with type, class,
and instance decls.  It's a bit tricky, so pay attention!

"Implicit" (or "system") binders
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
  Each data type decl defines 
        a worker name for each constructor
        to-T and from-T convertors
  Each class decl defines
        a tycon for the class
        a data constructor for that tycon
        the worker for that constructor
        a selector for each superclass

All have occurrence names that are derived uniquely from their parent
declaration.

None of these get separate definitions in an interface file; they are
fully defined by the data or class decl.  But they may *occur* in
interface files, of course.  Any such occurrence must haul in the
relevant type or class decl.

Plan of attack:
 - Ensure they "point to" the parent data/class decl 
   when loading that decl from an interface file
   (See RnHiFiles.getSysBinders)

 - When typechecking the decl, we build the implicit TyCons and Ids.
   When doing so we look them up in the name cache (RnEnv.lookupSysName),
   to ensure correct module and provenance is set

These are the two places that we have to conjure up the magic derived
names.  (The actual magic is in OccName.mkWorkerOcc, etc.)

Default methods
~~~~~~~~~~~~~~~
 - Occurrence name is derived uniquely from the method name
   E.g. $dmmax

 - If there is a default method name at all, it's recorded in
   the ClassOpSig (in HsBinds), in the DefMeth field.
   (DefMeth is defined in Class.lhs)

Source-code class decls and interface-code class decls are treated subtly
differently, which has given me a great deal of confusion over the years.
Here's the deal.  (We distinguish the two cases because source-code decls
have (Just binds) in the tcdMeths field, whereas interface decls have Nothing.

In *source-code* class declarations:

 - When parsing, every ClassOpSig gets a DefMeth with a suitable RdrName
   This is done by RdrHsSyn.mkClassOpSigDM

 - The renamer renames it to a Name

 - During typechecking, we generate a binding for each $dm for 
   which there's a programmer-supplied default method:
        class Foo a where
          op1 :: <type>
          op2 :: <type>
          op1 = ...
   We generate a binding for $dmop1 but not for $dmop2.
   The Class for Foo has a NoDefMeth for op2 and a DefMeth for op1.
   The Name for $dmop2 is simply discarded.

In *interface-file* class declarations:
  - When parsing, we see if there's an explicit programmer-supplied default method
    because there's an '=' sign to indicate it:
        class Foo a where
          op1 = :: <type>       -- NB the '='
          op2   :: <type>
    We use this info to generate a DefMeth with a suitable RdrName for op1,
    and a NoDefMeth for op2
  - The interface file has a separate definition for $dmop1, with unfolding etc.
  - The renamer renames it to a Name.
  - The renamer treats $dmop1 as a free variable of the declaration, so that
    the binding for $dmop1 will be sucked in.  (See RnHsSyn.tyClDeclFVs)  
    This doesn't happen for source code class decls, because they *bind* the default method.

Dictionary functions
~~~~~~~~~~~~~~~~~~~~
Each instance declaration gives rise to one dictionary function binding.

The type checker makes up new source-code instance declarations
(e.g. from 'deriving' or generic default methods --- see
TcInstDcls.tcInstDecls1).  So we can't generate the names for
dictionary functions in advance (we don't know how many we need).

On the other hand for interface-file instance declarations, the decl
specifies the name of the dictionary function, and it has a binding elsewhere
in the interface file:
        instance {Eq Int} = dEqInt
        dEqInt :: {Eq Int} <pragma info>

So again we treat source code and interface file code slightly differently.

Source code:
  - Source code instance decls have a Nothing in the (Maybe name) field
    (see data InstDecl below)

  - The typechecker makes up a Local name for the dict fun for any source-code
    instance decl, whether it comes from a source-code instance decl, or whether
    the instance decl is derived from some other construct (e.g. 'deriving').

  - The occurrence name it chooses is derived from the instance decl (just for 
    documentation really) --- e.g. dNumInt.  Two dict funs may share a common
    occurrence name, but will have different uniques.  E.g.
        instance Foo [Int]  where ...
        instance Foo [Bool] where ...
    These might both be dFooList

  - The CoreTidy phase externalises the name, and ensures the occurrence name is
    unique (this isn't special to dict funs).  So we'd get dFooList and dFooList1.

  - We can take this relaxed approach (changing the occurrence name later) 
    because dict fun Ids are not captured in a TyCon or Class (unlike default
    methods, say).  Instead, they are kept separately in the InstEnv.  This
    makes it easy to adjust them after compiling a module.  (Once we've finished
    compiling that module, they don't change any more.)


Interface file code:
  - The instance decl gives the dict fun name, so the InstDecl has a (Just name)
    in the (Maybe name) field.

  - RnHsSyn.instDeclFVs treats the dict fun name as free in the decl, so that we
    suck in the dfun binding


\begin{code}
<pre><a name="line-1"></a><a name="LTyClDecl"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LTyClDecl</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-conid'>TyClDecl</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>
<a name="line-2"></a>
<a name="line-3"></a><a name="TyClDecl"></a><span class='hs-comment'>-- | A type or class declaration.</span>
<a name="line-4"></a><a name="TyClDecl"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>TyClDecl</span> <span class='hs-varid'>name</span>
<a name="line-5"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ForeignType</span> <span class='hs-layout'>{</span> 
<a name="line-6"></a>                <span class='hs-varid'>tcdLName</span>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Located</span> <span class='hs-varid'>name</span><span class='hs-layout'>,</span>
<a name="line-7"></a>                <span class='hs-varid'>tcdExtName</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>FastString</span>
<a name="line-8"></a>    <span class='hs-layout'>}</span>
<a name="line-9"></a>
<a name="line-10"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-comment'>-- | @type/data family T :: *-&gt;*@</span>
<a name="line-11"></a>    <span class='hs-conid'>FamDecl</span> <span class='hs-layout'>{</span> <span class='hs-varid'>tcdFam</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>FamilyDecl</span> <span class='hs-varid'>name</span> <span class='hs-layout'>}</span>
<a name="line-12"></a>
<a name="line-13"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-comment'>-- | @type@ declaration</span>
<a name="line-14"></a>    <span class='hs-conid'>SynDecl</span> <span class='hs-layout'>{</span> <span class='hs-varid'>tcdLName</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Located</span> <span class='hs-varid'>name</span>            <span class='hs-comment'>-- ^ Type constructor</span>
<a name="line-15"></a>            <span class='hs-layout'>,</span> <span class='hs-varid'>tcdTyVars</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LHsTyVarBndrs</span> <span class='hs-varid'>name</span>      <span class='hs-comment'>-- ^ Type variables; for an associated type</span>
<a name="line-16"></a>                                                  <span class='hs-comment'>--   these include outer binders</span>
<a name="line-17"></a>            <span class='hs-layout'>,</span> <span class='hs-varid'>tcdRhs</span>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LHsType</span> <span class='hs-varid'>name</span>            <span class='hs-comment'>-- ^ RHS of type declaration</span>
<a name="line-18"></a>            <span class='hs-layout'>,</span> <span class='hs-varid'>tcdFVs</span>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>NameSet</span> <span class='hs-layout'>}</span>
<a name="line-19"></a>
<a name="line-20"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-comment'>-- | @data@ declaration</span>
<a name="line-21"></a>    <span class='hs-conid'>DataDecl</span> <span class='hs-layout'>{</span> <span class='hs-varid'>tcdLName</span>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Located</span> <span class='hs-varid'>name</span>        <span class='hs-comment'>-- ^ Type constructor</span>
<a name="line-22"></a>             <span class='hs-layout'>,</span> <span class='hs-varid'>tcdTyVars</span>   <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LHsTyVarBndrs</span> <span class='hs-varid'>name</span>  <span class='hs-comment'>-- ^ Type variables; for an assoicated type</span>
<a name="line-23"></a>                                                  <span class='hs-comment'>--   these include outer binders</span>
<a name="line-24"></a>                                                  <span class='hs-comment'>-- Eg  class T a where</span>
<a name="line-25"></a>                                                  <span class='hs-comment'>--       type F a :: *</span>
<a name="line-26"></a>                                                  <span class='hs-comment'>--       type F a = a -&gt; a</span>
<a name="line-27"></a>                                                  <span class='hs-comment'>-- Here the type decl for 'f' includes 'a' </span>
<a name="line-28"></a>                                                  <span class='hs-comment'>-- in its tcdTyVars</span>
<a name="line-29"></a>             <span class='hs-layout'>,</span> <span class='hs-varid'>tcdDataDefn</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsDataDefn</span> <span class='hs-varid'>name</span>
<a name="line-30"></a>             <span class='hs-layout'>,</span> <span class='hs-varid'>tcdFVs</span>      <span class='hs-keyglyph'>::</span> <span class='hs-conid'>NameSet</span> <span class='hs-layout'>}</span>
<a name="line-31"></a>
<a name="line-32"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ClassDecl</span> <span class='hs-layout'>{</span> <span class='hs-varid'>tcdCtxt</span>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LHsContext</span> <span class='hs-varid'>name</span><span class='hs-layout'>,</span>          <span class='hs-comment'>-- ^ Context...</span>
<a name="line-33"></a>                <span class='hs-varid'>tcdLName</span>   <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Located</span> <span class='hs-varid'>name</span><span class='hs-layout'>,</span>             <span class='hs-comment'>-- ^ Name of the class</span>
<a name="line-34"></a>                <span class='hs-varid'>tcdTyVars</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LHsTyVarBndrs</span> <span class='hs-varid'>name</span><span class='hs-layout'>,</span>       <span class='hs-comment'>-- ^ Class type variables</span>
<a name="line-35"></a>                <span class='hs-varid'>tcdFDs</span>     <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-conid'>FunDep</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span>  <span class='hs-comment'>-- ^ Functional deps</span>
<a name="line-36"></a>                <span class='hs-varid'>tcdSigs</span>    <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LSig</span> <span class='hs-varid'>name</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span>              <span class='hs-comment'>-- ^ Methods' signatures</span>
<a name="line-37"></a>                <span class='hs-varid'>tcdMeths</span>   <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LHsBinds</span> <span class='hs-varid'>name</span><span class='hs-layout'>,</span>            <span class='hs-comment'>-- ^ Default methods</span>
<a name="line-38"></a>                <span class='hs-varid'>tcdATs</span>     <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LFamilyDecl</span> <span class='hs-varid'>name</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span>       <span class='hs-comment'>-- ^ Associated types; ie</span>
<a name="line-39"></a>                <span class='hs-varid'>tcdATDefs</span>  <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LTyFamInstDecl</span> <span class='hs-varid'>name</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span>    <span class='hs-comment'>-- ^ Associated type defaults</span>
<a name="line-40"></a>                <span class='hs-varid'>tcdDocs</span>    <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LDocDecl</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span>               <span class='hs-comment'>-- ^ Haddock docs</span>
<a name="line-41"></a>                <span class='hs-varid'>tcdFVs</span>     <span class='hs-keyglyph'>::</span> <span class='hs-conid'>NameSet</span>
<a name="line-42"></a>    <span class='hs-layout'>}</span>
<a name="line-43"></a>    
<a name="line-44"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Data</span><span class='hs-layout'>,</span> <span class='hs-conid'>Typeable</span><span class='hs-layout'>)</span>
<a name="line-45"></a>
<a name="line-46"></a> <span class='hs-comment'>-- This is used in TcTyClsDecls to represent</span>
<a name="line-47"></a> <span class='hs-comment'>-- strongly connected components of decls</span>
<a name="line-48"></a> <span class='hs-comment'>-- No familiy instances in here</span>
<a name="line-49"></a> <span class='hs-comment'>-- The role annotations must be grouped with their decls for the</span>
<a name="line-50"></a> <span class='hs-comment'>-- type-checker to infer roles correctly</span>
<a name="line-51"></a><a name="TyClGroup"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>TyClGroup</span> <span class='hs-varid'>name</span>
<a name="line-52"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>TyClGroup</span> <span class='hs-layout'>{</span> <span class='hs-varid'>group_tyclds</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LTyClDecl</span> <span class='hs-varid'>name</span><span class='hs-keyglyph'>]</span>
<a name="line-53"></a>              <span class='hs-layout'>,</span> <span class='hs-varid'>group_roles</span>  <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LRoleAnnotDecl</span> <span class='hs-varid'>name</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>}</span>
<a name="line-54"></a>    <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Data</span><span class='hs-layout'>,</span> <span class='hs-conid'>Typeable</span><span class='hs-layout'>)</span>
<a name="line-55"></a>
<a name="line-56"></a><a name="tyClGroupConcat"></a><span class='hs-definition'>tyClGroupConcat</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>TyClGroup</span> <span class='hs-varid'>name</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LTyClDecl</span> <span class='hs-varid'>name</span><span class='hs-keyglyph'>]</span>
<a name="line-57"></a><span class='hs-definition'>tyClGroupConcat</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>concatMap</span> <span class='hs-varid'>group_tyclds</span>
<a name="line-58"></a>
<a name="line-59"></a><a name="mkTyClGroup"></a><span class='hs-definition'>mkTyClGroup</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LTyClDecl</span> <span class='hs-varid'>name</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TyClGroup</span> <span class='hs-varid'>name</span>
<a name="line-60"></a><span class='hs-definition'>mkTyClGroup</span> <span class='hs-varid'>decls</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>TyClGroup</span> <span class='hs-layout'>{</span> <span class='hs-varid'>group_tyclds</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>decls</span><span class='hs-layout'>,</span> <span class='hs-varid'>group_roles</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>[]</span> <span class='hs-layout'>}</span>
<a name="line-61"></a>
<a name="line-62"></a><a name="LFamilyDecl"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LFamilyDecl</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-conid'>FamilyDecl</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>
<a name="line-63"></a><a name="FamilyDecl"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>FamilyDecl</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>FamilyDecl</span>
<a name="line-64"></a>  <span class='hs-layout'>{</span> <span class='hs-varid'>fdInfo</span>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>FamilyInfo</span> <span class='hs-varid'>name</span>            <span class='hs-comment'>-- type or data, closed or open</span>
<a name="line-65"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>fdLName</span>   <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Located</span> <span class='hs-varid'>name</span>               <span class='hs-comment'>-- type constructor</span>
<a name="line-66"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>fdTyVars</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LHsTyVarBndrs</span> <span class='hs-varid'>name</span>         <span class='hs-comment'>-- type variables</span>
<a name="line-67"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>fdKindSig</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsKind</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-layout'>}</span>     <span class='hs-comment'>-- result kind</span>
<a name="line-68"></a>  <span class='hs-keyword'>deriving</span><span class='hs-layout'>(</span> <span class='hs-conid'>Data</span><span class='hs-layout'>,</span> <span class='hs-conid'>Typeable</span> <span class='hs-layout'>)</span>
<a name="line-69"></a>
<a name="line-70"></a><a name="FamilyInfo"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>FamilyInfo</span> <span class='hs-varid'>name</span>
<a name="line-71"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>DataFamily</span>
<a name="line-72"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>OpenTypeFamily</span>
<a name="line-73"></a>     <span class='hs-comment'>-- this list might be empty, if we're in an hs-boot file and the user</span>
<a name="line-74"></a>     <span class='hs-comment'>-- said "type family Foo x where .."</span>
<a name="line-75"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ClosedTypeFamily</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LTyFamInstEqn</span> <span class='hs-varid'>name</span><span class='hs-keyglyph'>]</span>
<a name="line-76"></a>  <span class='hs-keyword'>deriving</span><span class='hs-layout'>(</span> <span class='hs-conid'>Data</span><span class='hs-layout'>,</span> <span class='hs-conid'>Typeable</span> <span class='hs-layout'>)</span>
<a name="line-77"></a>
</pre>\end{code}

------------------------------
Simple classifiers

\begin{code}
<pre><a name="line-1"></a><a name="isDataDecl"></a><span class='hs-comment'>-- | @True@ &lt;=&gt; argument is a @data@\/@newtype@</span>
<a name="line-2"></a><span class='hs-comment'>-- declaration.</span>
<a name="line-3"></a><span class='hs-definition'>isDataDecl</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyClDecl</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-4"></a><span class='hs-definition'>isDataDecl</span> <span class='hs-layout'>(</span><span class='hs-conid'>DataDecl</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-5"></a><span class='hs-definition'>isDataDecl</span> <span class='hs-sel'>_other</span>        <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-6"></a>
<a name="line-7"></a><a name="isSynDecl"></a><span class='hs-comment'>-- | type or type instance declaration</span>
<a name="line-8"></a><span class='hs-definition'>isSynDecl</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyClDecl</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-9"></a><span class='hs-definition'>isSynDecl</span> <span class='hs-layout'>(</span><span class='hs-conid'>SynDecl</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-10"></a><span class='hs-definition'>isSynDecl</span> <span class='hs-sel'>_other</span>        <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-11"></a>
<a name="line-12"></a><a name="isClassDecl"></a><span class='hs-comment'>-- | type class</span>
<a name="line-13"></a><span class='hs-definition'>isClassDecl</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyClDecl</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-14"></a><span class='hs-definition'>isClassDecl</span> <span class='hs-layout'>(</span><span class='hs-conid'>ClassDecl</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-15"></a><span class='hs-definition'>isClassDecl</span> <span class='hs-keyword'>_</span>              <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-16"></a>
<a name="line-17"></a><a name="isFamilyDecl"></a><span class='hs-comment'>-- | type/data family declaration</span>
<a name="line-18"></a><span class='hs-definition'>isFamilyDecl</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyClDecl</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-19"></a><span class='hs-definition'>isFamilyDecl</span> <span class='hs-layout'>(</span><span class='hs-conid'>FamDecl</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-20"></a><span class='hs-definition'>isFamilyDecl</span> <span class='hs-sel'>_other</span>        <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-21"></a>
<a name="line-22"></a><a name="isTypeFamilyDecl"></a><span class='hs-comment'>-- | type family declaration</span>
<a name="line-23"></a><span class='hs-definition'>isTypeFamilyDecl</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyClDecl</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-24"></a><span class='hs-definition'>isTypeFamilyDecl</span> <span class='hs-layout'>(</span><span class='hs-conid'>FamDecl</span> <span class='hs-layout'>(</span><span class='hs-conid'>FamilyDecl</span> <span class='hs-layout'>{</span> <span class='hs-varid'>fdInfo</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>info</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>info</span> <span class='hs-keyword'>of</span>
<a name="line-25"></a>  <span class='hs-conid'>OpenTypeFamily</span>      <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>True</span>
<a name="line-26"></a>  <span class='hs-conid'>ClosedTypeFamily</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>True</span>
<a name="line-27"></a>  <span class='hs-keyword'>_</span>                   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>False</span>
<a name="line-28"></a><span class='hs-definition'>isTypeFamilyDecl</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-29"></a>
<a name="line-30"></a><a name="isOpenTypeFamilyInfo"></a><span class='hs-comment'>-- | open type family info</span>
<a name="line-31"></a><span class='hs-definition'>isOpenTypeFamilyInfo</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>FamilyInfo</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-32"></a><span class='hs-definition'>isOpenTypeFamilyInfo</span> <span class='hs-conid'>OpenTypeFamily</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-33"></a><span class='hs-definition'>isOpenTypeFamilyInfo</span> <span class='hs-keyword'>_</span>              <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-34"></a>
<a name="line-35"></a><a name="isClosedTypeFamilyInfo"></a><span class='hs-comment'>-- | closed type family info</span>
<a name="line-36"></a><span class='hs-definition'>isClosedTypeFamilyInfo</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>FamilyInfo</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-37"></a><span class='hs-definition'>isClosedTypeFamilyInfo</span> <span class='hs-layout'>(</span><span class='hs-conid'>ClosedTypeFamily</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-38"></a><span class='hs-definition'>isClosedTypeFamilyInfo</span> <span class='hs-keyword'>_</span>                     <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-39"></a>
<a name="line-40"></a><a name="isDataFamilyDecl"></a><span class='hs-comment'>-- | data family declaration</span>
<a name="line-41"></a><span class='hs-definition'>isDataFamilyDecl</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyClDecl</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-42"></a><span class='hs-definition'>isDataFamilyDecl</span> <span class='hs-layout'>(</span><span class='hs-conid'>FamDecl</span> <span class='hs-layout'>(</span><span class='hs-conid'>FamilyDecl</span> <span class='hs-layout'>{</span> <span class='hs-varid'>fdInfo</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>DataFamily</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-43"></a><span class='hs-definition'>isDataFamilyDecl</span> <span class='hs-sel'>_other</span>      <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-44"></a>
</pre>\end{code}

Dealing with names

\begin{code}
<pre><a name="line-1"></a><a name="tyFamInstDeclName"></a><span class='hs-definition'>tyFamInstDeclName</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>name</span>
<a name="line-2"></a>                  <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>TyFamInstDecl</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>name</span>
<a name="line-3"></a><span class='hs-definition'>tyFamInstDeclName</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>unLoc</span> <span class='hs-varop'>.</span> <span class='hs-varid'>tyFamInstDeclLName</span>
<a name="line-4"></a>
<a name="line-5"></a><a name="tyFamInstDeclLName"></a><span class='hs-definition'>tyFamInstDeclLName</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>name</span>
<a name="line-6"></a>                   <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>TyFamInstDecl</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Located</span> <span class='hs-varid'>name</span>
<a name="line-7"></a><span class='hs-definition'>tyFamInstDeclLName</span> <span class='hs-layout'>(</span><span class='hs-conid'>TyFamInstDecl</span> <span class='hs-layout'>{</span> <span class='hs-varid'>tfid_eqn</span> <span class='hs-keyglyph'>=</span>
<a name="line-8"></a>                     <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>TyFamInstEqn</span> <span class='hs-layout'>{</span> <span class='hs-varid'>tfie_tycon</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ln</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-9"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ln</span>
<a name="line-10"></a>
<a name="line-11"></a><a name="tyClDeclLName"></a><span class='hs-definition'>tyClDeclLName</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyClDecl</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Located</span> <span class='hs-varid'>name</span>
<a name="line-12"></a><span class='hs-definition'>tyClDeclLName</span> <span class='hs-layout'>(</span><span class='hs-conid'>FamDecl</span> <span class='hs-layout'>{</span> <span class='hs-varid'>tcdFam</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>FamilyDecl</span> <span class='hs-layout'>{</span> <span class='hs-varid'>fdLName</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ln</span> <span class='hs-layout'>}</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ln</span>
<a name="line-13"></a><span class='hs-definition'>tyClDeclLName</span> <span class='hs-varid'>decl</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tcdLName</span> <span class='hs-varid'>decl</span>
<a name="line-14"></a>
<a name="line-15"></a><a name="tcdName"></a><span class='hs-definition'>tcdName</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyClDecl</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>name</span>
<a name="line-16"></a><span class='hs-definition'>tcdName</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>unLoc</span> <span class='hs-varop'>.</span> <span class='hs-varid'>tyClDeclLName</span>
<a name="line-17"></a>
<a name="line-18"></a><a name="tyClDeclTyVars"></a><span class='hs-definition'>tyClDeclTyVars</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>TyClDecl</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsTyVarBndrs</span> <span class='hs-varid'>name</span>
<a name="line-19"></a><span class='hs-definition'>tyClDeclTyVars</span> <span class='hs-varid'>decl</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-conid'>ForeignType</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprPanic</span> <span class='hs-str'>"tyClDeclTyVars"</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>decl</span><span class='hs-layout'>)</span>
<a name="line-20"></a><span class='hs-definition'>tyClDeclTyVars</span> <span class='hs-layout'>(</span><span class='hs-conid'>FamDecl</span> <span class='hs-layout'>{</span> <span class='hs-varid'>tcdFam</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>FamilyDecl</span> <span class='hs-layout'>{</span> <span class='hs-varid'>fdTyVars</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tvs</span> <span class='hs-layout'>}</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tvs</span>
<a name="line-21"></a><span class='hs-definition'>tyClDeclTyVars</span> <span class='hs-varid'>d</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tcdTyVars</span> <span class='hs-varid'>d</span>
</pre>\end{code}

\begin{code}
<pre><a name="line-1"></a><a name="countTyClDecls"></a><span class='hs-definition'>countTyClDecls</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>TyClDecl</span> <span class='hs-varid'>name</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Int</span><span class='hs-layout'>,</span> <span class='hs-conid'>Int</span><span class='hs-layout'>,</span> <span class='hs-conid'>Int</span><span class='hs-layout'>,</span> <span class='hs-conid'>Int</span><span class='hs-layout'>,</span> <span class='hs-conid'>Int</span><span class='hs-layout'>)</span>
<a name="line-2"></a>        <span class='hs-comment'>-- class, synonym decls, data, newtype, family decls</span>
<a name="line-3"></a><span class='hs-definition'>countTyClDecls</span> <span class='hs-varid'>decls</span> 
<a name="line-4"></a> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>count</span> <span class='hs-varid'>isClassDecl</span>    <span class='hs-varid'>decls</span><span class='hs-layout'>,</span>
<a name="line-5"></a>    <span class='hs-varid'>count</span> <span class='hs-varid'>isSynDecl</span>      <span class='hs-varid'>decls</span><span class='hs-layout'>,</span>  <span class='hs-comment'>-- excluding...</span>
<a name="line-6"></a>    <span class='hs-varid'>count</span> <span class='hs-varid'>isDataTy</span>       <span class='hs-varid'>decls</span><span class='hs-layout'>,</span>  <span class='hs-comment'>-- ...family...</span>
<a name="line-7"></a>    <span class='hs-varid'>count</span> <span class='hs-varid'>isNewTy</span>        <span class='hs-varid'>decls</span><span class='hs-layout'>,</span>  <span class='hs-comment'>-- ...instances</span>
<a name="line-8"></a>    <span class='hs-varid'>count</span> <span class='hs-varid'>isFamilyDecl</span>   <span class='hs-varid'>decls</span><span class='hs-layout'>)</span>
<a name="line-9"></a> <span class='hs-keyword'>where</span>
<a name="line-10"></a>   <span class='hs-varid'>isDataTy</span> <span class='hs-conid'>DataDecl</span><span class='hs-layout'>{</span> <span class='hs-varid'>tcdDataDefn</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HsDataDefn</span> <span class='hs-layout'>{</span> <span class='hs-varid'>dd_ND</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>DataType</span> <span class='hs-layout'>}</span> <span class='hs-layout'>}</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-11"></a>   <span class='hs-varid'>isDataTy</span> <span class='hs-keyword'>_</span>                                                       <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-12"></a>   
<a name="line-13"></a>   <span class='hs-varid'>isNewTy</span> <span class='hs-conid'>DataDecl</span><span class='hs-layout'>{</span> <span class='hs-varid'>tcdDataDefn</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HsDataDefn</span> <span class='hs-layout'>{</span> <span class='hs-varid'>dd_ND</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>NewType</span> <span class='hs-layout'>}</span> <span class='hs-layout'>}</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-14"></a>   <span class='hs-varid'>isNewTy</span> <span class='hs-keyword'>_</span>                                                      <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
</pre>\end{code}

\begin{code}
<pre><a name="line-1"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>name</span>
<a name="line-2"></a>              <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Outputable</span> <span class='hs-layout'>(</span><span class='hs-conid'>TyClDecl</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-3"></a>
<a name="line-4"></a>    <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>ForeignType</span> <span class='hs-layout'>{</span><span class='hs-varid'>tcdLName</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ltycon</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-5"></a>        <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hsep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"foreign import type dotnet"</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>ltycon</span><span class='hs-keyglyph'>]</span>
<a name="line-6"></a>
<a name="line-7"></a>    <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>FamDecl</span> <span class='hs-layout'>{</span> <span class='hs-varid'>tcdFam</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>decl</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>decl</span>
<a name="line-8"></a>    <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>SynDecl</span> <span class='hs-layout'>{</span> <span class='hs-varid'>tcdLName</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ltycon</span><span class='hs-layout'>,</span> <span class='hs-varid'>tcdTyVars</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tyvars</span><span class='hs-layout'>,</span> <span class='hs-varid'>tcdRhs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>rhs</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-9"></a>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hang</span> <span class='hs-layout'>(</span><span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"type"</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;+&gt;</span>
<a name="line-10"></a>              <span class='hs-varid'>pp_vanilla_decl_head</span> <span class='hs-varid'>ltycon</span> <span class='hs-varid'>tyvars</span> <span class='hs-conid'>[]</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>equals</span><span class='hs-layout'>)</span>
<a name="line-11"></a>          <span class='hs-num'>4</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>rhs</span><span class='hs-layout'>)</span> 
<a name="line-12"></a>
<a name="line-13"></a>    <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>DataDecl</span> <span class='hs-layout'>{</span> <span class='hs-varid'>tcdLName</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ltycon</span><span class='hs-layout'>,</span> <span class='hs-varid'>tcdTyVars</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tyvars</span><span class='hs-layout'>,</span> <span class='hs-varid'>tcdDataDefn</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>defn</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-14"></a>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pp_data_defn</span> <span class='hs-layout'>(</span><span class='hs-varid'>pp_vanilla_decl_head</span> <span class='hs-varid'>ltycon</span> <span class='hs-varid'>tyvars</span><span class='hs-layout'>)</span> <span class='hs-varid'>defn</span>
<a name="line-15"></a>
<a name="line-16"></a>    <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>ClassDecl</span> <span class='hs-layout'>{</span><span class='hs-varid'>tcdCtxt</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>context</span><span class='hs-layout'>,</span> <span class='hs-varid'>tcdLName</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>lclas</span><span class='hs-layout'>,</span> <span class='hs-varid'>tcdTyVars</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tyvars</span><span class='hs-layout'>,</span> 
<a name="line-17"></a>                    <span class='hs-varid'>tcdFDs</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fds</span><span class='hs-layout'>,</span>
<a name="line-18"></a>                    <span class='hs-varid'>tcdSigs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sigs</span><span class='hs-layout'>,</span> <span class='hs-varid'>tcdMeths</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>methods</span><span class='hs-layout'>,</span>
<a name="line-19"></a>                    <span class='hs-varid'>tcdATs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ats</span><span class='hs-layout'>,</span> <span class='hs-varid'>tcdATDefs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>at_defs</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-20"></a>      <span class='hs-keyglyph'>|</span> <span class='hs-varid'>null</span> <span class='hs-varid'>sigs</span> <span class='hs-varop'>&amp;&amp;</span> <span class='hs-varid'>isEmptyBag</span> <span class='hs-varid'>methods</span> <span class='hs-varop'>&amp;&amp;</span> <span class='hs-varid'>null</span> <span class='hs-varid'>ats</span> <span class='hs-varop'>&amp;&amp;</span> <span class='hs-varid'>null</span> <span class='hs-varid'>at_defs</span> <span class='hs-comment'>-- No "where" part</span>
<a name="line-21"></a>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>top_matter</span>
<a name="line-22"></a>
<a name="line-23"></a>      <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>       <span class='hs-comment'>-- Laid out</span>
<a name="line-24"></a>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>vcat</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>top_matter</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"where"</span><span class='hs-layout'>)</span>
<a name="line-25"></a>             <span class='hs-layout'>,</span> <span class='hs-varid'>nest</span> <span class='hs-num'>2</span> <span class='hs-varop'>$</span> <span class='hs-varid'>pprDeclList</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>ats</span> <span class='hs-varop'>++</span>
<a name="line-26"></a>                                     <span class='hs-varid'>map</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>at_defs</span> <span class='hs-varop'>++</span>
<a name="line-27"></a>                                     <span class='hs-varid'>pprLHsBindsForUser</span> <span class='hs-varid'>methods</span> <span class='hs-varid'>sigs</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>]</span>
<a name="line-28"></a>      <span class='hs-keyword'>where</span>
<a name="line-29"></a>        <span class='hs-varid'>top_matter</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"class"</span><span class='hs-layout'>)</span> 
<a name="line-30"></a>                     <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>pp_vanilla_decl_head</span> <span class='hs-varid'>lclas</span> <span class='hs-varid'>tyvars</span> <span class='hs-layout'>(</span><span class='hs-varid'>unLoc</span> <span class='hs-varid'>context</span><span class='hs-layout'>)</span>
<a name="line-31"></a>                     <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>pprFundeps</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-varid'>unLoc</span> <span class='hs-varid'>fds</span><span class='hs-layout'>)</span>
<a name="line-32"></a>
<a name="line-33"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Outputable</span> <span class='hs-layout'>(</span><span class='hs-conid'>TyClGroup</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-34"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>TyClGroup</span> <span class='hs-layout'>{</span> <span class='hs-varid'>group_tyclds</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tyclds</span><span class='hs-layout'>,</span> <span class='hs-varid'>group_roles</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>roles</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-35"></a>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>tyclds</span> <span class='hs-varop'>$$</span>
<a name="line-36"></a>      <span class='hs-varid'>ppr</span> <span class='hs-varid'>roles</span>
<a name="line-37"></a>
<a name="line-38"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Outputable</span> <span class='hs-layout'>(</span><span class='hs-conid'>FamilyDecl</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-39"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>FamilyDecl</span> <span class='hs-layout'>{</span> <span class='hs-varid'>fdInfo</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>info</span><span class='hs-layout'>,</span> <span class='hs-varid'>fdLName</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ltycon</span><span class='hs-layout'>,</span> 
<a name="line-40"></a>                    <span class='hs-varid'>fdTyVars</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tyvars</span><span class='hs-layout'>,</span> <span class='hs-varid'>fdKindSig</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mb_kind</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-41"></a>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>vcat</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>pprFlavour</span> <span class='hs-varid'>info</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>pp_vanilla_decl_head</span> <span class='hs-varid'>ltycon</span> <span class='hs-varid'>tyvars</span> <span class='hs-conid'>[]</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>pp_kind</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>pp_where</span>
<a name="line-42"></a>             <span class='hs-layout'>,</span> <span class='hs-varid'>nest</span> <span class='hs-num'>2</span> <span class='hs-varop'>$</span> <span class='hs-varid'>pp_eqns</span> <span class='hs-keyglyph'>]</span>
<a name="line-43"></a>        <span class='hs-keyword'>where</span>
<a name="line-44"></a>          <span class='hs-varid'>pp_kind</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>mb_kind</span> <span class='hs-keyword'>of</span>
<a name="line-45"></a>                      <span class='hs-conid'>Nothing</span>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>empty</span>
<a name="line-46"></a>                      <span class='hs-conid'>Just</span> <span class='hs-varid'>kind</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>dcolon</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>kind</span>
<a name="line-47"></a>          <span class='hs-layout'>(</span><span class='hs-varid'>pp_where</span><span class='hs-layout'>,</span> <span class='hs-varid'>pp_eqns</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>info</span> <span class='hs-keyword'>of</span>
<a name="line-48"></a>            <span class='hs-conid'>ClosedTypeFamily</span> <span class='hs-varid'>eqns</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"where"</span><span class='hs-layout'>)</span>
<a name="line-49"></a>                                     <span class='hs-layout'>,</span> <span class='hs-keyword'>if</span> <span class='hs-varid'>null</span> <span class='hs-varid'>eqns</span>
<a name="line-50"></a>                                       <span class='hs-keyword'>then</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>".."</span><span class='hs-layout'>)</span>
<a name="line-51"></a>                                       <span class='hs-keyword'>else</span> <span class='hs-varid'>vcat</span> <span class='hs-varop'>$</span> <span class='hs-varid'>map</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>eqns</span> <span class='hs-layout'>)</span>
<a name="line-52"></a>            <span class='hs-keyword'>_</span>                     <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>empty</span><span class='hs-layout'>,</span> <span class='hs-varid'>empty</span><span class='hs-layout'>)</span>
<a name="line-53"></a>
<a name="line-54"></a><a name="pprFlavour"></a><span class='hs-definition'>pprFlavour</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>FamilyInfo</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-55"></a><span class='hs-definition'>pprFlavour</span> <span class='hs-conid'>DataFamily</span>            <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"data family"</span><span class='hs-layout'>)</span>
<a name="line-56"></a><span class='hs-definition'>pprFlavour</span> <span class='hs-conid'>OpenTypeFamily</span>        <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"type family"</span><span class='hs-layout'>)</span>
<a name="line-57"></a><span class='hs-definition'>pprFlavour</span> <span class='hs-layout'>(</span><span class='hs-conid'>ClosedTypeFamily</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"type family"</span><span class='hs-layout'>)</span>
<a name="line-58"></a>
<a name="line-59"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Outputable</span> <span class='hs-layout'>(</span><span class='hs-conid'>FamilyInfo</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-60"></a>  <span class='hs-varid'>ppr</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprFlavour</span>
<a name="line-61"></a>
<a name="line-62"></a><a name="pp_vanilla_decl_head"></a><span class='hs-definition'>pp_vanilla_decl_head</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>name</span>
<a name="line-63"></a>   <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Located</span> <span class='hs-varid'>name</span>
<a name="line-64"></a>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsTyVarBndrs</span> <span class='hs-varid'>name</span>
<a name="line-65"></a>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HsContext</span> <span class='hs-varid'>name</span>
<a name="line-66"></a>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-67"></a><span class='hs-definition'>pp_vanilla_decl_head</span> <span class='hs-varid'>thing</span> <span class='hs-varid'>tyvars</span> <span class='hs-varid'>context</span>
<a name="line-68"></a> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hsep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>pprHsContext</span> <span class='hs-varid'>context</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprPrefixOcc</span> <span class='hs-layout'>(</span><span class='hs-varid'>unLoc</span> <span class='hs-varid'>thing</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>tyvars</span><span class='hs-keyglyph'>]</span>
<a name="line-69"></a>
<a name="line-70"></a><a name="pp_fam_inst_lhs"></a><span class='hs-definition'>pp_fam_inst_lhs</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>name</span>
<a name="line-71"></a>   <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Located</span> <span class='hs-varid'>name</span>
<a name="line-72"></a>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HsWithBndrs</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LHsType</span> <span class='hs-varid'>name</span><span class='hs-keyglyph'>]</span>
<a name="line-73"></a>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HsContext</span> <span class='hs-varid'>name</span>
<a name="line-74"></a>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-75"></a><span class='hs-definition'>pp_fam_inst_lhs</span> <span class='hs-varid'>thing</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsWB</span> <span class='hs-layout'>{</span> <span class='hs-varid'>hswb_cts</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>typats</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-varid'>context</span> <span class='hs-comment'>-- explicit type patterns</span>
<a name="line-76"></a>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hsep</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>pprHsContext</span> <span class='hs-varid'>context</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprPrefixOcc</span> <span class='hs-layout'>(</span><span class='hs-varid'>unLoc</span> <span class='hs-varid'>thing</span><span class='hs-layout'>)</span>
<a name="line-77"></a>          <span class='hs-layout'>,</span> <span class='hs-varid'>hsep</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-varid'>pprParendHsType</span><span class='hs-varop'>.</span><span class='hs-varid'>unLoc</span><span class='hs-layout'>)</span> <span class='hs-varid'>typats</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-78"></a>
<a name="line-79"></a><a name="pprTyClDeclFlavour"></a><span class='hs-definition'>pprTyClDeclFlavour</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyClDecl</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-80"></a><span class='hs-definition'>pprTyClDeclFlavour</span> <span class='hs-layout'>(</span><span class='hs-conid'>ClassDecl</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"class"</span><span class='hs-layout'>)</span>
<a name="line-81"></a><span class='hs-definition'>pprTyClDeclFlavour</span> <span class='hs-layout'>(</span><span class='hs-conid'>FamDecl</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"family"</span><span class='hs-layout'>)</span>
<a name="line-82"></a><span class='hs-definition'>pprTyClDeclFlavour</span> <span class='hs-layout'>(</span><span class='hs-conid'>SynDecl</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"type"</span><span class='hs-layout'>)</span>
<a name="line-83"></a><span class='hs-definition'>pprTyClDeclFlavour</span> <span class='hs-layout'>(</span><span class='hs-conid'>DataDecl</span> <span class='hs-layout'>{</span> <span class='hs-varid'>tcdDataDefn</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsDataDefn</span> <span class='hs-layout'>{</span> <span class='hs-varid'>dd_ND</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>nd</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-84"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>nd</span>
<a name="line-85"></a><span class='hs-definition'>pprTyClDeclFlavour</span> <span class='hs-layout'>(</span><span class='hs-conid'>ForeignType</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"foreign type"</span><span class='hs-layout'>)</span>
</pre>\end{code}

%************************************************************************
%*                                                                      *
\subsection[ConDecl]{A data-constructor declaration}
%*                                                                      *
%************************************************************************

\begin{code}
<pre><a name="line-1"></a>
<a name="line-2"></a><a name="HsDataDefn"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>HsDataDefn</span> <span class='hs-varid'>name</span>   <span class='hs-comment'>-- The payload of a data type defn</span>
<a name="line-3"></a>                       <span class='hs-comment'>-- Used *both* for vanilla data declarations,</span>
<a name="line-4"></a>                       <span class='hs-comment'>--       *and* for data family instances</span>
<a name="line-5"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-comment'>-- | Declares a data type or newtype, giving its constructors</span>
<a name="line-6"></a>    <span class='hs-comment'>-- @</span>
<a name="line-7"></a>    <span class='hs-comment'>--  data/newtype T a = &lt;constrs&gt;</span>
<a name="line-8"></a>    <span class='hs-comment'>--  data/newtype instance T [a] = &lt;constrs&gt;</span>
<a name="line-9"></a>    <span class='hs-comment'>-- @</span>
<a name="line-10"></a>    <span class='hs-conid'>HsDataDefn</span> <span class='hs-layout'>{</span> <span class='hs-varid'>dd_ND</span>     <span class='hs-keyglyph'>::</span> <span class='hs-conid'>NewOrData</span><span class='hs-layout'>,</span>
<a name="line-11"></a>                 <span class='hs-varid'>dd_ctxt</span>   <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LHsContext</span> <span class='hs-varid'>name</span><span class='hs-layout'>,</span>           <span class='hs-comment'>-- ^ Context</span>
<a name="line-12"></a>                 <span class='hs-varid'>dd_cType</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>CType</span><span class='hs-layout'>,</span>
<a name="line-13"></a>                 <span class='hs-varid'>dd_kindSig</span><span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsKind</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-14"></a>                     <span class='hs-comment'>-- ^ Optional kind signature.</span>
<a name="line-15"></a>                     <span class='hs-comment'>--</span>
<a name="line-16"></a>                     <span class='hs-comment'>-- @(Just k)@ for a GADT-style @data@, </span>
<a name="line-17"></a>                     <span class='hs-comment'>-- or @data instance@ decl, with explicit kind sig</span>
<a name="line-18"></a>                     <span class='hs-comment'>--</span>
<a name="line-19"></a>                     <span class='hs-comment'>-- Always @Nothing@ for H98-syntax decls</span>
<a name="line-20"></a>
<a name="line-21"></a>                 <span class='hs-varid'>dd_cons</span>   <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LConDecl</span> <span class='hs-varid'>name</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span>
<a name="line-22"></a>                     <span class='hs-comment'>-- ^ Data constructors</span>
<a name="line-23"></a>                     <span class='hs-comment'>--</span>
<a name="line-24"></a>                     <span class='hs-comment'>-- For @data T a = T1 | T2 a@</span>
<a name="line-25"></a>                     <span class='hs-comment'>--   the 'LConDecl's all have 'ResTyH98'.</span>
<a name="line-26"></a>                     <span class='hs-comment'>-- For @data T a where { T1 :: T a }@</span>
<a name="line-27"></a>                     <span class='hs-comment'>--   the 'LConDecls' all have 'ResTyGADT'.</span>
<a name="line-28"></a>
<a name="line-29"></a>                 <span class='hs-varid'>dd_derivs</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LHsType</span> <span class='hs-varid'>name</span><span class='hs-keyglyph'>]</span>
<a name="line-30"></a>                     <span class='hs-comment'>-- ^ Derivings; @Nothing@ =&gt; not specified,</span>
<a name="line-31"></a>                     <span class='hs-comment'>--              @Just []@ =&gt; derive exactly what is asked</span>
<a name="line-32"></a>                     <span class='hs-comment'>--</span>
<a name="line-33"></a>                     <span class='hs-comment'>-- These "types" must be of form</span>
<a name="line-34"></a>                     <span class='hs-comment'>-- @</span>
<a name="line-35"></a>                     <span class='hs-comment'>--      forall ab. C ty1 ty2</span>
<a name="line-36"></a>                     <span class='hs-comment'>-- @</span>
<a name="line-37"></a>                     <span class='hs-comment'>-- Typically the foralls and ty args are empty, but they</span>
<a name="line-38"></a>                     <span class='hs-comment'>-- are non-empty for the newtype-deriving case</span>
<a name="line-39"></a>    <span class='hs-layout'>}</span>
<a name="line-40"></a>    <span class='hs-keyword'>deriving</span><span class='hs-layout'>(</span> <span class='hs-conid'>Data</span><span class='hs-layout'>,</span> <span class='hs-conid'>Typeable</span> <span class='hs-layout'>)</span>
<a name="line-41"></a>
<a name="line-42"></a><a name="NewOrData"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>NewOrData</span>
<a name="line-43"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>NewType</span>                     <span class='hs-comment'>-- ^ @newtype Blah ...@</span>
<a name="line-44"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>DataType</span>                    <span class='hs-comment'>-- ^ @data Blah ...@</span>
<a name="line-45"></a>  <span class='hs-keyword'>deriving</span><span class='hs-layout'>(</span> <span class='hs-conid'>Eq</span><span class='hs-layout'>,</span> <span class='hs-conid'>Data</span><span class='hs-layout'>,</span> <span class='hs-conid'>Typeable</span> <span class='hs-layout'>)</span>                <span class='hs-comment'>-- Needed because Demand derives Eq</span>
<a name="line-46"></a>
<a name="line-47"></a><a name="LConDecl"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LConDecl</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-conid'>ConDecl</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>
<a name="line-48"></a>
<a name="line-49"></a><span class='hs-comment'>-- data T b = forall a. Eq a =&gt; MkT a b</span>
<a name="line-50"></a><span class='hs-comment'>--   MkT :: forall b a. Eq a =&gt; MkT a b</span>
<a name="line-51"></a>
<a name="line-52"></a><span class='hs-comment'>-- data T b where</span>
<a name="line-53"></a><span class='hs-comment'>--      MkT1 :: Int -&gt; T Int</span>
<a name="line-54"></a>
<a name="line-55"></a><span class='hs-comment'>-- data T = Int `MkT` Int</span>
<a name="line-56"></a><span class='hs-comment'>--        | MkT2</span>
<a name="line-57"></a>
<a name="line-58"></a><span class='hs-comment'>-- data T a where</span>
<a name="line-59"></a><span class='hs-comment'>--      Int `MkT` Int :: T Int</span>
<a name="line-60"></a>
<a name="line-61"></a><a name="ConDecl"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>ConDecl</span> <span class='hs-varid'>name</span>
<a name="line-62"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ConDecl</span>
<a name="line-63"></a>    <span class='hs-layout'>{</span> <span class='hs-varid'>con_name</span>      <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Located</span> <span class='hs-varid'>name</span>
<a name="line-64"></a>        <span class='hs-comment'>-- ^ Constructor name.  This is used for the DataCon itself, and for</span>
<a name="line-65"></a>        <span class='hs-comment'>-- the user-callable wrapper Id.</span>
<a name="line-66"></a>
<a name="line-67"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>con_explicit</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsExplicitFlag</span>
<a name="line-68"></a>        <span class='hs-comment'>-- ^ Is there an user-written forall? (cf. 'HsTypes.HsForAllTy')</span>
<a name="line-69"></a>
<a name="line-70"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>con_qvars</span>     <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LHsTyVarBndrs</span> <span class='hs-varid'>name</span>
<a name="line-71"></a>        <span class='hs-comment'>-- ^ Type variables.  Depending on 'con_res' this describes the</span>
<a name="line-72"></a>        <span class='hs-comment'>-- following entities</span>
<a name="line-73"></a>        <span class='hs-comment'>--</span>
<a name="line-74"></a>        <span class='hs-comment'>--  - ResTyH98:  the constructor's *existential* type variables</span>
<a name="line-75"></a>        <span class='hs-comment'>--  - ResTyGADT: *all* the constructor's quantified type variables</span>
<a name="line-76"></a>        <span class='hs-comment'>--</span>
<a name="line-77"></a>        <span class='hs-comment'>-- If con_explicit is Implicit, then con_qvars is irrelevant</span>
<a name="line-78"></a>        <span class='hs-comment'>-- until after renaming.  </span>
<a name="line-79"></a>
<a name="line-80"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>con_cxt</span>       <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LHsContext</span> <span class='hs-varid'>name</span>
<a name="line-81"></a>        <span class='hs-comment'>-- ^ The context.  This /does not/ include the \"stupid theta\" which</span>
<a name="line-82"></a>        <span class='hs-comment'>-- lives only in the 'TyData' decl.</span>
<a name="line-83"></a>
<a name="line-84"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>con_details</span>   <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsConDeclDetails</span> <span class='hs-varid'>name</span>
<a name="line-85"></a>        <span class='hs-comment'>-- ^ The main payload</span>
<a name="line-86"></a>
<a name="line-87"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>con_res</span>       <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ResType</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsType</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>
<a name="line-88"></a>        <span class='hs-comment'>-- ^ Result type of the constructor</span>
<a name="line-89"></a>
<a name="line-90"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>con_doc</span>       <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>LHsDocString</span>
<a name="line-91"></a>        <span class='hs-comment'>-- ^ A possible Haddock comment.</span>
<a name="line-92"></a>
<a name="line-93"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>con_old_rec</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Bool</span>   
<a name="line-94"></a>        <span class='hs-comment'>-- ^ TEMPORARY field; True &lt;=&gt; user has employed now-deprecated syntax for</span>
<a name="line-95"></a>        <span class='hs-comment'>--                             GADT-style record decl   C { blah } :: T a b</span>
<a name="line-96"></a>        <span class='hs-comment'>-- Remove this when we no longer parse this stuff, and hence do not</span>
<a name="line-97"></a>        <span class='hs-comment'>-- need to report decprecated use</span>
<a name="line-98"></a>    <span class='hs-layout'>}</span> <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Data</span><span class='hs-layout'>,</span> <span class='hs-conid'>Typeable</span><span class='hs-layout'>)</span>
<a name="line-99"></a>
<a name="line-100"></a><a name="HsConDeclDetails"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>HsConDeclDetails</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HsConDetails</span> <span class='hs-layout'>(</span><span class='hs-conid'>LBangType</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>ConDeclField</span> <span class='hs-varid'>name</span><span class='hs-keyglyph'>]</span>
<a name="line-101"></a>
<a name="line-102"></a><a name="hsConDeclArgTys"></a><span class='hs-definition'>hsConDeclArgTys</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsConDeclDetails</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LBangType</span> <span class='hs-varid'>name</span><span class='hs-keyglyph'>]</span>
<a name="line-103"></a><span class='hs-definition'>hsConDeclArgTys</span> <span class='hs-layout'>(</span><span class='hs-conid'>PrefixCon</span> <span class='hs-varid'>tys</span><span class='hs-layout'>)</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tys</span>
<a name="line-104"></a><span class='hs-definition'>hsConDeclArgTys</span> <span class='hs-layout'>(</span><span class='hs-conid'>InfixCon</span> <span class='hs-varid'>ty1</span> <span class='hs-varid'>ty2</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>ty1</span><span class='hs-layout'>,</span><span class='hs-varid'>ty2</span><span class='hs-keyglyph'>]</span>
<a name="line-105"></a><span class='hs-definition'>hsConDeclArgTys</span> <span class='hs-layout'>(</span><span class='hs-conid'>RecCon</span> <span class='hs-varid'>flds</span><span class='hs-layout'>)</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>map</span> <span class='hs-varid'>cd_fld_type</span> <span class='hs-varid'>flds</span>
<a name="line-106"></a>
<a name="line-107"></a><a name="ResType"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>ResType</span> <span class='hs-varid'>ty</span>
<a name="line-108"></a>   <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ResTyH98</span>           <span class='hs-comment'>-- Constructor was declared using Haskell 98 syntax</span>
<a name="line-109"></a>   <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ResTyGADT</span> <span class='hs-varid'>ty</span>       <span class='hs-comment'>-- Constructor was declared using GADT-style syntax,</span>
<a name="line-110"></a>                        <span class='hs-comment'>--      and here is its result type</span>
<a name="line-111"></a>   <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Data</span><span class='hs-layout'>,</span> <span class='hs-conid'>Typeable</span><span class='hs-layout'>)</span>
<a name="line-112"></a>
<a name="line-113"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Outputable</span> <span class='hs-varid'>ty</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Outputable</span> <span class='hs-layout'>(</span><span class='hs-conid'>ResType</span> <span class='hs-varid'>ty</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-114"></a>         <span class='hs-comment'>-- Debugging only</span>
<a name="line-115"></a>   <span class='hs-varid'>ppr</span> <span class='hs-conid'>ResTyH98</span>       <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"ResTyH98"</span><span class='hs-layout'>)</span>
<a name="line-116"></a>   <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>ResTyGADT</span> <span class='hs-varid'>ty</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"ResTyGADT"</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>ty</span>
</pre>\end{code}


\begin{code}
<pre><a name="line-1"></a><a name="pp_data_defn"></a><span class='hs-definition'>pp_data_defn</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>name</span>
<a name="line-2"></a>                  <span class='hs-keyglyph'>=&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsContext</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span><span class='hs-layout'>)</span>   <span class='hs-comment'>-- Printing the header</span>
<a name="line-3"></a>                  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HsDataDefn</span> <span class='hs-varid'>name</span>
<a name="line-4"></a>                  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span> 
<a name="line-5"></a><span class='hs-definition'>pp_data_defn</span> <span class='hs-varid'>pp_hdr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsDataDefn</span> <span class='hs-layout'>{</span> <span class='hs-varid'>dd_ND</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>new_or_data</span><span class='hs-layout'>,</span> <span class='hs-varid'>dd_ctxt</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>context</span>
<a name="line-6"></a>                                <span class='hs-layout'>,</span> <span class='hs-varid'>dd_kindSig</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mb_sig</span> 
<a name="line-7"></a>                                <span class='hs-layout'>,</span> <span class='hs-varid'>dd_cons</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>condecls</span><span class='hs-layout'>,</span> <span class='hs-varid'>dd_derivs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>derivings</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-8"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>null</span> <span class='hs-varid'>condecls</span>
<a name="line-9"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>new_or_data</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>pp_hdr</span> <span class='hs-varid'>context</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>pp_sig</span>
<a name="line-10"></a>
<a name="line-11"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>
<a name="line-12"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hang</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>new_or_data</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>pp_hdr</span> <span class='hs-varid'>context</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>pp_sig</span><span class='hs-layout'>)</span>
<a name="line-13"></a>       <span class='hs-num'>2</span> <span class='hs-layout'>(</span><span class='hs-varid'>pp_condecls</span> <span class='hs-varid'>condecls</span> <span class='hs-varop'>$$</span> <span class='hs-varid'>pp_derivings</span><span class='hs-layout'>)</span>
<a name="line-14"></a>  <span class='hs-keyword'>where</span>
<a name="line-15"></a>    <span class='hs-varid'>pp_sig</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>mb_sig</span> <span class='hs-keyword'>of</span>
<a name="line-16"></a>               <span class='hs-conid'>Nothing</span>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>empty</span>
<a name="line-17"></a>               <span class='hs-conid'>Just</span> <span class='hs-varid'>kind</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>dcolon</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>kind</span>
<a name="line-18"></a>    <span class='hs-varid'>pp_derivings</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>derivings</span> <span class='hs-keyword'>of</span>
<a name="line-19"></a>                     <span class='hs-conid'>Nothing</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>empty</span>
<a name="line-20"></a>                     <span class='hs-conid'>Just</span> <span class='hs-varid'>ds</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>hsep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"deriving"</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>parens</span> <span class='hs-layout'>(</span><span class='hs-varid'>interpp'SP</span> <span class='hs-varid'>ds</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-21"></a>
<a name="line-22"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Outputable</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsDataDefn</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-23"></a>   <span class='hs-varid'>ppr</span> <span class='hs-varid'>d</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pp_data_defn</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"Naked HsDataDefn"</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varid'>d</span>
<a name="line-24"></a>
<a name="line-25"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Outputable</span> <span class='hs-conid'>NewOrData</span> <span class='hs-keyword'>where</span>
<a name="line-26"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>NewType</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"newtype"</span><span class='hs-layout'>)</span>
<a name="line-27"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>DataType</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"data"</span><span class='hs-layout'>)</span>
<a name="line-28"></a>
<a name="line-29"></a><a name="pp_condecls"></a><span class='hs-definition'>pp_condecls</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LConDecl</span> <span class='hs-varid'>name</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-30"></a><span class='hs-definition'>pp_condecls</span> <span class='hs-varid'>cs</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-conid'>ConDecl</span><span class='hs-layout'>{</span> <span class='hs-varid'>con_res</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ResTyGADT</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>}</span> <span class='hs-conop'>:</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- In GADT syntax</span>
<a name="line-31"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hang</span> <span class='hs-layout'>(</span><span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"where"</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-num'>2</span> <span class='hs-layout'>(</span><span class='hs-varid'>vcat</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>cs</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-32"></a><span class='hs-definition'>pp_condecls</span> <span class='hs-varid'>cs</span>                    <span class='hs-comment'>-- In H98 syntax</span>
<a name="line-33"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>equals</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>sep</span> <span class='hs-layout'>(</span><span class='hs-varid'>punctuate</span> <span class='hs-layout'>(</span><span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>" |"</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>cs</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-34"></a>
<a name="line-35"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Outputable</span> <span class='hs-layout'>(</span><span class='hs-conid'>ConDecl</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-36"></a>    <span class='hs-varid'>ppr</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprConDecl</span>
<a name="line-37"></a>
<a name="line-38"></a><a name="pprConDecl"></a><span class='hs-definition'>pprConDecl</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>ConDecl</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-39"></a><span class='hs-definition'>pprConDecl</span> <span class='hs-layout'>(</span><span class='hs-conid'>ConDecl</span> <span class='hs-layout'>{</span> <span class='hs-varid'>con_name</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>con</span><span class='hs-layout'>,</span> <span class='hs-varid'>con_explicit</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>expl</span><span class='hs-layout'>,</span> <span class='hs-varid'>con_qvars</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tvs</span>
<a name="line-40"></a>                    <span class='hs-layout'>,</span> <span class='hs-varid'>con_cxt</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>cxt</span><span class='hs-layout'>,</span> <span class='hs-varid'>con_details</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>details</span>
<a name="line-41"></a>                    <span class='hs-layout'>,</span> <span class='hs-varid'>con_res</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ResTyH98</span><span class='hs-layout'>,</span> <span class='hs-varid'>con_doc</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>doc</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-42"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>ppr_mbDoc</span> <span class='hs-varid'>doc</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprHsForAll</span> <span class='hs-varid'>expl</span> <span class='hs-varid'>tvs</span> <span class='hs-varid'>cxt</span><span class='hs-layout'>,</span> <span class='hs-varid'>ppr_details</span> <span class='hs-varid'>details</span><span class='hs-keyglyph'>]</span>
<a name="line-43"></a>  <span class='hs-keyword'>where</span>
<a name="line-44"></a>    <span class='hs-varid'>ppr_details</span> <span class='hs-layout'>(</span><span class='hs-conid'>InfixCon</span> <span class='hs-varid'>t1</span> <span class='hs-varid'>t2</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hsep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>t1</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprInfixOcc</span> <span class='hs-layout'>(</span><span class='hs-varid'>unLoc</span> <span class='hs-varid'>con</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>t2</span><span class='hs-keyglyph'>]</span>
<a name="line-45"></a>    <span class='hs-varid'>ppr_details</span> <span class='hs-layout'>(</span><span class='hs-conid'>PrefixCon</span> <span class='hs-varid'>tys</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hsep</span> <span class='hs-layout'>(</span><span class='hs-varid'>pprPrefixOcc</span> <span class='hs-layout'>(</span><span class='hs-varid'>unLoc</span> <span class='hs-varid'>con</span><span class='hs-layout'>)</span> <span class='hs-conop'>:</span> <span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-varid'>pprParendHsType</span> <span class='hs-varop'>.</span> <span class='hs-varid'>unLoc</span><span class='hs-layout'>)</span> <span class='hs-varid'>tys</span><span class='hs-layout'>)</span>
<a name="line-46"></a>    <span class='hs-varid'>ppr_details</span> <span class='hs-layout'>(</span><span class='hs-conid'>RecCon</span> <span class='hs-varid'>fields</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>con</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>pprConDeclFields</span> <span class='hs-varid'>fields</span>
<a name="line-47"></a>
<a name="line-48"></a><span class='hs-definition'>pprConDecl</span> <span class='hs-layout'>(</span><span class='hs-conid'>ConDecl</span> <span class='hs-layout'>{</span> <span class='hs-varid'>con_name</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>con</span><span class='hs-layout'>,</span> <span class='hs-varid'>con_explicit</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>expl</span><span class='hs-layout'>,</span> <span class='hs-varid'>con_qvars</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tvs</span>
<a name="line-49"></a>                    <span class='hs-layout'>,</span> <span class='hs-varid'>con_cxt</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>cxt</span><span class='hs-layout'>,</span> <span class='hs-varid'>con_details</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>PrefixCon</span> <span class='hs-varid'>arg_tys</span>
<a name="line-50"></a>                    <span class='hs-layout'>,</span> <span class='hs-varid'>con_res</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ResTyGADT</span> <span class='hs-varid'>res_ty</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-51"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>con</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>dcolon</span> <span class='hs-varop'>&lt;+&gt;</span> 
<a name="line-52"></a>    <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>pprHsForAll</span> <span class='hs-varid'>expl</span> <span class='hs-varid'>tvs</span> <span class='hs-varid'>cxt</span><span class='hs-layout'>,</span> <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-varid'>foldr</span> <span class='hs-varid'>mk_fun_ty</span> <span class='hs-varid'>res_ty</span> <span class='hs-varid'>arg_tys</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-53"></a>  <span class='hs-keyword'>where</span>
<a name="line-54"></a>    <span class='hs-varid'>mk_fun_ty</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>noLoc</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsFunTy</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span>
<a name="line-55"></a>
<a name="line-56"></a><span class='hs-definition'>pprConDecl</span> <span class='hs-layout'>(</span><span class='hs-conid'>ConDecl</span> <span class='hs-layout'>{</span> <span class='hs-varid'>con_name</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>con</span><span class='hs-layout'>,</span> <span class='hs-varid'>con_explicit</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>expl</span><span class='hs-layout'>,</span> <span class='hs-varid'>con_qvars</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tvs</span>
<a name="line-57"></a>                    <span class='hs-layout'>,</span> <span class='hs-varid'>con_cxt</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>cxt</span><span class='hs-layout'>,</span> <span class='hs-varid'>con_details</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>RecCon</span> <span class='hs-varid'>fields</span><span class='hs-layout'>,</span> <span class='hs-varid'>con_res</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ResTyGADT</span> <span class='hs-varid'>res_ty</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-58"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>con</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>dcolon</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>pprHsForAll</span> <span class='hs-varid'>expl</span> <span class='hs-varid'>tvs</span> <span class='hs-varid'>cxt</span><span class='hs-layout'>,</span> 
<a name="line-59"></a>         <span class='hs-varid'>pprConDeclFields</span> <span class='hs-varid'>fields</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>arrow</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>res_ty</span><span class='hs-keyglyph'>]</span>
<a name="line-60"></a>
<a name="line-61"></a><span class='hs-definition'>pprConDecl</span> <span class='hs-varid'>decl</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-conid'>ConDecl</span> <span class='hs-layout'>{</span> <span class='hs-varid'>con_details</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>InfixCon</span> <span class='hs-varid'>ty1</span> <span class='hs-varid'>ty2</span><span class='hs-layout'>,</span> <span class='hs-varid'>con_res</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ResTyGADT</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-62"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprConDecl</span> <span class='hs-layout'>(</span><span class='hs-varid'>decl</span> <span class='hs-layout'>{</span> <span class='hs-varid'>con_details</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>PrefixCon</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>ty1</span><span class='hs-layout'>,</span><span class='hs-varid'>ty2</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-63"></a>        <span class='hs-comment'>-- In GADT syntax we don't allow infix constructors</span>
<a name="line-64"></a>        <span class='hs-comment'>-- but the renamer puts them in this form (Note [Infix GADT constructors] in RnSource)</span>
</pre>\end{code}

%************************************************************************
%*                                                                      *
                Instance declarations
%*                                                                      *
%************************************************************************

\begin{code}
<pre><a name="line-1"></a><span class='hs-comment'>----------------- Type synonym family instances -------------</span>
<a name="line-2"></a>
<a name="line-3"></a><a name="LTyFamInstEqn"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LTyFamInstEqn</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-conid'>TyFamInstEqn</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>
<a name="line-4"></a>
<a name="line-5"></a><a name="TyFamInstEqn"></a><span class='hs-comment'>-- | One equation in a type family instance declaration</span>
<a name="line-6"></a><a name="TyFamInstEqn"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>TyFamInstEqn</span> <span class='hs-varid'>name</span>   
<a name="line-7"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>TyFamInstEqn</span>
<a name="line-8"></a>       <span class='hs-layout'>{</span> <span class='hs-varid'>tfie_tycon</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Located</span> <span class='hs-varid'>name</span>
<a name="line-9"></a>       <span class='hs-layout'>,</span> <span class='hs-varid'>tfie_pats</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsWithBndrs</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LHsType</span> <span class='hs-varid'>name</span><span class='hs-keyglyph'>]</span>
<a name="line-10"></a>            <span class='hs-comment'>-- ^ Type patterns (with kind and type bndrs)</span>
<a name="line-11"></a>            <span class='hs-comment'>-- See Note [Family instance declaration binders]</span>
<a name="line-12"></a>       <span class='hs-layout'>,</span> <span class='hs-varid'>tfie_rhs</span>   <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LHsType</span> <span class='hs-varid'>name</span> <span class='hs-layout'>}</span>         
<a name="line-13"></a>  <span class='hs-keyword'>deriving</span><span class='hs-layout'>(</span> <span class='hs-conid'>Typeable</span><span class='hs-layout'>,</span> <span class='hs-conid'>Data</span> <span class='hs-layout'>)</span>
<a name="line-14"></a>
<a name="line-15"></a><a name="LTyFamInstDecl"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LTyFamInstDecl</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-conid'>TyFamInstDecl</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>
<a name="line-16"></a><a name="TyFamInstDecl"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>TyFamInstDecl</span> <span class='hs-varid'>name</span> 
<a name="line-17"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>TyFamInstDecl</span>
<a name="line-18"></a>       <span class='hs-layout'>{</span> <span class='hs-varid'>tfid_eqn</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LTyFamInstEqn</span> <span class='hs-varid'>name</span> 
<a name="line-19"></a>       <span class='hs-layout'>,</span> <span class='hs-varid'>tfid_fvs</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>NameSet</span> <span class='hs-layout'>}</span>
<a name="line-20"></a>  <span class='hs-keyword'>deriving</span><span class='hs-layout'>(</span> <span class='hs-conid'>Typeable</span><span class='hs-layout'>,</span> <span class='hs-conid'>Data</span> <span class='hs-layout'>)</span>
<a name="line-21"></a>
<a name="line-22"></a><span class='hs-comment'>----------------- Data family instances -------------</span>
<a name="line-23"></a>
<a name="line-24"></a><a name="LDataFamInstDecl"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LDataFamInstDecl</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-conid'>DataFamInstDecl</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>
<a name="line-25"></a><a name="DataFamInstDecl"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>DataFamInstDecl</span> <span class='hs-varid'>name</span>
<a name="line-26"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>DataFamInstDecl</span>
<a name="line-27"></a>       <span class='hs-layout'>{</span> <span class='hs-varid'>dfid_tycon</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Located</span> <span class='hs-varid'>name</span>
<a name="line-28"></a>       <span class='hs-layout'>,</span> <span class='hs-varid'>dfid_pats</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsWithBndrs</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LHsType</span> <span class='hs-varid'>name</span><span class='hs-keyglyph'>]</span>   <span class='hs-comment'>-- lhs</span>
<a name="line-29"></a>            <span class='hs-comment'>-- ^ Type patterns (with kind and type bndrs)</span>
<a name="line-30"></a>            <span class='hs-comment'>-- See Note [Family instance declaration binders]</span>
<a name="line-31"></a>       <span class='hs-layout'>,</span> <span class='hs-varid'>dfid_defn</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsDataDefn</span>  <span class='hs-varid'>name</span>             <span class='hs-comment'>-- rhs</span>
<a name="line-32"></a>       <span class='hs-layout'>,</span> <span class='hs-varid'>dfid_fvs</span>   <span class='hs-keyglyph'>::</span> <span class='hs-conid'>NameSet</span> <span class='hs-layout'>}</span>                    <span class='hs-comment'>-- free vars for dependency analysis</span>
<a name="line-33"></a>  <span class='hs-keyword'>deriving</span><span class='hs-layout'>(</span> <span class='hs-conid'>Typeable</span><span class='hs-layout'>,</span> <span class='hs-conid'>Data</span> <span class='hs-layout'>)</span>
<a name="line-34"></a>
<a name="line-35"></a>
<a name="line-36"></a><span class='hs-comment'>----------------- Class instances -------------</span>
<a name="line-37"></a>
<a name="line-38"></a><a name="LClsInstDecl"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LClsInstDecl</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-conid'>ClsInstDecl</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>
<a name="line-39"></a><a name="ClsInstDecl"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>ClsInstDecl</span> <span class='hs-varid'>name</span>
<a name="line-40"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ClsInstDecl</span>
<a name="line-41"></a>      <span class='hs-layout'>{</span> <span class='hs-varid'>cid_poly_ty</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LHsType</span> <span class='hs-varid'>name</span>    <span class='hs-comment'>-- Context =&gt; Class Instance-type</span>
<a name="line-42"></a>                                       <span class='hs-comment'>-- Using a polytype means that the renamer conveniently</span>
<a name="line-43"></a>                                       <span class='hs-comment'>-- figures out the quantified type variables for us.</span>
<a name="line-44"></a>      <span class='hs-layout'>,</span> <span class='hs-varid'>cid_binds</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LHsBinds</span> <span class='hs-varid'>name</span>
<a name="line-45"></a>      <span class='hs-layout'>,</span> <span class='hs-varid'>cid_sigs</span>  <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LSig</span> <span class='hs-varid'>name</span><span class='hs-keyglyph'>]</span>                <span class='hs-comment'>-- User-supplied pragmatic info</span>
<a name="line-46"></a>      <span class='hs-layout'>,</span> <span class='hs-varid'>cid_tyfam_insts</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LTyFamInstDecl</span> <span class='hs-varid'>name</span><span class='hs-keyglyph'>]</span>  <span class='hs-comment'>-- type family instances</span>
<a name="line-47"></a>      <span class='hs-layout'>,</span> <span class='hs-varid'>cid_datafam_insts</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LDataFamInstDecl</span> <span class='hs-varid'>name</span><span class='hs-keyglyph'>]</span> <span class='hs-comment'>-- data family instances</span>
<a name="line-48"></a>      <span class='hs-layout'>}</span>
<a name="line-49"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Data</span><span class='hs-layout'>,</span> <span class='hs-conid'>Typeable</span><span class='hs-layout'>)</span>
<a name="line-50"></a>
<a name="line-51"></a>
<a name="line-52"></a><span class='hs-comment'>----------------- Instances of all kinds -------------</span>
<a name="line-53"></a>
<a name="line-54"></a><a name="LInstDecl"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LInstDecl</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-conid'>InstDecl</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>
<a name="line-55"></a><a name="InstDecl"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>InstDecl</span> <span class='hs-varid'>name</span>  <span class='hs-comment'>-- Both class and family instances</span>
<a name="line-56"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ClsInstD</span>    
<a name="line-57"></a>      <span class='hs-layout'>{</span> <span class='hs-varid'>cid_inst</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ClsInstDecl</span> <span class='hs-varid'>name</span> <span class='hs-layout'>}</span>
<a name="line-58"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>DataFamInstD</span>              <span class='hs-comment'>-- data family instance</span>
<a name="line-59"></a>      <span class='hs-layout'>{</span> <span class='hs-varid'>dfid_inst</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>DataFamInstDecl</span> <span class='hs-varid'>name</span> <span class='hs-layout'>}</span>
<a name="line-60"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>TyFamInstD</span>              <span class='hs-comment'>-- type family instance</span>
<a name="line-61"></a>      <span class='hs-layout'>{</span> <span class='hs-varid'>tfid_inst</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyFamInstDecl</span> <span class='hs-varid'>name</span> <span class='hs-layout'>}</span>
<a name="line-62"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Data</span><span class='hs-layout'>,</span> <span class='hs-conid'>Typeable</span><span class='hs-layout'>)</span>
</pre>\end{code}

Note [Family instance declaration binders]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
A {Ty|Data}FamInstDecl is a data/type family instance declaration
the pats field is LHS patterns, and the tvs of the HsBSig
tvs are fv(pat_tys), *including* ones that are already in scope

   Eg   class C s t where
          type F t p :: *
        instance C w (a,b) where
          type F (a,b) x = x->a
   The tcdTyVars of the F decl are {a,b,x}, even though the F decl
   is nested inside the 'instance' decl. 

   However after the renamer, the uniques will match up:
        instance C w7 (a8,b9) where
          type F (a8,b9) x10 = x10->a8
   so that we can compare the type patter in the 'instance' decl and
   in the associated 'type' decl

\begin{code}
<pre><a name="line-1"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Outputable</span> <span class='hs-layout'>(</span><span class='hs-conid'>TyFamInstDecl</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-2"></a>  <span class='hs-varid'>ppr</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprTyFamInstDecl</span> <span class='hs-conid'>TopLevel</span>
<a name="line-3"></a>
<a name="line-4"></a><a name="pprTyFamInstDecl"></a><span class='hs-definition'>pprTyFamInstDecl</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>TopLevelFlag</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TyFamInstDecl</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-5"></a><span class='hs-definition'>pprTyFamInstDecl</span> <span class='hs-varid'>top_lvl</span> <span class='hs-layout'>(</span><span class='hs-conid'>TyFamInstDecl</span> <span class='hs-layout'>{</span> <span class='hs-varid'>tfid_eqn</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>eqn</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-6"></a>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"type"</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr_instance_keyword</span> <span class='hs-varid'>top_lvl</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>eqn</span><span class='hs-layout'>)</span>
<a name="line-7"></a>
<a name="line-8"></a><a name="ppr_instance_keyword"></a><span class='hs-definition'>ppr_instance_keyword</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TopLevelFlag</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-9"></a><span class='hs-definition'>ppr_instance_keyword</span> <span class='hs-conid'>TopLevel</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"instance"</span><span class='hs-layout'>)</span>
<a name="line-10"></a><span class='hs-definition'>ppr_instance_keyword</span> <span class='hs-conid'>NotTopLevel</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>empty</span>
<a name="line-11"></a>
<a name="line-12"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Outputable</span> <span class='hs-layout'>(</span><span class='hs-conid'>TyFamInstEqn</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-13"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>TyFamInstEqn</span> <span class='hs-layout'>{</span> <span class='hs-varid'>tfie_tycon</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tycon</span>
<a name="line-14"></a>                    <span class='hs-layout'>,</span> <span class='hs-varid'>tfie_pats</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pats</span>
<a name="line-15"></a>                    <span class='hs-layout'>,</span> <span class='hs-varid'>tfie_rhs</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>rhs</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-16"></a>    <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>pp_fam_inst_lhs</span> <span class='hs-varid'>tycon</span> <span class='hs-varid'>pats</span> <span class='hs-conid'>[]</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>equals</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>rhs</span><span class='hs-layout'>)</span>
<a name="line-17"></a>
<a name="line-18"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Outputable</span> <span class='hs-layout'>(</span><span class='hs-conid'>DataFamInstDecl</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-19"></a>  <span class='hs-varid'>ppr</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprDataFamInstDecl</span> <span class='hs-conid'>TopLevel</span>
<a name="line-20"></a>
<a name="line-21"></a><a name="pprDataFamInstDecl"></a><span class='hs-definition'>pprDataFamInstDecl</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>TopLevelFlag</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>DataFamInstDecl</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-22"></a><span class='hs-definition'>pprDataFamInstDecl</span> <span class='hs-varid'>top_lvl</span> <span class='hs-layout'>(</span><span class='hs-conid'>DataFamInstDecl</span> <span class='hs-layout'>{</span> <span class='hs-varid'>dfid_tycon</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tycon</span>
<a name="line-23"></a>                                            <span class='hs-layout'>,</span> <span class='hs-varid'>dfid_pats</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pats</span>  
<a name="line-24"></a>                                            <span class='hs-layout'>,</span> <span class='hs-varid'>dfid_defn</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>defn</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-25"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pp_data_defn</span> <span class='hs-varid'>pp_hdr</span> <span class='hs-varid'>defn</span>
<a name="line-26"></a>  <span class='hs-keyword'>where</span>
<a name="line-27"></a>    <span class='hs-varid'>pp_hdr</span> <span class='hs-varid'>ctxt</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr_instance_keyword</span> <span class='hs-varid'>top_lvl</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>pp_fam_inst_lhs</span> <span class='hs-varid'>tycon</span> <span class='hs-varid'>pats</span> <span class='hs-varid'>ctxt</span>
<a name="line-28"></a>
<a name="line-29"></a><a name="pprDataFamInstFlavour"></a><span class='hs-definition'>pprDataFamInstFlavour</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>DataFamInstDecl</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-30"></a><span class='hs-definition'>pprDataFamInstFlavour</span> <span class='hs-layout'>(</span><span class='hs-conid'>DataFamInstDecl</span> <span class='hs-layout'>{</span> <span class='hs-varid'>dfid_defn</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsDataDefn</span> <span class='hs-layout'>{</span> <span class='hs-varid'>dd_ND</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>nd</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-31"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>nd</span>
<a name="line-32"></a>
<a name="line-33"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Outputable</span> <span class='hs-layout'>(</span><span class='hs-conid'>ClsInstDecl</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-34"></a>    <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>ClsInstDecl</span> <span class='hs-layout'>{</span> <span class='hs-varid'>cid_poly_ty</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>inst_ty</span><span class='hs-layout'>,</span> <span class='hs-varid'>cid_binds</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>binds</span>
<a name="line-35"></a>                     <span class='hs-layout'>,</span> <span class='hs-varid'>cid_sigs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sigs</span><span class='hs-layout'>,</span> <span class='hs-varid'>cid_tyfam_insts</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ats</span>
<a name="line-36"></a>                     <span class='hs-layout'>,</span> <span class='hs-varid'>cid_datafam_insts</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>adts</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-37"></a>      <span class='hs-keyglyph'>|</span> <span class='hs-varid'>null</span> <span class='hs-varid'>sigs</span><span class='hs-layout'>,</span> <span class='hs-varid'>null</span> <span class='hs-varid'>ats</span><span class='hs-layout'>,</span> <span class='hs-varid'>null</span> <span class='hs-varid'>adts</span><span class='hs-layout'>,</span> <span class='hs-varid'>isEmptyBag</span> <span class='hs-varid'>binds</span>  <span class='hs-comment'>-- No "where" part</span>
<a name="line-38"></a>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>top_matter</span>
<a name="line-39"></a>
<a name="line-40"></a>      <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>       <span class='hs-comment'>-- Laid out</span>
<a name="line-41"></a>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>vcat</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>top_matter</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"where"</span><span class='hs-layout'>)</span>
<a name="line-42"></a>             <span class='hs-layout'>,</span> <span class='hs-varid'>nest</span> <span class='hs-num'>2</span> <span class='hs-varop'>$</span> <span class='hs-varid'>pprDeclList</span> <span class='hs-varop'>$</span>
<a name="line-43"></a>               <span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-varid'>pprTyFamInstDecl</span> <span class='hs-conid'>NotTopLevel</span> <span class='hs-varop'>.</span> <span class='hs-varid'>unLoc</span><span class='hs-layout'>)</span>   <span class='hs-varid'>ats</span> <span class='hs-varop'>++</span>
<a name="line-44"></a>               <span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-varid'>pprDataFamInstDecl</span> <span class='hs-conid'>NotTopLevel</span> <span class='hs-varop'>.</span> <span class='hs-varid'>unLoc</span><span class='hs-layout'>)</span> <span class='hs-varid'>adts</span> <span class='hs-varop'>++</span>
<a name="line-45"></a>               <span class='hs-varid'>pprLHsBindsForUser</span> <span class='hs-varid'>binds</span> <span class='hs-varid'>sigs</span> <span class='hs-keyglyph'>]</span>
<a name="line-46"></a>      <span class='hs-keyword'>where</span>
<a name="line-47"></a>        <span class='hs-varid'>top_matter</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"instance"</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>inst_ty</span>
<a name="line-48"></a>
<a name="line-49"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Outputable</span> <span class='hs-layout'>(</span><span class='hs-conid'>InstDecl</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-50"></a>    <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>ClsInstD</span>     <span class='hs-layout'>{</span> <span class='hs-varid'>cid_inst</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>decl</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>decl</span>
<a name="line-51"></a>    <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>TyFamInstD</span>   <span class='hs-layout'>{</span> <span class='hs-varid'>tfid_inst</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>decl</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>decl</span>
<a name="line-52"></a>    <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>DataFamInstD</span> <span class='hs-layout'>{</span> <span class='hs-varid'>dfid_inst</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>decl</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>decl</span>
<a name="line-53"></a>
<a name="line-54"></a><span class='hs-comment'>-- Extract the declarations of associated data types from an instance</span>
<a name="line-55"></a>
<a name="line-56"></a><a name="instDeclDataFamInsts"></a><span class='hs-definition'>instDeclDataFamInsts</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LInstDecl</span> <span class='hs-varid'>name</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>DataFamInstDecl</span> <span class='hs-varid'>name</span><span class='hs-keyglyph'>]</span>
<a name="line-57"></a><span class='hs-definition'>instDeclDataFamInsts</span> <span class='hs-varid'>inst_decls</span> 
<a name="line-58"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>concatMap</span> <span class='hs-varid'>do_one</span> <span class='hs-varid'>inst_decls</span>
<a name="line-59"></a>  <span class='hs-keyword'>where</span>
<a name="line-60"></a>    <span class='hs-varid'>do_one</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>ClsInstD</span> <span class='hs-layout'>{</span> <span class='hs-varid'>cid_inst</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ClsInstDecl</span> <span class='hs-layout'>{</span> <span class='hs-varid'>cid_datafam_insts</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fam_insts</span> <span class='hs-layout'>}</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-61"></a>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>map</span> <span class='hs-varid'>unLoc</span> <span class='hs-varid'>fam_insts</span>
<a name="line-62"></a>    <span class='hs-varid'>do_one</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>DataFamInstD</span> <span class='hs-layout'>{</span> <span class='hs-varid'>dfid_inst</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fam_inst</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>      <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>fam_inst</span><span class='hs-keyglyph'>]</span>
<a name="line-63"></a>    <span class='hs-varid'>do_one</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>TyFamInstD</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>                              <span class='hs-keyglyph'>=</span> <span class='hs-conid'>[]</span>
</pre>\end{code}

%************************************************************************
%*                                                                      *
\subsection[DerivDecl]{A stand-alone instance deriving declaration}
%*                                                                      *
%************************************************************************

\begin{code}
<pre><a name="line-1"></a><a name="LDerivDecl"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LDerivDecl</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-conid'>DerivDecl</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>
<a name="line-2"></a>
<a name="line-3"></a><a name="DerivDecl"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>DerivDecl</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>DerivDecl</span> <span class='hs-layout'>{</span> <span class='hs-varid'>deriv_type</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LHsType</span> <span class='hs-varid'>name</span> <span class='hs-layout'>}</span>
<a name="line-4"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Data</span><span class='hs-layout'>,</span> <span class='hs-conid'>Typeable</span><span class='hs-layout'>)</span>
<a name="line-5"></a>
<a name="line-6"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Outputable</span> <span class='hs-layout'>(</span><span class='hs-conid'>DerivDecl</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-7"></a>    <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>DerivDecl</span> <span class='hs-varid'>ty</span><span class='hs-layout'>)</span> 
<a name="line-8"></a>        <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hsep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"deriving instance"</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>ty</span><span class='hs-keyglyph'>]</span>
</pre>\end{code}

%************************************************************************
%*                                                                      *
\subsection[DefaultDecl]{A @default@ declaration}
%*                                                                      *
%************************************************************************

There can only be one default declaration per module, but it is hard
for the parser to check that; we pass them all through in the abstract
syntax, and that restriction must be checked in the front end.

\begin{code}
<pre><a name="line-1"></a><a name="LDefaultDecl"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LDefaultDecl</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-conid'>DefaultDecl</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>
<a name="line-2"></a>
<a name="line-3"></a><a name="DefaultDecl"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>DefaultDecl</span> <span class='hs-varid'>name</span>
<a name="line-4"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>DefaultDecl</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LHsType</span> <span class='hs-varid'>name</span><span class='hs-keyglyph'>]</span>
<a name="line-5"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Data</span><span class='hs-layout'>,</span> <span class='hs-conid'>Typeable</span><span class='hs-layout'>)</span>
<a name="line-6"></a>
<a name="line-7"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>
<a name="line-8"></a>              <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Outputable</span> <span class='hs-layout'>(</span><span class='hs-conid'>DefaultDecl</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-9"></a>
<a name="line-10"></a>    <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>DefaultDecl</span> <span class='hs-varid'>tys</span><span class='hs-layout'>)</span>
<a name="line-11"></a>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"default"</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>parens</span> <span class='hs-layout'>(</span><span class='hs-varid'>interpp'SP</span> <span class='hs-varid'>tys</span><span class='hs-layout'>)</span>
</pre>\end{code}

%************************************************************************
%*                                                                      *
\subsection{Foreign function interface declaration}
%*                                                                      *
%************************************************************************

\begin{code}
<pre><a name="line-1"></a>
<a name="line-2"></a><a name="LForeignDecl"></a><span class='hs-comment'>-- foreign declarations are distinguished as to whether they define or use a</span>
<a name="line-3"></a><a name="LForeignDecl"></a><span class='hs-comment'>-- Haskell name</span>
<a name="line-4"></a><a name="LForeignDecl"></a><span class='hs-comment'>--</span>
<a name="line-5"></a><a name="LForeignDecl"></a><span class='hs-comment'>--  * the Boolean value indicates whether the pre-standard deprecated syntax</span>
<a name="line-6"></a><a name="LForeignDecl"></a><span class='hs-comment'>--   has been used</span>
<a name="line-7"></a><a name="LForeignDecl"></a><span class='hs-comment'>--</span>
<a name="line-8"></a><a name="LForeignDecl"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LForeignDecl</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-conid'>ForeignDecl</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>
<a name="line-9"></a>
<a name="line-10"></a><a name="ForeignDecl"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>ForeignDecl</span> <span class='hs-varid'>name</span>
<a name="line-11"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ForeignImport</span> <span class='hs-layout'>(</span><span class='hs-conid'>Located</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- defines this name</span>
<a name="line-12"></a>                  <span class='hs-layout'>(</span><span class='hs-conid'>LHsType</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- sig_ty</span>
<a name="line-13"></a>                  <span class='hs-conid'>Coercion</span>       <span class='hs-comment'>-- rep_ty ~ sig_ty</span>
<a name="line-14"></a>                  <span class='hs-conid'>ForeignImport</span>
<a name="line-15"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ForeignExport</span> <span class='hs-layout'>(</span><span class='hs-conid'>Located</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- uses this name</span>
<a name="line-16"></a>                  <span class='hs-layout'>(</span><span class='hs-conid'>LHsType</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- sig_ty</span>
<a name="line-17"></a>                  <span class='hs-conid'>Coercion</span>       <span class='hs-comment'>-- sig_ty ~ rep_ty</span>
<a name="line-18"></a>                  <span class='hs-conid'>ForeignExport</span>
<a name="line-19"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Data</span><span class='hs-layout'>,</span> <span class='hs-conid'>Typeable</span><span class='hs-layout'>)</span>
<a name="line-20"></a><span class='hs-comment'>{-
<a name="line-21"></a>    In both ForeignImport and ForeignExport:
<a name="line-22"></a>        sig_ty is the type given in the Haskell code
<a name="line-23"></a>        rep_ty is the representation for this type, i.e. with newtypes
<a name="line-24"></a>               coerced away and type functions evaluated.
<a name="line-25"></a>    Thus if the declaration is valid, then rep_ty will only use types
<a name="line-26"></a>    such as Int and IO that we know how to make foreign calls with.
<a name="line-27"></a>-}</span>
<a name="line-28"></a>
<a name="line-29"></a><a name="noForeignImportCoercionYet"></a><span class='hs-definition'>noForeignImportCoercionYet</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Coercion</span>
<a name="line-30"></a><span class='hs-definition'>noForeignImportCoercionYet</span>
<a name="line-31"></a>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>panic</span> <span class='hs-str'>"ForeignImport coercion evaluated before typechecking"</span>
<a name="line-32"></a>
<a name="line-33"></a><a name="noForeignExportCoercionYet"></a><span class='hs-definition'>noForeignExportCoercionYet</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Coercion</span>
<a name="line-34"></a><span class='hs-definition'>noForeignExportCoercionYet</span>
<a name="line-35"></a>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>panic</span> <span class='hs-str'>"ForeignExport coercion evaluated before typechecking"</span>
<a name="line-36"></a>
<a name="line-37"></a><a name="ForeignImport"></a><span class='hs-comment'>-- Specification Of an imported external entity in dependence on the calling</span>
<a name="line-38"></a><a name="ForeignImport"></a><span class='hs-comment'>-- convention </span>
<a name="line-39"></a><a name="ForeignImport"></a><span class='hs-comment'>--</span>
<a name="line-40"></a><a name="ForeignImport"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>ForeignImport</span> <span class='hs-keyglyph'>=</span> <span class='hs-comment'>-- import of a C entity</span>
<a name="line-41"></a>                     <span class='hs-comment'>--</span>
<a name="line-42"></a>                     <span class='hs-comment'>--  * the two strings specifying a header file or library</span>
<a name="line-43"></a>                     <span class='hs-comment'>--   may be empty, which indicates the absence of a</span>
<a name="line-44"></a>                     <span class='hs-comment'>--   header or object specification (both are not used</span>
<a name="line-45"></a>                     <span class='hs-comment'>--   in the case of `CWrapper' and when `CFunction'</span>
<a name="line-46"></a>                     <span class='hs-comment'>--   has a dynamic target)</span>
<a name="line-47"></a>                     <span class='hs-comment'>--</span>
<a name="line-48"></a>                     <span class='hs-comment'>--  * the calling convention is irrelevant for code</span>
<a name="line-49"></a>                     <span class='hs-comment'>--   generation in the case of `CLabel', but is needed</span>
<a name="line-50"></a>                     <span class='hs-comment'>--   for pretty printing </span>
<a name="line-51"></a>                     <span class='hs-comment'>--</span>
<a name="line-52"></a>                     <span class='hs-comment'>--  * `Safety' is irrelevant for `CLabel' and `CWrapper'</span>
<a name="line-53"></a>                     <span class='hs-comment'>--</span>
<a name="line-54"></a>                     <span class='hs-conid'>CImport</span>  <span class='hs-conid'>CCallConv</span>       <span class='hs-comment'>-- ccall or stdcall</span>
<a name="line-55"></a>                              <span class='hs-conid'>Safety</span>          <span class='hs-comment'>-- interruptible, safe or unsafe</span>
<a name="line-56"></a>                              <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-conid'>Header</span><span class='hs-layout'>)</span>  <span class='hs-comment'>-- name of C header</span>
<a name="line-57"></a>                              <span class='hs-conid'>CImportSpec</span>     <span class='hs-comment'>-- details of the C entity</span>
<a name="line-58"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Data</span><span class='hs-layout'>,</span> <span class='hs-conid'>Typeable</span><span class='hs-layout'>)</span>
<a name="line-59"></a>
<a name="line-60"></a><a name="CImportSpec"></a><span class='hs-comment'>-- details of an external C entity</span>
<a name="line-61"></a><a name="CImportSpec"></a><span class='hs-comment'>--</span>
<a name="line-62"></a><a name="CImportSpec"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>CImportSpec</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>CLabel</span>    <span class='hs-conid'>CLabelString</span>     <span class='hs-comment'>-- import address of a C label</span>
<a name="line-63"></a>                 <span class='hs-keyglyph'>|</span> <span class='hs-conid'>CFunction</span> <span class='hs-conid'>CCallTarget</span>      <span class='hs-comment'>-- static or dynamic function</span>
<a name="line-64"></a>                 <span class='hs-keyglyph'>|</span> <span class='hs-conid'>CWrapper</span>                   <span class='hs-comment'>-- wrapper to expose closures</span>
<a name="line-65"></a>                                              <span class='hs-comment'>-- (former f.e.d.)</span>
<a name="line-66"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Data</span><span class='hs-layout'>,</span> <span class='hs-conid'>Typeable</span><span class='hs-layout'>)</span>
<a name="line-67"></a>
<a name="line-68"></a><a name="ForeignExport"></a><span class='hs-comment'>-- specification of an externally exported entity in dependence on the calling</span>
<a name="line-69"></a><a name="ForeignExport"></a><span class='hs-comment'>-- convention</span>
<a name="line-70"></a><a name="ForeignExport"></a><span class='hs-comment'>--</span>
<a name="line-71"></a><a name="ForeignExport"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>ForeignExport</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>CExport</span>  <span class='hs-conid'>CExportSpec</span>    <span class='hs-comment'>-- contains the calling convention</span>
<a name="line-72"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Data</span><span class='hs-layout'>,</span> <span class='hs-conid'>Typeable</span><span class='hs-layout'>)</span>
<a name="line-73"></a>
<a name="line-74"></a><span class='hs-comment'>-- pretty printing of foreign declarations</span>
<a name="line-75"></a><span class='hs-comment'>--</span>
<a name="line-76"></a>
<a name="line-77"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Outputable</span> <span class='hs-layout'>(</span><span class='hs-conid'>ForeignDecl</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-78"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>ForeignImport</span> <span class='hs-varid'>n</span> <span class='hs-varid'>ty</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>fimport</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-79"></a>    <span class='hs-varid'>hang</span> <span class='hs-layout'>(</span><span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"foreign import"</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>fimport</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span>
<a name="line-80"></a>       <span class='hs-num'>2</span> <span class='hs-layout'>(</span><span class='hs-varid'>dcolon</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>ty</span><span class='hs-layout'>)</span>
<a name="line-81"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>ForeignExport</span> <span class='hs-varid'>n</span> <span class='hs-varid'>ty</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>fexport</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-82"></a>    <span class='hs-varid'>hang</span> <span class='hs-layout'>(</span><span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"foreign export"</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>fexport</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span>
<a name="line-83"></a>       <span class='hs-num'>2</span> <span class='hs-layout'>(</span><span class='hs-varid'>dcolon</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>ty</span><span class='hs-layout'>)</span>
<a name="line-84"></a>
<a name="line-85"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Outputable</span> <span class='hs-conid'>ForeignImport</span> <span class='hs-keyword'>where</span>
<a name="line-86"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>CImport</span>  <span class='hs-varid'>cconv</span> <span class='hs-varid'>safety</span> <span class='hs-varid'>mHeader</span> <span class='hs-varid'>spec</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-87"></a>    <span class='hs-varid'>ppr</span> <span class='hs-varid'>cconv</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>safety</span> <span class='hs-varop'>&lt;+&gt;</span> 
<a name="line-88"></a>    <span class='hs-varid'>char</span> <span class='hs-chr'>'"'</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>pprCEntity</span> <span class='hs-varid'>spec</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'"'</span>
<a name="line-89"></a>    <span class='hs-keyword'>where</span>
<a name="line-90"></a>      <span class='hs-varid'>pp_hdr</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>mHeader</span> <span class='hs-keyword'>of</span>
<a name="line-91"></a>               <span class='hs-conid'>Nothing</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>empty</span>
<a name="line-92"></a>               <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-conid'>Header</span> <span class='hs-varid'>header</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>ftext</span> <span class='hs-varid'>header</span>
<a name="line-93"></a>
<a name="line-94"></a>      <span class='hs-varid'>pprCEntity</span> <span class='hs-layout'>(</span><span class='hs-conid'>CLabel</span> <span class='hs-varid'>lbl</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> 
<a name="line-95"></a>        <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"static"</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>pp_hdr</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'&amp;'</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>lbl</span>
<a name="line-96"></a>      <span class='hs-varid'>pprCEntity</span> <span class='hs-layout'>(</span><span class='hs-conid'>CFunction</span> <span class='hs-layout'>(</span><span class='hs-conid'>StaticTarget</span> <span class='hs-varid'>lbl</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>isFun</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> 
<a name="line-97"></a>            <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"static"</span><span class='hs-layout'>)</span>
<a name="line-98"></a>        <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>pp_hdr</span>
<a name="line-99"></a>        <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-layout'>(</span><span class='hs-keyword'>if</span> <span class='hs-varid'>isFun</span> <span class='hs-keyword'>then</span> <span class='hs-varid'>empty</span> <span class='hs-keyword'>else</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"value"</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-100"></a>        <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>lbl</span>
<a name="line-101"></a>      <span class='hs-varid'>pprCEntity</span> <span class='hs-layout'>(</span><span class='hs-conid'>CFunction</span> <span class='hs-layout'>(</span><span class='hs-conid'>DynamicTarget</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-102"></a>        <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"dynamic"</span><span class='hs-layout'>)</span>
<a name="line-103"></a>      <span class='hs-varid'>pprCEntity</span> <span class='hs-layout'>(</span><span class='hs-conid'>CWrapper</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"wrapper"</span><span class='hs-layout'>)</span>
<a name="line-104"></a>
<a name="line-105"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Outputable</span> <span class='hs-conid'>ForeignExport</span> <span class='hs-keyword'>where</span>
<a name="line-106"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>CExport</span>  <span class='hs-layout'>(</span><span class='hs-conid'>CExportStatic</span> <span class='hs-varid'>lbl</span> <span class='hs-varid'>cconv</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> 
<a name="line-107"></a>    <span class='hs-varid'>ppr</span> <span class='hs-varid'>cconv</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'"'</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>lbl</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'"'</span>
</pre>\end{code}


%************************************************************************
%*                                                                      *
\subsection{Transformation rules}
%*                                                                      *
%************************************************************************

\begin{code}
<pre><a name="line-1"></a><a name="LRuleDecl"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LRuleDecl</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-conid'>RuleDecl</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>
<a name="line-2"></a>
<a name="line-3"></a><a name="RuleDecl"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>RuleDecl</span> <span class='hs-varid'>name</span>
<a name="line-4"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HsRule</span>                      <span class='hs-comment'>-- Source rule</span>
<a name="line-5"></a>        <span class='hs-conid'>RuleName</span>                <span class='hs-comment'>-- Rule name</span>
<a name="line-6"></a>        <span class='hs-conid'>Activation</span>
<a name="line-7"></a>        <span class='hs-keyglyph'>[</span><span class='hs-conid'>RuleBndr</span> <span class='hs-varid'>name</span><span class='hs-keyglyph'>]</span>         <span class='hs-comment'>-- Forall'd vars; after typechecking this includes tyvars</span>
<a name="line-8"></a>        <span class='hs-layout'>(</span><span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsExpr</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- LHS</span>
<a name="line-9"></a>        <span class='hs-conid'>NameSet</span>                 <span class='hs-comment'>-- Free-vars from the LHS</span>
<a name="line-10"></a>        <span class='hs-layout'>(</span><span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsExpr</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- RHS</span>
<a name="line-11"></a>        <span class='hs-conid'>NameSet</span>                 <span class='hs-comment'>-- Free-vars from the RHS</span>
<a name="line-12"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Data</span><span class='hs-layout'>,</span> <span class='hs-conid'>Typeable</span><span class='hs-layout'>)</span>
<a name="line-13"></a>
<a name="line-14"></a><a name="RuleBndr"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>RuleBndr</span> <span class='hs-varid'>name</span>
<a name="line-15"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>RuleBndr</span> <span class='hs-layout'>(</span><span class='hs-conid'>Located</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>
<a name="line-16"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>RuleBndrSig</span> <span class='hs-layout'>(</span><span class='hs-conid'>Located</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsWithBndrs</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsType</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-17"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Data</span><span class='hs-layout'>,</span> <span class='hs-conid'>Typeable</span><span class='hs-layout'>)</span>
<a name="line-18"></a>
<a name="line-19"></a><a name="collectRuleBndrSigTys"></a><span class='hs-definition'>collectRuleBndrSigTys</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>RuleBndr</span> <span class='hs-varid'>name</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>HsWithBndrs</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsType</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-20"></a><span class='hs-definition'>collectRuleBndrSigTys</span> <span class='hs-varid'>bndrs</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>ty</span> <span class='hs-keyglyph'>|</span> <span class='hs-conid'>RuleBndrSig</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>ty</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>bndrs</span><span class='hs-keyglyph'>]</span>
<a name="line-21"></a>
<a name="line-22"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Outputable</span> <span class='hs-layout'>(</span><span class='hs-conid'>RuleDecl</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-23"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsRule</span> <span class='hs-varid'>name</span> <span class='hs-varid'>act</span> <span class='hs-varid'>ns</span> <span class='hs-varid'>lhs</span> <span class='hs-sel'>_fv_lhs</span> <span class='hs-varid'>rhs</span> <span class='hs-sel'>_fv_rhs</span><span class='hs-layout'>)</span>
<a name="line-24"></a>        <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>text</span> <span class='hs-str'>"{-# RULES"</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>doubleQuotes</span> <span class='hs-layout'>(</span><span class='hs-varid'>ftext</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>act</span><span class='hs-layout'>,</span>
<a name="line-25"></a>               <span class='hs-varid'>nest</span> <span class='hs-num'>4</span> <span class='hs-layout'>(</span><span class='hs-varid'>pp_forall</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>pprExpr</span> <span class='hs-layout'>(</span><span class='hs-varid'>unLoc</span> <span class='hs-varid'>lhs</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> 
<a name="line-26"></a>               <span class='hs-varid'>nest</span> <span class='hs-num'>4</span> <span class='hs-layout'>(</span><span class='hs-varid'>equals</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>pprExpr</span> <span class='hs-layout'>(</span><span class='hs-varid'>unLoc</span> <span class='hs-varid'>rhs</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>text</span> <span class='hs-str'>"#-}"</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>]</span>
<a name="line-27"></a>        <span class='hs-keyword'>where</span>
<a name="line-28"></a>          <span class='hs-varid'>pp_forall</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>null</span> <span class='hs-varid'>ns</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>empty</span>
<a name="line-29"></a>                    <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"forall"</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>fsep</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>ns</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>dot</span>
<a name="line-30"></a>
<a name="line-31"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Outputable</span> <span class='hs-layout'>(</span><span class='hs-conid'>RuleBndr</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-32"></a>   <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>RuleBndr</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>name</span>
<a name="line-33"></a>   <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>RuleBndrSig</span> <span class='hs-varid'>name</span> <span class='hs-varid'>ty</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>name</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>dcolon</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>ty</span>
</pre>\end{code}


%************************************************************************
%*                                                                      *
\subsection{Vectorisation declarations}
%*                                                                      *
%************************************************************************

A vectorisation pragma, one of

  {-# VECTORISE f = closure1 g (scalar_map g) #-}
  {-# VECTORISE SCALAR f #-}
  {-# NOVECTORISE f #-}

  {-# VECTORISE type T = ty #-}
  {-# VECTORISE SCALAR type T #-}
  
\begin{code}
<pre><a name="line-1"></a><a name="LVectDecl"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LVectDecl</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-conid'>VectDecl</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>
<a name="line-2"></a>
<a name="line-3"></a><a name="VectDecl"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>VectDecl</span> <span class='hs-varid'>name</span>
<a name="line-4"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HsVect</span>
<a name="line-5"></a>      <span class='hs-layout'>(</span><span class='hs-conid'>Located</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>
<a name="line-6"></a>      <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>
<a name="line-7"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsNoVect</span>
<a name="line-8"></a>      <span class='hs-layout'>(</span><span class='hs-conid'>Located</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>
<a name="line-9"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsVectTypeIn</span>                <span class='hs-comment'>-- pre type-checking</span>
<a name="line-10"></a>      <span class='hs-conid'>Bool</span>                      <span class='hs-comment'>-- 'TRUE' =&gt; SCALAR declaration</span>
<a name="line-11"></a>      <span class='hs-layout'>(</span><span class='hs-conid'>Located</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>
<a name="line-12"></a>      <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>Located</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>    <span class='hs-comment'>-- 'Nothing' =&gt; no right-hand side</span>
<a name="line-13"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsVectTypeOut</span>               <span class='hs-comment'>-- post type-checking</span>
<a name="line-14"></a>      <span class='hs-conid'>Bool</span>                      <span class='hs-comment'>-- 'TRUE' =&gt; SCALAR declaration</span>
<a name="line-15"></a>      <span class='hs-conid'>TyCon</span>
<a name="line-16"></a>      <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-conid'>TyCon</span><span class='hs-layout'>)</span>             <span class='hs-comment'>-- 'Nothing' =&gt; no right-hand side</span>
<a name="line-17"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsVectClassIn</span>               <span class='hs-comment'>-- pre type-checking</span>
<a name="line-18"></a>      <span class='hs-layout'>(</span><span class='hs-conid'>Located</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>
<a name="line-19"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsVectClassOut</span>              <span class='hs-comment'>-- post type-checking</span>
<a name="line-20"></a>      <span class='hs-conid'>Class</span>
<a name="line-21"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsVectInstIn</span>                <span class='hs-comment'>-- pre type-checking (always SCALAR)  !!!FIXME: should be superfluous now</span>
<a name="line-22"></a>      <span class='hs-layout'>(</span><span class='hs-conid'>LHsType</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>
<a name="line-23"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsVectInstOut</span>               <span class='hs-comment'>-- post type-checking (always SCALAR) !!!FIXME: should be superfluous now</span>
<a name="line-24"></a>      <span class='hs-conid'>ClsInst</span>
<a name="line-25"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Data</span><span class='hs-layout'>,</span> <span class='hs-conid'>Typeable</span><span class='hs-layout'>)</span>
<a name="line-26"></a>
<a name="line-27"></a><a name="lvectDeclName"></a><span class='hs-definition'>lvectDeclName</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>NamedThing</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>LVectDecl</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Name</span>
<a name="line-28"></a><span class='hs-definition'>lvectDeclName</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsVect</span>         <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getName</span> <span class='hs-varid'>name</span>
<a name="line-29"></a><span class='hs-definition'>lvectDeclName</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsNoVect</span>       <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getName</span> <span class='hs-varid'>name</span>
<a name="line-30"></a><span class='hs-definition'>lvectDeclName</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsVectTypeIn</span>   <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getName</span> <span class='hs-varid'>name</span>
<a name="line-31"></a><span class='hs-definition'>lvectDeclName</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsVectTypeOut</span>  <span class='hs-keyword'>_</span> <span class='hs-varid'>tycon</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getName</span> <span class='hs-varid'>tycon</span>
<a name="line-32"></a><span class='hs-definition'>lvectDeclName</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsVectClassIn</span>  <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getName</span> <span class='hs-varid'>name</span>
<a name="line-33"></a><span class='hs-definition'>lvectDeclName</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsVectClassOut</span> <span class='hs-varid'>cls</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>            <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getName</span> <span class='hs-varid'>cls</span>
<a name="line-34"></a><span class='hs-definition'>lvectDeclName</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsVectInstIn</span>   <span class='hs-keyword'>_</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>              <span class='hs-keyglyph'>=</span> <span class='hs-varid'>panic</span> <span class='hs-str'>"HsDecls.lvectDeclName: HsVectInstIn"</span>
<a name="line-35"></a><span class='hs-definition'>lvectDeclName</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsVectInstOut</span>  <span class='hs-keyword'>_</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>              <span class='hs-keyglyph'>=</span> <span class='hs-varid'>panic</span> <span class='hs-str'>"HsDecls.lvectDeclName: HsVectInstOut"</span>
<a name="line-36"></a>
<a name="line-37"></a><a name="lvectInstDecl"></a><span class='hs-definition'>lvectInstDecl</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LVectDecl</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-38"></a><span class='hs-definition'>lvectInstDecl</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsVectInstIn</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-39"></a><span class='hs-definition'>lvectInstDecl</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsVectInstOut</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-40"></a><span class='hs-definition'>lvectInstDecl</span> <span class='hs-keyword'>_</span>                       <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-41"></a>
<a name="line-42"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Outputable</span> <span class='hs-layout'>(</span><span class='hs-conid'>VectDecl</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-43"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsVect</span> <span class='hs-varid'>v</span> <span class='hs-varid'>rhs</span><span class='hs-layout'>)</span>
<a name="line-44"></a>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>text</span> <span class='hs-str'>"{-# VECTORISE"</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>v</span><span class='hs-layout'>,</span>
<a name="line-45"></a>           <span class='hs-varid'>nest</span> <span class='hs-num'>4</span> <span class='hs-varop'>$</span> 
<a name="line-46"></a>             <span class='hs-varid'>pprExpr</span> <span class='hs-layout'>(</span><span class='hs-varid'>unLoc</span> <span class='hs-varid'>rhs</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>text</span> <span class='hs-str'>"#-}"</span> <span class='hs-keyglyph'>]</span>
<a name="line-47"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsNoVect</span> <span class='hs-varid'>v</span><span class='hs-layout'>)</span>
<a name="line-48"></a>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>text</span> <span class='hs-str'>"{-# NOVECTORISE"</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>v</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>text</span> <span class='hs-str'>"#-}"</span> <span class='hs-keyglyph'>]</span>
<a name="line-49"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsVectTypeIn</span> <span class='hs-conid'>False</span> <span class='hs-varid'>t</span> <span class='hs-conid'>Nothing</span><span class='hs-layout'>)</span>
<a name="line-50"></a>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>text</span> <span class='hs-str'>"{-# VECTORISE type"</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>t</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>text</span> <span class='hs-str'>"#-}"</span> <span class='hs-keyglyph'>]</span>
<a name="line-51"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsVectTypeIn</span> <span class='hs-conid'>False</span> <span class='hs-varid'>t</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-varid'>t'</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-52"></a>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>text</span> <span class='hs-str'>"{-# VECTORISE type"</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>t</span><span class='hs-layout'>,</span> <span class='hs-varid'>text</span> <span class='hs-str'>"="</span><span class='hs-layout'>,</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>t'</span><span class='hs-layout'>,</span> <span class='hs-varid'>text</span> <span class='hs-str'>"#-}"</span> <span class='hs-keyglyph'>]</span>
<a name="line-53"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsVectTypeIn</span> <span class='hs-conid'>True</span> <span class='hs-varid'>t</span> <span class='hs-conid'>Nothing</span><span class='hs-layout'>)</span>
<a name="line-54"></a>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>text</span> <span class='hs-str'>"{-# VECTORISE SCALAR type"</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>t</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>text</span> <span class='hs-str'>"#-}"</span> <span class='hs-keyglyph'>]</span>
<a name="line-55"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsVectTypeIn</span> <span class='hs-conid'>True</span> <span class='hs-varid'>t</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-varid'>t'</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-56"></a>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>text</span> <span class='hs-str'>"{-# VECTORISE SCALAR type"</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>t</span><span class='hs-layout'>,</span> <span class='hs-varid'>text</span> <span class='hs-str'>"="</span><span class='hs-layout'>,</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>t'</span><span class='hs-layout'>,</span> <span class='hs-varid'>text</span> <span class='hs-str'>"#-}"</span> <span class='hs-keyglyph'>]</span>
<a name="line-57"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsVectTypeOut</span> <span class='hs-conid'>False</span> <span class='hs-varid'>t</span> <span class='hs-conid'>Nothing</span><span class='hs-layout'>)</span>
<a name="line-58"></a>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>text</span> <span class='hs-str'>"{-# VECTORISE type"</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>t</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>text</span> <span class='hs-str'>"#-}"</span> <span class='hs-keyglyph'>]</span>
<a name="line-59"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsVectTypeOut</span> <span class='hs-conid'>False</span> <span class='hs-varid'>t</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-varid'>t'</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-60"></a>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>text</span> <span class='hs-str'>"{-# VECTORISE type"</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>t</span><span class='hs-layout'>,</span> <span class='hs-varid'>text</span> <span class='hs-str'>"="</span><span class='hs-layout'>,</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>t'</span><span class='hs-layout'>,</span> <span class='hs-varid'>text</span> <span class='hs-str'>"#-}"</span> <span class='hs-keyglyph'>]</span>
<a name="line-61"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsVectTypeOut</span> <span class='hs-conid'>True</span> <span class='hs-varid'>t</span> <span class='hs-conid'>Nothing</span><span class='hs-layout'>)</span>
<a name="line-62"></a>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>text</span> <span class='hs-str'>"{-# VECTORISE SCALAR type"</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>t</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>text</span> <span class='hs-str'>"#-}"</span> <span class='hs-keyglyph'>]</span>
<a name="line-63"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsVectTypeOut</span> <span class='hs-conid'>True</span> <span class='hs-varid'>t</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-varid'>t'</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-64"></a>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>text</span> <span class='hs-str'>"{-# VECTORISE SCALAR type"</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>t</span><span class='hs-layout'>,</span> <span class='hs-varid'>text</span> <span class='hs-str'>"="</span><span class='hs-layout'>,</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>t'</span><span class='hs-layout'>,</span> <span class='hs-varid'>text</span> <span class='hs-str'>"#-}"</span> <span class='hs-keyglyph'>]</span>
<a name="line-65"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsVectClassIn</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span>
<a name="line-66"></a>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>text</span> <span class='hs-str'>"{-# VECTORISE class"</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>c</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>text</span> <span class='hs-str'>"#-}"</span> <span class='hs-keyglyph'>]</span>
<a name="line-67"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsVectClassOut</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span>
<a name="line-68"></a>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>text</span> <span class='hs-str'>"{-# VECTORISE class"</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>c</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>text</span> <span class='hs-str'>"#-}"</span> <span class='hs-keyglyph'>]</span>
<a name="line-69"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsVectInstIn</span> <span class='hs-varid'>ty</span><span class='hs-layout'>)</span>
<a name="line-70"></a>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>text</span> <span class='hs-str'>"{-# VECTORISE SCALAR instance"</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>ty</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>text</span> <span class='hs-str'>"#-}"</span> <span class='hs-keyglyph'>]</span>
<a name="line-71"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsVectInstOut</span> <span class='hs-varid'>i</span><span class='hs-layout'>)</span>
<a name="line-72"></a>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>text</span> <span class='hs-str'>"{-# VECTORISE SCALAR instance"</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>i</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>text</span> <span class='hs-str'>"#-}"</span> <span class='hs-keyglyph'>]</span>
</pre>\end{code}

%************************************************************************
%*                                                                      *
\subsection[DocDecl]{Document comments}
%*                                                                      *
%************************************************************************

\begin{code}
<pre><a name="line-1"></a>
<a name="line-2"></a><a name="LDocDecl"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LDocDecl</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-conid'>DocDecl</span><span class='hs-layout'>)</span>
<a name="line-3"></a>
<a name="line-4"></a><a name="DocDecl"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>DocDecl</span>
<a name="line-5"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>DocCommentNext</span> <span class='hs-conid'>HsDocString</span>
<a name="line-6"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>DocCommentPrev</span> <span class='hs-conid'>HsDocString</span>
<a name="line-7"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>DocCommentNamed</span> <span class='hs-conid'>String</span> <span class='hs-conid'>HsDocString</span>
<a name="line-8"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>DocGroup</span> <span class='hs-conid'>Int</span> <span class='hs-conid'>HsDocString</span>
<a name="line-9"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Data</span><span class='hs-layout'>,</span> <span class='hs-conid'>Typeable</span><span class='hs-layout'>)</span>
<a name="line-10"></a> 
<a name="line-11"></a><span class='hs-comment'>-- Okay, I need to reconstruct the document comments, but for now:</span>
<a name="line-12"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Outputable</span> <span class='hs-conid'>DocDecl</span> <span class='hs-keyword'>where</span>
<a name="line-13"></a>  <span class='hs-varid'>ppr</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"&lt;document comment&gt;"</span>
<a name="line-14"></a>
<a name="line-15"></a><a name="docDeclDoc"></a><span class='hs-definition'>docDeclDoc</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>DocDecl</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HsDocString</span>
<a name="line-16"></a><span class='hs-definition'>docDeclDoc</span> <span class='hs-layout'>(</span><span class='hs-conid'>DocCommentNext</span> <span class='hs-varid'>d</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>d</span>
<a name="line-17"></a><span class='hs-definition'>docDeclDoc</span> <span class='hs-layout'>(</span><span class='hs-conid'>DocCommentPrev</span> <span class='hs-varid'>d</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>d</span>
<a name="line-18"></a><span class='hs-definition'>docDeclDoc</span> <span class='hs-layout'>(</span><span class='hs-conid'>DocCommentNamed</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>d</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>d</span>
<a name="line-19"></a><span class='hs-definition'>docDeclDoc</span> <span class='hs-layout'>(</span><span class='hs-conid'>DocGroup</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>d</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>d</span>
<a name="line-20"></a>
</pre>\end{code}

%************************************************************************
%*                                                                      *
\subsection[DeprecDecl]{Deprecations}
%*                                                                      *
%************************************************************************

We use exported entities for things to deprecate.

\begin{code}
<pre><a name="line-1"></a><a name="LWarnDecl"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LWarnDecl</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-conid'>WarnDecl</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>
<a name="line-2"></a>
<a name="line-3"></a><a name="WarnDecl"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>WarnDecl</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Warning</span> <span class='hs-varid'>name</span> <span class='hs-conid'>WarningTxt</span>
<a name="line-4"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Data</span><span class='hs-layout'>,</span> <span class='hs-conid'>Typeable</span><span class='hs-layout'>)</span>
<a name="line-5"></a>
<a name="line-6"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Outputable</span> <span class='hs-layout'>(</span><span class='hs-conid'>WarnDecl</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-7"></a>    <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>Warning</span> <span class='hs-varid'>thing</span> <span class='hs-varid'>txt</span><span class='hs-layout'>)</span>
<a name="line-8"></a>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hsep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>text</span> <span class='hs-str'>"{-# DEPRECATED"</span><span class='hs-layout'>,</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>thing</span><span class='hs-layout'>,</span> <span class='hs-varid'>doubleQuotes</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>txt</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>text</span> <span class='hs-str'>"#-}"</span><span class='hs-keyglyph'>]</span>
</pre>\end{code}

%************************************************************************
%*                                                                      *
\subsection[AnnDecl]{Annotations}
%*                                                                      *
%************************************************************************

\begin{code}
<pre><a name="line-1"></a><a name="LAnnDecl"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LAnnDecl</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-conid'>AnnDecl</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>
<a name="line-2"></a>
<a name="line-3"></a><a name="AnnDecl"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>AnnDecl</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HsAnnotation</span> <span class='hs-layout'>(</span><span class='hs-conid'>AnnProvenance</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsExpr</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-4"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Data</span><span class='hs-layout'>,</span> <span class='hs-conid'>Typeable</span><span class='hs-layout'>)</span>
<a name="line-5"></a>
<a name="line-6"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Outputable</span> <span class='hs-layout'>(</span><span class='hs-conid'>AnnDecl</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-7"></a>    <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsAnnotation</span> <span class='hs-varid'>provenance</span> <span class='hs-varid'>expr</span><span class='hs-layout'>)</span> 
<a name="line-8"></a>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hsep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>text</span> <span class='hs-str'>"{-#"</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprAnnProvenance</span> <span class='hs-varid'>provenance</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprExpr</span> <span class='hs-layout'>(</span><span class='hs-varid'>unLoc</span> <span class='hs-varid'>expr</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>text</span> <span class='hs-str'>"#-}"</span><span class='hs-keyglyph'>]</span>
<a name="line-9"></a>
<a name="line-10"></a>
<a name="line-11"></a><a name="AnnProvenance"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>AnnProvenance</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ValueAnnProvenance</span> <span class='hs-varid'>name</span>
<a name="line-12"></a>                        <span class='hs-keyglyph'>|</span> <span class='hs-conid'>TypeAnnProvenance</span> <span class='hs-varid'>name</span>
<a name="line-13"></a>                        <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ModuleAnnProvenance</span>
<a name="line-14"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Data</span><span class='hs-layout'>,</span> <span class='hs-conid'>Typeable</span><span class='hs-layout'>,</span> <span class='hs-conid'>Functor</span><span class='hs-layout'>,</span> <span class='hs-conid'>Foldable</span><span class='hs-layout'>,</span> <span class='hs-conid'>Traversable</span><span class='hs-layout'>)</span>
<a name="line-15"></a>
<a name="line-16"></a><a name="annProvenanceName_maybe"></a><span class='hs-definition'>annProvenanceName_maybe</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>AnnProvenance</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-varid'>name</span>
<a name="line-17"></a><span class='hs-definition'>annProvenanceName_maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>ValueAnnProvenance</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>name</span>
<a name="line-18"></a><span class='hs-definition'>annProvenanceName_maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>TypeAnnProvenance</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>name</span>
<a name="line-19"></a><span class='hs-definition'>annProvenanceName_maybe</span> <span class='hs-conid'>ModuleAnnProvenance</span>       <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-20"></a>
<a name="line-21"></a><a name="pprAnnProvenance"></a><span class='hs-definition'>pprAnnProvenance</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>AnnProvenance</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-22"></a><span class='hs-definition'>pprAnnProvenance</span> <span class='hs-conid'>ModuleAnnProvenance</span>       <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"ANN module"</span><span class='hs-layout'>)</span>
<a name="line-23"></a><span class='hs-definition'>pprAnnProvenance</span> <span class='hs-layout'>(</span><span class='hs-conid'>ValueAnnProvenance</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"ANN"</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>name</span>
<a name="line-24"></a><span class='hs-definition'>pprAnnProvenance</span> <span class='hs-layout'>(</span><span class='hs-conid'>TypeAnnProvenance</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"ANN type"</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>name</span>
</pre>\end{code}

%************************************************************************
%*                                                                      *
\subsection[RoleAnnot]{Role annotations}
%*                                                                      *
%************************************************************************

\begin{code}
<pre><a name="line-1"></a><a name="LRoleAnnotDecl"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LRoleAnnotDecl</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-conid'>RoleAnnotDecl</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>
<a name="line-2"></a>
<a name="line-3"></a><a name="RoleAnnotDecl"></a><span class='hs-comment'>-- See #8185 for more info about why role annotations are</span>
<a name="line-4"></a><a name="RoleAnnotDecl"></a><span class='hs-comment'>-- top-level declarations</span>
<a name="line-5"></a><a name="RoleAnnotDecl"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>RoleAnnotDecl</span> <span class='hs-varid'>name</span>
<a name="line-6"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>RoleAnnotDecl</span> <span class='hs-layout'>(</span><span class='hs-conid'>Located</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>         <span class='hs-comment'>-- type constructor</span>
<a name="line-7"></a>                  <span class='hs-keyglyph'>[</span><span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-conid'>Role</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span> <span class='hs-comment'>-- optional annotations</span>
<a name="line-8"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Data</span><span class='hs-layout'>,</span> <span class='hs-conid'>Typeable</span><span class='hs-layout'>)</span>
<a name="line-9"></a>
<a name="line-10"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Outputable</span> <span class='hs-layout'>(</span><span class='hs-conid'>RoleAnnotDecl</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-11"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>RoleAnnotDecl</span> <span class='hs-varid'>ltycon</span> <span class='hs-varid'>roles</span><span class='hs-layout'>)</span>
<a name="line-12"></a>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"type role"</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>ltycon</span> <span class='hs-varop'>&lt;+&gt;</span>
<a name="line-13"></a>      <span class='hs-varid'>hsep</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-varid'>pp_role</span> <span class='hs-varop'>.</span> <span class='hs-varid'>unLoc</span><span class='hs-layout'>)</span> <span class='hs-varid'>roles</span><span class='hs-layout'>)</span>
<a name="line-14"></a>    <span class='hs-keyword'>where</span>
<a name="line-15"></a>      <span class='hs-varid'>pp_role</span> <span class='hs-conid'>Nothing</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>underscore</span>
<a name="line-16"></a>      <span class='hs-varid'>pp_role</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>r</span>
<a name="line-17"></a>
<a name="line-18"></a><a name="roleAnnotDeclName"></a><span class='hs-definition'>roleAnnotDeclName</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>RoleAnnotDecl</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>name</span>
<a name="line-19"></a><span class='hs-definition'>roleAnnotDeclName</span> <span class='hs-layout'>(</span><span class='hs-conid'>RoleAnnotDecl</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>name</span>
<a name="line-20"></a>
</pre>\end{code}
</body>
</html>
