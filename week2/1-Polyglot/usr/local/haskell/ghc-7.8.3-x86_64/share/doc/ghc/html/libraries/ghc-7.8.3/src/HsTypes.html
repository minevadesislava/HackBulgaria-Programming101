<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>hsSyn/HsTypes.lhs</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
%
% (c) The University of Glasgow 2006
% (c) The GRASP/AQUA Project, Glasgow University, 1992-1998
%

HsTypes: Abstract syntax: user-defined types

\begin{code}
<pre><a name="line-1"></a><span class='hs-comment'>{-# LANGUAGE DeriveDataTypeable #-}</span>
<a name="line-2"></a>
<a name="line-3"></a><span class='hs-keyword'>module</span> <span class='hs-conid'>HsTypes</span> <span class='hs-layout'>(</span>
<a name="line-4"></a>        <span class='hs-conid'>HsType</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>LHsType</span><span class='hs-layout'>,</span> <span class='hs-conid'>HsKind</span><span class='hs-layout'>,</span> <span class='hs-conid'>LHsKind</span><span class='hs-layout'>,</span>
<a name="line-5"></a>        <span class='hs-conid'>HsTyVarBndr</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>LHsTyVarBndr</span><span class='hs-layout'>,</span> 
<a name="line-6"></a>        <span class='hs-conid'>LHsTyVarBndrs</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-7"></a>        <span class='hs-conid'>HsWithBndrs</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-8"></a>        <span class='hs-conid'>HsTupleSort</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>HsExplicitFlag</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-9"></a>        <span class='hs-conid'>HsContext</span><span class='hs-layout'>,</span> <span class='hs-conid'>LHsContext</span><span class='hs-layout'>,</span>
<a name="line-10"></a>        <span class='hs-conid'>HsQuasiQuote</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-11"></a>        <span class='hs-conid'>HsTyWrapper</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-12"></a>        <span class='hs-conid'>HsTyLit</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-13"></a>        <span class='hs-conid'>HsIPName</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>hsIPNameFS</span><span class='hs-layout'>,</span>
<a name="line-14"></a>
<a name="line-15"></a>        <span class='hs-conid'>LBangType</span><span class='hs-layout'>,</span> <span class='hs-conid'>BangType</span><span class='hs-layout'>,</span> <span class='hs-conid'>HsBang</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> 
<a name="line-16"></a>        <span class='hs-varid'>getBangType</span><span class='hs-layout'>,</span> <span class='hs-varid'>getBangStrictness</span><span class='hs-layout'>,</span> 
<a name="line-17"></a>
<a name="line-18"></a>        <span class='hs-conid'>ConDeclField</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprConDeclFields</span><span class='hs-layout'>,</span>
<a name="line-19"></a>        
<a name="line-20"></a>        <span class='hs-varid'>mkHsQTvs</span><span class='hs-layout'>,</span> <span class='hs-varid'>hsQTvBndrs</span><span class='hs-layout'>,</span>
<a name="line-21"></a>        <span class='hs-varid'>mkExplicitHsForAllTy</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkImplicitHsForAllTy</span><span class='hs-layout'>,</span> <span class='hs-varid'>hsExplicitTvs</span><span class='hs-layout'>,</span>
<a name="line-22"></a>        <span class='hs-varid'>hsTyVarName</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkHsWithBndrs</span><span class='hs-layout'>,</span> <span class='hs-varid'>hsLKiTyVarNames</span><span class='hs-layout'>,</span>
<a name="line-23"></a>        <span class='hs-varid'>hsLTyVarName</span><span class='hs-layout'>,</span> <span class='hs-varid'>hsLTyVarNames</span><span class='hs-layout'>,</span> <span class='hs-varid'>hsLTyVarLocName</span><span class='hs-layout'>,</span> <span class='hs-varid'>hsLTyVarLocNames</span><span class='hs-layout'>,</span>
<a name="line-24"></a>        <span class='hs-varid'>splitLHsInstDeclTy_maybe</span><span class='hs-layout'>,</span>
<a name="line-25"></a>        <span class='hs-varid'>splitHsClassTy_maybe</span><span class='hs-layout'>,</span> <span class='hs-varid'>splitLHsClassTy_maybe</span><span class='hs-layout'>,</span>
<a name="line-26"></a>        <span class='hs-varid'>splitHsFunType</span><span class='hs-layout'>,</span>
<a name="line-27"></a>        <span class='hs-varid'>splitHsAppTys</span><span class='hs-layout'>,</span> <span class='hs-varid'>hsTyGetAppHead_maybe</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkHsAppTys</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkHsOpTy</span><span class='hs-layout'>,</span>
<a name="line-28"></a>
<a name="line-29"></a>        <span class='hs-comment'>-- Printing</span>
<a name="line-30"></a>        <span class='hs-varid'>pprParendHsType</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprHsForAll</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprHsContext</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprHsContextNoArrow</span><span class='hs-layout'>,</span> <span class='hs-varid'>ppr_hs_context</span><span class='hs-layout'>,</span>
<a name="line-31"></a>    <span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-32"></a>
<a name="line-33"></a><span class='hs-keyword'>import</span> <span class='hs-comment'>{-# SOURCE #-}</span> <span class='hs-conid'>HsExpr</span> <span class='hs-layout'>(</span> <span class='hs-conid'>HsSplice</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprUntypedSplice</span> <span class='hs-layout'>)</span>
<a name="line-34"></a>
<a name="line-35"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>HsLit</span>
<a name="line-36"></a>
<a name="line-37"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Name</span><span class='hs-layout'>(</span> <span class='hs-conid'>Name</span> <span class='hs-layout'>)</span>
<a name="line-38"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>RdrName</span><span class='hs-layout'>(</span> <span class='hs-conid'>RdrName</span> <span class='hs-layout'>)</span>
<a name="line-39"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>DataCon</span><span class='hs-layout'>(</span> <span class='hs-conid'>HsBang</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span> <span class='hs-layout'>)</span>
<a name="line-40"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>TysPrim</span><span class='hs-layout'>(</span> <span class='hs-varid'>funTyConName</span> <span class='hs-layout'>)</span>
<a name="line-41"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Type</span>
<a name="line-42"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>HsDoc</span>
<a name="line-43"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>BasicTypes</span>
<a name="line-44"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>SrcLoc</span>
<a name="line-45"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>StaticFlags</span>
<a name="line-46"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Outputable</span>
<a name="line-47"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>FastString</span>
<a name="line-48"></a>
<a name="line-49"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Data</span>
</pre>\end{code}


%************************************************************************
%*                                                                      *
        Quasi quotes; used in types and elsewhere
%*                                                                      *
%************************************************************************

\begin{code}
<pre><a name="line-1"></a><a name="HsQuasiQuote"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>HsQuasiQuote</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HsQuasiQuote</span> 
<a name="line-2"></a>                           <span class='hs-varid'>id</span>           <span class='hs-comment'>-- The quasi-quoter</span>
<a name="line-3"></a>                           <span class='hs-conid'>SrcSpan</span>      <span class='hs-comment'>-- The span of the enclosed string</span>
<a name="line-4"></a>                           <span class='hs-conid'>FastString</span>   <span class='hs-comment'>-- The enclosed string</span>
<a name="line-5"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Data</span><span class='hs-layout'>,</span> <span class='hs-conid'>Typeable</span><span class='hs-layout'>)</span>
<a name="line-6"></a>
<a name="line-7"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Outputable</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsQuasiQuote</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-8"></a>    <span class='hs-varid'>ppr</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr_qq</span>
<a name="line-9"></a>
<a name="line-10"></a><a name="ppr_qq"></a><span class='hs-definition'>ppr_qq</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HsQuasiQuote</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-11"></a><span class='hs-definition'>ppr_qq</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsQuasiQuote</span> <span class='hs-varid'>quoter</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>quote</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-12"></a>    <span class='hs-varid'>char</span> <span class='hs-chr'>'['</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>quoter</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"|"</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;&gt;</span>
<a name="line-13"></a>    <span class='hs-varid'>ppr</span> <span class='hs-varid'>quote</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"|]"</span><span class='hs-layout'>)</span>
</pre>\end{code}


%************************************************************************
%*                                                                      *
\subsection{Bang annotations}
%*                                                                      *
%************************************************************************

\begin{code}
<pre><a name="line-1"></a><a name="LBangType"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LBangType</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-conid'>BangType</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>
<a name="line-2"></a><a name="BangType"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>BangType</span> <span class='hs-varid'>name</span>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HsType</span> <span class='hs-varid'>name</span>       <span class='hs-comment'>-- Bangs are in the HsType data type</span>
<a name="line-3"></a>
<a name="line-4"></a><a name="getBangType"></a><span class='hs-definition'>getBangType</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LHsType</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsType</span> <span class='hs-varid'>a</span>
<a name="line-5"></a><span class='hs-definition'>getBangType</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsBangTy</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>ty</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ty</span>
<a name="line-6"></a><span class='hs-definition'>getBangType</span> <span class='hs-varid'>ty</span>                    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ty</span>
<a name="line-7"></a>
<a name="line-8"></a><a name="getBangStrictness"></a><span class='hs-definition'>getBangStrictness</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LHsType</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HsBang</span>
<a name="line-9"></a><span class='hs-definition'>getBangStrictness</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsBangTy</span> <span class='hs-varid'>s</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>s</span>
<a name="line-10"></a><span class='hs-definition'>getBangStrictness</span> <span class='hs-keyword'>_</span>                    <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HsNoBang</span>
</pre>\end{code}


%************************************************************************
%*                                                                      *
\subsection{Data types}
%*                                                                      *
%************************************************************************

This is the syntax for types as seen in type signatures.

Note [HsBSig binder lists]
~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider a binder (or pattern) decoarated with a type or kind, 
   \ (x :: a -> a). blah
   forall (a :: k -> *) (b :: k). blah
Then we use a LHsBndrSig on the binder, so that the
renamer can decorate it with the variables bound
by the pattern ('a' in the first example, 'k' in the second),
assuming that neither of them is in scope already
See also Note [Kind and type-variable binders] in RnTypes

\begin{code}
<pre><a name="line-1"></a><a name="LHsContext"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LHsContext</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsContext</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>
<a name="line-2"></a>
<a name="line-3"></a><a name="HsContext"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>HsContext</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LHsType</span> <span class='hs-varid'>name</span><span class='hs-keyglyph'>]</span>
<a name="line-4"></a>
<a name="line-5"></a><a name="LHsType"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LHsType</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsType</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>
<a name="line-6"></a><a name="HsKind"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>HsKind</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HsType</span> <span class='hs-varid'>name</span>
<a name="line-7"></a><a name="LHsKind"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LHsKind</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsKind</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>
<a name="line-8"></a>
<a name="line-9"></a><a name="LHsTyVarBndr"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LHsTyVarBndr</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsTyVarBndr</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>
<a name="line-10"></a>
<a name="line-11"></a><a name="LHsTyVarBndrs"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>LHsTyVarBndrs</span> <span class='hs-varid'>name</span> 
<a name="line-12"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HsQTvs</span> <span class='hs-layout'>{</span> <span class='hs-varid'>hsq_kvs</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Name</span><span class='hs-keyglyph'>]</span>                  <span class='hs-comment'>-- Kind variables</span>
<a name="line-13"></a>           <span class='hs-layout'>,</span> <span class='hs-varid'>hsq_tvs</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LHsTyVarBndr</span> <span class='hs-varid'>name</span><span class='hs-keyglyph'>]</span>     <span class='hs-comment'>-- Type variables</span>
<a name="line-14"></a>             <span class='hs-comment'>-- See Note [HsForAllTy tyvar binders]</span>
<a name="line-15"></a>    <span class='hs-layout'>}</span>
<a name="line-16"></a>  <span class='hs-keyword'>deriving</span><span class='hs-layout'>(</span> <span class='hs-conid'>Data</span><span class='hs-layout'>,</span> <span class='hs-conid'>Typeable</span> <span class='hs-layout'>)</span>
<a name="line-17"></a>
<a name="line-18"></a><a name="mkHsQTvs"></a><span class='hs-definition'>mkHsQTvs</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LHsTyVarBndr</span> <span class='hs-conid'>RdrName</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsTyVarBndrs</span> <span class='hs-conid'>RdrName</span>
<a name="line-19"></a><span class='hs-comment'>-- Just at RdrName because in the Name variant we should know just</span>
<a name="line-20"></a><span class='hs-comment'>-- what the kind-variable binders are; and we don't</span>
<a name="line-21"></a><span class='hs-comment'>-- We put an empty list (rather than a panic) for the kind vars so </span>
<a name="line-22"></a><span class='hs-comment'>-- that the pretty printer works ok on them.</span>
<a name="line-23"></a><span class='hs-definition'>mkHsQTvs</span> <span class='hs-varid'>tvs</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HsQTvs</span> <span class='hs-layout'>{</span> <span class='hs-varid'>hsq_kvs</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>[]</span><span class='hs-layout'>,</span> <span class='hs-varid'>hsq_tvs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tvs</span> <span class='hs-layout'>}</span>
<a name="line-24"></a>
<a name="line-25"></a><a name="emptyHsQTvs"></a><span class='hs-definition'>emptyHsQTvs</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LHsTyVarBndrs</span> <span class='hs-varid'>name</span>   <span class='hs-comment'>-- Use only when you know there are no kind binders</span>
<a name="line-26"></a><span class='hs-definition'>emptyHsQTvs</span> <span class='hs-keyglyph'>=</span>  <span class='hs-conid'>HsQTvs</span> <span class='hs-layout'>{</span> <span class='hs-varid'>hsq_kvs</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>[]</span><span class='hs-layout'>,</span> <span class='hs-varid'>hsq_tvs</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>[]</span> <span class='hs-layout'>}</span>
<a name="line-27"></a>
<a name="line-28"></a><a name="hsQTvBndrs"></a><span class='hs-definition'>hsQTvBndrs</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LHsTyVarBndrs</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LHsTyVarBndr</span> <span class='hs-varid'>name</span><span class='hs-keyglyph'>]</span>
<a name="line-29"></a><span class='hs-definition'>hsQTvBndrs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hsq_tvs</span>
<a name="line-30"></a>
<a name="line-31"></a><a name="HsWithBndrs"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>HsWithBndrs</span> <span class='hs-varid'>thing</span>
<a name="line-32"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HsWB</span> <span class='hs-layout'>{</span> <span class='hs-varid'>hswb_cts</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>thing</span>         <span class='hs-comment'>-- Main payload (type or list of types)</span>
<a name="line-33"></a>         <span class='hs-layout'>,</span> <span class='hs-varid'>hswb_kvs</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Name</span><span class='hs-keyglyph'>]</span>        <span class='hs-comment'>-- Kind vars</span>
<a name="line-34"></a>         <span class='hs-layout'>,</span> <span class='hs-varid'>hswb_tvs</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Name</span><span class='hs-keyglyph'>]</span>        <span class='hs-comment'>-- Type vars</span>
<a name="line-35"></a>    <span class='hs-layout'>}</span>                  
<a name="line-36"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Data</span><span class='hs-layout'>,</span> <span class='hs-conid'>Typeable</span><span class='hs-layout'>)</span>
<a name="line-37"></a>
<a name="line-38"></a><a name="mkHsWithBndrs"></a><span class='hs-definition'>mkHsWithBndrs</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>thing</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HsWithBndrs</span> <span class='hs-varid'>thing</span>
<a name="line-39"></a><span class='hs-definition'>mkHsWithBndrs</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HsWB</span> <span class='hs-layout'>{</span> <span class='hs-varid'>hswb_cts</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>x</span><span class='hs-layout'>,</span> <span class='hs-varid'>hswb_kvs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>panic</span> <span class='hs-str'>"mkHsTyWithBndrs:kvs"</span>
<a name="line-40"></a>                                     <span class='hs-layout'>,</span> <span class='hs-varid'>hswb_tvs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>panic</span> <span class='hs-str'>"mkHsTyWithBndrs:tvs"</span> <span class='hs-layout'>}</span>
<a name="line-41"></a>
<a name="line-42"></a>
<a name="line-43"></a><a name="HsIPName"></a><span class='hs-comment'>-- | These names are used eary on to store the names of implicit</span>
<a name="line-44"></a><a name="HsIPName"></a><span class='hs-comment'>-- parameters.  They completely disappear after type-checking.</span>
<a name="line-45"></a><a name="HsIPName"></a><span class='hs-keyword'>newtype</span> <span class='hs-conid'>HsIPName</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HsIPName</span> <span class='hs-conid'>FastString</span><span class='hs-comment'>-- ?x</span>
<a name="line-46"></a>  <span class='hs-keyword'>deriving</span><span class='hs-layout'>(</span> <span class='hs-conid'>Eq</span><span class='hs-layout'>,</span> <span class='hs-conid'>Data</span><span class='hs-layout'>,</span> <span class='hs-conid'>Typeable</span> <span class='hs-layout'>)</span>
<a name="line-47"></a>
<a name="line-48"></a><a name="hsIPNameFS"></a><span class='hs-definition'>hsIPNameFS</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsIPName</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>FastString</span>
<a name="line-49"></a><span class='hs-definition'>hsIPNameFS</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsIPName</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>n</span>
<a name="line-50"></a>
<a name="line-51"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Outputable</span> <span class='hs-conid'>HsIPName</span> <span class='hs-keyword'>where</span>
<a name="line-52"></a>    <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsIPName</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'?'</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>ftext</span> <span class='hs-varid'>n</span> <span class='hs-comment'>-- Ordinary implicit parameters</span>
<a name="line-53"></a>
<a name="line-54"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>OutputableBndr</span> <span class='hs-conid'>HsIPName</span> <span class='hs-keyword'>where</span>
<a name="line-55"></a>    <span class='hs-varid'>pprBndr</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>n</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>n</span>         <span class='hs-comment'>-- Simple for now</span>
<a name="line-56"></a>    <span class='hs-varid'>pprInfixOcc</span>  <span class='hs-varid'>n</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>n</span>
<a name="line-57"></a>    <span class='hs-varid'>pprPrefixOcc</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>n</span>
<a name="line-58"></a>
<a name="line-59"></a><a name="HsTyVarBndr"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>HsTyVarBndr</span> <span class='hs-varid'>name</span>
<a name="line-60"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>UserTyVar</span>        <span class='hs-comment'>-- no explicit kinding</span>
<a name="line-61"></a>         <span class='hs-varid'>name</span>
<a name="line-62"></a>
<a name="line-63"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>KindedTyVar</span>
<a name="line-64"></a>         <span class='hs-varid'>name</span>
<a name="line-65"></a>         <span class='hs-layout'>(</span><span class='hs-conid'>LHsKind</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>  <span class='hs-comment'>-- The user-supplied kind signature</span>
<a name="line-66"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Data</span><span class='hs-layout'>,</span> <span class='hs-conid'>Typeable</span><span class='hs-layout'>)</span>
<a name="line-67"></a>
<a name="line-68"></a><a name="HsType"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>HsType</span> <span class='hs-varid'>name</span>
<a name="line-69"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HsForAllTy</span>  <span class='hs-conid'>HsExplicitFlag</span>          <span class='hs-comment'>-- Renamer leaves this flag unchanged, to record the way</span>
<a name="line-70"></a>                                        <span class='hs-comment'>-- the user wrote it originally, so that the printer can</span>
<a name="line-71"></a>                                        <span class='hs-comment'>-- print it as the user wrote it</span>
<a name="line-72"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>LHsTyVarBndrs</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> 
<a name="line-73"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>LHsContext</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>
<a name="line-74"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>LHsType</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>
<a name="line-75"></a>
<a name="line-76"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsTyVar</span>             <span class='hs-varid'>name</span>            <span class='hs-comment'>-- Type variable, type constructor, or data constructor</span>
<a name="line-77"></a>                                        <span class='hs-comment'>-- see Note [Promotions (HsTyVar)]</span>
<a name="line-78"></a>
<a name="line-79"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsAppTy</span>             <span class='hs-layout'>(</span><span class='hs-conid'>LHsType</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>
<a name="line-80"></a>                        <span class='hs-layout'>(</span><span class='hs-conid'>LHsType</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>
<a name="line-81"></a>
<a name="line-82"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsFunTy</span>             <span class='hs-layout'>(</span><span class='hs-conid'>LHsType</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>   <span class='hs-comment'>-- function type</span>
<a name="line-83"></a>                        <span class='hs-layout'>(</span><span class='hs-conid'>LHsType</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>
<a name="line-84"></a>
<a name="line-85"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsListTy</span>            <span class='hs-layout'>(</span><span class='hs-conid'>LHsType</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>  <span class='hs-comment'>-- Element type</span>
<a name="line-86"></a>
<a name="line-87"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsPArrTy</span>            <span class='hs-layout'>(</span><span class='hs-conid'>LHsType</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>  <span class='hs-comment'>-- Elem. type of parallel array: [:t:]</span>
<a name="line-88"></a>
<a name="line-89"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsTupleTy</span>           <span class='hs-conid'>HsTupleSort</span>
<a name="line-90"></a>                        <span class='hs-keyglyph'>[</span><span class='hs-conid'>LHsType</span> <span class='hs-varid'>name</span><span class='hs-keyglyph'>]</span>  <span class='hs-comment'>-- Element types (length gives arity)</span>
<a name="line-91"></a>
<a name="line-92"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsOpTy</span>              <span class='hs-layout'>(</span><span class='hs-conid'>LHsType</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsTyOp</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsType</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>
<a name="line-93"></a>
<a name="line-94"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsParTy</span>             <span class='hs-layout'>(</span><span class='hs-conid'>LHsType</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>   <span class='hs-comment'>-- See Note [Parens in HsSyn] in HsExpr</span>
<a name="line-95"></a>        <span class='hs-comment'>-- Parenthesis preserved for the precedence re-arrangement in RnTypes</span>
<a name="line-96"></a>        <span class='hs-comment'>-- It's important that a * (b + c) doesn't get rearranged to (a*b) + c!</span>
<a name="line-97"></a>
<a name="line-98"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsIParamTy</span>          <span class='hs-conid'>HsIPName</span>         <span class='hs-comment'>-- (?x :: ty)</span>
<a name="line-99"></a>                        <span class='hs-layout'>(</span><span class='hs-conid'>LHsType</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>   <span class='hs-comment'>-- Implicit parameters as they occur in contexts</span>
<a name="line-100"></a>
<a name="line-101"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsEqTy</span>              <span class='hs-layout'>(</span><span class='hs-conid'>LHsType</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>   <span class='hs-comment'>-- ty1 ~ ty2</span>
<a name="line-102"></a>                        <span class='hs-layout'>(</span><span class='hs-conid'>LHsType</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>   <span class='hs-comment'>-- Always allowed even without TypeOperators, and has special kinding rule</span>
<a name="line-103"></a>
<a name="line-104"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsKindSig</span>           <span class='hs-layout'>(</span><span class='hs-conid'>LHsType</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>  <span class='hs-comment'>-- (ty :: kind)</span>
<a name="line-105"></a>                        <span class='hs-layout'>(</span><span class='hs-conid'>LHsKind</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>  <span class='hs-comment'>-- A type with a kind signature</span>
<a name="line-106"></a>
<a name="line-107"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsQuasiQuoteTy</span>      <span class='hs-layout'>(</span><span class='hs-conid'>HsQuasiQuote</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>
<a name="line-108"></a>
<a name="line-109"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsSpliceTy</span>          <span class='hs-layout'>(</span><span class='hs-conid'>HsSplice</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> 
<a name="line-110"></a>                        <span class='hs-conid'>PostTcKind</span>
<a name="line-111"></a>
<a name="line-112"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsDocTy</span>             <span class='hs-layout'>(</span><span class='hs-conid'>LHsType</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-conid'>LHsDocString</span> <span class='hs-comment'>-- A documented type</span>
<a name="line-113"></a>
<a name="line-114"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsBangTy</span>    <span class='hs-conid'>HsBang</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsType</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>   <span class='hs-comment'>-- Bang-style type annotations </span>
<a name="line-115"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsRecTy</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>ConDeclField</span> <span class='hs-varid'>name</span><span class='hs-keyglyph'>]</span>         <span class='hs-comment'>-- Only in data type declarations</span>
<a name="line-116"></a>
<a name="line-117"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsCoreTy</span> <span class='hs-conid'>Type</span>       <span class='hs-comment'>-- An escape hatch for tunnelling a *closed* </span>
<a name="line-118"></a>                        <span class='hs-comment'>-- Core Type through HsSyn.  </span>
<a name="line-119"></a>
<a name="line-120"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsExplicitListTy</span>     <span class='hs-comment'>-- A promoted explicit list</span>
<a name="line-121"></a>        <span class='hs-conid'>PostTcKind</span>       <span class='hs-comment'>-- See Note [Promoted lists and tuples]</span>
<a name="line-122"></a>        <span class='hs-keyglyph'>[</span><span class='hs-conid'>LHsType</span> <span class='hs-varid'>name</span><span class='hs-keyglyph'>]</span>   
<a name="line-123"></a>                         
<a name="line-124"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsExplicitTupleTy</span>    <span class='hs-comment'>-- A promoted explicit tuple</span>
<a name="line-125"></a>        <span class='hs-keyglyph'>[</span><span class='hs-conid'>PostTcKind</span><span class='hs-keyglyph'>]</span>     <span class='hs-comment'>-- See Note [Promoted lists and tuples]</span>
<a name="line-126"></a>        <span class='hs-keyglyph'>[</span><span class='hs-conid'>LHsType</span> <span class='hs-varid'>name</span><span class='hs-keyglyph'>]</span>   
<a name="line-127"></a>
<a name="line-128"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsTyLit</span> <span class='hs-conid'>HsTyLit</span>      <span class='hs-comment'>-- A promoted numeric literal.</span>
<a name="line-129"></a>
<a name="line-130"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsWrapTy</span> <span class='hs-conid'>HsTyWrapper</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsType</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>  <span class='hs-comment'>-- only in typechecker output</span>
<a name="line-131"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Data</span><span class='hs-layout'>,</span> <span class='hs-conid'>Typeable</span><span class='hs-layout'>)</span>
<a name="line-132"></a>
<a name="line-133"></a>
<a name="line-134"></a><a name="HsTyLit"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>HsTyLit</span>
<a name="line-135"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HsNumTy</span> <span class='hs-conid'>Integer</span>
<a name="line-136"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsStrTy</span> <span class='hs-conid'>FastString</span>
<a name="line-137"></a>    <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Data</span><span class='hs-layout'>,</span> <span class='hs-conid'>Typeable</span><span class='hs-layout'>)</span>
<a name="line-138"></a>
<a name="line-139"></a><a name="HsTyWrapper"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>HsTyWrapper</span>
<a name="line-140"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>WpKiApps</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Kind</span><span class='hs-keyglyph'>]</span>  <span class='hs-comment'>-- kind instantiation: [] k1 k2 .. kn</span>
<a name="line-141"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Data</span><span class='hs-layout'>,</span> <span class='hs-conid'>Typeable</span><span class='hs-layout'>)</span>
<a name="line-142"></a>
<a name="line-143"></a><a name="LHsTyOp"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LHsTyOp</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HsTyOp</span> <span class='hs-layout'>(</span><span class='hs-conid'>Located</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>
<a name="line-144"></a><a name="HsTyOp"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>HsTyOp</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsTyWrapper</span><span class='hs-layout'>,</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>
<a name="line-145"></a>
<a name="line-146"></a><a name="mkHsOpTy"></a><span class='hs-definition'>mkHsOpTy</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LHsType</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Located</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsType</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HsType</span> <span class='hs-varid'>name</span>
<a name="line-147"></a><span class='hs-definition'>mkHsOpTy</span> <span class='hs-varid'>ty1</span> <span class='hs-varid'>op</span> <span class='hs-varid'>ty2</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HsOpTy</span> <span class='hs-varid'>ty1</span> <span class='hs-layout'>(</span><span class='hs-conid'>WpKiApps</span> <span class='hs-conid'>[]</span><span class='hs-layout'>,</span> <span class='hs-varid'>op</span><span class='hs-layout'>)</span> <span class='hs-varid'>ty2</span>
</pre>\end{code}

Note [HsForAllTy tyvar binders]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
After parsing:
  * Implicit => empty
    Explicit => the variables the user wrote

After renaming
  * Implicit => the *type* variables free in the type
    Explicit => the variables the user wrote (renamed)

The kind variables bound in the hsq_kvs field come both
  a) from the kind signatures on the kind vars (eg k1)
  b) from the scope of the forall (eg k2)
Example:   f :: forall (a::k1) b. T a (b::k2)


Note [Unit tuples]
~~~~~~~~~~~~~~~~~~
Consider the type
    type instance F Int = ()
We want to parse that "()" 
    as HsTupleTy HsBoxedOrConstraintTuple [], 
NOT as HsTyVar unitTyCon

Why? Because F might have kind (* -> Constraint), so we when parsing we
don't know if that tuple is going to be a constraint tuple or an ordinary
unit tuple.  The HsTupleSort flag is specifically designed to deal with
that, but it has to work for unit tuples too.

Note [Promotions (HsTyVar)]
~~~~~~~~~~~~~~~~~~~~~~~~~~~
HsTyVar: A name in a type or kind.
  Here are the allowed namespaces for the name.
    In a type:
      Var: not allowed
      Data: promoted data constructor
      Tv: type variable
      TcCls before renamer: type constructor, class constructor, or promoted data constructor
      TcCls after renamer: type constructor or class constructor
    In a kind:
      Var, Data: not allowed
      Tv: kind variable
      TcCls: kind constructor or promoted type constructor


Note [Promoted lists and tuples]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Notice the difference between
   HsListTy    HsExplicitListTy
   HsTupleTy   HsExplicitListTupleTy

E.g.    f :: [Int]                      HsListTy                

        g3  :: T '[]                   All these use  
        g2  :: T '[True]                  HsExplicitListTy        
        g1  :: T '[True,False]          
        g1a :: T [True,False]             (can omit ' where unambiguous)

  kind of T :: [Bool] -> *        This kind uses HsListTy!

E.g.    h :: (Int,Bool)                 HsTupleTy; f is a pair               
        k :: S '(True,False)            HsExplicitTypleTy; S is indexed by   
                                           a type-level pair of booleans 
        kind of S :: (Bool,Bool) -> *   This kind uses HsExplicitTupleTy

Note [Distinguishing tuple kinds]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Apart from promotion, tuples can have one of three different kinds:

        x :: (Int, Bool)                -- Regular boxed tuples
        f :: Int# -> (# Int#, Int# #)   -- Unboxed tuples
        g :: (Eq a, Ord a) => a         -- Constraint tuples

For convenience, internally we use a single constructor for all of these,
namely HsTupleTy, but keep track of the tuple kind (in the first argument to
HsTupleTy, a HsTupleSort). We can tell if a tuple is unboxed while parsing,
because of the #. However, with -XConstraintKinds we can only distinguish
between constraint and boxed tuples during type checking, in general. Hence the
four constructors of HsTupleSort:
        
        HsUnboxedTuple                  -> Produced by the parser
        HsBoxedTuple                    -> Certainly a boxed tuple
        HsConstraintTuple               -> Certainly a constraint tuple
        HsBoxedOrConstraintTuple        -> Could be a boxed or a constraint 
                                        tuple. Produced by the parser only,
                                        disappears after type checking

\begin{code}
<pre><a name="line-1"></a><a name="HsTupleSort"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>HsTupleSort</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HsUnboxedTuple</span>
<a name="line-2"></a>                 <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsBoxedTuple</span>
<a name="line-3"></a>                 <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsConstraintTuple</span>
<a name="line-4"></a>                 <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsBoxedOrConstraintTuple</span>
<a name="line-5"></a>                 <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Data</span><span class='hs-layout'>,</span> <span class='hs-conid'>Typeable</span><span class='hs-layout'>)</span>
<a name="line-6"></a>
<a name="line-7"></a><a name="HsExplicitFlag"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>HsExplicitFlag</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Explicit</span> <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Implicit</span> <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Data</span><span class='hs-layout'>,</span> <span class='hs-conid'>Typeable</span><span class='hs-layout'>)</span>
<a name="line-8"></a>
<a name="line-9"></a><a name="ConDeclField"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>ConDeclField</span> <span class='hs-varid'>name</span>  <span class='hs-comment'>-- Record fields have Haddoc docs on them</span>
<a name="line-10"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ConDeclField</span> <span class='hs-layout'>{</span> <span class='hs-varid'>cd_fld_name</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Located</span> <span class='hs-varid'>name</span><span class='hs-layout'>,</span>
<a name="line-11"></a>                   <span class='hs-varid'>cd_fld_type</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LBangType</span> <span class='hs-varid'>name</span><span class='hs-layout'>,</span> 
<a name="line-12"></a>                   <span class='hs-varid'>cd_fld_doc</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>LHsDocString</span> <span class='hs-layout'>}</span>
<a name="line-13"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Data</span><span class='hs-layout'>,</span> <span class='hs-conid'>Typeable</span><span class='hs-layout'>)</span>
<a name="line-14"></a>
<a name="line-15"></a><span class='hs-comment'>-----------------------</span>
<a name="line-16"></a><span class='hs-comment'>-- Combine adjacent for-alls. </span>
<a name="line-17"></a><span class='hs-comment'>-- The following awkward situation can happen otherwise:</span>
<a name="line-18"></a><span class='hs-comment'>--      f :: forall a. ((Num a) =&gt; Int)</span>
<a name="line-19"></a><span class='hs-comment'>-- might generate HsForAll (Just [a]) [] (HsForAll Nothing [Num a] t)</span>
<a name="line-20"></a><span class='hs-comment'>-- Then a isn't discovered as ambiguous, and we abstract the AbsBinds wrt []</span>
<a name="line-21"></a><span class='hs-comment'>-- but the export list abstracts f wrt [a].  Disaster.</span>
<a name="line-22"></a><span class='hs-comment'>--</span>
<a name="line-23"></a><span class='hs-comment'>-- A valid type must have one for-all at the top of the type, or of the fn arg types</span>
<a name="line-24"></a>
<a name="line-25"></a><a name="mkImplicitHsForAllTy"></a><span class='hs-definition'>mkImplicitHsForAllTy</span> <span class='hs-keyglyph'>::</span>                           <span class='hs-conid'>LHsContext</span> <span class='hs-conid'>RdrName</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsType</span> <span class='hs-conid'>RdrName</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HsType</span> <span class='hs-conid'>RdrName</span>
<a name="line-26"></a><a name="mkExplicitHsForAllTy"></a><span class='hs-definition'>mkExplicitHsForAllTy</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LHsTyVarBndr</span> <span class='hs-conid'>RdrName</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsContext</span> <span class='hs-conid'>RdrName</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsType</span> <span class='hs-conid'>RdrName</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HsType</span> <span class='hs-conid'>RdrName</span>
<a name="line-27"></a><span class='hs-definition'>mkImplicitHsForAllTy</span>     <span class='hs-varid'>ctxt</span> <span class='hs-varid'>ty</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkHsForAllTy</span> <span class='hs-conid'>Implicit</span> <span class='hs-conid'>[]</span>  <span class='hs-varid'>ctxt</span> <span class='hs-varid'>ty</span>
<a name="line-28"></a><span class='hs-definition'>mkExplicitHsForAllTy</span> <span class='hs-varid'>tvs</span> <span class='hs-varid'>ctxt</span> <span class='hs-varid'>ty</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkHsForAllTy</span> <span class='hs-conid'>Explicit</span> <span class='hs-varid'>tvs</span> <span class='hs-varid'>ctxt</span> <span class='hs-varid'>ty</span>
<a name="line-29"></a>
<a name="line-30"></a><a name="mkHsForAllTy"></a><span class='hs-definition'>mkHsForAllTy</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsExplicitFlag</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LHsTyVarBndr</span> <span class='hs-conid'>RdrName</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsContext</span> <span class='hs-conid'>RdrName</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsType</span> <span class='hs-conid'>RdrName</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HsType</span> <span class='hs-conid'>RdrName</span>
<a name="line-31"></a><span class='hs-comment'>-- Smart constructor for HsForAllTy</span>
<a name="line-32"></a><span class='hs-definition'>mkHsForAllTy</span> <span class='hs-varid'>exp</span> <span class='hs-varid'>tvs</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-conid'>[]</span><span class='hs-layout'>)</span> <span class='hs-varid'>ty</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mk_forall_ty</span> <span class='hs-varid'>exp</span> <span class='hs-varid'>tvs</span> <span class='hs-varid'>ty</span>
<a name="line-33"></a><span class='hs-definition'>mkHsForAllTy</span> <span class='hs-varid'>exp</span> <span class='hs-varid'>tvs</span> <span class='hs-varid'>ctxt</span>     <span class='hs-varid'>ty</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HsForAllTy</span> <span class='hs-varid'>exp</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkHsQTvs</span> <span class='hs-varid'>tvs</span><span class='hs-layout'>)</span> <span class='hs-varid'>ctxt</span> <span class='hs-varid'>ty</span>
<a name="line-34"></a>
<a name="line-35"></a><a name="mk_forall_ty"></a><span class='hs-comment'>-- mk_forall_ty makes a pure for-all type (no context)</span>
<a name="line-36"></a><span class='hs-definition'>mk_forall_ty</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsExplicitFlag</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LHsTyVarBndr</span> <span class='hs-conid'>RdrName</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsType</span> <span class='hs-conid'>RdrName</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HsType</span> <span class='hs-conid'>RdrName</span>
<a name="line-37"></a><span class='hs-definition'>mk_forall_ty</span> <span class='hs-varid'>exp</span>  <span class='hs-varid'>tvs</span>  <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsParTy</span> <span class='hs-varid'>ty</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>                    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mk_forall_ty</span> <span class='hs-varid'>exp</span> <span class='hs-varid'>tvs</span> <span class='hs-varid'>ty</span>
<a name="line-38"></a><span class='hs-definition'>mk_forall_ty</span> <span class='hs-varid'>exp1</span> <span class='hs-varid'>tvs1</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsForAllTy</span> <span class='hs-varid'>exp2</span> <span class='hs-varid'>qtvs2</span> <span class='hs-varid'>ctxt</span> <span class='hs-varid'>ty</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkHsForAllTy</span> <span class='hs-layout'>(</span><span class='hs-varid'>exp1</span> <span class='hs-varop'>`plus`</span> <span class='hs-varid'>exp2</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>tvs1</span> <span class='hs-varop'>++</span> <span class='hs-varid'>hsq_tvs</span> <span class='hs-varid'>qtvs2</span><span class='hs-layout'>)</span> <span class='hs-varid'>ctxt</span> <span class='hs-varid'>ty</span>
<a name="line-39"></a><span class='hs-definition'>mk_forall_ty</span> <span class='hs-varid'>exp</span>  <span class='hs-varid'>tvs</span>  <span class='hs-varid'>ty</span>                                    <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HsForAllTy</span> <span class='hs-varid'>exp</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkHsQTvs</span> <span class='hs-varid'>tvs</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>noLoc</span> <span class='hs-conid'>[]</span><span class='hs-layout'>)</span> <span class='hs-varid'>ty</span>
<a name="line-40"></a>        <span class='hs-comment'>-- Even if tvs is empty, we still make a HsForAll!</span>
<a name="line-41"></a>        <span class='hs-comment'>-- In the Implicit case, this signals the place to do implicit quantification</span>
<a name="line-42"></a>        <span class='hs-comment'>-- In the Explicit case, it prevents implicit quantification    </span>
<a name="line-43"></a>        <span class='hs-comment'>--      (see the sigtype production in Parser.y.pp)</span>
<a name="line-44"></a>        <span class='hs-comment'>--      so that (forall. ty) isn't implicitly quantified</span>
<a name="line-45"></a>
<a name="line-46"></a><a name="plus"></a><span class='hs-definition'>plus</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsExplicitFlag</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HsExplicitFlag</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HsExplicitFlag</span>
<a name="line-47"></a><span class='hs-conid'>Implicit</span> <span class='hs-varop'>`plus`</span> <span class='hs-conid'>Implicit</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Implicit</span>
<a name="line-48"></a><span class='hs-keyword'>_</span>        <span class='hs-varop'>`plus`</span> <span class='hs-keyword'>_</span>        <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Explicit</span>
<a name="line-49"></a>
<a name="line-50"></a><a name="hsExplicitTvs"></a><span class='hs-definition'>hsExplicitTvs</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LHsType</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Name</span><span class='hs-keyglyph'>]</span>
<a name="line-51"></a><span class='hs-comment'>-- The explicitly-given forall'd type variables of a HsType</span>
<a name="line-52"></a><span class='hs-definition'>hsExplicitTvs</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsForAllTy</span> <span class='hs-conid'>Explicit</span> <span class='hs-varid'>tvs</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hsLKiTyVarNames</span> <span class='hs-varid'>tvs</span>
<a name="line-53"></a><span class='hs-definition'>hsExplicitTvs</span> <span class='hs-keyword'>_</span>                                   <span class='hs-keyglyph'>=</span> <span class='hs-conid'>[]</span>
<a name="line-54"></a>
<a name="line-55"></a><a name="hsTyVarName"></a><span class='hs-comment'>---------------------</span>
<a name="line-56"></a><span class='hs-definition'>hsTyVarName</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsTyVarBndr</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>name</span>
<a name="line-57"></a><span class='hs-definition'>hsTyVarName</span> <span class='hs-layout'>(</span><span class='hs-conid'>UserTyVar</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>n</span>
<a name="line-58"></a><span class='hs-definition'>hsTyVarName</span> <span class='hs-layout'>(</span><span class='hs-conid'>KindedTyVar</span> <span class='hs-varid'>n</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>n</span>
<a name="line-59"></a>
<a name="line-60"></a><a name="hsLTyVarName"></a><span class='hs-definition'>hsLTyVarName</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LHsTyVarBndr</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>name</span>
<a name="line-61"></a><span class='hs-definition'>hsLTyVarName</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hsTyVarName</span> <span class='hs-varop'>.</span> <span class='hs-varid'>unLoc</span>
<a name="line-62"></a>
<a name="line-63"></a><a name="hsLTyVarNames"></a><span class='hs-definition'>hsLTyVarNames</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LHsTyVarBndrs</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>name</span><span class='hs-keyglyph'>]</span>
<a name="line-64"></a><span class='hs-comment'>-- Type variables only</span>
<a name="line-65"></a><span class='hs-definition'>hsLTyVarNames</span> <span class='hs-varid'>qtvs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>map</span> <span class='hs-varid'>hsLTyVarName</span> <span class='hs-layout'>(</span><span class='hs-varid'>hsQTvBndrs</span> <span class='hs-varid'>qtvs</span><span class='hs-layout'>)</span>
<a name="line-66"></a>
<a name="line-67"></a><a name="hsLKiTyVarNames"></a><span class='hs-definition'>hsLKiTyVarNames</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LHsTyVarBndrs</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Name</span><span class='hs-keyglyph'>]</span>
<a name="line-68"></a><span class='hs-comment'>-- Kind and type variables</span>
<a name="line-69"></a><span class='hs-definition'>hsLKiTyVarNames</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsQTvs</span> <span class='hs-layout'>{</span> <span class='hs-varid'>hsq_kvs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>kvs</span><span class='hs-layout'>,</span> <span class='hs-varid'>hsq_tvs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tvs</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-70"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>kvs</span> <span class='hs-varop'>++</span> <span class='hs-varid'>map</span> <span class='hs-varid'>hsLTyVarName</span> <span class='hs-varid'>tvs</span>
<a name="line-71"></a>
<a name="line-72"></a><a name="hsLTyVarLocName"></a><span class='hs-definition'>hsLTyVarLocName</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LHsTyVarBndr</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Located</span> <span class='hs-varid'>name</span>
<a name="line-73"></a><span class='hs-definition'>hsLTyVarLocName</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fmap</span> <span class='hs-varid'>hsTyVarName</span>
<a name="line-74"></a>
<a name="line-75"></a><a name="hsLTyVarLocNames"></a><span class='hs-definition'>hsLTyVarLocNames</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LHsTyVarBndrs</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Located</span> <span class='hs-varid'>name</span><span class='hs-keyglyph'>]</span>
<a name="line-76"></a><span class='hs-definition'>hsLTyVarLocNames</span> <span class='hs-varid'>qtvs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>map</span> <span class='hs-varid'>hsLTyVarLocName</span> <span class='hs-layout'>(</span><span class='hs-varid'>hsQTvBndrs</span> <span class='hs-varid'>qtvs</span><span class='hs-layout'>)</span>
</pre>\end{code}


\begin{code}
<pre><a name="line-1"></a><a name="splitHsAppTys"></a><span class='hs-definition'>splitHsAppTys</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LHsType</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LHsType</span> <span class='hs-varid'>n</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsType</span> <span class='hs-varid'>n</span><span class='hs-layout'>,</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LHsType</span> <span class='hs-varid'>n</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-2"></a><span class='hs-definition'>splitHsAppTys</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsAppTy</span> <span class='hs-varid'>f</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyword'>as</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>splitHsAppTys</span> <span class='hs-varid'>f</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-conop'>:</span><span class='hs-keyword'>as</span><span class='hs-layout'>)</span>
<a name="line-3"></a><span class='hs-definition'>splitHsAppTys</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsParTy</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>   <span class='hs-keyword'>as</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>splitHsAppTys</span> <span class='hs-varid'>f</span> <span class='hs-keyword'>as</span>
<a name="line-4"></a><span class='hs-definition'>splitHsAppTys</span> <span class='hs-varid'>f</span>                   <span class='hs-keyword'>as</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span><span class='hs-layout'>,</span><span class='hs-keyword'>as</span><span class='hs-layout'>)</span>
<a name="line-5"></a>
<a name="line-6"></a><a name="hsTyGetAppHead_maybe"></a><span class='hs-comment'>-- retrieve the name of the "head" of a nested type application</span>
<a name="line-7"></a><span class='hs-comment'>-- somewhat like splitHsAppTys, but a little more thorough</span>
<a name="line-8"></a><span class='hs-comment'>-- used to examine the result of a GADT-like datacon, so it doesn't handle</span>
<a name="line-9"></a><span class='hs-comment'>-- *all* cases (like lists, tuples, (~), etc.)</span>
<a name="line-10"></a><span class='hs-definition'>hsTyGetAppHead_maybe</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LHsType</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-varid'>n</span><span class='hs-layout'>,</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LHsType</span> <span class='hs-varid'>n</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-11"></a><span class='hs-definition'>hsTyGetAppHead_maybe</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>go</span> <span class='hs-conid'>[]</span>
<a name="line-12"></a>  <span class='hs-keyword'>where</span>
<a name="line-13"></a>    <span class='hs-varid'>go</span> <span class='hs-varid'>tys</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsTyVar</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>             <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-varid'>n</span><span class='hs-layout'>,</span> <span class='hs-varid'>tys</span><span class='hs-layout'>)</span>
<a name="line-14"></a>    <span class='hs-varid'>go</span> <span class='hs-varid'>tys</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsAppTy</span> <span class='hs-varid'>l</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>           <span class='hs-keyglyph'>=</span> <span class='hs-varid'>go</span> <span class='hs-layout'>(</span><span class='hs-varid'>r</span> <span class='hs-conop'>:</span> <span class='hs-varid'>tys</span><span class='hs-layout'>)</span> <span class='hs-varid'>l</span>
<a name="line-15"></a>    <span class='hs-varid'>go</span> <span class='hs-varid'>tys</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsOpTy</span> <span class='hs-varid'>l</span> <span class='hs-layout'>(</span><span class='hs-keyword'>_</span><span class='hs-layout'>,</span> <span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-varid'>n</span><span class='hs-layout'>,</span> <span class='hs-varid'>l</span> <span class='hs-conop'>:</span> <span class='hs-varid'>r</span> <span class='hs-conop'>:</span> <span class='hs-varid'>tys</span><span class='hs-layout'>)</span>
<a name="line-16"></a>    <span class='hs-varid'>go</span> <span class='hs-varid'>tys</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsParTy</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>             <span class='hs-keyglyph'>=</span> <span class='hs-varid'>go</span> <span class='hs-varid'>tys</span> <span class='hs-varid'>t</span>
<a name="line-17"></a>    <span class='hs-varid'>go</span> <span class='hs-varid'>tys</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsKindSig</span> <span class='hs-varid'>t</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>         <span class='hs-keyglyph'>=</span> <span class='hs-varid'>go</span> <span class='hs-varid'>tys</span> <span class='hs-varid'>t</span>
<a name="line-18"></a>    <span class='hs-varid'>go</span> <span class='hs-keyword'>_</span>   <span class='hs-keyword'>_</span>                             <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-19"></a>
<a name="line-20"></a><a name="mkHsAppTys"></a><span class='hs-definition'>mkHsAppTys</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>LHsType</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LHsType</span> <span class='hs-varid'>n</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HsType</span> <span class='hs-varid'>n</span>
<a name="line-21"></a><span class='hs-definition'>mkHsAppTys</span> <span class='hs-varid'>fun_ty</span> <span class='hs-conid'>[]</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprPanic</span> <span class='hs-str'>"mkHsAppTys"</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>fun_ty</span><span class='hs-layout'>)</span>
<a name="line-22"></a><span class='hs-definition'>mkHsAppTys</span> <span class='hs-varid'>fun_ty</span> <span class='hs-layout'>(</span><span class='hs-varid'>arg_ty</span><span class='hs-conop'>:</span><span class='hs-varid'>arg_tys</span><span class='hs-layout'>)</span>
<a name="line-23"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>foldl</span> <span class='hs-varid'>mk_app</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsAppTy</span> <span class='hs-varid'>fun_ty</span> <span class='hs-varid'>arg_ty</span><span class='hs-layout'>)</span> <span class='hs-varid'>arg_tys</span>
<a name="line-24"></a>  <span class='hs-keyword'>where</span>
<a name="line-25"></a>    <span class='hs-varid'>mk_app</span> <span class='hs-varid'>fun</span> <span class='hs-varid'>arg</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HsAppTy</span> <span class='hs-layout'>(</span><span class='hs-varid'>noLoc</span> <span class='hs-varid'>fun</span><span class='hs-layout'>)</span> <span class='hs-varid'>arg</span>    
<a name="line-26"></a>       <span class='hs-comment'>-- Add noLocs for inner nodes of the application; </span>
<a name="line-27"></a>       <span class='hs-comment'>-- they are never used </span>
<a name="line-28"></a>
<a name="line-29"></a><a name="splitLHsInstDeclTy_maybe"></a><span class='hs-definition'>splitLHsInstDeclTy_maybe</span>
<a name="line-30"></a>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LHsType</span> <span class='hs-varid'>name</span> 
<a name="line-31"></a>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsTyVarBndrs</span> <span class='hs-varid'>name</span><span class='hs-layout'>,</span> <span class='hs-conid'>HsContext</span> <span class='hs-varid'>name</span><span class='hs-layout'>,</span> <span class='hs-conid'>Located</span> <span class='hs-varid'>name</span><span class='hs-layout'>,</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LHsType</span> <span class='hs-varid'>name</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-32"></a>        <span class='hs-comment'>-- Split up an instance decl type, returning the pieces</span>
<a name="line-33"></a><span class='hs-definition'>splitLHsInstDeclTy_maybe</span> <span class='hs-varid'>inst_ty</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-34"></a>    <span class='hs-keyword'>let</span> <span class='hs-layout'>(</span><span class='hs-varid'>tvs</span><span class='hs-layout'>,</span> <span class='hs-varid'>cxt</span><span class='hs-layout'>,</span> <span class='hs-varid'>ty</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>splitLHsForAllTy</span> <span class='hs-varid'>inst_ty</span>
<a name="line-35"></a>    <span class='hs-layout'>(</span><span class='hs-varid'>cls</span><span class='hs-layout'>,</span> <span class='hs-varid'>tys</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>splitLHsClassTy_maybe</span> <span class='hs-varid'>ty</span>
<a name="line-36"></a>    <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>tvs</span><span class='hs-layout'>,</span> <span class='hs-varid'>cxt</span><span class='hs-layout'>,</span> <span class='hs-varid'>cls</span><span class='hs-layout'>,</span> <span class='hs-varid'>tys</span><span class='hs-layout'>)</span>
<a name="line-37"></a>
<a name="line-38"></a><a name="splitLHsForAllTy"></a><span class='hs-definition'>splitLHsForAllTy</span>
<a name="line-39"></a>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LHsType</span> <span class='hs-varid'>name</span> 
<a name="line-40"></a>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsTyVarBndrs</span> <span class='hs-varid'>name</span><span class='hs-layout'>,</span> <span class='hs-conid'>HsContext</span> <span class='hs-varid'>name</span><span class='hs-layout'>,</span> <span class='hs-conid'>LHsType</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>
<a name="line-41"></a><span class='hs-definition'>splitLHsForAllTy</span> <span class='hs-varid'>poly_ty</span>
<a name="line-42"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>unLoc</span> <span class='hs-varid'>poly_ty</span> <span class='hs-keyword'>of</span>
<a name="line-43"></a>        <span class='hs-conid'>HsParTy</span> <span class='hs-varid'>ty</span>              <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>splitLHsForAllTy</span> <span class='hs-varid'>ty</span>
<a name="line-44"></a>        <span class='hs-conid'>HsForAllTy</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>tvs</span> <span class='hs-varid'>cxt</span> <span class='hs-varid'>ty</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>tvs</span><span class='hs-layout'>,</span> <span class='hs-varid'>unLoc</span> <span class='hs-varid'>cxt</span><span class='hs-layout'>,</span> <span class='hs-varid'>ty</span><span class='hs-layout'>)</span>
<a name="line-45"></a>        <span class='hs-keyword'>_</span>                       <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>emptyHsQTvs</span><span class='hs-layout'>,</span> <span class='hs-conid'>[]</span><span class='hs-layout'>,</span> <span class='hs-varid'>poly_ty</span><span class='hs-layout'>)</span>
<a name="line-46"></a>        <span class='hs-comment'>-- The type vars should have been computed by now, even if they were implicit</span>
<a name="line-47"></a>
<a name="line-48"></a><a name="splitHsClassTy_maybe"></a><span class='hs-definition'>splitHsClassTy_maybe</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsType</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-varid'>name</span><span class='hs-layout'>,</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LHsType</span> <span class='hs-varid'>name</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-49"></a><span class='hs-definition'>splitHsClassTy_maybe</span> <span class='hs-varid'>ty</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fmap</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>n</span><span class='hs-layout'>,</span> <span class='hs-varid'>tys</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>n</span><span class='hs-layout'>,</span> <span class='hs-varid'>tys</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-varid'>splitLHsClassTy_maybe</span> <span class='hs-layout'>(</span><span class='hs-varid'>noLoc</span> <span class='hs-varid'>ty</span><span class='hs-layout'>)</span>
<a name="line-50"></a>
<a name="line-51"></a><a name="splitLHsClassTy_maybe"></a><span class='hs-definition'>splitLHsClassTy_maybe</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LHsType</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>Located</span> <span class='hs-varid'>name</span><span class='hs-layout'>,</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LHsType</span> <span class='hs-varid'>name</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-52"></a><span class='hs-comment'>--- Watch out.. in ...deriving( Show )... we use this on </span>
<a name="line-53"></a><span class='hs-comment'>--- the list of partially applied predicates in the deriving,</span>
<a name="line-54"></a><span class='hs-comment'>--- so there can be zero args.</span>
<a name="line-55"></a>
<a name="line-56"></a><span class='hs-comment'>-- In TcDeriv we also use this to figure out what data type is being</span>
<a name="line-57"></a><span class='hs-comment'>-- mentioned in a deriving (Generic (Foo bar baz)) declaration (i.e. "Foo").</span>
<a name="line-58"></a><span class='hs-definition'>splitLHsClassTy_maybe</span> <span class='hs-varid'>ty</span>
<a name="line-59"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>checkl</span> <span class='hs-varid'>ty</span> <span class='hs-conid'>[]</span>
<a name="line-60"></a>  <span class='hs-keyword'>where</span>
<a name="line-61"></a>    <span class='hs-varid'>checkl</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-varid'>l</span> <span class='hs-varid'>ty</span><span class='hs-layout'>)</span> <span class='hs-varid'>args</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>ty</span> <span class='hs-keyword'>of</span>
<a name="line-62"></a>        <span class='hs-conid'>HsTyVar</span> <span class='hs-varid'>t</span>          <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-varid'>l</span> <span class='hs-varid'>t</span><span class='hs-layout'>,</span> <span class='hs-varid'>args</span><span class='hs-layout'>)</span>
<a name="line-63"></a>        <span class='hs-conid'>HsAppTy</span> <span class='hs-varid'>l</span> <span class='hs-varid'>r</span>        <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>checkl</span> <span class='hs-varid'>l</span> <span class='hs-layout'>(</span><span class='hs-varid'>r</span><span class='hs-conop'>:</span><span class='hs-varid'>args</span><span class='hs-layout'>)</span>
<a name="line-64"></a>        <span class='hs-conid'>HsOpTy</span> <span class='hs-varid'>l</span> <span class='hs-layout'>(</span><span class='hs-keyword'>_</span><span class='hs-layout'>,</span> <span class='hs-varid'>tc</span><span class='hs-layout'>)</span> <span class='hs-varid'>r</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>checkl</span> <span class='hs-layout'>(</span><span class='hs-varid'>fmap</span> <span class='hs-conid'>HsTyVar</span> <span class='hs-varid'>tc</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>l</span><span class='hs-conop'>:</span><span class='hs-varid'>r</span><span class='hs-conop'>:</span><span class='hs-varid'>args</span><span class='hs-layout'>)</span>
<a name="line-65"></a>        <span class='hs-conid'>HsParTy</span> <span class='hs-varid'>t</span>          <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>checkl</span> <span class='hs-varid'>t</span> <span class='hs-varid'>args</span>
<a name="line-66"></a>        <span class='hs-conid'>HsKindSig</span> <span class='hs-varid'>ty</span> <span class='hs-keyword'>_</span>     <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>checkl</span> <span class='hs-varid'>ty</span> <span class='hs-varid'>args</span>
<a name="line-67"></a>        <span class='hs-keyword'>_</span>                  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Nothing</span>
<a name="line-68"></a>
<a name="line-69"></a><a name="splitHsFunType"></a><span class='hs-comment'>-- splitHsFunType decomposes a type (t1 -&gt; t2 ... -&gt; tn)</span>
<a name="line-70"></a><span class='hs-comment'>-- Breaks up any parens in the result type: </span>
<a name="line-71"></a><span class='hs-comment'>--      splitHsFunType (a -&gt; (b -&gt; c)) = ([a,b], c)</span>
<a name="line-72"></a><span class='hs-comment'>-- Also deals with (-&gt;) t1 t2; that is why it only works on LHsType Name</span>
<a name="line-73"></a><span class='hs-comment'>--   (see Trac #9096)</span>
<a name="line-74"></a><span class='hs-definition'>splitHsFunType</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LHsType</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>[</span><span class='hs-conid'>LHsType</span> <span class='hs-conid'>Name</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span> <span class='hs-conid'>LHsType</span> <span class='hs-conid'>Name</span><span class='hs-layout'>)</span>
<a name="line-75"></a><span class='hs-definition'>splitHsFunType</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsParTy</span> <span class='hs-varid'>ty</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> 
<a name="line-76"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>splitHsFunType</span> <span class='hs-varid'>ty</span>
<a name="line-77"></a>
<a name="line-78"></a><span class='hs-definition'>splitHsFunType</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsFunTy</span> <span class='hs-varid'>x</span> <span class='hs-varid'>y</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-79"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-layout'>(</span><span class='hs-varid'>args</span><span class='hs-layout'>,</span> <span class='hs-varid'>res</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>splitHsFunType</span> <span class='hs-varid'>y</span>
<a name="line-80"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span><span class='hs-conop'>:</span><span class='hs-varid'>args</span><span class='hs-layout'>,</span> <span class='hs-varid'>res</span><span class='hs-layout'>)</span>
<a name="line-81"></a>
<a name="line-82"></a><span class='hs-definition'>splitHsFunType</span> <span class='hs-varid'>orig_ty</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsAppTy</span> <span class='hs-varid'>t1</span> <span class='hs-varid'>t2</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> 
<a name="line-83"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>go</span> <span class='hs-varid'>t1</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>t2</span><span class='hs-keyglyph'>]</span>
<a name="line-84"></a>  <span class='hs-keyword'>where</span>  <span class='hs-comment'>-- Look for (-&gt;) t1 t2, possibly with parenthesisation</span>
<a name="line-85"></a>    <span class='hs-varid'>go</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsTyVar</span> <span class='hs-varid'>fn</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>    <span class='hs-varid'>tys</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>fn</span> <span class='hs-varop'>==</span> <span class='hs-varid'>funTyConName</span>
<a name="line-86"></a>                                 <span class='hs-layout'>,</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>t1</span><span class='hs-layout'>,</span><span class='hs-varid'>t2</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>tys</span>
<a name="line-87"></a>                                 <span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-varid'>args</span><span class='hs-layout'>,</span> <span class='hs-varid'>res</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>splitHsFunType</span> <span class='hs-varid'>t2</span>
<a name="line-88"></a>                                 <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>t1</span><span class='hs-conop'>:</span><span class='hs-varid'>args</span><span class='hs-layout'>,</span> <span class='hs-varid'>res</span><span class='hs-layout'>)</span>
<a name="line-89"></a>    <span class='hs-varid'>go</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsAppTy</span> <span class='hs-varid'>t1</span> <span class='hs-varid'>t2</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varid'>tys</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>go</span> <span class='hs-varid'>t1</span> <span class='hs-layout'>(</span><span class='hs-varid'>t2</span><span class='hs-conop'>:</span><span class='hs-varid'>tys</span><span class='hs-layout'>)</span>
<a name="line-90"></a>    <span class='hs-varid'>go</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsParTy</span> <span class='hs-varid'>ty</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>    <span class='hs-varid'>tys</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>go</span> <span class='hs-varid'>ty</span> <span class='hs-varid'>tys</span>
<a name="line-91"></a>    <span class='hs-varid'>go</span> <span class='hs-keyword'>_</span>                     <span class='hs-keyword'>_</span>   <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-conid'>[]</span><span class='hs-layout'>,</span> <span class='hs-varid'>orig_ty</span><span class='hs-layout'>)</span>  <span class='hs-comment'>-- Failure to match</span>
<a name="line-92"></a>
<a name="line-93"></a><span class='hs-definition'>splitHsFunType</span> <span class='hs-varid'>other</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-conid'>[]</span><span class='hs-layout'>,</span> <span class='hs-varid'>other</span><span class='hs-layout'>)</span>
</pre>\end{code}


%************************************************************************
%*                                                                      *
\subsection{Pretty printing}
%*                                                                      *
%************************************************************************

\begin{code}
<pre><a name="line-1"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Outputable</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsType</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-2"></a>    <span class='hs-varid'>ppr</span> <span class='hs-varid'>ty</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprHsType</span> <span class='hs-varid'>ty</span>
<a name="line-3"></a>
<a name="line-4"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Outputable</span> <span class='hs-conid'>HsTyLit</span> <span class='hs-keyword'>where</span>
<a name="line-5"></a>    <span class='hs-varid'>ppr</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr_tylit</span>
<a name="line-6"></a>
<a name="line-7"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Outputable</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsTyVarBndrs</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-8"></a>    <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsQTvs</span> <span class='hs-layout'>{</span> <span class='hs-varid'>hsq_kvs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>kvs</span><span class='hs-layout'>,</span> <span class='hs-varid'>hsq_tvs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tvs</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span> 
<a name="line-9"></a>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>ifPprDebug</span> <span class='hs-varop'>$</span> <span class='hs-varid'>braces</span> <span class='hs-layout'>(</span><span class='hs-varid'>interppSP</span> <span class='hs-varid'>kvs</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>interppSP</span> <span class='hs-varid'>tvs</span> <span class='hs-keyglyph'>]</span>
<a name="line-10"></a>
<a name="line-11"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Outputable</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsTyVarBndr</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-12"></a>    <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>UserTyVar</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>n</span>
<a name="line-13"></a>    <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>KindedTyVar</span> <span class='hs-varid'>n</span> <span class='hs-varid'>k</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>parens</span> <span class='hs-varop'>$</span> <span class='hs-varid'>hsep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>n</span><span class='hs-layout'>,</span> <span class='hs-varid'>dcolon</span><span class='hs-layout'>,</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>k</span><span class='hs-keyglyph'>]</span>
<a name="line-14"></a>
<a name="line-15"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>Outputable</span> <span class='hs-varid'>thing</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Outputable</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsWithBndrs</span> <span class='hs-varid'>thing</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-16"></a>    <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsWB</span> <span class='hs-layout'>{</span> <span class='hs-varid'>hswb_cts</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ty</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>ty</span>
<a name="line-17"></a>
<a name="line-18"></a><a name="pprHsForAll"></a><span class='hs-definition'>pprHsForAll</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HsExplicitFlag</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsTyVarBndrs</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>-&gt;</span>  <span class='hs-conid'>LHsContext</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-19"></a><span class='hs-definition'>pprHsForAll</span> <span class='hs-varid'>exp</span> <span class='hs-varid'>qtvs</span> <span class='hs-varid'>cxt</span> 
<a name="line-20"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>show_forall</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>forall_part</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>pprHsContext</span> <span class='hs-layout'>(</span><span class='hs-varid'>unLoc</span> <span class='hs-varid'>cxt</span><span class='hs-layout'>)</span>
<a name="line-21"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprHsContext</span> <span class='hs-layout'>(</span><span class='hs-varid'>unLoc</span> <span class='hs-varid'>cxt</span><span class='hs-layout'>)</span>
<a name="line-22"></a>  <span class='hs-keyword'>where</span>
<a name="line-23"></a>    <span class='hs-varid'>show_forall</span> <span class='hs-keyglyph'>=</span>  <span class='hs-varid'>opt_PprStyle_Debug</span>
<a name="line-24"></a>                <span class='hs-varop'>||</span> <span class='hs-layout'>(</span><span class='hs-varid'>not</span> <span class='hs-layout'>(</span><span class='hs-varid'>null</span> <span class='hs-layout'>(</span><span class='hs-varid'>hsQTvBndrs</span> <span class='hs-varid'>qtvs</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varop'>&amp;&amp;</span> <span class='hs-varid'>is_explicit</span><span class='hs-layout'>)</span>
<a name="line-25"></a>    <span class='hs-varid'>is_explicit</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>exp</span> <span class='hs-keyword'>of</span> <span class='hs-layout'>{</span><span class='hs-conid'>Explicit</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>True</span><span class='hs-layout'>;</span> <span class='hs-conid'>Implicit</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>False</span><span class='hs-layout'>}</span>
<a name="line-26"></a>    <span class='hs-varid'>forall_part</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"forall"</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>qtvs</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>dot</span>
<a name="line-27"></a>
<a name="line-28"></a><a name="pprHsContext"></a><span class='hs-definition'>pprHsContext</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HsContext</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-29"></a><span class='hs-definition'>pprHsContext</span> <span class='hs-conid'>[]</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>empty</span>
<a name="line-30"></a><span class='hs-definition'>pprHsContext</span> <span class='hs-varid'>cxt</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprHsContextNoArrow</span> <span class='hs-varid'>cxt</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>darrow</span>
<a name="line-31"></a>
<a name="line-32"></a><a name="pprHsContextNoArrow"></a><span class='hs-definition'>pprHsContextNoArrow</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HsContext</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-33"></a><span class='hs-definition'>pprHsContextNoArrow</span> <span class='hs-conid'>[]</span>         <span class='hs-keyglyph'>=</span> <span class='hs-varid'>empty</span>
<a name="line-34"></a><span class='hs-definition'>pprHsContextNoArrow</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>pred</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>pred</span>
<a name="line-35"></a><span class='hs-definition'>pprHsContextNoArrow</span> <span class='hs-varid'>cxt</span>        <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr_hs_context</span> <span class='hs-varid'>cxt</span>
<a name="line-36"></a>
<a name="line-37"></a><a name="ppr_hs_context"></a><span class='hs-definition'>ppr_hs_context</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HsContext</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-38"></a><span class='hs-definition'>ppr_hs_context</span> <span class='hs-conid'>[]</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>empty</span>
<a name="line-39"></a><span class='hs-definition'>ppr_hs_context</span> <span class='hs-varid'>cxt</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>parens</span> <span class='hs-layout'>(</span><span class='hs-varid'>interpp'SP</span> <span class='hs-varid'>cxt</span><span class='hs-layout'>)</span>
<a name="line-40"></a>
<a name="line-41"></a><a name="pprConDeclFields"></a><span class='hs-definition'>pprConDeclFields</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>ConDeclField</span> <span class='hs-varid'>name</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-42"></a><span class='hs-definition'>pprConDeclFields</span> <span class='hs-varid'>fields</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>braces</span> <span class='hs-layout'>(</span><span class='hs-varid'>sep</span> <span class='hs-layout'>(</span><span class='hs-varid'>punctuate</span> <span class='hs-varid'>comma</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-varid'>ppr_fld</span> <span class='hs-varid'>fields</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-43"></a>  <span class='hs-keyword'>where</span>
<a name="line-44"></a>    <span class='hs-varid'>ppr_fld</span> <span class='hs-layout'>(</span><span class='hs-conid'>ConDeclField</span> <span class='hs-layout'>{</span> <span class='hs-varid'>cd_fld_name</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>n</span><span class='hs-layout'>,</span> <span class='hs-varid'>cd_fld_type</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ty</span><span class='hs-layout'>,</span> 
<a name="line-45"></a>                            <span class='hs-varid'>cd_fld_doc</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>doc</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-46"></a>        <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>n</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>dcolon</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>ty</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr_mbDoc</span> <span class='hs-varid'>doc</span>
</pre>\end{code}

Note [Printing KindedTyVars]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Trac #3830 reminded me that we should really only print the kind
signature on a KindedTyVar if the kind signature was put there by the
programmer.  During kind inference GHC now adds a PostTcKind to UserTyVars,
rather than converting to KindedTyVars as before.

(As it happens, the message in #3830 comes out a different way now,
and the problem doesn't show up; but having the flag on a KindedTyVar
seems like the Right Thing anyway.)

\begin{code}
<pre><a name="line-1"></a><a name="pREC_TOP"></a><span class='hs-definition'>pREC_TOP</span><span class='hs-layout'>,</span> <span class='hs-varid'>pREC_FUN</span><span class='hs-layout'>,</span> <span class='hs-varid'>pREC_OP</span><span class='hs-layout'>,</span> <span class='hs-varid'>pREC_CON</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span>
<a name="line-2"></a><span class='hs-definition'>pREC_TOP</span> <span class='hs-keyglyph'>=</span> <span class='hs-num'>0</span>  <span class='hs-comment'>-- type   in ParseIface.y</span>
<a name="line-3"></a><a name="pREC_FUN"></a><span class='hs-definition'>pREC_FUN</span> <span class='hs-keyglyph'>=</span> <span class='hs-num'>1</span>  <span class='hs-comment'>-- btype  in ParseIface.y</span>
<a name="line-4"></a>              <span class='hs-comment'>-- Used for LH arg of (-&gt;)</span>
<a name="line-5"></a><a name="pREC_OP"></a><span class='hs-definition'>pREC_OP</span>  <span class='hs-keyglyph'>=</span> <span class='hs-num'>2</span>  <span class='hs-comment'>-- Used for arg of any infix operator</span>
<a name="line-6"></a>              <span class='hs-comment'>-- (we don't keep their fixities around)</span>
<a name="line-7"></a><a name="pREC_CON"></a><span class='hs-definition'>pREC_CON</span> <span class='hs-keyglyph'>=</span> <span class='hs-num'>3</span>  <span class='hs-comment'>-- Used for arg of type applicn:</span>
<a name="line-8"></a>              <span class='hs-comment'>-- always parenthesise unless atomic</span>
<a name="line-9"></a>
<a name="line-10"></a><a name="maybeParen"></a><span class='hs-definition'>maybeParen</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span>       <span class='hs-comment'>-- Precedence of context</span>
<a name="line-11"></a>           <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span>       <span class='hs-comment'>-- Precedence of top-level operator</span>
<a name="line-12"></a>           <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>      <span class='hs-comment'>-- Wrap in parens if (ctxt &gt;= op)</span>
<a name="line-13"></a><span class='hs-definition'>maybeParen</span> <span class='hs-varid'>ctxt_prec</span> <span class='hs-varid'>op_prec</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>ctxt_prec</span> <span class='hs-varop'>&gt;=</span> <span class='hs-varid'>op_prec</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>parens</span> <span class='hs-varid'>p</span>
<a name="line-14"></a>                               <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>            <span class='hs-keyglyph'>=</span> <span class='hs-varid'>p</span>
<a name="line-15"></a>        
<a name="line-16"></a><span class='hs-comment'>-- printing works more-or-less as for Types</span>
<a name="line-17"></a>
<a name="line-18"></a><a name="pprHsType"></a><span class='hs-definition'>pprHsType</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprParendHsType</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HsType</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-19"></a>
<a name="line-20"></a><span class='hs-definition'>pprHsType</span> <span class='hs-varid'>ty</span>       <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getPprStyle</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>sty</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>ppr_mono_ty</span> <span class='hs-varid'>pREC_TOP</span> <span class='hs-layout'>(</span><span class='hs-varid'>prepare</span> <span class='hs-varid'>sty</span> <span class='hs-varid'>ty</span><span class='hs-layout'>)</span>
<a name="line-21"></a><a name="pprParendHsType"></a><span class='hs-definition'>pprParendHsType</span> <span class='hs-varid'>ty</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr_mono_ty</span> <span class='hs-varid'>pREC_CON</span> <span class='hs-varid'>ty</span>
<a name="line-22"></a>
<a name="line-23"></a><a name="prepare"></a><span class='hs-comment'>-- Before printing a type</span>
<a name="line-24"></a><span class='hs-comment'>-- (a) Remove outermost HsParTy parens</span>
<a name="line-25"></a><span class='hs-comment'>-- (b) Drop top-level for-all type variables in user style</span>
<a name="line-26"></a><span class='hs-comment'>--     since they are implicit in Haskell</span>
<a name="line-27"></a><span class='hs-definition'>prepare</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>PprStyle</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HsType</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HsType</span> <span class='hs-varid'>name</span>
<a name="line-28"></a><span class='hs-definition'>prepare</span> <span class='hs-varid'>sty</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsParTy</span> <span class='hs-varid'>ty</span><span class='hs-layout'>)</span>          <span class='hs-keyglyph'>=</span> <span class='hs-varid'>prepare</span> <span class='hs-varid'>sty</span> <span class='hs-layout'>(</span><span class='hs-varid'>unLoc</span> <span class='hs-varid'>ty</span><span class='hs-layout'>)</span>
<a name="line-29"></a><span class='hs-definition'>prepare</span> <span class='hs-keyword'>_</span>   <span class='hs-varid'>ty</span>                    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ty</span>
<a name="line-30"></a>
<a name="line-31"></a><a name="ppr_mono_lty"></a><span class='hs-definition'>ppr_mono_lty</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsType</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-32"></a><span class='hs-definition'>ppr_mono_lty</span> <span class='hs-varid'>ctxt_prec</span> <span class='hs-varid'>ty</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr_mono_ty</span> <span class='hs-varid'>ctxt_prec</span> <span class='hs-layout'>(</span><span class='hs-varid'>unLoc</span> <span class='hs-varid'>ty</span><span class='hs-layout'>)</span>
<a name="line-33"></a>
<a name="line-34"></a><a name="ppr_mono_ty"></a><span class='hs-definition'>ppr_mono_ty</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HsType</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-35"></a><span class='hs-definition'>ppr_mono_ty</span> <span class='hs-varid'>ctxt_prec</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsForAllTy</span> <span class='hs-varid'>exp</span> <span class='hs-varid'>tvs</span> <span class='hs-varid'>ctxt</span> <span class='hs-varid'>ty</span><span class='hs-layout'>)</span>
<a name="line-36"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>maybeParen</span> <span class='hs-varid'>ctxt_prec</span> <span class='hs-varid'>pREC_FUN</span> <span class='hs-varop'>$</span>
<a name="line-37"></a>    <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>pprHsForAll</span> <span class='hs-varid'>exp</span> <span class='hs-varid'>tvs</span> <span class='hs-varid'>ctxt</span><span class='hs-layout'>,</span> <span class='hs-varid'>ppr_mono_lty</span> <span class='hs-varid'>pREC_TOP</span> <span class='hs-varid'>ty</span><span class='hs-keyglyph'>]</span>
<a name="line-38"></a>
<a name="line-39"></a><span class='hs-definition'>ppr_mono_ty</span> <span class='hs-keyword'>_</span>    <span class='hs-layout'>(</span><span class='hs-conid'>HsBangTy</span> <span class='hs-varid'>b</span> <span class='hs-varid'>ty</span><span class='hs-layout'>)</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>b</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>ppr_mono_lty</span> <span class='hs-varid'>pREC_CON</span> <span class='hs-varid'>ty</span>
<a name="line-40"></a><span class='hs-definition'>ppr_mono_ty</span> <span class='hs-keyword'>_</span>    <span class='hs-layout'>(</span><span class='hs-conid'>HsQuasiQuoteTy</span> <span class='hs-varid'>qq</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>qq</span>
<a name="line-41"></a><span class='hs-definition'>ppr_mono_ty</span> <span class='hs-keyword'>_</span>    <span class='hs-layout'>(</span><span class='hs-conid'>HsRecTy</span> <span class='hs-varid'>flds</span><span class='hs-layout'>)</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprConDeclFields</span> <span class='hs-varid'>flds</span>
<a name="line-42"></a><span class='hs-definition'>ppr_mono_ty</span> <span class='hs-keyword'>_</span>    <span class='hs-layout'>(</span><span class='hs-conid'>HsTyVar</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprPrefixOcc</span> <span class='hs-varid'>name</span>
<a name="line-43"></a><span class='hs-definition'>ppr_mono_ty</span> <span class='hs-varid'>prec</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsFunTy</span> <span class='hs-varid'>ty1</span> <span class='hs-varid'>ty2</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr_fun_ty</span> <span class='hs-varid'>prec</span> <span class='hs-varid'>ty1</span> <span class='hs-varid'>ty2</span>
<a name="line-44"></a><span class='hs-definition'>ppr_mono_ty</span> <span class='hs-keyword'>_</span>    <span class='hs-layout'>(</span><span class='hs-conid'>HsTupleTy</span> <span class='hs-varid'>con</span> <span class='hs-varid'>tys</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tupleParens</span> <span class='hs-varid'>std_con</span> <span class='hs-layout'>(</span><span class='hs-varid'>interpp'SP</span> <span class='hs-varid'>tys</span><span class='hs-layout'>)</span>
<a name="line-45"></a>  <span class='hs-keyword'>where</span> <span class='hs-varid'>std_con</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>con</span> <span class='hs-keyword'>of</span>
<a name="line-46"></a>                    <span class='hs-conid'>HsUnboxedTuple</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>UnboxedTuple</span>
<a name="line-47"></a>                    <span class='hs-keyword'>_</span>              <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>BoxedTuple</span>
<a name="line-48"></a><span class='hs-definition'>ppr_mono_ty</span> <span class='hs-keyword'>_</span>    <span class='hs-layout'>(</span><span class='hs-conid'>HsKindSig</span> <span class='hs-varid'>ty</span> <span class='hs-varid'>kind</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>parens</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr_mono_lty</span> <span class='hs-varid'>pREC_TOP</span> <span class='hs-varid'>ty</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>dcolon</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>kind</span><span class='hs-layout'>)</span>
<a name="line-49"></a><span class='hs-definition'>ppr_mono_ty</span> <span class='hs-keyword'>_</span>    <span class='hs-layout'>(</span><span class='hs-conid'>HsListTy</span> <span class='hs-varid'>ty</span><span class='hs-layout'>)</span>       <span class='hs-keyglyph'>=</span> <span class='hs-varid'>brackets</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr_mono_lty</span> <span class='hs-varid'>pREC_TOP</span> <span class='hs-varid'>ty</span><span class='hs-layout'>)</span>
<a name="line-50"></a><span class='hs-definition'>ppr_mono_ty</span> <span class='hs-keyword'>_</span>    <span class='hs-layout'>(</span><span class='hs-conid'>HsPArrTy</span> <span class='hs-varid'>ty</span><span class='hs-layout'>)</span>       <span class='hs-keyglyph'>=</span> <span class='hs-varid'>paBrackets</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr_mono_lty</span> <span class='hs-varid'>pREC_TOP</span> <span class='hs-varid'>ty</span><span class='hs-layout'>)</span>
<a name="line-51"></a><span class='hs-definition'>ppr_mono_ty</span> <span class='hs-varid'>prec</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsIParamTy</span> <span class='hs-varid'>n</span> <span class='hs-varid'>ty</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>maybeParen</span> <span class='hs-varid'>prec</span> <span class='hs-varid'>pREC_FUN</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>n</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>dcolon</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr_mono_lty</span> <span class='hs-varid'>pREC_TOP</span> <span class='hs-varid'>ty</span><span class='hs-layout'>)</span>
<a name="line-52"></a><span class='hs-definition'>ppr_mono_ty</span> <span class='hs-keyword'>_</span>    <span class='hs-layout'>(</span><span class='hs-conid'>HsSpliceTy</span> <span class='hs-varid'>s</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprUntypedSplice</span> <span class='hs-varid'>s</span>
<a name="line-53"></a><span class='hs-definition'>ppr_mono_ty</span> <span class='hs-keyword'>_</span>    <span class='hs-layout'>(</span><span class='hs-conid'>HsCoreTy</span> <span class='hs-varid'>ty</span><span class='hs-layout'>)</span>       <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>ty</span>
<a name="line-54"></a><span class='hs-definition'>ppr_mono_ty</span> <span class='hs-keyword'>_</span>    <span class='hs-layout'>(</span><span class='hs-conid'>HsExplicitListTy</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>tys</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>quote</span> <span class='hs-varop'>$</span> <span class='hs-varid'>brackets</span> <span class='hs-layout'>(</span><span class='hs-varid'>interpp'SP</span> <span class='hs-varid'>tys</span><span class='hs-layout'>)</span>
<a name="line-55"></a><span class='hs-definition'>ppr_mono_ty</span> <span class='hs-keyword'>_</span>    <span class='hs-layout'>(</span><span class='hs-conid'>HsExplicitTupleTy</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>tys</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>quote</span> <span class='hs-varop'>$</span> <span class='hs-varid'>parens</span> <span class='hs-layout'>(</span><span class='hs-varid'>interpp'SP</span> <span class='hs-varid'>tys</span><span class='hs-layout'>)</span>
<a name="line-56"></a><span class='hs-definition'>ppr_mono_ty</span> <span class='hs-keyword'>_</span>    <span class='hs-layout'>(</span><span class='hs-conid'>HsTyLit</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span>         <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr_tylit</span> <span class='hs-varid'>t</span>
<a name="line-57"></a>
<a name="line-58"></a><span class='hs-definition'>ppr_mono_ty</span> <span class='hs-varid'>ctxt_prec</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsWrapTy</span> <span class='hs-layout'>(</span><span class='hs-conid'>WpKiApps</span> <span class='hs-sel'>_kis</span><span class='hs-layout'>)</span> <span class='hs-varid'>ty</span><span class='hs-layout'>)</span>
<a name="line-59"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr_mono_ty</span> <span class='hs-varid'>ctxt_prec</span> <span class='hs-varid'>ty</span>
<a name="line-60"></a><span class='hs-comment'>-- We are not printing kind applications. If we wanted to do so, we should do</span>
<a name="line-61"></a><span class='hs-comment'>-- something like this:</span>
<a name="line-62"></a><span class='hs-comment'>{-
<a name="line-63"></a>  = go ctxt_prec kis ty
<a name="line-64"></a>  where
<a name="line-65"></a>    go ctxt_prec [] ty = ppr_mono_ty ctxt_prec ty
<a name="line-66"></a>    go ctxt_prec (ki:kis) ty
<a name="line-67"></a>      = maybeParen ctxt_prec pREC_CON $
<a name="line-68"></a>        hsep [ go pREC_FUN kis ty
<a name="line-69"></a>             , ptext (sLit "@") &lt;&gt; pprParendKind ki ]
<a name="line-70"></a>-}</span>
<a name="line-71"></a>
<a name="line-72"></a><span class='hs-definition'>ppr_mono_ty</span> <span class='hs-varid'>ctxt_prec</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsEqTy</span> <span class='hs-varid'>ty1</span> <span class='hs-varid'>ty2</span><span class='hs-layout'>)</span>
<a name="line-73"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>maybeParen</span> <span class='hs-varid'>ctxt_prec</span> <span class='hs-varid'>pREC_OP</span> <span class='hs-varop'>$</span>
<a name="line-74"></a>    <span class='hs-varid'>ppr_mono_lty</span> <span class='hs-varid'>pREC_OP</span> <span class='hs-varid'>ty1</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'~'</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr_mono_lty</span> <span class='hs-varid'>pREC_OP</span> <span class='hs-varid'>ty2</span>
<a name="line-75"></a>
<a name="line-76"></a><span class='hs-definition'>ppr_mono_ty</span> <span class='hs-varid'>ctxt_prec</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsAppTy</span> <span class='hs-varid'>fun_ty</span> <span class='hs-varid'>arg_ty</span><span class='hs-layout'>)</span>
<a name="line-77"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>maybeParen</span> <span class='hs-varid'>ctxt_prec</span> <span class='hs-varid'>pREC_CON</span> <span class='hs-varop'>$</span>
<a name="line-78"></a>    <span class='hs-varid'>hsep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>ppr_mono_lty</span> <span class='hs-varid'>pREC_FUN</span> <span class='hs-varid'>fun_ty</span><span class='hs-layout'>,</span> <span class='hs-varid'>ppr_mono_lty</span> <span class='hs-varid'>pREC_CON</span> <span class='hs-varid'>arg_ty</span><span class='hs-keyglyph'>]</span>
<a name="line-79"></a>
<a name="line-80"></a><span class='hs-definition'>ppr_mono_ty</span> <span class='hs-varid'>ctxt_prec</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsOpTy</span> <span class='hs-varid'>ty1</span> <span class='hs-layout'>(</span><span class='hs-sel'>_wrapper</span><span class='hs-layout'>,</span> <span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>op</span><span class='hs-layout'>)</span> <span class='hs-varid'>ty2</span><span class='hs-layout'>)</span>
<a name="line-81"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>maybeParen</span> <span class='hs-varid'>ctxt_prec</span> <span class='hs-varid'>pREC_OP</span> <span class='hs-varop'>$</span>
<a name="line-82"></a>    <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>ppr_mono_lty</span> <span class='hs-varid'>pREC_OP</span> <span class='hs-varid'>ty1</span>
<a name="line-83"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>pprInfixOcc</span> <span class='hs-varid'>op</span><span class='hs-layout'>,</span> <span class='hs-varid'>ppr_mono_lty</span> <span class='hs-varid'>pREC_OP</span> <span class='hs-varid'>ty2</span> <span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>]</span>
<a name="line-84"></a>    <span class='hs-comment'>-- Don't print the wrapper (= kind applications)</span>
<a name="line-85"></a>    <span class='hs-comment'>-- c.f. HsWrapTy</span>
<a name="line-86"></a>
<a name="line-87"></a><span class='hs-definition'>ppr_mono_ty</span> <span class='hs-keyword'>_</span>         <span class='hs-layout'>(</span><span class='hs-conid'>HsParTy</span> <span class='hs-varid'>ty</span><span class='hs-layout'>)</span>
<a name="line-88"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>parens</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr_mono_lty</span> <span class='hs-varid'>pREC_TOP</span> <span class='hs-varid'>ty</span><span class='hs-layout'>)</span>
<a name="line-89"></a>  <span class='hs-comment'>-- Put the parens in where the user did</span>
<a name="line-90"></a>  <span class='hs-comment'>-- But we still use the precedence stuff to add parens because</span>
<a name="line-91"></a>  <span class='hs-comment'>--    toHsType doesn't put in any HsParTys, so we may still need them</span>
<a name="line-92"></a>
<a name="line-93"></a><span class='hs-definition'>ppr_mono_ty</span> <span class='hs-varid'>ctxt_prec</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsDocTy</span> <span class='hs-varid'>ty</span> <span class='hs-varid'>doc</span><span class='hs-layout'>)</span> 
<a name="line-94"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>maybeParen</span> <span class='hs-varid'>ctxt_prec</span> <span class='hs-varid'>pREC_OP</span> <span class='hs-varop'>$</span>
<a name="line-95"></a>    <span class='hs-varid'>ppr_mono_lty</span> <span class='hs-varid'>pREC_OP</span> <span class='hs-varid'>ty</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-varid'>unLoc</span> <span class='hs-varid'>doc</span><span class='hs-layout'>)</span>
<a name="line-96"></a>  <span class='hs-comment'>-- we pretty print Haddock comments on types as if they were</span>
<a name="line-97"></a>  <span class='hs-comment'>-- postfix operators</span>
<a name="line-98"></a>
<a name="line-99"></a><a name="ppr_fun_ty"></a><span class='hs-comment'>--------------------------</span>
<a name="line-100"></a><span class='hs-definition'>ppr_fun_ty</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsType</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsType</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-101"></a><span class='hs-definition'>ppr_fun_ty</span> <span class='hs-varid'>ctxt_prec</span> <span class='hs-varid'>ty1</span> <span class='hs-varid'>ty2</span>
<a name="line-102"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>let</span> <span class='hs-varid'>p1</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr_mono_lty</span> <span class='hs-varid'>pREC_FUN</span> <span class='hs-varid'>ty1</span>
<a name="line-103"></a>        <span class='hs-varid'>p2</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr_mono_lty</span> <span class='hs-varid'>pREC_TOP</span> <span class='hs-varid'>ty2</span>
<a name="line-104"></a>    <span class='hs-keyword'>in</span>
<a name="line-105"></a>    <span class='hs-varid'>maybeParen</span> <span class='hs-varid'>ctxt_prec</span> <span class='hs-varid'>pREC_FUN</span> <span class='hs-varop'>$</span>
<a name="line-106"></a>    <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>p1</span><span class='hs-layout'>,</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"-&gt;"</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>p2</span><span class='hs-keyglyph'>]</span>
<a name="line-107"></a>
<a name="line-108"></a><a name="ppr_tylit"></a><span class='hs-comment'>--------------------------</span>
<a name="line-109"></a><span class='hs-definition'>ppr_tylit</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsTyLit</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-110"></a><span class='hs-definition'>ppr_tylit</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsNumTy</span> <span class='hs-varid'>i</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>integer</span> <span class='hs-varid'>i</span>
<a name="line-111"></a><span class='hs-definition'>ppr_tylit</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsStrTy</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-layout'>(</span><span class='hs-varid'>show</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span>
</pre>\end{code}


</body>
</html>
